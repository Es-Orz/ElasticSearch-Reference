# Index API
Index API 可以添加或更新一个json类型的文档到一个指定的索引中，使它可以被搜索。下面的粟子，是插入了一个josn数据到"twitter"索引中，并且它的类型是"tweet":

```sh
curl -XPUT 'localhost:9200/twitter/tweet/1?pretty' -H 'Content-Type: application/json' -d'
{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}
'
#响应
{
    "_shards" : {
        "total" : 2,
        "failed" : 0,
        "successful" : 2
    },
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 1,
    "created" : true,
    "result" : created
}
```

对响应内的说明：

shards部分说明了建立索引操作中的全部分片信息

* total   
 在建立索引的过程中总共有多少个分片(包括主分片和复制分片)应该执行
* faild  
 建立索引过程中，失败的分片数
* successful  
建立索引过程上，成功的分片数

执行成功的定义successful不为0

# 自动索引创建
如果尚未创建索引，建立索引操作会自动创建一个索引（查看[创建索引API]()以手动创建索引），如果尚未创建类型，也会为指定类型，自动创建动态类型映射（查看[put mapping API]()手动创建类型映射）。

映射本身非常灵活，无模式。新的字段和对象将自动添加到指定类型的映射定义中。查看[映射部分]()了解映射定义的更多信息。

**通过在所有节点的配置文件中将action.auto_create_index设置为false，可以禁用索引自动创建。**

**通过将index.mapper.dynamic设置为false\可以禁用映射自动创建。**

自动索引创建可以包括基于模式的白/黑名单，例如设置 action.auto_create_index为+aaa*， -bbb*，+ccc*， -*（+意思是允许的，而-意思是不允许的）。

# 版本控制
每个索引文档都有一个版本号。 关联的版本号作为对索引API请求的响应的一部分返回。 当指定版本参数时，索引API可选地允许进行[乐观并发控制]()。 这将控制操作执行的文档的版本。 版本控制用例的一个很好的例子就是执行一个事务性的read-then-update。 从初始读取的文档中指定一个版本可确保在此期间没有发生变化（阅读时为了更新，建议将首选项设置为_primary）。 例如：

```sh
curl -XPUT 'localhost:9200/twitter/tweet/1?version=2&pretty' -H 'Content-Type: application/json' -d'
{
    "message" : "elasticsearch now has versioning support, double cool!"
}
'
```
注：版本控制是完全实时的，不受搜索操作的近实时方面的影响。如果没有提供版本，则操作在没有任何版本检查的情况下执行。

默认情况下，使用内部版本控制，从1开始，每增加一个更新，包括删除。可选地，版本号可以用外部值补充（例如，如果保存在数据库中）。要启用此功能，version_type应设置为外部。提供的值必须是数字，长整数值大于或等于0，小于大约9.2e + 18。当使用外部版本类型时，系统将检查传递给索引请求的版本号是否大于当前存储的文档的版本，而不是检查匹配的版本号。如果为true，则将文档编入索引并使用新的版本号。如果提供的值小于或等于存储文档的版本号，则会发生版本冲突，索引操作将失败。

> ### 警告
> 外部版本支持的值0作为一个有效的版本号。这允许版本与外部同步版本控制系统版本号从0开始,而不是一个地方。它有副作用,文档版本号等于零不能使用Update-By-Query API和使用Delete删除查询API,只要他们的版本号等于零。

# 版本类型
除上面解释的内部（internal）和外部(external)版本类型外，Elasticsearch还支持其他类型的特定用例。以下是不同版本类型及其语义的概述。

* **internal**  
如果给定版本与存储文档的版本相同，则只索引文档。
* **external或external\_gt**  
如果给定的版本严格高于存储的文档的版本或者没有存在的文档，则只索引文档。给定的版本将被用作新版本，并将与新文档一起存储。提供的版本必须是非负数的长整数。
* **external\_gte**  
如果给定版本等于或高于存储文档的版本，则只索引文档。如果没有现有的文件，操作也会成功。给定的版本将被用作新版本，并将与新文档一起存储。提供的版本必须是非负数的长整数。

注意：external\_gte版本类型是为特殊用途而设计的，应谨慎使用。如果使用不当，可能会导致数据丢失。还有另一个选项force，由于可能会导致主分片和副本分片分歧，因此不推荐使用。

