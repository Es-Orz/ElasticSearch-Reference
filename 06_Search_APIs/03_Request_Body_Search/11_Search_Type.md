## 查询类型 Search Type

执行分布式搜索时可以执行不同的执行路径。分布式搜索操作需要分散到所有相关的分片，然后收集所有的结果。在执行分散/聚集类型的操作时，有几种方法可以做到这一点，特别是在搜索引擎中。

执行分布式搜索时的一个问题是从每个分片中检索多少结果。例如，如果我们有10个分片，第1个分片可能会保持从0到10的最相关的结果，其他分片结果排在其下面。因此，在执行请求时，我们需要从所有分片中得到0到10的结果，对它们进行排序，然后返回结果，以确保结果正确。

另一个与搜索引擎相关的问题是每个分片都是独立的。在特定分片上执行查询时，不会考虑其他分片中的词频和其他搜索引擎信息。如果我们要支持准确的排名，我们需要首先从所有分片收集术语频率以计算全局词频，然后使用这些全局频率在每个分片上执行查询。

另外，由于需要对结果进行排序，在保持正确的排序行为的同时取回大文档集，甚至滚动它，可能是非常昂贵的操作。对于较大的结果集滚动，如果返回文档的顺序不重要，最好按`_doc`排序。

Elasticsearch非常灵活，可以控制**每个搜索请求**执行的搜索类型。可以通过在查询字符串中设置**search_type** 参数来配置类型。类型是：

### 查询然后获取 Query Then Fetch

参数值: **query_then_fetch**.

该请求分两个阶段处理。 在第一阶段，查询被转发到**所有涉及的分片**。 每个分片都执行搜索，并生成结果的排序列表，该分片在本地。 每个分片向协调节点返回**正好足够的信息**，以允许它合并，并将分片级结果重新排序为全局排序的结果集，最大长度为`size`。

在第二阶段，协调节点请求来自**的文档内容（以及高亮显示的片段，如果有的话）只有相关的分片**。

在第二阶段，协调节点请求来自的文档内容（以及高亮显示的片段，如果有的话）来自**相关的分片**的查询结果。

![Note](/images/icons/note.png)

这是默认设置，如果你没有在你的请求中指定`search_type`。

###Dfs，查询然后获取

参数值 **dfs_query_then_fetch**.

与`查询然后获取`相同，除了最初的分散阶段，它计算分布式词条频率以获得更准确的评分。
