## 5.0.0-alpha1 Release Notes (Changes previously released in 2.x)

The changes listed below were first released in the 2.x series. Changes released for the first time in Elasticsearch 5.0.0-alpha1 are listed in [_5.0.0-alpha1 Release Notes_](release-notes-5.0.0-alpha1.html).

### Breaking changes

Index APIs 
    

  * Change Field stats API response to include both number and string based min and max values [<1>4674](https://github.com/elastic/elasticsearch/pull/14674) (issue: [<1>4404](https://github.com/elastic/elasticsearch/issues/14404)) 
  * Add Force Merge API, deprecate Optimize API [<1>3778](https://github.com/elastic/elasticsearch/pull/13778)



Internal 
    

  * Forbid changing thread pool types [<1>4367](https://github.com/elastic/elasticsearch/pull/14367) (issues: [<1>4294](https://github.com/elastic/elasticsearch/issues/14294), [<2>509](https://github.com/elastic/elasticsearch/issues/2509), [<2>858](https://github.com/elastic/elasticsearch/issues/2858), [<5>152](https://github.com/elastic/elasticsearch/issues/5152)) 



Logging 
    

  * Log cluster health status changes [<1>4557](https://github.com/elastic/elasticsearch/pull/14557) (issue: [<1>1657](https://github.com/elastic/elasticsearch/issues/11657)) 



Mapping 
    

  * Add per-index setting to limit number of nested fields [<1>5989](https://github.com/elastic/elasticsearch/pull/15989) (issue: [<1>4983](https://github.com/elastic/elasticsearch/issues/14983)) 



Nested Docs 
    

  * If sorting by nested field then the `nested_path` should always be specified [<1>3429](https://github.com/elastic/elasticsearch/pull/13429) (issue: [<1>3420](https://github.com/elastic/elasticsearch/issues/13420)) 



Scripting 
    

  * Filter classes loaded by scripts [<1>5262](https://github.com/elastic/elasticsearch/pull/15262)
  * Lock down javascript and python script engines better [<1>3924](https://github.com/elastic/elasticsearch/pull/13924)



Search 
    

  * Limit the size of the result window to a dynamic property [<1>3188](https://github.com/elastic/elasticsearch/pull/13188) (issue: [<9>311](https://github.com/elastic/elasticsearch/issues/9311)) 



### Breaking Java changes

Allocation 
    

  * Speed up shard balancer by reusing shard model while moving shards that can no longer be allocated to a node [<1>6926](https://github.com/elastic/elasticsearch/pull/16926)



### New features

Aggregations 
    

  * Adds geo_centroid metric aggregator [<1>3846](https://github.com/elastic/elasticsearch/pull/13846) (issue: [<1>3621](https://github.com/elastic/elasticsearch/issues/13621)) 
  * Add `percentiles_bucket` pipeline aggregation [<1>3186](https://github.com/elastic/elasticsearch/pull/13186)
  * Add `stats_bucket` / `extended_stats_bucket` pipeline aggs [<1>3128](https://github.com/elastic/elasticsearch/pull/13128)



Geo 
    

  * Add CONTAINS relation to geo_shape query [<1>4810](https://github.com/elastic/elasticsearch/pull/14810) (issue: [<1>4713](https://github.com/elastic/elasticsearch/issues/14713)) 
  * Add support for Lucene 5.4 GeoPoint queries [<1>4537](https://github.com/elastic/elasticsearch/pull/14537)
  * Add GeoPointV2 Field Mapping [<1>4536](https://github.com/elastic/elasticsearch/pull/14536)



Network 
    

  * Allow binding to multiple addresses. [<1>3954](https://github.com/elastic/elasticsearch/pull/13954) (issue: [<1>3592](https://github.com/elastic/elasticsearch/issues/13592)) 



Plugin Analysis Phonetic 
    

  * Add support for `daitch_mokotoff` [<1>4834](https://github.com/elastic/elasticsearch/pull/14834)



Plugin Cloud AWS 
    

  * Add support for S3 storage class [<1>3656](https://github.com/elastic/elasticsearch/pull/13656) (issue: [<1>3655](https://github.com/elastic/elasticsearch/issues/13655)) 



Plugins 
    

  * Decentralize plugin security [<1>4108](https://github.com/elastic/elasticsearch/pull/14108)



Search 
    

  * Add query profiler [<1>4889](https://github.com/elastic/elasticsearch/pull/14889) (issues: [<1>2974](https://github.com/elastic/elasticsearch/issues/12974), [<6>699](https://github.com/elastic/elasticsearch/issues/6699)) 



### Enhancements

Aliases 
    

  * Add support to _aliases endpoint to specify multiple indices and aliases in one action [<1>5305](https://github.com/elastic/elasticsearch/pull/15305) (issue: [<1>5186](https://github.com/elastic/elasticsearch/issues/15186)) 



Allocation 
    

  * Skip capturing least/most FS info for an FS with no total [<1>6001](https://github.com/elastic/elasticsearch/pull/16001) (issue: [<1>5919](https://github.com/elastic/elasticsearch/issues/15919)) 
  * Speed improvements for BalancedShardsAllocator [<1>5678](https://github.com/elastic/elasticsearch/pull/15678) (issue: [<6>372](https://github.com/elastic/elasticsearch/issues/6372)) 
  * Simplify delayed shard allocation [<1>4808](https://github.com/elastic/elasticsearch/pull/14808)
  * Add cluster-wide setting for total shard limit [<1>4563](https://github.com/elastic/elasticsearch/pull/14563) (issue: [<1>4456](https://github.com/elastic/elasticsearch/issues/14456)) 
  * Early terminate high disk watermark checks on single data node cluster [<1>3882](https://github.com/elastic/elasticsearch/pull/13882) (issue: [<9>391](https://github.com/elastic/elasticsearch/issues/9391)) 
  * Also use PriorityComparator in shard balancer [<1>3256](https://github.com/elastic/elasticsearch/pull/13256) (issue: [<1>3249](https://github.com/elastic/elasticsearch/issues/13249)) 
  * Add support for filtering by publish IP address [<8>801](https://github.com/elastic/elasticsearch/pull/8801)



Analysis 
    

  * Add detail response support for _analyze API [<1>1660](https://github.com/elastic/elasticsearch/pull/11660) (issue: [<1>1076](https://github.com/elastic/elasticsearch/issues/11076)) 



CAT API 
    

  * Add sync_id to cat shards API [<1>4712](https://github.com/elastic/elasticsearch/pull/14712) (issue: [<1>4705](https://github.com/elastic/elasticsearch/issues/14705)) 
  * Add duration field to /_cat/snapshots [<1>4385](https://github.com/elastic/elasticsearch/pull/14385)
  * Add cat API for repositories and snapshots [<1>4247](https://github.com/elastic/elasticsearch/pull/14247) (issue: [<1>3919](https://github.com/elastic/elasticsearch/issues/13919)) 
  * Adds disk used by indices to _cat/allocation [<1>3783](https://github.com/elastic/elasticsearch/pull/13783) (issue: [<1>3529](https://github.com/elastic/elasticsearch/issues/13529)) 



Cluster 
    

  * Shard state action request logging [<1>6396](https://github.com/elastic/elasticsearch/pull/16396)
  * Safe cluster state task notifications [<1>5777](https://github.com/elastic/elasticsearch/pull/15777)
  * Reroute once per batch of shard failures [<1>5510](https://github.com/elastic/elasticsearch/pull/15510)
  * Add callback for publication of new cluster state [<1>5494](https://github.com/elastic/elasticsearch/pull/15494) (issue: [<1>5482](https://github.com/elastic/elasticsearch/issues/15482)) 
  * Use general cluster state batching mechanism for shard started [<1>5023](https://github.com/elastic/elasticsearch/pull/15023) (issues: [<1>4725](https://github.com/elastic/elasticsearch/issues/14725), [<1>4899](https://github.com/elastic/elasticsearch/issues/14899)) 
  * Use general cluster state batching mechanism for shard failures [<1>5016](https://github.com/elastic/elasticsearch/pull/15016) (issues: [<1>4725](https://github.com/elastic/elasticsearch/issues/14725), [<1>4899](https://github.com/elastic/elasticsearch/issues/14899)) 
  * Set an newly created IndexShard’s ShardRouting before exposing it to operations [<1>4918](https://github.com/elastic/elasticsearch/pull/14918) (issue: [<1>0708](https://github.com/elastic/elasticsearch/issues/10708)) 
  * Uniform exceptions for TransportMasterNodeAction [<1>4737](https://github.com/elastic/elasticsearch/pull/14737)



Core 
    

  * Remove log4j exception hiding [<1>6834](https://github.com/elastic/elasticsearch/pull/16834)
  * Avoid cloning MessageDigest instances [<1>6479](https://github.com/elastic/elasticsearch/pull/16479)
  * Add a hard check to ensure we are running with the expected lucene version [<1>6305](https://github.com/elastic/elasticsearch/pull/16305) (issue: [<1>6301](https://github.com/elastic/elasticsearch/issues/16301)) 
  * If we can’t get a MAC address for the node, use a dummy one [<1>5266](https://github.com/elastic/elasticsearch/pull/15266) (issue: [<1>0099](https://github.com/elastic/elasticsearch/issues/10099)) 
  * Simplify shard inactive logging [<1>5259](https://github.com/elastic/elasticsearch/pull/15259) (issue: [<1>5252](https://github.com/elastic/elasticsearch/issues/15252)) 
  * Simplify IndexingMemoryController#checkIdle [<1>5252](https://github.com/elastic/elasticsearch/pull/15252) (issue: [<1>5251](https://github.com/elastic/elasticsearch/issues/15251)) 
  * IndexingMemoryController should not track shard index states [<1>5251](https://github.com/elastic/elasticsearch/pull/15251) (issues: [<1>3918](https://github.com/elastic/elasticsearch/issues/13918), [<1>5225](https://github.com/elastic/elasticsearch/issues/15225)) 
  * Verify Checksum once it has been fully written to fail as soon as possible [<1>3896](https://github.com/elastic/elasticsearch/pull/13896)



Discovery 
    

  * Don’t allow nodes with missing custom meta data to join cluster [<1>5401](https://github.com/elastic/elasticsearch/pull/15401) (issue: [<1>3445](https://github.com/elastic/elasticsearch/issues/13445)) 



Exceptions 
    

  * Added file name to exceptions when failing to read index state [<1>6850](https://github.com/elastic/elasticsearch/pull/16850) (issue: [<1>6713](https://github.com/elastic/elasticsearch/issues/16713)) 
  * Add Exception class name to message in `NotSerializableExceptionWrapper` [<1>6325](https://github.com/elastic/elasticsearch/pull/16325)
  * Deduplicate cause if already contained in shard failures [<1>4432](https://github.com/elastic/elasticsearch/pull/14432)
  * Give a better exception when running from freebsd jail without enforce_statfs=1 [<1>4135](https://github.com/elastic/elasticsearch/pull/14135) (issue: [<1>2018](https://github.com/elastic/elasticsearch/issues/12018)) 
  * Make root_cause of field conflicts more obvious [<1>3976](https://github.com/elastic/elasticsearch/pull/13976) (issue: [<1>2839](https://github.com/elastic/elasticsearch/issues/12839)) 
  * Use a dedicated id to serialize EsExceptions instead of it’s class name. [<1>3629](https://github.com/elastic/elasticsearch/pull/13629)



Fielddata 
    

  * Update GeoPoint FieldData for GeoPointV2 [<1>4345](https://github.com/elastic/elasticsearch/pull/14345)



Geo 
    

  * Upgrade GeoPointField to use Lucene 5.5 PrefixEncoding [<1>6482](https://github.com/elastic/elasticsearch/pull/16482)
  * Geo: Fix toString() in GeoDistanceRangeQuery and GeoPolygonQuery [<1>5026](https://github.com/elastic/elasticsearch/pull/15026)
  * Enable GeoPointV2 with backward compatibility testing [<1>4667](https://github.com/elastic/elasticsearch/pull/14667) (issues: [<1>0761](https://github.com/elastic/elasticsearch/issues/10761), [<1>1159](https://github.com/elastic/elasticsearch/issues/11159), [<9>859](https://github.com/elastic/elasticsearch/issues/9859)) 
  * Refactor Geo utilities to Lucene 5.4 [<1>4339](https://github.com/elastic/elasticsearch/pull/14339)



Index APIs 
    

  * Add option to disable closing indices [<1>4169](https://github.com/elastic/elasticsearch/pull/14169) (issue: [<1>4168](https://github.com/elastic/elasticsearch/issues/14168)) 



Index Templates 
    

  * Disallow index template pattern to be the same as an alias name [<1>5184](https://github.com/elastic/elasticsearch/pull/15184) (issue: [<1>4842](https://github.com/elastic/elasticsearch/issues/14842)) 



Internal 
    

  * Implement available for all StreamInput classes [<1>7218](https://github.com/elastic/elasticsearch/pull/17218)
  * Cleanup search sub transport actions and collapse o.e.action.search.type package into o.e.action.search [<1>6758](https://github.com/elastic/elasticsearch/pull/16758) (issue: [<1>1710](https://github.com/elastic/elasticsearch/issues/11710)) 
  * Simplify the Text API. [<1>5511](https://github.com/elastic/elasticsearch/pull/15511)
  * Simpler using compressed oops flag representation [<1>5509](https://github.com/elastic/elasticsearch/pull/15509) (issue: [<1>5489](https://github.com/elastic/elasticsearch/issues/15489)) 
  * Info on compressed ordinary object pointers [<1>5489](https://github.com/elastic/elasticsearch/pull/15489) (issues: [<1>3187](https://github.com/elastic/elasticsearch/issues/13187), [<4>55](https://github.com/elastic/elasticsearch/issues/455)) 
  * Explicitly log cluster state update failures [<1>5428](https://github.com/elastic/elasticsearch/pull/15428) (issues: [<1>4899](https://github.com/elastic/elasticsearch/issues/14899), [<1>5016](https://github.com/elastic/elasticsearch/issues/15016), [<1>5023](https://github.com/elastic/elasticsearch/issues/15023)) 
  * Use transport service to handle RetryOnReplicaException to execute replica action on the current node [<1>5363](https://github.com/elastic/elasticsearch/pull/15363)
  * Make IndexShard operation be more explicit about whether they are expected to run on a primary or replica [<1>5282](https://github.com/elastic/elasticsearch/pull/15282)
  * Avoid trace logging allocations in TransportBroadcastByNodeAction [<1>5221](https://github.com/elastic/elasticsearch/pull/15221)
  * Only trace log shard not available exceptions [<1>4950](https://github.com/elastic/elasticsearch/pull/14950) (issue: [<1>4927](https://github.com/elastic/elasticsearch/issues/14927)) 
  * Transport options should be immutable [<1>4760](https://github.com/elastic/elasticsearch/pull/14760)
  * Fix dangling comma in ClusterBlock#toString [<1>4483](https://github.com/elastic/elasticsearch/pull/14483)
  * Improve some logging around master election and cluster state [<1>4481](https://github.com/elastic/elasticsearch/pull/14481)
  * Add System#exit(), Runtime#exit() and Runtime#halt() to forbidden APIs [<1>4473](https://github.com/elastic/elasticsearch/pull/14473) (issue: [<1>2596](https://github.com/elastic/elasticsearch/issues/12596)) 
  * Simplify XContent detection. [<1>4472](https://github.com/elastic/elasticsearch/pull/14472)
  * Add threadgroup isolation. [<1>4353](https://github.com/elastic/elasticsearch/pull/14353)
  * Cleanup plugin security [<1>4311](https://github.com/elastic/elasticsearch/pull/14311)
  * Add workaround for JDK-8014008 [<1>4274](https://github.com/elastic/elasticsearch/pull/14274)
  * Refactor retry logic for TransportMasterNodeAction [<1>4222](https://github.com/elastic/elasticsearch/pull/14222)
  * Remove MetaDataSerivce and it’s semaphores [<1>4159](https://github.com/elastic/elasticsearch/pull/14159) (issue: [<1>296](https://github.com/elastic/elasticsearch/issues/1296)) 
  * Cleanup IndexMetaData [<1>4119](https://github.com/elastic/elasticsearch/pull/14119)
  * Add SpecialPermission to guard exceptions to security policy. [<1>3854](https://github.com/elastic/elasticsearch/pull/13854)
  * Clean up scripting permissions. [<1>3844](https://github.com/elastic/elasticsearch/pull/13844)
  * Factor groovy out of core into lang-groovy [<1>3834](https://github.com/elastic/elasticsearch/pull/13834) (issue: [<1>3725](https://github.com/elastic/elasticsearch/issues/13725)) 
  * More helpful error message on parameter order [<1>3737](https://github.com/elastic/elasticsearch/pull/13737)
  * Factor expressions scripts out to lang-expression plugin [<1>3726](https://github.com/elastic/elasticsearch/pull/13726) (issue: [<1>3725](https://github.com/elastic/elasticsearch/issues/13725)) 
  * Cleanup InternalClusterInfoService [<1>3543](https://github.com/elastic/elasticsearch/pull/13543)
  * Remove and forbid use of com.google.common.base.Throwables [<1>3409](https://github.com/elastic/elasticsearch/pull/13409) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove cyclic dependencies between IndexService and FieldData / BitSet caches [<1>3381](https://github.com/elastic/elasticsearch/pull/13381)
  * Remove and forbid use of com.google.common.base.Objects [<1>3355](https://github.com/elastic/elasticsearch/pull/13355) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Enable indy (invokedynamic) compile flag for Groovy scripts by default [<8>201](https://github.com/elastic/elasticsearch/pull/8201) (issue: [<8>184](https://github.com/elastic/elasticsearch/issues/8184)) 



Java API 
    

  * Add created flag to IndexingOperationListener#postIndex [<1>7340](https://github.com/elastic/elasticsearch/pull/17340) (issue: [<1>7333](https://github.com/elastic/elasticsearch/issues/17333)) 
  * Align handling of interrupts in BulkProcessor [<1>5527](https://github.com/elastic/elasticsearch/pull/15527) (issue: [<1>4833](https://github.com/elastic/elasticsearch/issues/14833)) 
  * BulkProcessor backs off exponentially by default [<1>5513](https://github.com/elastic/elasticsearch/pull/15513) (issue: [<1>4829](https://github.com/elastic/elasticsearch/issues/14829)) 
  * Reject refresh usage in bulk items when using and fix NPE when no source [<1>5082](https://github.com/elastic/elasticsearch/pull/15082) (issue: [<7>361](https://github.com/elastic/elasticsearch/issues/7361)) 
  * BulkProcessor retries after request handling has been rejected due to a full thread pool [<1>4829](https://github.com/elastic/elasticsearch/pull/14829) (issue: [<1>4620](https://github.com/elastic/elasticsearch/issues/14620)) 



Logging 
    

  * Log suppressed stack traces under DEBUG [<1>6627](https://github.com/elastic/elasticsearch/pull/16627) (issues: [<1>2991](https://github.com/elastic/elasticsearch/issues/12991), [<1>5329](https://github.com/elastic/elasticsearch/issues/15329), [<1>6622](https://github.com/elastic/elasticsearch/issues/16622)) 
  * Add circuit breaker name to logging package [<1>4661](https://github.com/elastic/elasticsearch/pull/14661)
  * Move logging for the amount of free disk to TRACE [<1>4403](https://github.com/elastic/elasticsearch/pull/14403) (issue: [<1>2843](https://github.com/elastic/elasticsearch/issues/12843)) 
  * Map log-level _trace_ to JDK-Level _FINEST_ [<1>4234](https://github.com/elastic/elasticsearch/pull/14234)



Mapping 
    

  * Expose the reason why a mapping merge is issued. [<1>6059](https://github.com/elastic/elasticsearch/pull/16059) (issue: [<1>5989](https://github.com/elastic/elasticsearch/issues/15989)) 
  * Add sub-fields support to `bool` fields. [<1>5636](https://github.com/elastic/elasticsearch/pull/15636) (issue: [<6>587](https://github.com/elastic/elasticsearch/issues/6587)) 
  * Improve cross-type dynamic mapping updates. [<1>5633](https://github.com/elastic/elasticsearch/pull/15633) (issue: [<1>5568](https://github.com/elastic/elasticsearch/issues/15568)) 
  * Make mapping updates more robust. [<1>5539](https://github.com/elastic/elasticsearch/pull/15539)
  * Make mapping serialization more robust. [<1>5480](https://github.com/elastic/elasticsearch/pull/15480)
  * Make mappings immutable. [<1>5313](https://github.com/elastic/elasticsearch/pull/15313) (issue: [<9>365](https://github.com/elastic/elasticsearch/issues/9365)) 
  * Make MappedFieldType.checkTypeName part of MappedFieldType.checkCompatibility. [<1>5245](https://github.com/elastic/elasticsearch/pull/15245)
  * Register field mappers at the node level. [<1>4896](https://github.com/elastic/elasticsearch/pull/14896) (issue: [<1>4828](https://github.com/elastic/elasticsearch/issues/14828)) 



Network 
    

  * Provide better error message when an incompatible node connects to a node [<1>7182](https://github.com/elastic/elasticsearch/pull/17182) (issue: [<1>7090](https://github.com/elastic/elasticsearch/issues/17090)) 
  * Add additional fallback to http.publish_port and restrict fallback to transport.publish_port [<1>6626](https://github.com/elastic/elasticsearch/pull/16626) (issue: [<1>4535](https://github.com/elastic/elasticsearch/issues/14535)) 
  * only allow code to bind to the user’s configured port numbers/ranges [<1>4549](https://github.com/elastic/elasticsearch/pull/14549)
  * Port of publishAddress should match port of corresponding boundAddress [<1>4535](https://github.com/elastic/elasticsearch/pull/14535) (issues: [<1>4503](https://github.com/elastic/elasticsearch/issues/14503), [<1>4513](https://github.com/elastic/elasticsearch/issues/14513), [<1>4514](https://github.com/elastic/elasticsearch/issues/14514)) 



Packaging 
    

  * Windows service: Use JAVA_HOME environment variable in registry [<1>6552](https://github.com/elastic/elasticsearch/pull/16552) (issue: [<1>3521](https://github.com/elastic/elasticsearch/issues/13521)) 
  * Default standard output to the journal in systemd [<1>6159](https://github.com/elastic/elasticsearch/pull/16159) (issues: [<1>5315](https://github.com/elastic/elasticsearch/issues/15315), [<1>6134](https://github.com/elastic/elasticsearch/issues/16134)) 
  * Use egrep instead of grep -E for Solaris [<1>5755](https://github.com/elastic/elasticsearch/pull/15755) (issue: [<1>5628](https://github.com/elastic/elasticsearch/issues/15628)) 
  * punch thru symlinks when loading plugins/modules [<1>5311](https://github.com/elastic/elasticsearch/pull/15311)
  * set ActiveProcessLimit=1 on windows [<1>5055](https://github.com/elastic/elasticsearch/pull/15055)
  * set RLIMIT_NPROC = 0 on bsd/os X systems. [<1>5039](https://github.com/elastic/elasticsearch/pull/15039)
  * Drop ability to execute on Solaris [<1>4200](https://github.com/elastic/elasticsearch/pull/14200)
  * Nuke ES_CLASSPATH appending, JarHell fail on empty classpath elements [<1>3880](https://github.com/elastic/elasticsearch/pull/13880) (issues: [<1>3812](https://github.com/elastic/elasticsearch/issues/13812), [<1>3864](https://github.com/elastic/elasticsearch/issues/13864)) 
  * improve seccomp syscall filtering [<1>3829](https://github.com/elastic/elasticsearch/pull/13829)
  * Block process execution with seccomp on linux/amd64 [<1>3753](https://github.com/elastic/elasticsearch/pull/13753)
  * Get lang-javascript, lang-python, securemock ready for script refactoring [<1>3695](https://github.com/elastic/elasticsearch/pull/13695)
  * Remove some bogus permissions only needed for tests. [<1>3620](https://github.com/elastic/elasticsearch/pull/13620)
  * Remove java.lang.reflect.ReflectPermission "suppressAccessChecks" [<1>3603](https://github.com/elastic/elasticsearch/pull/13603)
  * Remove JAVA_HOME detection from the debian init script [<1>3514](https://github.com/elastic/elasticsearch/pull/13514) (issues: [<1>3403](https://github.com/elastic/elasticsearch/issues/13403), [<9>774](https://github.com/elastic/elasticsearch/issues/9774)) 



Plugin Cloud AWS 
    

  * Add ap-northeast-2 (seoul) endpoints for EC2 discovery and S3 snapshots [<1>6167](https://github.com/elastic/elasticsearch/pull/16167) (issue: [<1>6166](https://github.com/elastic/elasticsearch/issues/16166)) 
  * Add aws canned acl [<1>4297](https://github.com/elastic/elasticsearch/pull/14297) (issue: [<1>4103](https://github.com/elastic/elasticsearch/issues/14103)) 
  * Improved building of disco nodes [<1>4155](https://github.com/elastic/elasticsearch/pull/14155)
  * Enable S3SignerType [<1>3360](https://github.com/elastic/elasticsearch/pull/13360) (issue: [<1>3332](https://github.com/elastic/elasticsearch/issues/13332)) 



Plugin Cloud Azure 
    

  * Add support for secondary azure storage account [<1>3779](https://github.com/elastic/elasticsearch/pull/13779) (issue: [<1>3228](https://github.com/elastic/elasticsearch/issues/13228)) 



Plugin Cloud GCE 
    

  * cloud-gce plugin should check `discovery.type` [<1>3809](https://github.com/elastic/elasticsearch/pull/13809) (issue: [<1>3614](https://github.com/elastic/elasticsearch/issues/13614)) 
  * Adding backoff from retries on GCE errors [<1>3671](https://github.com/elastic/elasticsearch/pull/13671) (issue: [<1>3460](https://github.com/elastic/elasticsearch/issues/13460)) 



Plugin Discovery EC2 
    

  * Adding US-Gov-West [<1>4358](https://github.com/elastic/elasticsearch/pull/14358)



Plugin Ingest Attachment 
    

  * Fix attachments plugins with docx [<1>7059](https://github.com/elastic/elasticsearch/pull/17059) (issue: [<1>6864](https://github.com/elastic/elasticsearch/issues/16864)) 



Plugins 
    

  * Expose http.type setting, and collapse al(most all) modules relating to transport/http [<1>5434](https://github.com/elastic/elasticsearch/pull/15434) (issue: [<1>4148](https://github.com/elastic/elasticsearch/issues/14148)) 
  * Ban RuntimePermission("getClassLoader") [<1>5253](https://github.com/elastic/elasticsearch/pull/15253)
  * Add nicer error message when a plugin descriptor is missing [<1>5200](https://github.com/elastic/elasticsearch/pull/15200) (issue: [<1>5197](https://github.com/elastic/elasticsearch/issues/15197)) 
  * Don’t be lenient in PluginService#processModule(Module) [<1>4306](https://github.com/elastic/elasticsearch/pull/14306)
  * Adds a validation for plugins script to check if java is set [<1>3633](https://github.com/elastic/elasticsearch/pull/13633) (issue: [<1>3613](https://github.com/elastic/elasticsearch/issues/13613)) 
  * Output plugin info only in verbose mode [<1>2908](https://github.com/elastic/elasticsearch/pull/12908) (issue: [<1>2907](https://github.com/elastic/elasticsearch/issues/12907)) 



Query DSL 
    

  * Allow CIDR notation in query string query [<1>4773](https://github.com/elastic/elasticsearch/pull/14773) (issue: [<7>464](https://github.com/elastic/elasticsearch/issues/7464)) 
  * Internal: simplify filtered query conversion to lucene query [<1>3312](https://github.com/elastic/elasticsearch/pull/13312) (issue: [<1>3272](https://github.com/elastic/elasticsearch/issues/13272)) 



REST 
    

  * Make XContentGenerator.writeRaw* safer. [<1>5358](https://github.com/elastic/elasticsearch/pull/15358)
  * Filter path refactoring [<1>4390](https://github.com/elastic/elasticsearch/pull/14390) (issues: [<1>0980](https://github.com/elastic/elasticsearch/issues/10980), [<1>1560](https://github.com/elastic/elasticsearch/issues/11560), [<1>3344](https://github.com/elastic/elasticsearch/issues/13344)) 



Recovery 
    

  * Handle cancel exceptions on recovery target if the cancel comes from the source [<1>5309](https://github.com/elastic/elasticsearch/pull/15309)
  * Decouple routing and primary operation logic in TransportReplicationAction [<1>4852](https://github.com/elastic/elasticsearch/pull/14852)



Reindex API 
    

  * Implement helpful interfaces in reindex requests [<1>7032](https://github.com/elastic/elasticsearch/pull/17032)
  * Reindex should timeout if sub-requests timeout [<1>6962](https://github.com/elastic/elasticsearch/pull/16962)
  * Teach reindex to retry on rejection [<1>6556](https://github.com/elastic/elasticsearch/pull/16556) (issue: [<1>6093](https://github.com/elastic/elasticsearch/issues/16093)) 



Scripting 
    

  * Remove suppressAccessChecks permission for Groovy script plugin [<1>6839](https://github.com/elastic/elasticsearch/pull/16839) (issue: [<1>6527](https://github.com/elastic/elasticsearch/issues/16527)) 
  * Class permission for Groovy references [<1>6660](https://github.com/elastic/elasticsearch/pull/16660) (issue: [<1>6657](https://github.com/elastic/elasticsearch/issues/16657)) 
  * Scripting: Allow to get size of array in mustache [<1>6193](https://github.com/elastic/elasticsearch/pull/16193)
  * Enhancements to the mustache script engine [<1>5661](https://github.com/elastic/elasticsearch/pull/15661)
  * Add property permissions so groovy scripts can serialize json [<1>4500](https://github.com/elastic/elasticsearch/pull/14500) (issue: [<1>4488](https://github.com/elastic/elasticsearch/issues/14488)) 
  * Remove ScriptEngineService.unwrap. [<1>3958](https://github.com/elastic/elasticsearch/pull/13958)
  * Remove ScriptEngineService.execute. [<1>3956](https://github.com/elastic/elasticsearch/pull/13956)



Search 
    

  * Caching Weight wrappers should propagate the BulkScorer. [<1>4317](https://github.com/elastic/elasticsearch/pull/14317)
  * fix numerical issue in function score query [<1>4085](https://github.com/elastic/elasticsearch/pull/14085)
  * Optimize scrolls for constant-score queries. [<1>3311](https://github.com/elastic/elasticsearch/pull/13311)



Settings 
    

  * Log warning if max file descriptors too low [<1>6506](https://github.com/elastic/elasticsearch/pull/16506)



Snapshot/Restore 
    

  * Support wildcards for getting repositories and snapshots [<1>5151](https://github.com/elastic/elasticsearch/pull/15151) (issue: [<4>758](https://github.com/elastic/elasticsearch/issues/4758)) 
  * Add ignore_unavailable parameter to skip unavailable snapshot [<1>4471](https://github.com/elastic/elasticsearch/pull/14471) (issue: [<1>3887](https://github.com/elastic/elasticsearch/issues/13887)) 
  * Simplify the BlobContainer blob writing interface [<1>3434](https://github.com/elastic/elasticsearch/pull/13434)



Stats 
    

  * Pull Fields instance once from LeafReader in completion stats [<1>5090](https://github.com/elastic/elasticsearch/pull/15090) (issue: [<6>593](https://github.com/elastic/elasticsearch/issues/6593)) 
  * Add os.allocated_processors stats [<1>4409](https://github.com/elastic/elasticsearch/pull/14409) (issue: [<1>3917](https://github.com/elastic/elasticsearch/issues/13917)) 
  * Adds stats counter for failed indexing requests [<1>3130](https://github.com/elastic/elasticsearch/pull/13130) (issue: [<8>938](https://github.com/elastic/elasticsearch/issues/8938)) 



Top Hits 
    

  * Put method addField on TopHitsBuilder [<1>4597](https://github.com/elastic/elasticsearch/pull/14597) (issue: [<1>2962](https://github.com/elastic/elasticsearch/issues/12962)) 



Translog 
    

  * Check for tragic event on all kinds of exceptions not only ACE and IOException [<1>5535](https://github.com/elastic/elasticsearch/pull/15535)



Tribe Node 
    

  * Tribe nodes should apply cluster state updates in batches [<1>4993](https://github.com/elastic/elasticsearch/pull/14993) (issues: [<1>4725](https://github.com/elastic/elasticsearch/issues/14725), [<1>4899](https://github.com/elastic/elasticsearch/issues/14899)) 



### Bug fixes

Aggregations 
    

  * Prevents exception being raised when ordering by an aggregation which wasn’t collected [<1>7379](https://github.com/elastic/elasticsearch/pull/17379) (issue: [<1>7225](https://github.com/elastic/elasticsearch/issues/17225)) 
  * Setting _other_ bucket on empty aggregation [<1>7264](https://github.com/elastic/elasticsearch/pull/17264) (issue: [<1>6546](https://github.com/elastic/elasticsearch/issues/16546)) 
  * Build empty extended stats aggregation if no docs collected for bucket [<1>6972](https://github.com/elastic/elasticsearch/pull/16972) (issues: [<1>6812](https://github.com/elastic/elasticsearch/issues/16812), [<9>544](https://github.com/elastic/elasticsearch/issues/9544)) 
  * Set meta data for pipeline aggregations [<1>6516](https://github.com/elastic/elasticsearch/pull/16516) (issue: [<1>6484](https://github.com/elastic/elasticsearch/issues/16484)) 
  * Filter(s) aggregation should create weights only once. [<1>5998](https://github.com/elastic/elasticsearch/pull/15998)
  * Make `missing` on terms aggs work with all execution modes. [<1>5746](https://github.com/elastic/elasticsearch/pull/15746) (issue: [<1>4882](https://github.com/elastic/elasticsearch/issues/14882)) 
  * Run pipeline aggregations for empty buckets added in the Range Aggregation [<1>5519](https://github.com/elastic/elasticsearch/pull/15519) (issue: [<1>5471](https://github.com/elastic/elasticsearch/issues/15471)) 
  * [Children agg] fix bug that prevented all child docs from being evaluated [<1>5457](https://github.com/elastic/elasticsearch/pull/15457)
  * Correct typo in class name of StatsAggregator [<1>5321](https://github.com/elastic/elasticsearch/pull/15321) (issue: [<1>4730](https://github.com/elastic/elasticsearch/issues/14730)) 
  * Fix significant terms reduce for long terms [<1>4948](https://github.com/elastic/elasticsearch/pull/14948) (issue: [<1>3522](https://github.com/elastic/elasticsearch/issues/13522)) 
  * Fix NPE in Derivative Pipeline when current bucket value is null [<1>4745](https://github.com/elastic/elasticsearch/pull/14745)
  * Pass extended bounds into HistogramAggregator when creating an unmapped aggregator [<1>4742](https://github.com/elastic/elasticsearch/pull/14742) (issue: [<1>4735](https://github.com/elastic/elasticsearch/issues/14735)) 
  * Added correct generic type parameter on ScriptedMetricBuilder [<1>4018](https://github.com/elastic/elasticsearch/pull/14018) (issue: [<1>3986](https://github.com/elastic/elasticsearch/issues/13986)) 
  * Pipeline Aggregations at the root of the agg tree are now validated [<1>3475](https://github.com/elastic/elasticsearch/pull/13475) (issue: [<1>3179](https://github.com/elastic/elasticsearch/issues/13179)) 



Aliases 
    

  * Fix _aliases filter and null parameters [<1>6553](https://github.com/elastic/elasticsearch/pull/16553) (issues: [<1>6547](https://github.com/elastic/elasticsearch/issues/16547), [<1>6549](https://github.com/elastic/elasticsearch/issues/16549)) 



Allocation 
    

  * IndicesStore checks for `allocated elsewhere` for every shard not alocated on the local node [<1>7106](https://github.com/elastic/elasticsearch/pull/17106)
  * Prevent peer recovery from node with older version [<1>5775](https://github.com/elastic/elasticsearch/pull/15775)
  * Fix calculation of next delay for delayed shard allocation [<1>4765](https://github.com/elastic/elasticsearch/pull/14765)
  * Take ignored unallocated shards into account when making allocation decision [<1>4678](https://github.com/elastic/elasticsearch/pull/14678) (issue: [<1>4670](https://github.com/elastic/elasticsearch/issues/14670)) 
  * Only allow rebalance operations to run if all shard store data is available [<1>4591](https://github.com/elastic/elasticsearch/pull/14591) (issue: [<1>4387](https://github.com/elastic/elasticsearch/issues/14387)) 
  * Delayed allocation can miss a reroute [<1>4494](https://github.com/elastic/elasticsearch/pull/14494) (issues: [<1>4010](https://github.com/elastic/elasticsearch/issues/14010), [<1>4011](https://github.com/elastic/elasticsearch/issues/14011), [<1>4445](https://github.com/elastic/elasticsearch/issues/14445)) 
  * Check rebalancing constraints when shards are moved from a node they can no longer remain on [<1>4259](https://github.com/elastic/elasticsearch/pull/14259) (issue: [<1>4057](https://github.com/elastic/elasticsearch/issues/14057)) 



Analysis 
    

  * Analysis : Allow string explain param in JSON [<1>6977](https://github.com/elastic/elasticsearch/pull/16977) (issue: [<1>6925](https://github.com/elastic/elasticsearch/issues/16925)) 
  * Analysis : Fix no response from Analyze API without specified index [<1>5447](https://github.com/elastic/elasticsearch/pull/15447) (issue: [<1>5148](https://github.com/elastic/elasticsearch/issues/15148)) 



Bulk 
    

  * Bulk api: fail deletes when routing is required but not specified [<1>6675](https://github.com/elastic/elasticsearch/pull/16675) (issues: [<1>0136](https://github.com/elastic/elasticsearch/issues/10136), [<1>6645](https://github.com/elastic/elasticsearch/issues/16645)) 
  * Do not release unacquired semaphore [<1>4909](https://github.com/elastic/elasticsearch/pull/14909) (issue: [<1>4908](https://github.com/elastic/elasticsearch/issues/14908)) 



CAT API 
    

  * Fix column aliases in _cat/indices, _cat/nodes and _cat/shards APIs [<1>7145](https://github.com/elastic/elasticsearch/pull/17145) (issue: [<1>7101](https://github.com/elastic/elasticsearch/issues/17101)) 
  * Properly set indices and indicesOptions on subrequest made by /_cat/indices [<1>4360](https://github.com/elastic/elasticsearch/pull/14360)



CRUD 
    

  * Throw exception if content type could not be determined in Update API [<1>5904](https://github.com/elastic/elasticsearch/pull/15904) (issue: [<1>5822](https://github.com/elastic/elasticsearch/issues/15822)) 
  * Index name expressions should not be broken up [<1>3691](https://github.com/elastic/elasticsearch/pull/13691) (issue: [<1>3665](https://github.com/elastic/elasticsearch/issues/13665)) 



Cache 
    

  * Handle closed readers in ShardCoreKeyMap [<1>6027](https://github.com/elastic/elasticsearch/pull/16027)



Cluster 
    

  * Index deletes not applied when cluster UUID has changed [<1>6825](https://github.com/elastic/elasticsearch/pull/16825) (issue: [<1>1665](https://github.com/elastic/elasticsearch/issues/11665)) 
  * Only fail the relocation target when a replication request on it fails [<1>5791](https://github.com/elastic/elasticsearch/pull/15791) (issue: [<1>5790](https://github.com/elastic/elasticsearch/issues/15790)) 
  * Handle shards assigned to nodes that are not in the cluster state [<1>4586](https://github.com/elastic/elasticsearch/pull/14586) (issue: [<1>4584](https://github.com/elastic/elasticsearch/issues/14584)) 
  * Bulk cluster state updates on index deletion [<1>1258](https://github.com/elastic/elasticsearch/pull/11258) (issue: [<7>295](https://github.com/elastic/elasticsearch/issues/7295)) 



Core 
    

  * BitSetFilterCache duplicates its content. [<1>5836](https://github.com/elastic/elasticsearch/pull/15836) (issue: [<1>5820](https://github.com/elastic/elasticsearch/issues/15820)) 
  * Limit the max size of bulk and index thread pools to bounded number of processors [<1>5585](https://github.com/elastic/elasticsearch/pull/15585) (issue: [<1>5582](https://github.com/elastic/elasticsearch/issues/15582)) 
  * AllTermQuery’s scorer should skip segments that never saw the requested term [<1>5506](https://github.com/elastic/elasticsearch/pull/15506)
  * Include root-cause exception when we fail to change shard’s index buffer [<1>4867](https://github.com/elastic/elasticsearch/pull/14867)
  * Restore thread interrupt flag after an InterruptedException [<1>4799](https://github.com/elastic/elasticsearch/pull/14799) (issue: [<1>4798](https://github.com/elastic/elasticsearch/issues/14798)) 
  * Record all bytes of the checksum in VerifyingIndexOutput [<1>3923](https://github.com/elastic/elasticsearch/pull/13923) (issues: [<1>3848](https://github.com/elastic/elasticsearch/issues/13848), [<1>3896](https://github.com/elastic/elasticsearch/issues/13896)) 
  * When shard becomes active again, immediately increase its indexing buffer [<1>3918](https://github.com/elastic/elasticsearch/pull/13918) (issue: [<1>3802](https://github.com/elastic/elasticsearch/issues/13802)) 
  * Close TokenStream in finally clause [<1>3870](https://github.com/elastic/elasticsearch/pull/13870) (issue: [<1>1947](https://github.com/elastic/elasticsearch/issues/11947)) 
  * LoggingRunnable.run should catch and log all errors, not just Exception? [<1>3718](https://github.com/elastic/elasticsearch/pull/13718) (issue: [<1>3487](https://github.com/elastic/elasticsearch/issues/13487)) 



Exceptions 
    

  * Fix ensureNodesAreAvailable’s error message [<1>4007](https://github.com/elastic/elasticsearch/pull/14007) (issue: [<1>3957](https://github.com/elastic/elasticsearch/issues/13957)) 



Expressions 
    

  * Check that _value is used in aggregations script before setting value to specialValue [<1>7091](https://github.com/elastic/elasticsearch/pull/17091) (issue: [<1>4262](https://github.com/elastic/elasticsearch/issues/14262)) 



Fielddata 
    

  * Don’t cache top level field data for fields that don’t exist [<1>4693](https://github.com/elastic/elasticsearch/pull/14693)



Geo 
    

  * Remove .geohash suffix from GeoDistanceQuery and GeoDistanceRangeQuery [<1>5871](https://github.com/elastic/elasticsearch/pull/15871) (issue: [<1>5179](https://github.com/elastic/elasticsearch/issues/15179)) 
  * Geo: Allow numeric parameters enclosed in quotes for _geohash_grid_ aggregation [<1>4440](https://github.com/elastic/elasticsearch/pull/14440) (issue: [<1>3132](https://github.com/elastic/elasticsearch/issues/13132)) 
  * Resync Geopoint hashCode/equals method [<1>4124](https://github.com/elastic/elasticsearch/pull/14124) (issue: [<1>4083](https://github.com/elastic/elasticsearch/issues/14083)) 
  * Fix GeoPointFieldMapper to index geohash at correct precision. [<1>3649](https://github.com/elastic/elasticsearch/pull/13649) (issue: [<1>2467](https://github.com/elastic/elasticsearch/issues/12467)) 



Highlighting 
    

  * Don’t override originalQuery with request filters [<1>5793](https://github.com/elastic/elasticsearch/pull/15793) (issue: [<1>5689](https://github.com/elastic/elasticsearch/issues/15689)) 
  * Fix spans extraction to not also include individual terms. [<1>5516](https://github.com/elastic/elasticsearch/pull/15516) (issues: [<1>3239](https://github.com/elastic/elasticsearch/issues/13239), [<1>5291](https://github.com/elastic/elasticsearch/issues/15291)) 



Index APIs 
    

  * Field stats: Index constraints should remove indices in the response if the field to evaluate is empty [<1>4868](https://github.com/elastic/elasticsearch/pull/14868)
  * Field stats: Fix NPE for index constraint on empty index [<1>4841](https://github.com/elastic/elasticsearch/pull/14841)
  * Field stats: Added `format` option for index constraints [<1>4823](https://github.com/elastic/elasticsearch/pull/14823) (issue: [<1>4804](https://github.com/elastic/elasticsearch/issues/14804)) 
  * Forbid index name `.` and `..` [<1>3862](https://github.com/elastic/elasticsearch/pull/13862) (issue: [<1>3858](https://github.com/elastic/elasticsearch/issues/13858)) 



Inner Hits 
    

  * Query and top level inner hit definitions shouldn’t overwrite each other [<1>6222](https://github.com/elastic/elasticsearch/pull/16222) (issue: [<1>6218](https://github.com/elastic/elasticsearch/issues/16218)) 



Internal 
    

  * Log uncaught exceptions from scheduled once tasks [<1>5824](https://github.com/elastic/elasticsearch/pull/15824) (issue: [<1>5814](https://github.com/elastic/elasticsearch/issues/15814)) 
  * FunctionScoreQuery should implement two-phase iteration. [<1>5602](https://github.com/elastic/elasticsearch/pull/15602)
  * Make sure the remaining delay of unassigned shard is updated with every reroute [<1>4890](https://github.com/elastic/elasticsearch/pull/14890) (issue: [<1>4808](https://github.com/elastic/elasticsearch/issues/14808)) 
  * Throw a meaningful error when loading metadata and an alias and index have the same name [<1>4842](https://github.com/elastic/elasticsearch/pull/14842) (issue: [<1>4706](https://github.com/elastic/elasticsearch/issues/14706)) 
  * fixup issues with 32-bit jvm [<1>4609](https://github.com/elastic/elasticsearch/pull/14609)
  * Failure to update the cluster state with the recovered state should make sure it will be recovered later [<1>4485](https://github.com/elastic/elasticsearch/pull/14485)
  * Gateway: a race condition can prevent the initial cluster state from being recovered [<1>3997](https://github.com/elastic/elasticsearch/pull/13997)
  * Verify actually written checksum in VerifyingIndexOutput [<1>3848](https://github.com/elastic/elasticsearch/pull/13848)
  * An inactive shard is activated by triggered synced flush [<1>3802](https://github.com/elastic/elasticsearch/pull/13802)
  * Remove all setAccessible in tests and forbid [<1>3539](https://github.com/elastic/elasticsearch/pull/13539)
  * Remove easy uses of setAccessible in tests. [<1>3537](https://github.com/elastic/elasticsearch/pull/13537)
  * Ban setAccessible from core code, restore monitoring stats under java 9 [<1>3531](https://github.com/elastic/elasticsearch/pull/13531) (issue: [<1>3527](https://github.com/elastic/elasticsearch/issues/13527)) 



Logging 
    

  * Add missing index name to indexing slow log [<1>7026](https://github.com/elastic/elasticsearch/pull/17026) (issue: [<1>7025](https://github.com/elastic/elasticsearch/issues/17025)) 
  * ParseFieldMatcher should log when using deprecated settings. [<1>6988](https://github.com/elastic/elasticsearch/pull/16988)
  * Don’t log multi-megabyte guice exceptions. [<1>3782](https://github.com/elastic/elasticsearch/pull/13782)
  * Moving system property setting to before it can be used [<1>3660](https://github.com/elastic/elasticsearch/pull/13660) (issue: [<1>3658](https://github.com/elastic/elasticsearch/issues/13658)) 



Mapping 
    

  * Put mapping operations must update metadata of all types. [<1>6264](https://github.com/elastic/elasticsearch/pull/16264) (issue: [<1>6239](https://github.com/elastic/elasticsearch/issues/16239)) 
  * Fix serialization of `search_analyzer`. [<1>6255](https://github.com/elastic/elasticsearch/pull/16255)
  * Reuse metadata mappers for dynamic updates. [<1>6023](https://github.com/elastic/elasticsearch/pull/16023) (issue: [<1>5997](https://github.com/elastic/elasticsearch/issues/15997)) 
  * Fix MapperService#searchFilter(…) [<1>5923](https://github.com/elastic/elasticsearch/pull/15923) (issue: [<1>5757](https://github.com/elastic/elasticsearch/issues/15757)) 
  * Fix initial sizing of BytesStreamOutput. [<1>5864](https://github.com/elastic/elasticsearch/pull/15864) (issue: [<1>5789](https://github.com/elastic/elasticsearch/issues/15789)) 
  * MetaDataMappingService should call MapperService.merge with the original mapping update. [<1>5508](https://github.com/elastic/elasticsearch/pull/15508)
  * MapperService: check index.mapper.dynamic during index creation [<1>5424](https://github.com/elastic/elasticsearch/pull/15424) (issue: [<1>5381](https://github.com/elastic/elasticsearch/issues/15381)) 
  * Only text fields should accept analyzer and term vector settings. [<1>5308](https://github.com/elastic/elasticsearch/pull/15308)
  * Mapper parsers should not check for a `tokenized` property. [<1>5289](https://github.com/elastic/elasticsearch/pull/15289)
  * Validate that fields are defined only once. [<1>5243](https://github.com/elastic/elasticsearch/pull/15243) (issue: [<1>5057](https://github.com/elastic/elasticsearch/issues/15057)) 
  * Check mapping compatibility up-front. [<1>5175](https://github.com/elastic/elasticsearch/pull/15175) (issue: [<1>5049](https://github.com/elastic/elasticsearch/issues/15049)) 
  * Don’t treat _default_ as a regular type. [<1>5156](https://github.com/elastic/elasticsearch/pull/15156) (issue: [<1>5049](https://github.com/elastic/elasticsearch/issues/15049)) 
  * Don’t ignore mapping merge failures. [<1>5144](https://github.com/elastic/elasticsearch/pull/15144) (issue: [<1>5049](https://github.com/elastic/elasticsearch/issues/15049)) 
  * Treat mappings at an index-level feature. [<1>5142](https://github.com/elastic/elasticsearch/pull/15142)
  * Make _type use doc values [<1>4783](https://github.com/elastic/elasticsearch/pull/14783) (issue: [<1>4781](https://github.com/elastic/elasticsearch/issues/14781)) 



Network 
    

  * Only accept transport requests after node is fully initialized [<1>6746](https://github.com/elastic/elasticsearch/pull/16746) (issue: [<1>6723](https://github.com/elastic/elasticsearch/issues/16723)) 



Packaging 
    

  * Fix waiting for pidfile [<1>6718](https://github.com/elastic/elasticsearch/pull/16718) (issue: [<1>6717](https://github.com/elastic/elasticsearch/issues/16717)) 
  * Fix Windows service installation failure [<1>5549](https://github.com/elastic/elasticsearch/pull/15549) (issue: [<1>5349](https://github.com/elastic/elasticsearch/issues/15349)) 
  * Enable es_include at init [<1>5173](https://github.com/elastic/elasticsearch/pull/15173)
  * Handle system policy correctly [<1>4704](https://github.com/elastic/elasticsearch/pull/14704) (issue: [<1>4690](https://github.com/elastic/elasticsearch/issues/14690)) 
  * Startup script exit status should catch daemonized startup failures [<1>4170](https://github.com/elastic/elasticsearch/pull/14170) (issue: [<1>4163](https://github.com/elastic/elasticsearch/issues/14163)) 
  * Don’t let ubuntu try to install its crazy jayatana agent. [<1>3813](https://github.com/elastic/elasticsearch/pull/13813) (issue: [<1>3785](https://github.com/elastic/elasticsearch/issues/13785)) 



Parent/Child 
    

  * Check that parent_type in Has Parent Query has child types [<1>6923](https://github.com/elastic/elasticsearch/pull/16923) (issue: [<1>6692](https://github.com/elastic/elasticsearch/issues/16692)) 
  * Has child query forces default similarity [<1>6611](https://github.com/elastic/elasticsearch/pull/16611) (issues: [<1>6550](https://github.com/elastic/elasticsearch/issues/16550), [<4>977](https://github.com/elastic/elasticsearch/issues/4977)) 



Percolator 
    

  * Don’t replace found fields if map unmapped fields as string is enabled [<1>6043](https://github.com/elastic/elasticsearch/pull/16043) (issue: [<1>0500](https://github.com/elastic/elasticsearch/issues/10500)) 
  * mpercolate api should serialise start time [<1>5938](https://github.com/elastic/elasticsearch/pull/15938) (issue: [<1>5908](https://github.com/elastic/elasticsearch/issues/15908)) 



Plugin Delete By Query 
    

  * Fix Delete-by-Query with Shield [<1>4658](https://github.com/elastic/elasticsearch/pull/14658) (issue: [<1>4527](https://github.com/elastic/elasticsearch/issues/14527)) 



Plugin Discovery GCE 
    

  * Add setFactory permission to GceDiscoveryPlugin [<1>6860](https://github.com/elastic/elasticsearch/pull/16860) (issue: [<1>6485](https://github.com/elastic/elasticsearch/issues/16485)) 



Plugin Mapper Attachment 
    

  * Fix toXContent() for mapper attachments field [<1>5110](https://github.com/elastic/elasticsearch/pull/15110)



Plugin Repository S3 
    

  * Hack around aws security hole of accessing sun.security.ssl, s3 repository works on java 9 again [<1>3538](https://github.com/elastic/elasticsearch/pull/13538) (issue: [<4>32](https://github.com/elastic/elasticsearch/issues/432)) 



Plugins 
    

  * Fix plugin list command error message [<1>4288](https://github.com/elastic/elasticsearch/pull/14288) (issue: [<1>4287](https://github.com/elastic/elasticsearch/issues/14287)) 
  * Fix HTML response during redirection [<1>1374](https://github.com/elastic/elasticsearch/pull/11374) (issue: [<1>1370](https://github.com/elastic/elasticsearch/issues/11370)) 



Query DSL 
    

  * Fix FunctionScore equals/hashCode to include minScore and friends [<1>5676](https://github.com/elastic/elasticsearch/pull/15676)
  * Min should match greater than the number of optional clauses should return no result [<1>5571](https://github.com/elastic/elasticsearch/pull/15571) (issue: [<1>5521](https://github.com/elastic/elasticsearch/issues/15521)) 
  * Return a better exception message when `regexp` query is used on a numeric field [<1>4910](https://github.com/elastic/elasticsearch/pull/14910) (issue: [<1>4782](https://github.com/elastic/elasticsearch/issues/14782)) 



REST 
    

  * Remove detect_noop from REST spec [<1>6386](https://github.com/elastic/elasticsearch/pull/16386)
  * Make text parsing less lenient. [<1>5679](https://github.com/elastic/elasticsearch/pull/15679)
  * Throw exception when trying to write map with null keys [<1>5479](https://github.com/elastic/elasticsearch/pull/15479) (issue: [<1>4346](https://github.com/elastic/elasticsearch/issues/14346)) 
  * Fix OOM in AbstractXContentParser [<1>5350](https://github.com/elastic/elasticsearch/pull/15350) (issue: [<1>5338](https://github.com/elastic/elasticsearch/issues/15338)) 
  * XContentFactory.xContentType: allow for possible UTF-8 BOM for JSON XContentType [<1>4611](https://github.com/elastic/elasticsearch/pull/14611) (issue: [<1>4442](https://github.com/elastic/elasticsearch/issues/14442)) 
  * RestUtils.decodeQueryString ignores the URI fragment when parsing a query string [<1>3365](https://github.com/elastic/elasticsearch/pull/13365) (issue: [<1>3320](https://github.com/elastic/elasticsearch/issues/13320)) 



Recovery 
    

  * Try to renew sync ID if `flush=true` on forceMerge [<1>7108](https://github.com/elastic/elasticsearch/pull/17108) (issue: [<1>7019](https://github.com/elastic/elasticsearch/issues/17019)) 
  * CancellableThreads should also treat ThreadInterruptedException as InterruptedException [<1>5318](https://github.com/elastic/elasticsearch/pull/15318)



Reindex API 
    

  * Properly register reindex status [<1>7125](https://github.com/elastic/elasticsearch/pull/17125)
  * Make search failure cause rest failure [<1>6889](https://github.com/elastic/elasticsearch/pull/16889) (issue: [<1>6037](https://github.com/elastic/elasticsearch/issues/16037)) 



Scripting 
    

  * Add permission to access sun.reflect.MethodAccessorImpl from Groovy scripts [<1>6540](https://github.com/elastic/elasticsearch/pull/16540) (issue: [<1>6536](https://github.com/elastic/elasticsearch/issues/16536)) 
  * Security permissions for Groovy closures [<1>6196](https://github.com/elastic/elasticsearch/pull/16196) (issues: [<1>6194](https://github.com/elastic/elasticsearch/issues/16194), [<2>48](https://github.com/elastic/elasticsearch/issues/248)) 



Search 
    

  * Do not apply minimum_should_match on auto generated boolean query if the coordination factor is disabled. [<1>6155](https://github.com/elastic/elasticsearch/pull/16155)
  * Do not apply minimum-should-match on a boolean query if the coords are disabled [<1>6078](https://github.com/elastic/elasticsearch/pull/16078) (issue: [<1>5858](https://github.com/elastic/elasticsearch/issues/15858)) 
  * Fix blended terms take 2 [<1>5894](https://github.com/elastic/elasticsearch/pull/15894) (issue: [<1>5860](https://github.com/elastic/elasticsearch/issues/15860)) 
  * Fix NPE when a segment with an empty cache gets closed. [<1>5202](https://github.com/elastic/elasticsearch/pull/15202) (issue: [<1>5043](https://github.com/elastic/elasticsearch/issues/15043)) 
  * Fix the quotes in the explain message for a script score function without parameters [<1>1398](https://github.com/elastic/elasticsearch/pull/11398)



Settings 
    

  * TransportClient should use updated setting for initialization of modules and service [<1>6095](https://github.com/elastic/elasticsearch/pull/16095)
  * ByteSizeValue.equals should normalize units [<1>3784](https://github.com/elastic/elasticsearch/pull/13784)



Snapshot/Restore 
    

  * Prevent closing index during snapshot restore [<1>6933](https://github.com/elastic/elasticsearch/pull/16933) (issue: [<1>6321](https://github.com/elastic/elasticsearch/issues/16321)) 
  * Add node version check to shard allocation during restore [<1>6520](https://github.com/elastic/elasticsearch/pull/16520) (issue: [<1>6519](https://github.com/elastic/elasticsearch/issues/16519)) 
  * Snapshot restore and index creates should keep index settings and cluster blocks in sync [<1>3931](https://github.com/elastic/elasticsearch/pull/13931) (issue: [<1>3213](https://github.com/elastic/elasticsearch/issues/13213)) 
  * Fix blob size in writeBlob() method [<1>3574](https://github.com/elastic/elasticsearch/pull/13574) (issue: [<1>3434](https://github.com/elastic/elasticsearch/issues/13434)) 



Stats 
    

  * Fix recovery translog stats totals when recovering from store [<1>6493](https://github.com/elastic/elasticsearch/pull/16493) (issue: [<1>5974](https://github.com/elastic/elasticsearch/issues/15974)) 
  * Fix calculation of age of pending tasks [<1>5995](https://github.com/elastic/elasticsearch/pull/15995) (issue: [<1>5988](https://github.com/elastic/elasticsearch/issues/15988)) 
  * Add extra validation into `cluster/stats` [<1>4699](https://github.com/elastic/elasticsearch/pull/14699) (issue: [<7>390](https://github.com/elastic/elasticsearch/issues/7390)) 
  * Omit current* stats for OldShardStats [<1>3801](https://github.com/elastic/elasticsearch/pull/13801) (issue: [<1>3386](https://github.com/elastic/elasticsearch/issues/13386)) 



Task Manager 
    

  * Fix TaskId#isSet to return true when id is set and not other way around [<1>7307](https://github.com/elastic/elasticsearch/pull/17307)
  * Don’t wait for completion of list tasks tasks when wait_for_completion flag is set [<1>7231](https://github.com/elastic/elasticsearch/pull/17231)



Translog 
    

  * Never delete translog-N.tlog file when creation fails [<1>5788](https://github.com/elastic/elasticsearch/pull/15788)
  * Close recovered translog readers if createWriter fails [<1>5762](https://github.com/elastic/elasticsearch/pull/15762) (issue: [<1>5754](https://github.com/elastic/elasticsearch/issues/15754)) 
  * Fail and close translog hard if writing to disk fails [<1>5420](https://github.com/elastic/elasticsearch/pull/15420) (issue: [<1>5333](https://github.com/elastic/elasticsearch/issues/15333)) 
  * Prevent writing to closed channel if translog is already closed [<1>5012](https://github.com/elastic/elasticsearch/pull/15012) (issue: [<1>4866](https://github.com/elastic/elasticsearch/issues/14866)) 
  * Don’t delete temp recovered checkpoint file if it was renamed [<1>4872](https://github.com/elastic/elasticsearch/pull/14872) (issue: [<1>4695](https://github.com/elastic/elasticsearch/issues/14695)) 
  * Translog recovery can repeatedly fail if we run out of disk [<1>4695](https://github.com/elastic/elasticsearch/pull/14695)
  * Pending operations in the translog prevent shard from being marked as inactive [<1>3759](https://github.com/elastic/elasticsearch/pull/13759) (issue: [<1>3707](https://github.com/elastic/elasticsearch/issues/13707)) 



Tribe Node 
    

  * Passthrough environment and network settings to tribe client nodes [<1>6893](https://github.com/elastic/elasticsearch/pull/16893)
  * Tribe node: pass path.conf to inner tribe clients [<1>6258](https://github.com/elastic/elasticsearch/pull/16258) (issue: [<1>6253](https://github.com/elastic/elasticsearch/issues/16253)) 
  * Fix tribe node to load config file for internal client nodes [<1>5300](https://github.com/elastic/elasticsearch/pull/15300) (issues: [<1>3383](https://github.com/elastic/elasticsearch/issues/13383), [<1>4573](https://github.com/elastic/elasticsearch/issues/14573)) 



### Regressions

Analysis 
    

  * Add PathHierarchy type back to path_hierarchy tokenizer for backward compatibility with 1.x [<1>5785](https://github.com/elastic/elasticsearch/pull/15785) (issue: [<1>5756](https://github.com/elastic/elasticsearch/issues/15756)) 



Internal 
    

  * Deduplicate concrete indices after indices resolution [<1>4316](https://github.com/elastic/elasticsearch/pull/14316) (issues: [<1>1258](https://github.com/elastic/elasticsearch/issues/11258), [<1>2058](https://github.com/elastic/elasticsearch/issues/12058)) 



Plugin Cloud Azure 
    

  * Filter cloud azure credentials [<1>4863](https://github.com/elastic/elasticsearch/pull/14863) (issues: [<1>3779](https://github.com/elastic/elasticsearch/issues/13779), [<1>4843](https://github.com/elastic/elasticsearch/issues/14843)) 



REST 
    

  * Don’t return all indices immediately if count of expressions  >1 and first expression is * [<1>7033](https://github.com/elastic/elasticsearch/pull/17033) (issue: [<1>7027](https://github.com/elastic/elasticsearch/issues/17027)) 



### Upgrades

Core 
    

  * Upgrade to Lucene 5.5.0 official release [<1>6742](https://github.com/elastic/elasticsearch/pull/16742)
  * Upgrade to lucene 5.5.0-snapshot-850c6c2 [<1>6615](https://github.com/elastic/elasticsearch/pull/16615)
  * Upgrade to lucene 5.5.0-snapshot-4de5f1d [<1>6400](https://github.com/elastic/elasticsearch/pull/16400) (issues: [<1>6373](https://github.com/elastic/elasticsearch/issues/16373), [<1>6399](https://github.com/elastic/elasticsearch/issues/16399)) 
  * Update lucene to r1725675 [<1>6114](https://github.com/elastic/elasticsearch/pull/16114)
  * Upgrade to lucene-5.5.0-snapshot-1721183. [<1>5575](https://github.com/elastic/elasticsearch/pull/15575)
  * Upgrade Lucene to 5.4.0-snapshot-1715952 [<1>4951](https://github.com/elastic/elasticsearch/pull/14951)
  * Upgrade Lucene to 5.4.0-snapshot-1714615 [<1>4784](https://github.com/elastic/elasticsearch/pull/14784)
  * Upgrade to lucene-5.4.0-snapshot-1712973. [<1>4619](https://github.com/elastic/elasticsearch/pull/14619)
  * update to lucene-5.4.x-snapshot-1711508 [<1>4398](https://github.com/elastic/elasticsearch/pull/14398)
  * Upgrade to lucene-5.4-snapshot-1710880. [<1>4320](https://github.com/elastic/elasticsearch/pull/14320)
  * Upgrade to lucene-5.4-snapshot-1708254. [<1>4074](https://github.com/elastic/elasticsearch/pull/14074)
  * upgrade lucene to r1702265 [<1>3439](https://github.com/elastic/elasticsearch/pull/13439)
  * Upgrade master to lucene 5.4-snapshot r1701068 [<1>3324](https://github.com/elastic/elasticsearch/pull/13324)



Geo 
    

  * Update to spatial4j 0.5 for correct Multi-Geometry [<1>4269](https://github.com/elastic/elasticsearch/pull/14269) (issue: [<9>904](https://github.com/elastic/elasticsearch/issues/9904)) 



Internal 
    

  * Update to Jackson 2.6.2 [<1>3344](https://github.com/elastic/elasticsearch/pull/13344) (issues: [<1>0980](https://github.com/elastic/elasticsearch/issues/10980), [<2>07](https://github.com/elastic/elasticsearch/issues/207), [<2>13](https://github.com/elastic/elasticsearch/issues/213)) 



Plugin Cloud AWS 
    

  * Update AWS SDK version to 1.10.19 [<1>3655](https://github.com/elastic/elasticsearch/pull/13655) (issue: [<1>3656](https://github.com/elastic/elasticsearch/issues/13656)) 



Plugin Cloud Azure 
    

  * Upgrade Azure Storage client to 4.0.0 [<1>6084](https://github.com/elastic/elasticsearch/pull/16084) (issues: [<1>2567](https://github.com/elastic/elasticsearch/issues/12567), [<1>5080](https://github.com/elastic/elasticsearch/issues/15080), [<1>5976](https://github.com/elastic/elasticsearch/issues/15976)) 
  * Update Azure Service Management API to 0.9.0 [<1>5232](https://github.com/elastic/elasticsearch/pull/15232) (issue: [<1>5209](https://github.com/elastic/elasticsearch/issues/15209)) 



Plugin Discovery Azure 
    

  * Upgrade azure SDK to 0.9.3 [<1>7102](https://github.com/elastic/elasticsearch/pull/17102) (issues: [<1>7042](https://github.com/elastic/elasticsearch/issues/17042), [<5>57](https://github.com/elastic/elasticsearch/issues/557)) 



Plugin Discovery EC2 
    

  * Upgrade to aws 1.10.33 [<1>4672](https://github.com/elastic/elasticsearch/pull/14672)



Plugin Lang JS 
    

  * upgrade rhino for plugins/lang-javascript [<1>4466](https://github.com/elastic/elasticsearch/pull/14466)



Scripting 
    

  * Upgrade groovy dependency in lang-groovy module to version 2.4.6 [<1>6830](https://github.com/elastic/elasticsearch/pull/16830) (issue: [<1>6527](https://github.com/elastic/elasticsearch/issues/16527)) 


