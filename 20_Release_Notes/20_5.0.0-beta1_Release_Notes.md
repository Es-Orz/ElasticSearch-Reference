## 5.0.0-beta1 Release Notes

Also see [_5.0的版本变更_](breaking-changes-5.0.html).

![Important](https://www.elastic.co/guide/en/elasticsearch/reference/current/images/icons/important.png)

This is a beta release and is intended for _testing purposes only_. Indices created in this version will **not be compatible with Elasticsearch 5.0.0 GA**. Upgrading 5.0.0-beta1 to any other version is not supported.

### Breaking changes

Analysis 
    

  * Remove `token_filter` in _analyze API [<2>0285](https://github.com/elastic/elasticsearch/pull/20285) (issue: [<2>0283](https://github.com/elastic/elasticsearch/issues/20283)) 
  * Removes support for adding aliases to analyzers [<1>9994](https://github.com/elastic/elasticsearch/pull/19994) (issue: [<1>8244](https://github.com/elastic/elasticsearch/issues/18244)) 



CRUD 
    

  * Fixed naming inconsistency for fields/stored_fields in the APIs [<2>0166](https://github.com/elastic/elasticsearch/pull/20166) (issues: [<1>8943](https://github.com/elastic/elasticsearch/issues/18943), [<2>0155](https://github.com/elastic/elasticsearch/issues/20155)) 
  * Disallow creating indices starting with _-_ or _+_ [<2>0033](https://github.com/elastic/elasticsearch/pull/20033) (issue: [<1>9800](https://github.com/elastic/elasticsearch/issues/19800)) 



Core 
    

  * Remove minimum master nodes bootstrap check [<2>0082](https://github.com/elastic/elasticsearch/pull/20082)



Engine 
    

  * Optimize indexing for the autogenerated ID append-only case [<2>0211](https://github.com/elastic/elasticsearch/pull/20211) (issue: [<1>9813](https://github.com/elastic/elasticsearch/issues/19813)) 



Geo 
    

  * Deprecate GeoDistance enums and remove geo distance script helpers [<1>9783](https://github.com/elastic/elasticsearch/pull/19783)



Logging 
    

  * Introduce Log4j 2 [<2>0235](https://github.com/elastic/elasticsearch/pull/20235) (issues: [<1>6030](https://github.com/elastic/elasticsearch/issues/16030), [<1>7697](https://github.com/elastic/elasticsearch/issues/17697)) 



Packaging 
    

  * Rename service.bat to elasticsearch-service.bat [<2>0496](https://github.com/elastic/elasticsearch/pull/20496) (issue: [<1>7528](https://github.com/elastic/elasticsearch/issues/17528)) 
  * Remove -D handling in args for windows plugin script [<2>0378](https://github.com/elastic/elasticsearch/pull/20378) (issue: [<1>8207](https://github.com/elastic/elasticsearch/issues/18207)) 
  * Set default min heap equal to default max heap [<2>0080](https://github.com/elastic/elasticsearch/pull/20080) (issues: [<1>6334](https://github.com/elastic/elasticsearch/issues/16334), [<1>7728](https://github.com/elastic/elasticsearch/issues/17728), [<1>8311](https://github.com/elastic/elasticsearch/issues/18311)) 



Plugin Lang Painless 
    

  * Make Painless the Default Language [<2>0017](https://github.com/elastic/elasticsearch/pull/20017) (issue: [<1>9960](https://github.com/elastic/elasticsearch/issues/19960)) 



REST 
    

  * Parameter improvements to Cluster Health API wait for shards [<2>0223](https://github.com/elastic/elasticsearch/pull/20223) (issue: [<2>0216](https://github.com/elastic/elasticsearch/issues/20216)) 
  * Switch indices.exists_type from `{index}/{type}` to `{index}/_mapping/{type}`. [<2>0055](https://github.com/elastic/elasticsearch/pull/20055) (issue: [<1>5613](https://github.com/elastic/elasticsearch/issues/15613)) 
  * Only use `PUT` for index creation, not POST. [<2>0001](https://github.com/elastic/elasticsearch/pull/20001) (issues: [<1>5613](https://github.com/elastic/elasticsearch/issues/15613), [<1>8160](https://github.com/elastic/elasticsearch/issues/18160)) 



Scripting 
    

  * Hardcode painless as the default scripting lang and add legacy script default for stored scripts [<2>0310](https://github.com/elastic/elasticsearch/pull/20310) (issue: [<2>0122](https://github.com/elastic/elasticsearch/issues/20122)) 



Settings 
    

  * Default max local storage nodes to one [<1>9964](https://github.com/elastic/elasticsearch/pull/19964) (issues: [<1>9679](https://github.com/elastic/elasticsearch/issues/19679), [<1>9748](https://github.com/elastic/elasticsearch/issues/19748)) 



### Breaking Java changes

Core 
    

  * Remove ability to plug-in TransportService [<2>0505](https://github.com/elastic/elasticsearch/pull/20505)



Internal 
    

  * Remove TransportService#registerRequestHandler leniency [<2>0469](https://github.com/elastic/elasticsearch/pull/20469) (issue: [<2>0468](https://github.com/elastic/elasticsearch/issues/20468)) 
  * Consolidate search parser registries [<2>0000](https://github.com/elastic/elasticsearch/pull/20000)
  * Move all FetchSubPhases to o.e.search.fetch.subphase [<1>9702](https://github.com/elastic/elasticsearch/pull/19702)
  * Squash the rest of o.e.rest.action [<1>9698](https://github.com/elastic/elasticsearch/pull/19698)



Plugins 
    

  * Cleanup sub fetch phase extension point [<2>0382](https://github.com/elastic/elasticsearch/pull/20382)
  * Remove IndexTemplateFilter [<2>0072](https://github.com/elastic/elasticsearch/pull/20072)
  * Switch custom ShardsAllocators to pull based model [<2>0071](https://github.com/elastic/elasticsearch/pull/20071)
  * Make custom allocation deciders use pull based extensions [<2>0040](https://github.com/elastic/elasticsearch/pull/20040)



Search 
    

  * Remove FetchSubPhaseParseElement [<2>0350](https://github.com/elastic/elasticsearch/pull/20350)



### Deprecations

Geo 
    

  * Deprecate optimize_bbox on geodistance queries [<2>0032](https://github.com/elastic/elasticsearch/pull/20032) (issue: [<2>0014](https://github.com/elastic/elasticsearch/issues/20014)) 
  * Deprecate geohash parameters for geo_point parser [<2>0030](https://github.com/elastic/elasticsearch/pull/20030) (issue: [<2>0009](https://github.com/elastic/elasticsearch/issues/20009)) 



Scripting 
    

  * Deprecate Groovy, Python, and Javascript [<2>0244](https://github.com/elastic/elasticsearch/pull/20244) (issue: [<2>0129](https://github.com/elastic/elasticsearch/issues/20129)) 



### New features

Aliases 
    

  * Add an alias action to delete an index [<2>0184](https://github.com/elastic/elasticsearch/pull/20184) (issue: [<2>0064](https://github.com/elastic/elasticsearch/issues/20064)) 



Analysis 
    

  * Exposing lucene 6.x minhash filter. [<2>0206](https://github.com/elastic/elasticsearch/pull/20206) (issue: [<2>0149](https://github.com/elastic/elasticsearch/issues/20149)) 



Geo 
    

  * Cut over geo_point field and queries to new LatLonPoint type [<2>0315](https://github.com/elastic/elasticsearch/pull/20315) (issue: [<2>0314](https://github.com/elastic/elasticsearch/issues/20314)) 



Plugin Discovery File 
    

  * File-based discovery plugin [<2>0394](https://github.com/elastic/elasticsearch/pull/20394) (issue: [<2>0323](https://github.com/elastic/elasticsearch/issues/20323)) 



Search 
    

  * Add the ability to disable the retrieval of the stored fields entirely [<2>0026](https://github.com/elastic/elasticsearch/pull/20026)



Suggesters 
    

  * Add support for returning documents with completion suggester [<1>9536](https://github.com/elastic/elasticsearch/pull/19536) (issue: [<1>0746](https://github.com/elastic/elasticsearch/issues/10746)) 



### Enhancements

Allocation 
    

  * Change DiskThresholdDecider’s behavior when factoring in leaving shards [<2>0349](https://github.com/elastic/elasticsearch/pull/20349)
  * Verify AllocationIDs in replication actions [<2>0320](https://github.com/elastic/elasticsearch/pull/20320)
  * Mark shard as stale on non-replicated write, not on node shutdown [<2>0023](https://github.com/elastic/elasticsearch/pull/20023) (issue: [<1>8919](https://github.com/elastic/elasticsearch/issues/18919)) 
  * Add routing changes API to RoutingAllocation [<1>9992](https://github.com/elastic/elasticsearch/pull/19992)
  * Primary shard allocator observes limits in forcing allocation [<1>9811](https://github.com/elastic/elasticsearch/pull/19811) (issue: [<1>9446](https://github.com/elastic/elasticsearch/issues/19446)) 
  * Use primary terms as authority to fail shards [<1>9715](https://github.com/elastic/elasticsearch/pull/19715)
  * Add recovery source to ShardRouting [<1>9516](https://github.com/elastic/elasticsearch/pull/19516)



Analysis 
    

  * Stop using cached component in _analyze API [<1>9929](https://github.com/elastic/elasticsearch/pull/19929) (issue: [<1>9827](https://github.com/elastic/elasticsearch/issues/19827)) 



Benchmark 
    

  * Add client-benchmark-noop-api-plugin to stress clients even more in benchmarks [<2>0103](https://github.com/elastic/elasticsearch/pull/20103)



CAT API 
    

  * Add health status parameter to cat indices API [<2>0393](https://github.com/elastic/elasticsearch/pull/20393)



Circuit Breakers 
    

  * Circuit break the number of inline scripts compiled per minute [<1>9694](https://github.com/elastic/elasticsearch/pull/19694) (issue: [<1>9396](https://github.com/elastic/elasticsearch/issues/19396)) 



Cluster 
    

  * Add clusterUUID to RestMainAction output [<2>0503](https://github.com/elastic/elasticsearch/pull/20503)



Core 
    

  * Add serial collector bootstrap check [<2>0558](https://github.com/elastic/elasticsearch/pull/20558)
  * Rename Netty TCP transports thread factories from http_* to transport_* [<2>0207](https://github.com/elastic/elasticsearch/pull/20207)
  * Do not log full bootstrap checks exception [<1>9989](https://github.com/elastic/elasticsearch/pull/19989)
  * Mark halting the virtual machine as privileged [<1>9923](https://github.com/elastic/elasticsearch/pull/19923) (issues: [<1>9272](https://github.com/elastic/elasticsearch/issues/19272), [<1>9806](https://github.com/elastic/elasticsearch/issues/19806)) 



Engine 
    

  * Only try to read new segments info if we really flushed the index [<2>0474](https://github.com/elastic/elasticsearch/pull/20474)
  * Use _refresh instead of reading from Translog in the RT GET case [<2>0102](https://github.com/elastic/elasticsearch/pull/20102)



Exceptions 
    

  * Improve startup exception [<2>0083](https://github.com/elastic/elasticsearch/pull/20083)



Index Templates 
    

  * Add "version" field to Templates [<2>0353](https://github.com/elastic/elasticsearch/pull/20353) (issue: [<2>0171](https://github.com/elastic/elasticsearch/issues/20171)) 



Ingest 
    

  * Add "version" field to Pipelines [<2>0343](https://github.com/elastic/elasticsearch/pull/20343) (issue: [<2>0171](https://github.com/elastic/elasticsearch/issues/20171)) 
  * Make it possible for Ingest Processors to access AnalysisRegistry [<2>0233](https://github.com/elastic/elasticsearch/pull/20233)
  * add ignore_missing option to convert,trim,lowercase,uppercase,grok,rename [<2>0194](https://github.com/elastic/elasticsearch/pull/20194) (issue: [<1>9995](https://github.com/elastic/elasticsearch/issues/19995)) 
  * Add support for parameters to the script ingest processor [<2>0136](https://github.com/elastic/elasticsearch/pull/20136)
  * introduce the JSON Processor [<2>0128](https://github.com/elastic/elasticsearch/pull/20128) (issue: [<2>0052](https://github.com/elastic/elasticsearch/issues/20052)) 
  * Allow rename processor to turn leaf fields into branch fields [<2>0053](https://github.com/elastic/elasticsearch/pull/20053) (issue: [<1>9892](https://github.com/elastic/elasticsearch/issues/19892)) 
  * remove ability to set field value in script-processor configuration [<1>9981](https://github.com/elastic/elasticsearch/pull/19981)



Internal 
    

  * Remove poor-mans compression in InternalSearchHit and friends [<2>0472](https://github.com/elastic/elasticsearch/pull/20472)
  * Don’t register SearchTransportService handlers more than once [<2>0468](https://github.com/elastic/elasticsearch/pull/20468)
  * Unguice SearchModule [<2>0456](https://github.com/elastic/elasticsearch/pull/20456)
  * Deguice SearchService and friends [<2>0423](https://github.com/elastic/elasticsearch/pull/20423)
  * NodeStats classes to implement Writeable rather then Streamable [<2>0327](https://github.com/elastic/elasticsearch/pull/20327)
  * More info classes to implement Writeable rather than Streamable [<2>0288](https://github.com/elastic/elasticsearch/pull/20288) (issue: [<2>0255](https://github.com/elastic/elasticsearch/issues/20255)) 
  * Internal: Split disk threshold monitoring from decider [<2>0018](https://github.com/elastic/elasticsearch/pull/20018)
  * Switching LockObtainFailedException over to ShardLockObtainFailedException [<1>9991](https://github.com/elastic/elasticsearch/pull/19991) (issue: [<1>9978](https://github.com/elastic/elasticsearch/issues/19978)) 
  * update and delete by query requests to implement IndicesRequest.Replaceable [<1>9961](https://github.com/elastic/elasticsearch/pull/19961)
  * VersionFetchSubPhase should not use Versions#loadDocIdAndVersion [<1>9944](https://github.com/elastic/elasticsearch/pull/19944)



Java API 
    

  * Ensure PutMappingRequest.buildFromSimplifiedDef input are pairs [<1>9837](https://github.com/elastic/elasticsearch/pull/19837) (issue: [<1>9836](https://github.com/elastic/elasticsearch/issues/19836)) 



Java REST Client 
    

  * Add support for a RestClient path prefix [<2>0190](https://github.com/elastic/elasticsearch/pull/20190)
  * Add "Async" to the end of each Async RestClient method [<2>0172](https://github.com/elastic/elasticsearch/pull/20172) (issue: [<2>0168](https://github.com/elastic/elasticsearch/issues/20168)) 
  * Allow RestClient to send array-based headers [<2>0151](https://github.com/elastic/elasticsearch/pull/20151)



Logging 
    

  * Ensure logging is initialized in CLI tools [<2>0575](https://github.com/elastic/elasticsearch/pull/20575)
  * Give useful error message if log config is missing [<2>0493](https://github.com/elastic/elasticsearch/pull/20493)
  * Complete Elasticsearch logger names [<2>0457](https://github.com/elastic/elasticsearch/pull/20457) (issue: [<2>0326](https://github.com/elastic/elasticsearch/issues/20326)) 
  * Add node name to decider trace logging [<2>0437](https://github.com/elastic/elasticsearch/pull/20437) (issue: [<2>0379](https://github.com/elastic/elasticsearch/issues/20379)) 
  * Logging shutdown hack [<2>0389](https://github.com/elastic/elasticsearch/pull/20389) (issue: [<2>0304](https://github.com/elastic/elasticsearch/issues/20304)) 
  * Disable console logging [<2>0387](https://github.com/elastic/elasticsearch/pull/20387)
  * Skip loading of jansi from log4j2 [<2>0334](https://github.com/elastic/elasticsearch/pull/20334)
  * Configure AWS SDK logging configuration [<2>0313](https://github.com/elastic/elasticsearch/pull/20313) (issue: [<2>0294](https://github.com/elastic/elasticsearch/issues/20294)) 
  * Warn if unsupported logging configuration present [<2>0309](https://github.com/elastic/elasticsearch/pull/20309)
  * Size limit deprecation logs [<2>0287](https://github.com/elastic/elasticsearch/pull/20287) (issues: [<2>0235](https://github.com/elastic/elasticsearch/issues/20235), [<2>0254](https://github.com/elastic/elasticsearch/issues/20254)) 
  * Increase visibility of deprecation logger [<2>0254](https://github.com/elastic/elasticsearch/pull/20254) (issue: [<1>1033](https://github.com/elastic/elasticsearch/issues/11033)) 
  * Add shardId and node name in search slow log [<1>9949](https://github.com/elastic/elasticsearch/pull/19949) (issue: [<1>9735](https://github.com/elastic/elasticsearch/issues/19735)) 



Mapping 
    

  * Automatically downgrade text and keyword to string on indexes imported from 2.x [<2>0177](https://github.com/elastic/elasticsearch/pull/20177)
  * Do not parse numbers as both strings and numbers when not included in `_all`. [<2>0167](https://github.com/elastic/elasticsearch/pull/20167)
  * Don’t index the `_version` field [<2>0132](https://github.com/elastic/elasticsearch/pull/20132)
  * The root object mapper should support updating `numeric_detection`, `date_detection` and `dynamic_date_formats`. [<2>0119](https://github.com/elastic/elasticsearch/pull/20119) (issue: [<2>0111](https://github.com/elastic/elasticsearch/issues/20111)) 
  * Automatically upgrade analyzed string fields that have `index_options` or `position_increment_gap` set. [<2>0002](https://github.com/elastic/elasticsearch/pull/20002) (issue: [<1>9974](https://github.com/elastic/elasticsearch/issues/19974)) 
  * Mappings: Support dots in field names in mapping parsing [<1>9899](https://github.com/elastic/elasticsearch/pull/19899) (issue: [<1>9443](https://github.com/elastic/elasticsearch/issues/19443)) 
  * Save one utf8 conversion in KeywordFieldMapper. [<1>9867](https://github.com/elastic/elasticsearch/pull/19867)
  * Do not parse the created version from the settings every time a field is parsed. [<1>9824](https://github.com/elastic/elasticsearch/pull/19824)



Network 
    

  * Avoid early initializing Netty [<1>9819](https://github.com/elastic/elasticsearch/pull/19819) (issue: [<5>644](https://github.com/elastic/elasticsearch/issues/5644)) 
  * Network: Allow to listen on virtual interfaces. [<1>9568](https://github.com/elastic/elasticsearch/pull/19568) (issues: [<1>7473](https://github.com/elastic/elasticsearch/issues/17473), [<1>9537](https://github.com/elastic/elasticsearch/issues/19537)) 



Packaging 
    

  * Add quiet option to disable console logging [<2>0422](https://github.com/elastic/elasticsearch/pull/20422) (issues: [<1>5315](https://github.com/elastic/elasticsearch/issues/15315), [<1>6159](https://github.com/elastic/elasticsearch/issues/16159), [<1>7220](https://github.com/elastic/elasticsearch/issues/17220)) 
  * Explicitly disable Netty key set replacement [<2>0249](https://github.com/elastic/elasticsearch/pull/20249)



Plugin Lang Painless 
    

  * Disable regexes by default in painless [<2>0427](https://github.com/elastic/elasticsearch/pull/20427) (issue: [<2>0397](https://github.com/elastic/elasticsearch/issues/20397)) 
  * Catch OutOfMemory and StackOverflow errors in Painless [<1>9936](https://github.com/elastic/elasticsearch/pull/19936)



Plugin Repository S3 
    

  * Extract AWS Key from KeyChain instead of using potential null value [<1>9560](https://github.com/elastic/elasticsearch/pull/19560) (issues: [<1>8703](https://github.com/elastic/elasticsearch/issues/18703), [<1>9557](https://github.com/elastic/elasticsearch/issues/19557)) 



Plugins 
    

  * Print message when removing plugin with config [<2>0338](https://github.com/elastic/elasticsearch/pull/20338)
  * Plugins: Update official plugin location with unified release [<1>9996](https://github.com/elastic/elasticsearch/pull/19996)
  * Allow plugins to upgrade global custom metadata on startup [<1>9962](https://github.com/elastic/elasticsearch/pull/19962)
  * Switch aggregations from push to pull [<1>9839](https://github.com/elastic/elasticsearch/pull/19839)
  * Display plugins versions [<1>8683](https://github.com/elastic/elasticsearch/pull/18683)



Query DSL 
    

  * Throw exception when multiple field names are provided as part of query short syntax [<1>9871](https://github.com/elastic/elasticsearch/pull/19871) (issue: [<1>9791](https://github.com/elastic/elasticsearch/issues/19791)) 
  * Query parsers to throw exception when multiple field names are provided [<1>9791](https://github.com/elastic/elasticsearch/pull/19791) (issue: [<1>9547](https://github.com/elastic/elasticsearch/issues/19547)) 



REST 
    

  * Add exclusion support to response filtering [<1>9865](https://github.com/elastic/elasticsearch/pull/19865)



Recovery 
    

  * Pass on maxUnsafeAutoIdTimestamp on recovery / relocation [<2>0300](https://github.com/elastic/elasticsearch/pull/20300)



Scripting 
    

  * Parse script on storage instead of on retrieval [<2>0356](https://github.com/elastic/elasticsearch/pull/20356)
  * Migrate elasticsearch native script examples to the main repo [<1>9334](https://github.com/elastic/elasticsearch/pull/19334) (issue: [<1>4662](https://github.com/elastic/elasticsearch/issues/14662)) 



Settings 
    

  * Make `action.auto_create_index` setting a dynamic cluster setting [<2>0274](https://github.com/elastic/elasticsearch/pull/20274) (issue: [<7>513](https://github.com/elastic/elasticsearch/issues/7513)) 
  * Removes space between # and the setting in elasticsearch.yml [<2>0094](https://github.com/elastic/elasticsearch/pull/20094) (issue: [<2>0090](https://github.com/elastic/elasticsearch/issues/20090)) 



Snapshot/Restore 
    

  * Delete differing files in the store before restoring [<2>0220](https://github.com/elastic/elasticsearch/pull/20220) (issue: [<2>0148](https://github.com/elastic/elasticsearch/issues/20148)) 
  * Adds ignoreUnavailable option to the snapshot status API [<2>0066](https://github.com/elastic/elasticsearch/pull/20066) (issue: [<1>8522](https://github.com/elastic/elasticsearch/issues/18522)) 
  * Check restores in progress before deleting a snapshot [<1>9853](https://github.com/elastic/elasticsearch/pull/19853)
  * Snapshot repository cleans up empty index folders [<1>9751](https://github.com/elastic/elasticsearch/pull/19751)



Stats 
    

  * Add mem div back to cluster stats [<2>0255](https://github.com/elastic/elasticsearch/pull/20255) (issue: [<1>7278](https://github.com/elastic/elasticsearch/issues/17278)) 
  * Add network types to cluster stats [<2>0144](https://github.com/elastic/elasticsearch/pull/20144)



Suggesters 
    

  * Move SuggestUtils methods to their respective caller classes [<1>9914](https://github.com/elastic/elasticsearch/pull/19914) (issue: [<1>9906](https://github.com/elastic/elasticsearch/issues/19906)) 
  * Remove payload option from completion suggester [<1>9877](https://github.com/elastic/elasticsearch/pull/19877) (issue: [<1>9536](https://github.com/elastic/elasticsearch/issues/19536)) 



Task Manager 
    

  * Rename Task Persistence into Storing Task Results [<1>9982](https://github.com/elastic/elasticsearch/pull/19982)



Translog 
    

  * Fsync documents in an async fashion [<2>0145](https://github.com/elastic/elasticsearch/pull/20145)
  * Add checksumming and versions to the Translog’s Checkpoint files [<1>9797](https://github.com/elastic/elasticsearch/pull/19797)



### Bug fixes

Aggregations 
    

  * Fix agg profiling when using breadth_first collect mode [<2>0156](https://github.com/elastic/elasticsearch/pull/20156)
  * Throw exception when maxBounds greater than minBounds [<1>9855](https://github.com/elastic/elasticsearch/pull/19855) (issue: [<1>9833](https://github.com/elastic/elasticsearch/issues/19833)) 



Allocation 
    

  * Upon being elected as master, prefer joins' node info to existing cluster state [<1>9743](https://github.com/elastic/elasticsearch/pull/19743)



Analysis 
    

  * Can load non-PreBuiltTokenFilter in Analyze API [<2>0396](https://github.com/elastic/elasticsearch/pull/20396)



CRUD 
    

  * GET operations should not extract fields from `_source`. [<2>0158](https://github.com/elastic/elasticsearch/pull/20158) (issues: [<1>5017](https://github.com/elastic/elasticsearch/issues/15017), [<2>0102](https://github.com/elastic/elasticsearch/issues/20102)) 



Cache 
    

  * Serialize index boost and phrase suggest collation keys in a consistent order [<2>0081](https://github.com/elastic/elasticsearch/pull/20081) (issue: [<1>9986](https://github.com/elastic/elasticsearch/issues/19986)) 



Cluster 
    

  * Fixes issue with dangling index being deleted instead of re-imported [<1>9666](https://github.com/elastic/elasticsearch/pull/19666)



Discovery 
    

  * Update discovery nodes after cluster state is published [<2>0409](https://github.com/elastic/elasticsearch/pull/20409)
  * Add current cluster state version to zen pings and use them in master election [<2>0384](https://github.com/elastic/elasticsearch/pull/20384) (issue: [<2>0348](https://github.com/elastic/elasticsearch/issues/20348)) 



Engine 
    

  * Take refresh IOExceptions into account when catching ACE in InternalEngine [<2>0546](https://github.com/elastic/elasticsearch/pull/20546) (issue: [<1>9975](https://github.com/elastic/elasticsearch/issues/19975)) 
  * Don’t suppress AlreadyClosedException [<1>9975](https://github.com/elastic/elasticsearch/pull/19975) (issue: [<1>9861](https://github.com/elastic/elasticsearch/issues/19861)) 



Highlighting 
    

  * Fix highlighting of MultiTermQuery within a FunctionScoreQuery [<2>0400](https://github.com/elastic/elasticsearch/pull/20400) (issue: [<2>0392](https://github.com/elastic/elasticsearch/issues/20392)) 
  * Enable BoostingQuery with FVH highlighter [<1>9984](https://github.com/elastic/elasticsearch/pull/19984) (issue: [<1>9985](https://github.com/elastic/elasticsearch/issues/19985)) 



Index APIs 
    

  * Fix IndexNotFoundException in multi index search request. [<2>0188](https://github.com/elastic/elasticsearch/pull/20188) (issue: [<3>839](https://github.com/elastic/elasticsearch/issues/3839)) 



Ingest 
    

  * Don’t rebuild pipeline on every cluster state update [<2>0189](https://github.com/elastic/elasticsearch/pull/20189)
  * Add dotexpander processor [<2>0078](https://github.com/elastic/elasticsearch/pull/20078)



Internal 
    

  * Ensure elasticsearch doesn’t start with unuspported indices [<2>0514](https://github.com/elastic/elasticsearch/pull/20514) (issue: [<2>0512](https://github.com/elastic/elasticsearch/issues/20512)) 
  * Remove ListTasksResponse#setDiscoveryNodes() [<1>9773](https://github.com/elastic/elasticsearch/pull/19773) (issue: [<1>9772](https://github.com/elastic/elasticsearch/issues/19772)) 



Java API 
    

  * fix IndexResponse#toString to print out shards info [<2>0562](https://github.com/elastic/elasticsearch/pull/20562)
  * Add NamedWriteables from plugins to TransportClient [<1>9825](https://github.com/elastic/elasticsearch/pull/19825) (issue: [<1>9764](https://github.com/elastic/elasticsearch/issues/19764)) 



Logging 
    

  * Avoid unnecessary creation of prefix loggers [<2>0571](https://github.com/elastic/elasticsearch/pull/20571) (issue: [<2>0570](https://github.com/elastic/elasticsearch/issues/20570)) 
  * Fix logging hierarchy configs [<2>0463](https://github.com/elastic/elasticsearch/pull/20463)
  * Fix prefix logging [<2>0429](https://github.com/elastic/elasticsearch/pull/20429)
  * Hack around Log4j bug rendering exceptions [<2>0306](https://github.com/elastic/elasticsearch/pull/20306) (issue: [<2>0304](https://github.com/elastic/elasticsearch/issues/20304)) 
  * Avoid prematurely triggering logger initialization [<2>0170](https://github.com/elastic/elasticsearch/pull/20170)



Mapping 
    

  * Mapping updates on objects should propagate `include_an_all`. [<2>0051](https://github.com/elastic/elasticsearch/pull/20051)
  * Validate blank field name [<1>9860](https://github.com/elastic/elasticsearch/pull/19860) (issue: [<1>9251](https://github.com/elastic/elasticsearch/issues/19251)) 



Network 
    

  * Fix expect 100 continue header handling [<1>9904](https://github.com/elastic/elasticsearch/pull/19904) (issue: [<1>9834](https://github.com/elastic/elasticsearch/issues/19834)) 
  * Fixes netty4 module’s CORS config to use defaults [<1>9874](https://github.com/elastic/elasticsearch/pull/19874)
  * Fix various concurrency issues in transport [<1>9675](https://github.com/elastic/elasticsearch/pull/19675)



Packaging 
    

  * [Packaging] Do not remove scripts directory on upgrade [<2>0452](https://github.com/elastic/elasticsearch/pull/20452)
  * [Package] Remove bin/lib/modules directories on RPM uninstall/upgrade [<2>0448](https://github.com/elastic/elasticsearch/pull/20448)
  * RESTART_ON_UPGRADE incorrectly named ES_RESTART_ON_UPGRADE in sysconfig [<1>9976](https://github.com/elastic/elasticsearch/pull/19976) (issue: [<1>9950](https://github.com/elastic/elasticsearch/issues/19950)) 
  * Fix handling of spaces for jvm.options on Windows [<1>9951](https://github.com/elastic/elasticsearch/pull/19951) (issue: [<1>9941](https://github.com/elastic/elasticsearch/issues/19941)) 



Percolator 
    

  * Fail indexing percolator queries containing either a has_child or has_parent query [<2>0229](https://github.com/elastic/elasticsearch/pull/20229) (issue: [<2>960](https://github.com/elastic/elasticsearch/issues/2960)) 



Plugin Ingest Attachment 
    

  * Adds content-length as number [<1>9927](https://github.com/elastic/elasticsearch/pull/19927) (issue: [<1>9924](https://github.com/elastic/elasticsearch/issues/19924)) 



Plugin Ingest GeoIp 
    

  * [ingest-geoip] update geoip to not include null-valued results from [<2>0455](https://github.com/elastic/elasticsearch/pull/20455)



Plugin Lang Painless 
    

  * Fix break bug in for/foreach loops. [<2>0146](https://github.com/elastic/elasticsearch/pull/20146)



Plugins 
    

  * Use sysprop like with es.path.home to pass conf dir [<1>8870](https://github.com/elastic/elasticsearch/pull/18870) (issue: [<1>8689](https://github.com/elastic/elasticsearch/issues/18689)) 



Query DSL 
    

  * Fix silently accepting malformed queries [<2>0515](https://github.com/elastic/elasticsearch/pull/20515) (issue: [<2>0500](https://github.com/elastic/elasticsearch/issues/20500)) 
  * query_string_query should take term length into consideration when fuzziness is auto [<2>0299](https://github.com/elastic/elasticsearch/pull/20299) (issue: [<1>5972](https://github.com/elastic/elasticsearch/issues/15972)) 



Recovery 
    

  * Fix concurrency issues between cancelling a relocation and marking shard as relocated [<2>0443](https://github.com/elastic/elasticsearch/pull/20443)



Reindex API 
    

  * Fix reindex with transport client [<1>9997](https://github.com/elastic/elasticsearch/pull/19997) (issues: [<1>9773](https://github.com/elastic/elasticsearch/issues/19773), [<1>9979](https://github.com/elastic/elasticsearch/issues/19979)) 
  * Make reindex and lang-javascript compatible [<1>9933](https://github.com/elastic/elasticsearch/pull/19933)



Scripting 
    

  * Fix Javascript OOM build Failure [<2>0307](https://github.com/elastic/elasticsearch/pull/20307)
  * Fix propagating the default value for script settings [<2>0183](https://github.com/elastic/elasticsearch/pull/20183) (issue: [<2>0159](https://github.com/elastic/elasticsearch/issues/20159)) 
  * Catch and wrap AssertionError and NoClassDefFoundError in groovy scripts [<1>9958](https://github.com/elastic/elasticsearch/pull/19958) (issues: [<1>9806](https://github.com/elastic/elasticsearch/issues/19806), [<1>9923](https://github.com/elastic/elasticsearch/issues/19923)) 



Search 
    

  * Throw error when trying to fetch fields from source and source is disabled [<2>0424](https://github.com/elastic/elasticsearch/pull/20424) (issues: [<2>0093](https://github.com/elastic/elasticsearch/issues/20093), [<2>0408](https://github.com/elastic/elasticsearch/issues/20408)) 
  * Source filtering should keep working when the source contains numbers greater than `Long.MAX_VALUE`. [<2>0278](https://github.com/elastic/elasticsearch/pull/20278) (issue: [<1>1508](https://github.com/elastic/elasticsearch/issues/11508)) 
  * Fix NPE when running a range query on a `scaled_float` with no upper bound. [<2>0253](https://github.com/elastic/elasticsearch/pull/20253)
  * Add ref-counting to SearchContext to prevent accessing already closed readers [<2>0095](https://github.com/elastic/elasticsearch/pull/20095) (issue: [<2>0008](https://github.com/elastic/elasticsearch/issues/20008)) 
  * Fix NPE during search with source filtering if the source is disabled. [<2>0093](https://github.com/elastic/elasticsearch/pull/20093) (issue: [<7>758](https://github.com/elastic/elasticsearch/issues/7758)) 
  * Restore assignment of time value when deserializing a scroll instance [<1>9977](https://github.com/elastic/elasticsearch/pull/19977) (issue: [<1>8820](https://github.com/elastic/elasticsearch/issues/18820)) 
  * Fix explain output for dfs query [<1>9972](https://github.com/elastic/elasticsearch/pull/19972) (issue: [<1>5369](https://github.com/elastic/elasticsearch/issues/15369)) 



Settings 
    

  * Validate max thread/merge settings [<2>0383](https://github.com/elastic/elasticsearch/pull/20383) (issue: [<2>0380](https://github.com/elastic/elasticsearch/issues/20380)) 
  * Fix filter cache setting to allow percentages [<2>0335](https://github.com/elastic/elasticsearch/pull/20335) (issue: [<2>0330](https://github.com/elastic/elasticsearch/issues/20330)) 
  * Move cluster.routing.allocation.same_shard.host setting to new settings infrastructure [<2>0046](https://github.com/elastic/elasticsearch/pull/20046) (issue: [<2>0045](https://github.com/elastic/elasticsearch/issues/20045)) 



Stats 
    

  * Fix FieldStats deserialization of `ip` field [<2>0522](https://github.com/elastic/elasticsearch/pull/20522) (issue: [<2>0516](https://github.com/elastic/elasticsearch/issues/20516)) 



Translog 
    

  * Fix RAM usage estimation of LiveVersionMap. [<2>0123](https://github.com/elastic/elasticsearch/pull/20123) (issue: [<1>9787](https://github.com/elastic/elasticsearch/issues/19787)) 



### Upgrades

Core 
    

  * Upgrade to Lucene 6.2.0 [<2>0147](https://github.com/elastic/elasticsearch/pull/20147) (issue: [<2>0092](https://github.com/elastic/elasticsearch/issues/20092)) 
  * Update to jackson 2.8.1 [<1>8939](https://github.com/elastic/elasticsearch/pull/18939) (issue: [<1>8076](https://github.com/elastic/elasticsearch/issues/18076)) 



Network 
    

  * Upgrade to Netty 4.1.5 [<2>0222](https://github.com/elastic/elasticsearch/pull/20222) (issue: [<1>9786](https://github.com/elastic/elasticsearch/issues/19786)) 



Scripting 
    

  * Dependencies: Updates to mustache 0.9.3 [<2>0337](https://github.com/elastic/elasticsearch/pull/20337)


