## 5.0.0 Combined Release Notes

The list below covers all changes from 5.0.0-alpha1 to 5.0.0 GA excluding changes which were already released in the 2.x series, which can be found in [_5.0.0-alpha1 Release Notes (Changes previously released in 2.x)_](release-notes-5.0.0-alpha1-2x.html).

Also see [_5.0的版本变更_](breaking-changes-5.0.html).

### Breaking changes

Aggregations 
    

  * Remove size 0 options in aggregations [<1>8854](https://github.com/elastic/elasticsearch/pull/18854) (issue: [<1>8838](https://github.com/elastic/elasticsearch/issues/18838)) 



Aliases 
    

  * make get alias expand to open and closed indices by default [<1>5954](https://github.com/elastic/elasticsearch/pull/15954) (issue: [<1>4982](https://github.com/elastic/elasticsearch/issues/14982)) 
  * Remove deprecated indices.get_aliases [<1>3906](https://github.com/elastic/elasticsearch/pull/13906)



Allocation 
    

  * Remove DisableAllocationDecider [<1>3313](https://github.com/elastic/elasticsearch/pull/13313)



Analysis 
    

  * Remove `token_filter` in _analyze API [<2>0285](https://github.com/elastic/elasticsearch/pull/20285) (issue: [<2>0283](https://github.com/elastic/elasticsearch/issues/20283)) 
  * Removes support for adding aliases to analyzers [<1>9994](https://github.com/elastic/elasticsearch/pull/19994) (issue: [<1>8244](https://github.com/elastic/elasticsearch/issues/18244)) 
  * Analyze API : Rename filters/token_filters/char_filter in Analyze API in master [<1>7843](https://github.com/elastic/elasticsearch/pull/17843) (issue: [<1>5189](https://github.com/elastic/elasticsearch/issues/15189)) 



CAT API 
    

  * Improve cat thread pool API [<1>9721](https://github.com/elastic/elasticsearch/pull/19721) (issue: [<1>9590](https://github.com/elastic/elasticsearch/issues/19590)) 
  * Row-centric output for _cat/fielddata [<1>8068](https://github.com/elastic/elasticsearch/pull/18068) (issue: [<1>0249](https://github.com/elastic/elasticsearch/issues/10249)) 
  * Add raw recovery progress to cat recovery API [<1>7064](https://github.com/elastic/elasticsearch/pull/17064) (issue: [<1>7022](https://github.com/elastic/elasticsearch/issues/17022)) 
  * Remove host from cat nodes API [<1>6656](https://github.com/elastic/elasticsearch/pull/16656) (issues: [<1>2959](https://github.com/elastic/elasticsearch/issues/12959), [<1>6575](https://github.com/elastic/elasticsearch/issues/16575)) 
  * Using the accept header in the request instead of content-type in _cat API. [<1>4421](https://github.com/elastic/elasticsearch/pull/14421) (issue: [<1>4195](https://github.com/elastic/elasticsearch/issues/14195)) 



CRUD 
    

  * Fixed naming inconsistency for fields/stored_fields in the APIs [<2>0166](https://github.com/elastic/elasticsearch/pull/20166) (issues: [<1>8943](https://github.com/elastic/elasticsearch/issues/18943), [<2>0155](https://github.com/elastic/elasticsearch/issues/20155)) 
  * Disallow creating indices starting with _-_ or _+_ [<2>0033](https://github.com/elastic/elasticsearch/pull/20033) (issue: [<1>9800](https://github.com/elastic/elasticsearch/issues/19800)) 
  * Wait for changes to be visible by search [<1>7986](https://github.com/elastic/elasticsearch/pull/17986) (issue: [<1>063](https://github.com/elastic/elasticsearch/issues/1063)) 
  * Remove object notation for core types. [<1>5684](https://github.com/elastic/elasticsearch/pull/15684) (issue: [<1>5388](https://github.com/elastic/elasticsearch/issues/15388)) 



Cache 
    

  * Remove deprecated query cache settings [<1>5592](https://github.com/elastic/elasticsearch/pull/15592)



Cluster 
    

  * Persistent Node Ids [<1>9140](https://github.com/elastic/elasticsearch/pull/19140) (issue: [<1>7811](https://github.com/elastic/elasticsearch/issues/17811)) 
  * Remove validation errors from cluster health response [<1>7773](https://github.com/elastic/elasticsearch/pull/17773) (issue: [<1>6979](https://github.com/elastic/elasticsearch/issues/16979)) 
  * Remove memory div [<1>7278](https://github.com/elastic/elasticsearch/pull/17278) (issues: [<1>2049](https://github.com/elastic/elasticsearch/issues/12049), [<1>6756](https://github.com/elastic/elasticsearch/issues/16756)) 



Core 
    

  * Remove ignore system bootstrap checks [<2>0511](https://github.com/elastic/elasticsearch/pull/20511)
  * Remove minimum master nodes bootstrap check [<2>0082](https://github.com/elastic/elasticsearch/pull/20082)
  * Keep input time unit when parsing TimeValues [<1>9102](https://github.com/elastic/elasticsearch/pull/19102)
  * Remove cluster name from data path [<1>8554](https://github.com/elastic/elasticsearch/pull/18554) (issue: [<1>7810](https://github.com/elastic/elasticsearch/issues/17810)) 
  * Add max number of processes check [<1>6919](https://github.com/elastic/elasticsearch/pull/16919)
  * Add mlockall bootstrap check [<1>6909](https://github.com/elastic/elasticsearch/pull/16909)
  * One log [<1>6703](https://github.com/elastic/elasticsearch/pull/16703) (issue: [<1>6585](https://github.com/elastic/elasticsearch/issues/16585)) 



Engine 
    

  * Optimize indexing for the autogenerated ID append-only case [<2>0211](https://github.com/elastic/elasticsearch/pull/20211) (issue: [<1>9813](https://github.com/elastic/elasticsearch/issues/19813)) 
  * Remove `index.compound_on_flush` setting and default to `true` [<1>5594](https://github.com/elastic/elasticsearch/pull/15594) (issue: [<1>0778](https://github.com/elastic/elasticsearch/issues/10778)) 



Exceptions 
    

  * Die with dignity [<1>9272](https://github.com/elastic/elasticsearch/pull/19272) (issue: [<1>9231](https://github.com/elastic/elasticsearch/issues/19231)) 



Fielddata 
    

  * Remove "uninverted" and "binary" fielddata support for numeric and boolean fields. [<1>4082](https://github.com/elastic/elasticsearch/pull/14082) (issue: [<1>4113](https://github.com/elastic/elasticsearch/issues/14113)) 



Geo 
    

  * Deprecate GeoDistance enums and remove geo distance script helpers [<1>9783](https://github.com/elastic/elasticsearch/pull/19783)



Index APIs 
    

  * Removes write consistency level across replication action APIs in favor of wait_for_active_shards [<1>9454](https://github.com/elastic/elasticsearch/pull/19454) (issue: [<1>8985](https://github.com/elastic/elasticsearch/issues/18985)) 
  * Remove `GET` option for /_forcemerge [<1>5223](https://github.com/elastic/elasticsearch/pull/15223) (issue: [<1>5165](https://github.com/elastic/elasticsearch/issues/15165)) 
  * Remove /_optimize REST API endpoint [<1>4226](https://github.com/elastic/elasticsearch/pull/14226) (issue: [<1>3778](https://github.com/elastic/elasticsearch/issues/13778)) 



Indexed Scripts/Templates 
    

  * Store indexed scripts in the cluster state instead of the `.scripts` index [<1>7650](https://github.com/elastic/elasticsearch/pull/17650) (issue: [<1>6651](https://github.com/elastic/elasticsearch/issues/16651)) 



Inner Hits 
    

  * Also do not serialize `_index` key in search response for parent/child inner hits [<1>9011](https://github.com/elastic/elasticsearch/pull/19011)
  * Don’t include `_id`, `_type` and `_index` keys in search response for inner hits [<1>8995](https://github.com/elastic/elasticsearch/pull/18995) (issue: [<1>8091](https://github.com/elastic/elasticsearch/issues/18091)) 
  * Nested inner hits shouldn’t use relative paths [<1>8567](https://github.com/elastic/elasticsearch/pull/18567) (issue: [<1>6653](https://github.com/elastic/elasticsearch/issues/16653)) 
  * Drop top level inner hits in favour of inner hits defined in the query dsl [<1>7816](https://github.com/elastic/elasticsearch/pull/17816) (issue: [<1>1118](https://github.com/elastic/elasticsearch/issues/11118)) 



Internal 
    

  * `_flush` should block by default [<2>0597](https://github.com/elastic/elasticsearch/pull/20597) (issue: [<2>0569](https://github.com/elastic/elasticsearch/issues/20569)) 
  * Actually bound the generic thread pool [<1>7017](https://github.com/elastic/elasticsearch/pull/17017)
  * Remove support for pre 2.0 indices [<1>3799](https://github.com/elastic/elasticsearch/pull/13799)



Logging 
    

  * Introduce Log4j 2 [<2>0235](https://github.com/elastic/elasticsearch/pull/20235) (issues: [<1>6030](https://github.com/elastic/elasticsearch/issues/16030), [<1>7697](https://github.com/elastic/elasticsearch/issues/17697)) 



Mapping 
    

  * Remove `_timestamp` and `_ttl` on 5.x indices. [<1>8980](https://github.com/elastic/elasticsearch/pull/18980) (issue: [<1>8280](https://github.com/elastic/elasticsearch/issues/18280)) 
  * Add a soft limit on the mapping depth. [<1>7400](https://github.com/elastic/elasticsearch/pull/17400)
  * Disable fielddata on text fields by defaults. [<1>7386](https://github.com/elastic/elasticsearch/pull/17386)
  * Add limit to total number of fields in mapping [<1>7357](https://github.com/elastic/elasticsearch/pull/17357)
  * Change the field mapping index time boost into a query time boost. [<1>6900](https://github.com/elastic/elasticsearch/pull/16900)
  * Deprecate string in favor of text/keyword. [<1>6877](https://github.com/elastic/elasticsearch/pull/16877)
  * Term vector APIs should no longer update mappings [<1>6285](https://github.com/elastic/elasticsearch/pull/16285)
  * Remove the `format` option of the `_source` field. [<1>5398](https://github.com/elastic/elasticsearch/pull/15398)
  * Remove transform [<1>3657](https://github.com/elastic/elasticsearch/pull/13657) (issue: [<1>2674](https://github.com/elastic/elasticsearch/issues/12674)) 



Packaging 
    

  * Rename service.bat to elasticsearch-service.bat [<2>0496](https://github.com/elastic/elasticsearch/pull/20496) (issue: [<1>7528](https://github.com/elastic/elasticsearch/issues/17528)) 
  * Remove -D handling in args for windows plugin script [<2>0378](https://github.com/elastic/elasticsearch/pull/20378) (issue: [<1>8207](https://github.com/elastic/elasticsearch/issues/18207)) 
  * Set default min heap equal to default max heap [<2>0080](https://github.com/elastic/elasticsearch/pull/20080) (issues: [<1>6334](https://github.com/elastic/elasticsearch/issues/16334), [<1>7728](https://github.com/elastic/elasticsearch/issues/17728), [<1>8311](https://github.com/elastic/elasticsearch/issues/18311)) 
  * Remove allow running as root [<1>8694](https://github.com/elastic/elasticsearch/pull/18694) (issue: [<1>8688](https://github.com/elastic/elasticsearch/issues/18688)) 
  * Require /bin/bash in packaging [<1>8259](https://github.com/elastic/elasticsearch/pull/18259) (issue: [<1>8251](https://github.com/elastic/elasticsearch/issues/18251)) 
  * Remove plugin script parsing of system properties [<1>8207](https://github.com/elastic/elasticsearch/pull/18207) (issue: [<1>8140](https://github.com/elastic/elasticsearch/issues/18140)) 
  * Add JVM options configuration file [<1>7675](https://github.com/elastic/elasticsearch/pull/17675) (issue: [<1>7121](https://github.com/elastic/elasticsearch/issues/17121)) 



Parent/Child 
    

  * Removed `total` score mode in favour for `sum` score mode. [<1>7174](https://github.com/elastic/elasticsearch/pull/17174) (issues: [<1>3470](https://github.com/elastic/elasticsearch/issues/13470), [<1>7083](https://github.com/elastic/elasticsearch/issues/17083)) 
  * Removed pre 2.x parent child implementation [<1>3376](https://github.com/elastic/elasticsearch/pull/13376)



Percolator 
    

  * Remove `.percolator` type in favour of `percolator` field type [<1>7560](https://github.com/elastic/elasticsearch/pull/17560)
  * Change the percolate api to not dynamically add fields to mapping [<1>6077](https://github.com/elastic/elasticsearch/pull/16077) (issue: [<1>5751](https://github.com/elastic/elasticsearch/issues/15751)) 



Plugin Delete By Query 
    

  * Remove Delete-By-Query plugin [<1>8516](https://github.com/elastic/elasticsearch/pull/18516) (issue: [<1>8469](https://github.com/elastic/elasticsearch/issues/18469)) 



Plugin Lang Painless 
    

  * Remove all date _now_ methods from Painless [<2>0766](https://github.com/elastic/elasticsearch/pull/20766) (issue: [<2>0762](https://github.com/elastic/elasticsearch/issues/20762)) 
  * Make Painless the Default Language [<2>0017](https://github.com/elastic/elasticsearch/pull/20017) (issue: [<1>9960](https://github.com/elastic/elasticsearch/issues/19960)) 



Plugins 
    

  * Plugins cleanup [<1>8594](https://github.com/elastic/elasticsearch/pull/18594) (issue: [<1>8588](https://github.com/elastic/elasticsearch/issues/18588)) 
  * Rename bin/plugin in bin/elasticsearch-plugin [<1>6454](https://github.com/elastic/elasticsearch/pull/16454)
  * Change the inner structure of the plugins zip [<1>6453](https://github.com/elastic/elasticsearch/pull/16453)
  * Remove multicast plugin [<1>6326](https://github.com/elastic/elasticsearch/pull/16326) (issue: [<1>6310](https://github.com/elastic/elasticsearch/issues/16310)) 
  * Plugins: Remove site plugins [<1>6038](https://github.com/elastic/elasticsearch/pull/16038)



Query DSL 
    

  * Lessen leniency of the query dsl. [<1>8276](https://github.com/elastic/elasticsearch/pull/18276)
  * Function score query: remove deprecated support for boost_factor [<1>3510](https://github.com/elastic/elasticsearch/pull/13510)
  * Remove support for deprecated queries. [<1>3418](https://github.com/elastic/elasticsearch/pull/13418) (issue: [<1>3326](https://github.com/elastic/elasticsearch/issues/13326)) 



REST 
    

  * Change separator for shards preference [<2>0786](https://github.com/elastic/elasticsearch/pull/20786) (issues: [<2>0722](https://github.com/elastic/elasticsearch/issues/20722), [<2>0769](https://github.com/elastic/elasticsearch/issues/20769)) 
  * Parameter improvements to Cluster Health API wait for shards [<2>0223](https://github.com/elastic/elasticsearch/pull/20223) (issue: [<2>0216](https://github.com/elastic/elasticsearch/issues/20216)) 
  * Switch indices.exists_type from `{index}/{type}` to `{index}/_mapping/{type}`. [<2>0055](https://github.com/elastic/elasticsearch/pull/20055) (issue: [<1>5613](https://github.com/elastic/elasticsearch/issues/15613)) 
  * Only use `PUT` for index creation, not POST. [<2>0001](https://github.com/elastic/elasticsearch/pull/20001) (issues: [<1>5613](https://github.com/elastic/elasticsearch/issues/15613), [<1>8160](https://github.com/elastic/elasticsearch/issues/18160)) 
  * Remove camelCase support [<1>7933](https://github.com/elastic/elasticsearch/pull/17933) (issue: [<8>988](https://github.com/elastic/elasticsearch/issues/8988)) 
  * Remove _case_ parameter from rest apis [<1>7774](https://github.com/elastic/elasticsearch/pull/17774) (issue: [<8>988](https://github.com/elastic/elasticsearch/issues/8988)) 
  * Disallow unquoted field names [<1>5351](https://github.com/elastic/elasticsearch/pull/15351) (issue: [<9>800](https://github.com/elastic/elasticsearch/issues/9800)) 
  * Limit the accepted length of the _id [<1>6036](https://github.com/elastic/elasticsearch/pull/16036) (issue: [<1>6034](https://github.com/elastic/elasticsearch/issues/16034)) 



Scripting 
    

  * Hardcode painless as the default scripting lang and add legacy script default for stored scripts [<2>0310](https://github.com/elastic/elasticsearch/pull/20310) (issue: [<2>0122](https://github.com/elastic/elasticsearch/issues/20122)) 
  * Remove deprecated 1.x script and template syntax [<1>9387](https://github.com/elastic/elasticsearch/pull/19387) (issue: [<1>3729](https://github.com/elastic/elasticsearch/issues/13729)) 
  * Allow only a single extension for a scripting engine [<1>8332](https://github.com/elastic/elasticsearch/pull/18332) (issue: [<1>0598](https://github.com/elastic/elasticsearch/issues/10598)) 
  * Remove _sandbox_ option for script settings, allow only registering a single language. [<1>8226](https://github.com/elastic/elasticsearch/pull/18226) (issues: [<1>0598](https://github.com/elastic/elasticsearch/issues/10598), [<1>7114](https://github.com/elastic/elasticsearch/issues/17114)) 



Search 
    

  * Rename `fields` to `stored_fields` and add `docvalue_fields` [<1>8992](https://github.com/elastic/elasticsearch/pull/18992) (issue: [<1>8943](https://github.com/elastic/elasticsearch/issues/18943)) 
  * Remove only node preference [<1>8875](https://github.com/elastic/elasticsearch/pull/18875) (issue: [<1>8822](https://github.com/elastic/elasticsearch/issues/18822)) 
  * Add search preference to prefer multiple nodes [<1>8872](https://github.com/elastic/elasticsearch/pull/18872) (issue: [<1>8822](https://github.com/elastic/elasticsearch/issues/18822)) 
  * Add a soft limit on the number of shards that can be queried in a single search request. [<1>7396](https://github.com/elastic/elasticsearch/pull/17396)
  * Remove deprecated reverse option from sorting [<1>7282](https://github.com/elastic/elasticsearch/pull/17282) (issue: [<1>7047](https://github.com/elastic/elasticsearch/issues/17047)) 
  * Remove some deprecations [<1>4331](https://github.com/elastic/elasticsearch/pull/14331)
  * Remove search exists api [<1>3911](https://github.com/elastic/elasticsearch/pull/13911) (issues: [<1>3682](https://github.com/elastic/elasticsearch/issues/13682), [<1>3910](https://github.com/elastic/elasticsearch/issues/13910)) 
  * Remove the scan and count search types. [<1>3310](https://github.com/elastic/elasticsearch/pull/13310)



Search Refactoring 
    

  * Remove deprecated parameter from field sort builder. [<1>6573](https://github.com/elastic/elasticsearch/pull/16573) (issue: [<1>6127](https://github.com/elastic/elasticsearch/issues/16127)) 
  * Remove "query" query and fix related parsing bugs [<1>4304](https://github.com/elastic/elasticsearch/pull/14304) (issue: [<1>3326](https://github.com/elastic/elasticsearch/issues/13326)) 



Settings 
    

  * Default max local storage nodes to one [<1>9964](https://github.com/elastic/elasticsearch/pull/19964) (issues: [<1>9679](https://github.com/elastic/elasticsearch/issues/19679), [<1>9748](https://github.com/elastic/elasticsearch/issues/19748)) 
  * Persistent Node Names [<1>9456](https://github.com/elastic/elasticsearch/pull/19456) (issue: [<1>9140](https://github.com/elastic/elasticsearch/issues/19140)) 
  * Remove support for properties [<1>9398](https://github.com/elastic/elasticsearch/pull/19398) (issues: [<1>9388](https://github.com/elastic/elasticsearch/issues/19388), [<1>9391](https://github.com/elastic/elasticsearch/issues/19391)) 
  * Rename boostrap.mlockall to bootstrap.memory_lock [<1>8669](https://github.com/elastic/elasticsearch/pull/18669)
  * Register `indices.query.bool.max_clause_count` setting [<1>8341](https://github.com/elastic/elasticsearch/pull/18341) (issue: [<1>8336](https://github.com/elastic/elasticsearch/issues/18336)) 
  * Remove settings and system properties entanglement [<1>8198](https://github.com/elastic/elasticsearch/pull/18198) (issue: [<1>8197](https://github.com/elastic/elasticsearch/issues/18197)) 
  * Remove `action.get.realtime` setting [<1>7857](https://github.com/elastic/elasticsearch/pull/17857) (issue: [<1>2543](https://github.com/elastic/elasticsearch/issues/12543)) 
  * Remove ability to specify arbitrary node attributes with `node.` prefix [<1>7402](https://github.com/elastic/elasticsearch/pull/17402) (issue: [<1>7280](https://github.com/elastic/elasticsearch/issues/17280)) 
  * Enforce `discovery.zen.minimum_master_nodes` is set when bound to a public ip [<1>7288](https://github.com/elastic/elasticsearch/pull/17288)
  * Prevent index level setting from being configured on a node level [<1>7144](https://github.com/elastic/elasticsearch/pull/17144) (issue: [<1>6799](https://github.com/elastic/elasticsearch/issues/16799)) 
  * Remove support for node.client setting [<1>6963](https://github.com/elastic/elasticsearch/pull/16963) (issue: [<1>6565](https://github.com/elastic/elasticsearch/issues/16565)) 
  * Remove es.max-open-files flag [<1>6757](https://github.com/elastic/elasticsearch/pull/16757) (issues: [<1>6506](https://github.com/elastic/elasticsearch/issues/16506), [<4>83](https://github.com/elastic/elasticsearch/issues/483)) 
  * Enforce node level limits if node is started in production env [<1>6733](https://github.com/elastic/elasticsearch/pull/16733) (issue: [<1>6727](https://github.com/elastic/elasticsearch/issues/16727)) 
  * Make settings validation strict [<1>6365](https://github.com/elastic/elasticsearch/pull/16365)
  * Remove the ability to fsync on every operation and only schedule fsync task if really needed [<1>6257](https://github.com/elastic/elasticsearch/pull/16257) (issue: [<1>6152](https://github.com/elastic/elasticsearch/issues/16152)) 
  * Script settings [<1>6197](https://github.com/elastic/elasticsearch/pull/16197)
  * Remove index.flush_on_close entirely [<1>5977](https://github.com/elastic/elasticsearch/pull/15977)
  * Restore chunksize of 512kb on recovery and remove configurability [<1>5235](https://github.com/elastic/elasticsearch/pull/15235) (issue: [<1>5161](https://github.com/elastic/elasticsearch/issues/15161)) 
  * Remove ancient deprecated and alternative recovery settings [<1>5234](https://github.com/elastic/elasticsearch/pull/15234)



Similarities 
    

  * Renames `default` similarity into `classic` [<1>5446](https://github.com/elastic/elasticsearch/pull/15446) (issue: [<1>5102](https://github.com/elastic/elasticsearch/issues/15102)) 



Snapshot/Restore 
    

  * Change the default of `include_global_state` from true to false for snapshot restores [<1>8773](https://github.com/elastic/elasticsearch/pull/18773) (issue: [<1>8569](https://github.com/elastic/elasticsearch/issues/18569)) 
  * Fail closing or deleting indices during a full snapshot [<1>7021](https://github.com/elastic/elasticsearch/pull/17021) (issue: [<1>6321](https://github.com/elastic/elasticsearch/issues/16321)) 



Stats 
    

  * Modify load average format [<1>5932](https://github.com/elastic/elasticsearch/pull/15932) (issue: [<1>5907](https://github.com/elastic/elasticsearch/issues/15907)) 
  * Reintroduce five-minute and fifteen-minute load averages on Linux [<1>5907](https://github.com/elastic/elasticsearch/pull/15907) (issues: [<1>2049](https://github.com/elastic/elasticsearch/issues/12049), [<1>4741](https://github.com/elastic/elasticsearch/issues/14741)) 
  * Add system CPU percent to OS stats [<1>4741](https://github.com/elastic/elasticsearch/pull/14741)



Term Vectors 
    

  * Remove DFS support from TermVector API [<1>6452](https://github.com/elastic/elasticsearch/pull/16452)



Translog 
    

  * Drop support for simple translog and hard-wire buffer to 8kb [<1>5574](https://github.com/elastic/elasticsearch/pull/15574)
  * Simplify translog-based flush settings [<1>5573](https://github.com/elastic/elasticsearch/pull/15573)



Warmers 
    

  * Remove query warmers and the warmer API. [<1>5614](https://github.com/elastic/elasticsearch/pull/15614) (issue: [<1>5607](https://github.com/elastic/elasticsearch/issues/15607)) 



### Breaking Java changes

Aggregations 
    

  * getKeyAsString and key_as_string should be the same for terms aggregation on boolean field [<1>5393](https://github.com/elastic/elasticsearch/pull/15393)



Allocation 
    

  * Move parsing of allocation commands into REST and remove support for plugins to register allocation commands [<1>7802](https://github.com/elastic/elasticsearch/pull/17802) (issue: [<1>7894](https://github.com/elastic/elasticsearch/issues/17894)) 
  * Simplify shard balancer interface [<1>7028](https://github.com/elastic/elasticsearch/pull/17028) (issue: [<8>954](https://github.com/elastic/elasticsearch/issues/8954)) 



Analysis 
    

  * Simplify Analysis registration and configuration [<1>4355](https://github.com/elastic/elasticsearch/pull/14355)



CRUD 
    

  * Removing isCreated and isFound from the Java API [<1>9645](https://github.com/elastic/elasticsearch/pull/19645) (issues: [<1>9566](https://github.com/elastic/elasticsearch/issues/19566), [<1>9631](https://github.com/elastic/elasticsearch/issues/19631)) 



Cache 
    

  * Refactor IndicesRequestCache to make it testable. [<1>6610](https://github.com/elastic/elasticsearch/pull/16610)
  * Fold IndexCacheModule into IndexModule [<1>4293](https://github.com/elastic/elasticsearch/pull/14293)



Core 
    

  * Remove ability to plug-in TransportService [<2>0505](https://github.com/elastic/elasticsearch/pull/20505)
  * Register thread pool settings [<1>8674](https://github.com/elastic/elasticsearch/pull/18674) (issues: [<1>8613](https://github.com/elastic/elasticsearch/issues/18613), [<9>216](https://github.com/elastic/elasticsearch/issues/9216)) 
  * Bootstrap does not set system properties [<1>7088](https://github.com/elastic/elasticsearch/pull/17088) (issues: [<1>6579](https://github.com/elastic/elasticsearch/issues/16579), [<1>6791](https://github.com/elastic/elasticsearch/issues/16791)) 
  * Remove es.useLinkedTransferQueue [<1>6786](https://github.com/elastic/elasticsearch/pull/16786)



Discovery 
    

  * Introduce node handshake [<1>5971](https://github.com/elastic/elasticsearch/pull/15971) (issue: [<9>061](https://github.com/elastic/elasticsearch/issues/9061)) 
  * Include pings from client nodes in master election [<1>7329](https://github.com/elastic/elasticsearch/pull/17329) (issue: [<1>7325](https://github.com/elastic/elasticsearch/issues/17325)) 



Highlighting 
    

  * Register Highlighter instances instead of classes [<1>8859](https://github.com/elastic/elasticsearch/pull/18859)



Internal 
    

  * Remove TransportService#registerRequestHandler leniency [<2>0469](https://github.com/elastic/elasticsearch/pull/20469) (issue: [<2>0468](https://github.com/elastic/elasticsearch/issues/20468)) 
  * Consolidate search parser registries [<2>0000](https://github.com/elastic/elasticsearch/pull/20000)
  * Move all FetchSubPhases to o.e.search.fetch.subphase [<1>9702](https://github.com/elastic/elasticsearch/pull/19702)
  * Squash the rest of o.e.rest.action [<1>9698](https://github.com/elastic/elasticsearch/pull/19698)
  * Clean up BytesReference [<1>9196](https://github.com/elastic/elasticsearch/pull/19196)
  * Cleanup ClusterService dependencies and detached from Guice [<1>8941](https://github.com/elastic/elasticsearch/pull/18941)
  * Simplify SubFetchPhase interface [<1>8881](https://github.com/elastic/elasticsearch/pull/18881)
  * Simplify FetchSubPhase registration and detach it from Guice [<1>8862](https://github.com/elastic/elasticsearch/pull/18862)
  * Remove duplicate getters from DiscoveryNode and DiscoveryNodes [<1>7410](https://github.com/elastic/elasticsearch/pull/17410) (issue: [<1>6963](https://github.com/elastic/elasticsearch/issues/16963)) 
  * Cli: Switch to jopt-simple [<1>7024](https://github.com/elastic/elasticsearch/pull/17024) (issue: [<1>1564](https://github.com/elastic/elasticsearch/issues/11564)) 
  * Replace ContextAndHeaders with a ThreadPool based ThreadLocal implementation [<1>5776](https://github.com/elastic/elasticsearch/pull/15776)
  * Remove NodeBuilder [<1>5354](https://github.com/elastic/elasticsearch/pull/15354)
  * Fix IndexSearcherWrapper interface to not depend on the EngineConfig [<1>4654](https://github.com/elastic/elasticsearch/pull/14654)
  * Cleanup query parsing and remove IndexQueryParserService [<1>4452](https://github.com/elastic/elasticsearch/pull/14452)
  * Remove circular dependency between IndicesService and IndicesStore [<1>4285](https://github.com/elastic/elasticsearch/pull/14285)
  * Remove guice injection from IndexStore and friends [<1>4279](https://github.com/elastic/elasticsearch/pull/14279)
  * Replace IndicesLifecycle with a per-index IndexEventListener [<1>4217](https://github.com/elastic/elasticsearch/pull/14217) (issue: [<1>3259](https://github.com/elastic/elasticsearch/issues/13259)) 
  * Simplify similarity module and friends [<1>3942](https://github.com/elastic/elasticsearch/pull/13942)
  * Refactor SearchRequest to be parsed on the coordinating node [<1>3859](https://github.com/elastic/elasticsearch/pull/13859)



Java API 
    

  * Add a dedicated client/transport project for transport-client [<1>9435](https://github.com/elastic/elasticsearch/pull/19435) (issue: [<1>9412](https://github.com/elastic/elasticsearch/issues/19412)) 
  * Remove setRefresh [<1>8752](https://github.com/elastic/elasticsearch/pull/18752) (issue: [<1>063](https://github.com/elastic/elasticsearch/issues/1063)) 
  * Remove the count api [<1>4166](https://github.com/elastic/elasticsearch/pull/14166) (issue: [<1>3928](https://github.com/elastic/elasticsearch/issues/13928)) 
  * IdsQueryBuilder to accept only non null ids and types [<1>3937](https://github.com/elastic/elasticsearch/pull/13937)



Mapping 
    

  * [Mapping] Several MappingService cleanups [<1>6133](https://github.com/elastic/elasticsearch/pull/16133) (issue: [<1>5924](https://github.com/elastic/elasticsearch/issues/15924)) 



Network 
    

  * Factor out abstract TCPTransport* classes to reduce the netty footprint [<1>9096](https://github.com/elastic/elasticsearch/pull/19096)
  * Remove ability to disable Netty gathering writes [<1>6774](https://github.com/elastic/elasticsearch/pull/16774) (issue: [<7>811](https://github.com/elastic/elasticsearch/issues/7811)) 



Parent/Child 
    

  * Cleanup ParentFieldMapper [<1>6045](https://github.com/elastic/elasticsearch/pull/16045)
  * Several other parent/child cleanups [<1>3470](https://github.com/elastic/elasticsearch/pull/13470)



Percolator 
    

  * Move the percolator from core to its own module [<1>8511](https://github.com/elastic/elasticsearch/pull/18511)
  * Remove percolator cache [<1>8434](https://github.com/elastic/elasticsearch/pull/18434)



Plugins 
    

  * Cleanup sub fetch phase extension point [<2>0382](https://github.com/elastic/elasticsearch/pull/20382)
  * Remove IndexTemplateFilter [<2>0072](https://github.com/elastic/elasticsearch/pull/20072)
  * Switch custom ShardsAllocators to pull based model [<2>0071](https://github.com/elastic/elasticsearch/pull/20071)
  * Make custom allocation deciders use pull based extensions [<2>0040](https://github.com/elastic/elasticsearch/pull/20040)
  * Migrate query registration from push to pull [<1>9376](https://github.com/elastic/elasticsearch/pull/19376)
  * Add components getter as bridge between guice and new plugin init world [<1>9371](https://github.com/elastic/elasticsearch/pull/19371)
  * Remove CustomNodeAttributes extension point [<1>9348](https://github.com/elastic/elasticsearch/pull/19348)
  * Add RepositoryPlugin interface for registering snapshot repositories [<1>9324](https://github.com/elastic/elasticsearch/pull/19324)
  * Simplified repository api for snapshot/restore [<1>9292](https://github.com/elastic/elasticsearch/pull/19292)
  * Switch most search extensions from push to pull [<1>9238](https://github.com/elastic/elasticsearch/pull/19238)
  * Move RestHandler registration to ActionModule and ActionPlugin [<1>9165](https://github.com/elastic/elasticsearch/pull/19165)
  * Pull actions from plugins [<1>9108](https://github.com/elastic/elasticsearch/pull/19108)
  * Switch analysis from push to pull [<1>9073](https://github.com/elastic/elasticsearch/pull/19073)
  * Remove guice from Mapper plugins [<1>9018](https://github.com/elastic/elasticsearch/pull/19018)
  * Fail to start if plugin tries broken onModule [<1>9025](https://github.com/elastic/elasticsearch/pull/19025)
  * Simplify ScriptModule and script registration [<1>8903](https://github.com/elastic/elasticsearch/pull/18903)
  * Cut over settings registration to a pull model [<1>8890](https://github.com/elastic/elasticsearch/pull/18890)
  * Enforce isolated mode for all plugins [<1>7276](https://github.com/elastic/elasticsearch/pull/17276)
  * Don’t use guice for QueryParsers [<1>5761](https://github.com/elastic/elasticsearch/pull/15761)
  * Remove guice from the index level [<1>4518](https://github.com/elastic/elasticsearch/pull/14518)
  * Remove shard-level injector [<1>3881](https://github.com/elastic/elasticsearch/pull/13881)



Query DSL 
    

  * Remove the MissingQueryBuilder which was deprecated in 2.2.0. [<1>5364](https://github.com/elastic/elasticsearch/pull/15364) (issue: [<1>4112](https://github.com/elastic/elasticsearch/issues/14112)) 
  * Remove NotQueryBuilder [<1>4204](https://github.com/elastic/elasticsearch/pull/14204) (issue: [<1>3761](https://github.com/elastic/elasticsearch/issues/13761)) 



Scripting 
    

  * Remove o.e.script.Template class and move template query to lang-mustache module [<1>9425](https://github.com/elastic/elasticsearch/pull/19425) (issue: [<1>6314](https://github.com/elastic/elasticsearch/issues/16314)) 
  * Move search template to lang-mustache module [<1>8765](https://github.com/elastic/elasticsearch/pull/18765) (issue: [<1>7906](https://github.com/elastic/elasticsearch/issues/17906)) 
  * Remove LeafSearchScript.runAsFloat(): Nothing calls it. [<1>8364](https://github.com/elastic/elasticsearch/pull/18364)



Search 
    

  * Remove FetchSubPhaseParseElement [<2>0350](https://github.com/elastic/elasticsearch/pull/20350)
  * Refactor of query profile classes to make way for other profile implementations [<1>8370](https://github.com/elastic/elasticsearch/pull/18370) (issue: [<1>0538](https://github.com/elastic/elasticsearch/issues/10538)) 
  * Query refactoring: split parse phase into fromXContent and toQuery for all queries [<1>3788](https://github.com/elastic/elasticsearch/pull/13788) (issue: [<1>0217](https://github.com/elastic/elasticsearch/issues/10217)) 



Search Refactoring 
    

  * Refactored inner hits parsing and intoduced InnerHitBuilder [<1>7291](https://github.com/elastic/elasticsearch/pull/17291)
  * Remove support for query_binary and filter_binary [<1>4433](https://github.com/elastic/elasticsearch/pull/14433) (issue: [<1>4308](https://github.com/elastic/elasticsearch/issues/14308)) 
  * Validate query api: move query parsing to the coordinating node [<1>4384](https://github.com/elastic/elasticsearch/pull/14384)



Settings 
    

  * Remove `node.mode` and `node.local` settings [<1>9428](https://github.com/elastic/elasticsearch/pull/19428)
  * Remove Settings.settingsBuilder. [<1>7619](https://github.com/elastic/elasticsearch/pull/17619)
  * Move remaining settings in NettyHttpServerTransport to the new infra [<1>6531](https://github.com/elastic/elasticsearch/pull/16531)
  * Replace IndexSettings annotation with a full-fledged class [<1>4251](https://github.com/elastic/elasticsearch/pull/14251)
  * Fix ping timeout settings inconsistencies [<1>3701](https://github.com/elastic/elasticsearch/pull/13701) (issue: [<6>579](https://github.com/elastic/elasticsearch/issues/6579)) 



Snapshot/Restore 
    

  * Removes extra writeBlob method in BlobContainer [<1>9727](https://github.com/elastic/elasticsearch/pull/19727) (issue: [<1>8528](https://github.com/elastic/elasticsearch/issues/18528)) 



Store 
    

  * Standardize state format type for global and index level metadata [<1>7123](https://github.com/elastic/elasticsearch/pull/17123)



Suggesters 
    

  * Remove suggest threadpool [<1>7304](https://github.com/elastic/elasticsearch/pull/17304) (issue: [<1>7198](https://github.com/elastic/elasticsearch/issues/17198)) 
  * Remove suggest transport action [<1>7198](https://github.com/elastic/elasticsearch/pull/17198) (issue: [<1>0217](https://github.com/elastic/elasticsearch/issues/10217)) 



### Deprecations

CRUD 
    

  * Deprecate found and created in delete and index rest responses [<1>9633](https://github.com/elastic/elasticsearch/pull/19633)



Plugin Discovery Azure Classic 
    

  * Deprecate discovery-azure and rename it to discovery-azure-classic [<1>9186](https://github.com/elastic/elasticsearch/pull/19186) (issue: [<1>9144](https://github.com/elastic/elasticsearch/issues/19144)) 



Plugin Mapper Attachment 
    

  * Deprecate mapper-attachments plugin [<1>6948](https://github.com/elastic/elasticsearch/pull/16948) (issue: [<1>6910](https://github.com/elastic/elasticsearch/issues/16910)) 



Query DSL 
    

  * Deprecate Indices query [<1>7710](https://github.com/elastic/elasticsearch/pull/17710) (issue: [<1>2017](https://github.com/elastic/elasticsearch/issues/12017)) 
  * Deprecate mlt, in and geo_bbox query name shortcuts [<1>7507](https://github.com/elastic/elasticsearch/pull/17507)



Query Refactoring 
    

  * Splits `phrase` and `phrase_prefix` in match query into `MatchPhraseQueryBuilder` and `MatchPhrasePrefixQueryBuilder` [<1>7508](https://github.com/elastic/elasticsearch/pull/17508)



Scripting 
    

  * Deprecate Groovy, Python, and Javascript [<2>0244](https://github.com/elastic/elasticsearch/pull/20244) (issue: [<2>0129](https://github.com/elastic/elasticsearch/issues/20129)) 



Search 
    

  * Deprecate fuzzy query [<1>6211](https://github.com/elastic/elasticsearch/pull/16211) (issues: [<1>5760](https://github.com/elastic/elasticsearch/issues/15760), [<1>6121](https://github.com/elastic/elasticsearch/issues/16121)) 



Templates 
    

  * Deprecate template query [<1>9607](https://github.com/elastic/elasticsearch/pull/19607) (issue: [<1>9390](https://github.com/elastic/elasticsearch/issues/19390)) 



### New features

Aggregations 
    

  * Split regular histograms from date histograms. [<1>9551](https://github.com/elastic/elasticsearch/pull/19551) (issues: [<4>847](https://github.com/elastic/elasticsearch/issues/4847), [<8>082](https://github.com/elastic/elasticsearch/issues/8082)) 
  * Adds aggregation profiling to the profile API [<1>8414](https://github.com/elastic/elasticsearch/pull/18414) (issue: [<1>0538](https://github.com/elastic/elasticsearch/issues/10538)) 
  * New Matrix Stats Aggregation module [<1>8300](https://github.com/elastic/elasticsearch/pull/18300) (issue: [<1>6826](https://github.com/elastic/elasticsearch/issues/16826)) 



Aliases 
    

  * Add an alias action to delete an index [<2>0184](https://github.com/elastic/elasticsearch/pull/20184) (issue: [<2>0064](https://github.com/elastic/elasticsearch/issues/20064)) 



Allocation 
    

  * Add API to explain why a shard is or isn’t assigned [<1>7305](https://github.com/elastic/elasticsearch/pull/17305) (issue: [<1>4593](https://github.com/elastic/elasticsearch/issues/14593)) 



Analysis 
    

  * Exposing lucene 6.x minhash filter. [<2>0206](https://github.com/elastic/elasticsearch/pull/20206) (issue: [<2>0149](https://github.com/elastic/elasticsearch/issues/20149)) 
  * Add `fingerprint` token filter and `fingerprint` analyzer [<1>7873](https://github.com/elastic/elasticsearch/pull/17873) (issue: [<1>3325](https://github.com/elastic/elasticsearch/issues/13325)) 



Circuit Breakers 
    

  * Circuit break on aggregation bucket numbers with request breaker [<1>9394](https://github.com/elastic/elasticsearch/pull/19394) (issue: [<1>4046](https://github.com/elastic/elasticsearch/issues/14046)) 



Discovery 
    

  * Add two phased commit to Cluster State publishing [<1>3062](https://github.com/elastic/elasticsearch/pull/13062)



Geo 
    

  * Cut over geo_point field and queries to new LatLonPoint type [<2>0315](https://github.com/elastic/elasticsearch/pull/20315) (issue: [<2>0314](https://github.com/elastic/elasticsearch/issues/20314)) 



Index APIs 
    

  * Add rollover API to switch index aliases given some predicates [<1>8732](https://github.com/elastic/elasticsearch/pull/18732) (issue: [<1>8647](https://github.com/elastic/elasticsearch/issues/18647)) 



Ingest 
    

  * ingest-useragent plugin [<1>9074](https://github.com/elastic/elasticsearch/pull/19074)
  * Add a Sort ingest processor [<1>7999](https://github.com/elastic/elasticsearch/pull/17999)
  * Add date_index_name processor [<1>7973](https://github.com/elastic/elasticsearch/pull/17973) (issue: [<1>7814](https://github.com/elastic/elasticsearch/issues/17814)) 
  * Merge feature/ingest branch into master branch [<1>6049](https://github.com/elastic/elasticsearch/pull/16049) (issue: [<1>4049](https://github.com/elastic/elasticsearch/issues/14049)) 



Java REST Client 
    

  * Introduce async performRequest method [<1>9400](https://github.com/elastic/elasticsearch/pull/19400)
  * Low level Rest Client [<1>8735](https://github.com/elastic/elasticsearch/pull/18735) (issue: [<7>743](https://github.com/elastic/elasticsearch/issues/7743)) 



Mapping 
    

  * Add `scaled_float`. [<1>9264](https://github.com/elastic/elasticsearch/pull/19264) (issues: [<1>5939](https://github.com/elastic/elasticsearch/issues/15939), [<1>941](https://github.com/elastic/elasticsearch/issues/1941)) 
  * Expose half-floats. [<1>8887](https://github.com/elastic/elasticsearch/pull/18887)
  * Add a text field. [<1>6637](https://github.com/elastic/elasticsearch/pull/16637)
  * Add a new `keyword` field. [<1>6589](https://github.com/elastic/elasticsearch/pull/16589) (issue: [<1>4113](https://github.com/elastic/elasticsearch/issues/14113)) 



Percolator 
    

  * index the query terms from the percolator query [<1>3646](https://github.com/elastic/elasticsearch/pull/13646) (issue: [<1>2664](https://github.com/elastic/elasticsearch/issues/12664)) 



Plugin Analysis ICU 
    

  * Adding support for customizing the rule file in ICU tokenizer [<1>3651](https://github.com/elastic/elasticsearch/pull/13651) (issue: [<1>3146](https://github.com/elastic/elasticsearch/issues/13146)) 



Plugin Discovery File 
    

  * File-based discovery plugin [<2>0394](https://github.com/elastic/elasticsearch/pull/20394) (issue: [<2>0323](https://github.com/elastic/elasticsearch/issues/20323)) 



Plugin Ingest Attachment 
    

  * Ingest: Add attachment processor [<1>6490](https://github.com/elastic/elasticsearch/pull/16490) (issue: [<1>6303](https://github.com/elastic/elasticsearch/issues/16303)) 



Plugin Mapper Attachment 
    

  * Migrate mapper attachments plugin to main repository [<1>4605](https://github.com/elastic/elasticsearch/pull/14605)



Plugin Repository HDFS 
    

  * HDFS Snapshot/Restore plugin [<1>5192](https://github.com/elastic/elasticsearch/pull/15192) (issue: [<1>5191](https://github.com/elastic/elasticsearch/issues/15191)) 



Plugin Repository S3 
    

  * Add support for path_style_access [<1>5114](https://github.com/elastic/elasticsearch/pull/15114)



Query DSL 
    

  * Adds a rewrite phase to queries on the shard level [<1>6870](https://github.com/elastic/elasticsearch/pull/16870) (issue: [<9>526](https://github.com/elastic/elasticsearch/issues/9526)) 



Reindex API 
    

  * Reindex from remote [<1>8585](https://github.com/elastic/elasticsearch/pull/18585) (issue: [<1>7447](https://github.com/elastic/elasticsearch/issues/17447)) 
  * Port Delete By Query to Reindex infrastructure [<1>8329](https://github.com/elastic/elasticsearch/pull/18329) (issue: [<1>6883](https://github.com/elastic/elasticsearch/issues/16883)) 
  * Merge reindex to master [<1>6861](https://github.com/elastic/elasticsearch/pull/16861)



Scripting 
    

  * Exceptions and Infinite Loop Checking [<1>5936](https://github.com/elastic/elasticsearch/pull/15936)
  * Added a new scripting language (PlanA) [<1>5136](https://github.com/elastic/elasticsearch/pull/15136) (issue: [<1>3084](https://github.com/elastic/elasticsearch/issues/13084)) 



Scroll 
    

  * Add the ability to partition a scroll in multiple slices. [<1>8237](https://github.com/elastic/elasticsearch/pull/18237) (issue: [<1>3494](https://github.com/elastic/elasticsearch/issues/13494)) 



Search 
    

  * Add the ability to disable the retrieval of the stored fields entirely [<2>0026](https://github.com/elastic/elasticsearch/pull/20026)
  * Add `search_after` parameter in the SearchAPI [<1>6125](https://github.com/elastic/elasticsearch/pull/16125) (issue: [<8>192](https://github.com/elastic/elasticsearch/issues/8192)) 



Settings 
    

  * Add infrastructure to transactionally apply and reset dynamic settings [<1>5278](https://github.com/elastic/elasticsearch/pull/15278)



Snapshot/Restore 
    

  * Add Google Cloud Storage repository plugin [<1>3578](https://github.com/elastic/elasticsearch/pull/13578) (issue: [<1>2880](https://github.com/elastic/elasticsearch/issues/12880)) 



Stats 
    

  * Extend field stats to report searchable/aggregatable fields [<1>7980](https://github.com/elastic/elasticsearch/pull/17980) (issue: [<1>7750](https://github.com/elastic/elasticsearch/issues/17750)) 
  * API for listing index file sizes [<1>6661](https://github.com/elastic/elasticsearch/pull/16661) (issue: [<1>6131](https://github.com/elastic/elasticsearch/issues/16131)) 



Store 
    

  * Expose MMapDirectory.preLoad(). [<1>8880](https://github.com/elastic/elasticsearch/pull/18880)
  * Add primitive to shrink an index into a single shard [<1>8270](https://github.com/elastic/elasticsearch/pull/18270)



Suggesters 
    

  * Add support for returning documents with completion suggester [<1>9536](https://github.com/elastic/elasticsearch/pull/19536) (issue: [<1>0746](https://github.com/elastic/elasticsearch/issues/10746)) 
  * Add document-oriented completion suggester [<1>4410](https://github.com/elastic/elasticsearch/pull/14410) (issue: [<1>0746](https://github.com/elastic/elasticsearch/issues/10746)) 



Task Manager 
    

  * Add task cancellation mechanism [<1>6320](https://github.com/elastic/elasticsearch/pull/16320)
  * Make the Task object available to the action caller [<1>6033](https://github.com/elastic/elasticsearch/pull/16033)
  * Task Management: Add framework for registering and communicating with tasks [<1>5347](https://github.com/elastic/elasticsearch/pull/15347) (issue: [<1>5117](https://github.com/elastic/elasticsearch/issues/15117)) 



Translog 
    

  * Add `elasticsearch-translog` CLI tool with `truncate` command [<1>9342](https://github.com/elastic/elasticsearch/pull/19342) (issue: [<1>9123](https://github.com/elastic/elasticsearch/issues/19123)) 



### Enhancements

Aggregations 
    

  * Make the heuristic to compute the default shard size less aggressive. [<1>9659](https://github.com/elastic/elasticsearch/pull/19659)
  * Add _bucket_count option to buckets_path [<1>9571](https://github.com/elastic/elasticsearch/pull/19571) (issue: [<1>9553](https://github.com/elastic/elasticsearch/issues/19553)) 
  * Remove AggregationStreams [<1>9507](https://github.com/elastic/elasticsearch/pull/19507)
  * Migrate serial_diff aggregation to NamedWriteable [<1>9483](https://github.com/elastic/elasticsearch/pull/19483)
  * Migrate most remaining pipeline aggregations to NamedWriteable [<1>9480](https://github.com/elastic/elasticsearch/pull/19480)
  * Migrate moving_avg pipeline aggregation to NamedWriteable [<1>9420](https://github.com/elastic/elasticsearch/pull/19420)
  * Migrate matrix_stats to NamedWriteable [<1>9418](https://github.com/elastic/elasticsearch/pull/19418)
  * Migrate derivative pipeline aggregation to NamedWriteable [<1>9407](https://github.com/elastic/elasticsearch/pull/19407)
  * Migrate top_hits, histogram, and ip_range aggregations to NamedWriteable [<1>9375](https://github.com/elastic/elasticsearch/pull/19375)
  * Migrate nested, reverse_nested, and children aggregations to NamedWriteable [<1>9374](https://github.com/elastic/elasticsearch/pull/19374)
  * Migrate geohash_grid and geo_bounds aggregations to NamedWriteable [<1>9372](https://github.com/elastic/elasticsearch/pull/19372)
  * Clean up significant terms aggregation results [<1>9365](https://github.com/elastic/elasticsearch/pull/19365)
  * Migrate range, date_range, and geo_distance aggregations to NamedWriteable [<1>9321](https://github.com/elastic/elasticsearch/pull/19321)
  * Migrate terms aggregation to NamedWriteable [<1>9277](https://github.com/elastic/elasticsearch/pull/19277)
  * Migrate sampler and missing aggregations to NamedWriteable [<1>9259](https://github.com/elastic/elasticsearch/pull/19259)
  * Migrate global, filter, and filters aggregation to NamedWriteable [<1>9220](https://github.com/elastic/elasticsearch/pull/19220)
  * Migrate the cardinality, scripted_metric, and geo_centroid aggregations to NamedWriteable [<1>9219](https://github.com/elastic/elasticsearch/pull/19219)
  * Use a static default precision for the cardinality aggregation. [<1>9215](https://github.com/elastic/elasticsearch/pull/19215)
  * Migrate more aggregations to NamedWriteable [<1>9199](https://github.com/elastic/elasticsearch/pull/19199)
  * Migrate stats and extended stats to NamedWriteable [<1>9198](https://github.com/elastic/elasticsearch/pull/19198)
  * Migrate sum, min, and max aggregations over to NamedWriteable [<1>9194](https://github.com/elastic/elasticsearch/pull/19194)
  * Start migration away from aggregation streams [<1>9097](https://github.com/elastic/elasticsearch/pull/19097)
  * Automatically set the collection mode to breadth_first in the terms aggregation when the cardinality of the field is unknown or smaller than the requested size. [<1>8779](https://github.com/elastic/elasticsearch/pull/18779) (issue: [<9>825](https://github.com/elastic/elasticsearch/issues/9825)) 
  * Rename PipelineAggregatorBuilder to PipelineAggregationBuilder. [<1>8677](https://github.com/elastic/elasticsearch/pull/18677) (issue: [<1>8377](https://github.com/elastic/elasticsearch/issues/18377)) 
  * AggregatorBuilder and PipelineAggregatorBuilder do not need generics. [<1>8368](https://github.com/elastic/elasticsearch/pull/18368) (issue: [<1>8133](https://github.com/elastic/elasticsearch/issues/18133)) 
  * Rename AggregatorBuilder to AggregationBuilder [<1>8377](https://github.com/elastic/elasticsearch/pull/18377) (issue: [<1>8367](https://github.com/elastic/elasticsearch/issues/18367)) 
  * Add the ability to use the breadth_first mode with nested aggregations (such as `top_hits`) which require access to score information. [<1>8127](https://github.com/elastic/elasticsearch/pull/18127) (issue: [<9>825](https://github.com/elastic/elasticsearch/issues/9825)) 
  * Make significant terms work on fields that are indexed with points. [<1>8031](https://github.com/elastic/elasticsearch/pull/18031)
  * Add tests and documentation for using `time_zone` in date range aggregation [<1>6955](https://github.com/elastic/elasticsearch/pull/16955) (issue: [<1>0130](https://github.com/elastic/elasticsearch/issues/10130)) 
  * Fixes serialisation of Ranges [<1>6674](https://github.com/elastic/elasticsearch/pull/16674)



Allocation 
    

  * Verify AllocationIDs in replication actions [<2>0320](https://github.com/elastic/elasticsearch/pull/20320)
  * Mark shard as stale on non-replicated write, not on node shutdown [<2>0023](https://github.com/elastic/elasticsearch/pull/20023) (issue: [<1>8919](https://github.com/elastic/elasticsearch/issues/18919)) 
  * Add routing changes API to RoutingAllocation [<1>9992](https://github.com/elastic/elasticsearch/pull/19992)
  * Primary shard allocator observes limits in forcing allocation [<1>9811](https://github.com/elastic/elasticsearch/pull/19811) (issue: [<1>9446](https://github.com/elastic/elasticsearch/issues/19446)) 
  * Use primary terms as authority to fail shards [<1>9715](https://github.com/elastic/elasticsearch/pull/19715)
  * Add recovery source to ShardRouting [<1>9516](https://github.com/elastic/elasticsearch/pull/19516)
  * Allow `_shrink` to N shards if source shards is a multiple of N [<1>8699](https://github.com/elastic/elasticsearch/pull/18699)
  * Only filter intial recovery (post API) when shrinking an index [<1>8661](https://github.com/elastic/elasticsearch/pull/18661)
  * Estimate shard size for shrinked indices [<1>8659](https://github.com/elastic/elasticsearch/pull/18659)
  * Only fail relocation target shard if failing source shard is a primary [<1>8574](https://github.com/elastic/elasticsearch/pull/18574) (issue: [<1>6144](https://github.com/elastic/elasticsearch/issues/16144)) 
  * Simplify delayed shard allocation [<1>8351](https://github.com/elastic/elasticsearch/pull/18351) (issue: [<1>8293](https://github.com/elastic/elasticsearch/issues/18293)) 
  * Limit retries of failed allocations per index [<1>8467](https://github.com/elastic/elasticsearch/pull/18467) (issue: [<1>8417](https://github.com/elastic/elasticsearch/issues/18417)) 
  * Immutable ShardRouting [<1>7821](https://github.com/elastic/elasticsearch/pull/17821)
  * Add the shard’s store status to the explain API [<1>7689](https://github.com/elastic/elasticsearch/pull/17689) (issue: [<1>7372](https://github.com/elastic/elasticsearch/issues/17372)) 
  * Write shard state metadata as soon as shard is created / initializing [<1>6625](https://github.com/elastic/elasticsearch/pull/16625) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Reuse existing allocation id for primary shard allocation [<1>6530](https://github.com/elastic/elasticsearch/pull/16530) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Remove version in ShardRouting (now obsolete) [<1>6243](https://github.com/elastic/elasticsearch/pull/16243) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Prefer nodes that previously held primary shard for primary shard allocation [<1>6096](https://github.com/elastic/elasticsearch/pull/16096) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Extend reroute with an option to force assign stale primary shard copies [<1>5708](https://github.com/elastic/elasticsearch/pull/15708) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Allocate primary shards based on allocation IDs [<1>5281](https://github.com/elastic/elasticsearch/pull/15281) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Persist currently started allocation IDs to index metadata [<1>4964](https://github.com/elastic/elasticsearch/pull/14964) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Use ObjectParser to parse AllocationID [<1>4962](https://github.com/elastic/elasticsearch/pull/14962) (issue: [<1>4831](https://github.com/elastic/elasticsearch/issues/14831)) 
  * Persist allocation ID with shard state metadata on nodes [<1>4831](https://github.com/elastic/elasticsearch/pull/14831) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 



Analysis 
    

  * Stop using cached component in _analyze API [<1>9929](https://github.com/elastic/elasticsearch/pull/19929) (issue: [<1>9827](https://github.com/elastic/elasticsearch/issues/19827)) 
  * Specify custom char_filters/tokenizer/token_filters in the analyze API [<1>5671](https://github.com/elastic/elasticsearch/pull/15671) (issue: [<8>878](https://github.com/elastic/elasticsearch/issues/8878)) 
  * Add a MultiTermAwareComponent marker interface to analysis factories. [<1>9028](https://github.com/elastic/elasticsearch/pull/19028) (issues: [<1>8064](https://github.com/elastic/elasticsearch/issues/18064), [<9>978](https://github.com/elastic/elasticsearch/issues/9978)) 
  * Add Flags Parameter for Char Filter [<1>8363](https://github.com/elastic/elasticsearch/pull/18363) (issue: [<1>8362](https://github.com/elastic/elasticsearch/issues/18362)) 
  * Core: better error message when analyzer created without tokenizer or… [<1>8455](https://github.com/elastic/elasticsearch/pull/18455) (issue: [<1>5492](https://github.com/elastic/elasticsearch/issues/15492)) 
  * Move AsciiFolding earlier in FingerprintAnalyzer filter chain [<1>8281](https://github.com/elastic/elasticsearch/pull/18281) (issue: [<1>8266](https://github.com/elastic/elasticsearch/issues/18266)) 
  * Improve error message if resource files have illegal encoding [<1>7237](https://github.com/elastic/elasticsearch/pull/17237) (issue: [<1>7212](https://github.com/elastic/elasticsearch/issues/17212)) 



Benchmark 
    

  * Add client-benchmark-noop-api-plugin to stress clients even more in benchmarks [<2>0103](https://github.com/elastic/elasticsearch/pull/20103)



CAT API 
    

  * Add health status parameter to cat indices API [<2>0393](https://github.com/elastic/elasticsearch/pull/20393)
  * Includes the index UUID in the _cat/indices API [<1>9204](https://github.com/elastic/elasticsearch/pull/19204) (issue: [<1>9132](https://github.com/elastic/elasticsearch/issues/19132)) 
  * Add node name to Cat Recovery [<1>8187](https://github.com/elastic/elasticsearch/pull/18187) (issue: [<8>041](https://github.com/elastic/elasticsearch/issues/8041)) 
  * Add support for documented byte/size units and for micros as a time unit in _cat API [<1>7779](https://github.com/elastic/elasticsearch/pull/17779)
  * Add _cat/tasks [<1>7551](https://github.com/elastic/elasticsearch/pull/17551)
  * Cat health supports ts=0 option [<1>3508](https://github.com/elastic/elasticsearch/pull/13508) (issue: [<1>0109](https://github.com/elastic/elasticsearch/issues/10109)) 
  * Expose http address in cat/nodes [<1>6770](https://github.com/elastic/elasticsearch/pull/16770)
  * [cat/recovery] Make recovery time a TimeValue() [<1>6743](https://github.com/elastic/elasticsearch/pull/16743) (issue: [<9>209](https://github.com/elastic/elasticsearch/issues/9209)) 
  * :CAT API: remove space at the end of a line [<1>5250](https://github.com/elastic/elasticsearch/pull/15250) (issue: [<9>464](https://github.com/elastic/elasticsearch/issues/9464)) 



CRUD 
    

  * Renaming operation to result and reworking responses [<1>9704](https://github.com/elastic/elasticsearch/pull/19704) (issue: [<1>9664](https://github.com/elastic/elasticsearch/issues/19664)) 
  * Adding _operation field to index, update, delete response. [<1>9566](https://github.com/elastic/elasticsearch/pull/19566) (issues: [<1>9267](https://github.com/elastic/elasticsearch/issues/19267), [<9>642](https://github.com/elastic/elasticsearch/issues/9642), [<9>736](https://github.com/elastic/elasticsearch/issues/9736)) 
  * CRUD: Allow to get and set ttl as a time value/string [<1>5047](https://github.com/elastic/elasticsearch/pull/15047)



Cache 
    

  * Enable option to use request cache for size  > 0 [<1>9472](https://github.com/elastic/elasticsearch/pull/19472)
  * Cache FieldStats in the request cache [<1>8768](https://github.com/elastic/elasticsearch/pull/18768) (issue: [<1>8717](https://github.com/elastic/elasticsearch/issues/18717)) 
  * Allow the query cache to be disabled. [<1>6268](https://github.com/elastic/elasticsearch/pull/16268) (issue: [<1>5802](https://github.com/elastic/elasticsearch/issues/15802)) 
  * Enable the indices request cache by default [<1>7162](https://github.com/elastic/elasticsearch/pull/17162) (issues: [<1>6870](https://github.com/elastic/elasticsearch/issues/16870), [<1>7134](https://github.com/elastic/elasticsearch/issues/17134)) 



Circuit Breakers 
    

  * Cluster Settings Updates should not trigger circuit breakers. [<2>0827](https://github.com/elastic/elasticsearch/pull/20827)
  * Circuit break the number of inline scripts compiled per minute [<1>9694](https://github.com/elastic/elasticsearch/pull/19694) (issue: [<1>9396](https://github.com/elastic/elasticsearch/issues/19396)) 



Cluster 
    

  * Add clusterUUID to RestMainAction output [<2>0503](https://github.com/elastic/elasticsearch/pull/20503)
  * Batch process node left and node failure [<1>9289](https://github.com/elastic/elasticsearch/pull/19289) (issue: [<1>9282](https://github.com/elastic/elasticsearch/issues/19282)) 
  * Index creation waits for write consistency shards [<1>8985](https://github.com/elastic/elasticsearch/pull/18985)
  * Inline reroute with process of node join/master election [<1>8938](https://github.com/elastic/elasticsearch/pull/18938) (issue: [<1>7270](https://github.com/elastic/elasticsearch/issues/17270)) 
  * Index creation does not cause the cluster health to go RED [<1>8737](https://github.com/elastic/elasticsearch/pull/18737) (issues: [<9>106](https://github.com/elastic/elasticsearch/issues/9106), [<9>126](https://github.com/elastic/elasticsearch/issues/9126)) 
  * Cluster Health class improvements [<1>8673](https://github.com/elastic/elasticsearch/pull/18673)
  * Adds tombstones to cluster state for index deletions [<1>7265](https://github.com/elastic/elasticsearch/pull/17265) (issues: [<1>6358](https://github.com/elastic/elasticsearch/issues/16358), [<1>7435](https://github.com/elastic/elasticsearch/issues/17435)) 
  * Enable acked indexing [<1>7038](https://github.com/elastic/elasticsearch/pull/17038) (issue: [<7>572](https://github.com/elastic/elasticsearch/issues/7572)) 
  * Cluster Health should run on applied states, even if waitFor=0 [<1>7440](https://github.com/elastic/elasticsearch/pull/17440)
  * Resolve index names to Index instances early [<1>7048](https://github.com/elastic/elasticsearch/pull/17048)
  * Remove DiscoveryNode#shouldConnectTo method [<1>6898](https://github.com/elastic/elasticsearch/pull/16898) (issue: [<1>6815](https://github.com/elastic/elasticsearch/issues/16815)) 
  * Fail demoted primary shards and retry request [<1>6415](https://github.com/elastic/elasticsearch/pull/16415) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Illegal shard failure requests [<1>6275](https://github.com/elastic/elasticsearch/pull/16275)
  * Shard failure requests for non-existent shards [<1>6089](https://github.com/elastic/elasticsearch/pull/16089) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Add handling of channel failures when starting a shard [<1>6041](https://github.com/elastic/elasticsearch/pull/16041) (issue: [<1>5895](https://github.com/elastic/elasticsearch/issues/15895)) 
  * Wait for new master when failing shard [<1>5748](https://github.com/elastic/elasticsearch/pull/15748) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Master should wait on cluster state publication when failing a shard [<1>5468](https://github.com/elastic/elasticsearch/pull/15468) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Split cluster state update tasks into roles [<1>4899](https://github.com/elastic/elasticsearch/pull/14899) (issue: [<1>3627](https://github.com/elastic/elasticsearch/issues/13627)) 
  * Add timeout mechanism for sending shard failures [<1>4707](https://github.com/elastic/elasticsearch/pull/14707) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Add listener mechanism for failures to send shard failed [<1>4295](https://github.com/elastic/elasticsearch/pull/14295) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 



Core 
    

  * Add production warning for pre-release builds [<2>0674](https://github.com/elastic/elasticsearch/pull/20674)
  * Add serial collector bootstrap check [<2>0558](https://github.com/elastic/elasticsearch/pull/20558)
  * Rename Netty TCP transports thread factories from http_* to transport_* [<2>0207](https://github.com/elastic/elasticsearch/pull/20207)
  * Do not log full bootstrap checks exception [<1>9989](https://github.com/elastic/elasticsearch/pull/19989)
  * Mark halting the virtual machine as privileged [<1>9923](https://github.com/elastic/elasticsearch/pull/19923) (issues: [<1>9272](https://github.com/elastic/elasticsearch/issues/19272), [<1>9806](https://github.com/elastic/elasticsearch/issues/19806)) 
  * Makes index creation more friendly [<1>9450](https://github.com/elastic/elasticsearch/pull/19450) (issue: [<9>126](https://github.com/elastic/elasticsearch/issues/9126)) 
  * Clearer error when handling fractional time values [<1>9158](https://github.com/elastic/elasticsearch/pull/19158) (issue: [<1>9102](https://github.com/elastic/elasticsearch/issues/19102)) 
  * Read Elasticsearch manifest via URL [<1>8999](https://github.com/elastic/elasticsearch/pull/18999) (issue: [<1>8996](https://github.com/elastic/elasticsearch/issues/18996)) 
  * Throw if the local node is not set [<1>8963](https://github.com/elastic/elasticsearch/pull/18963) (issue: [<1>8962](https://github.com/elastic/elasticsearch/issues/18962)) 
  * Bootstrap check for OnOutOfMemoryError and seccomp [<1>8756](https://github.com/elastic/elasticsearch/pull/18756) (issue: [<1>8736](https://github.com/elastic/elasticsearch/issues/18736)) 
  * Log OS and JVM on startup [<1>8557](https://github.com/elastic/elasticsearch/pull/18557)
  * Add GC overhead logging [<1>8419](https://github.com/elastic/elasticsearch/pull/18419)
  * Refactor JvmGcMonitorService for testing [<1>8378](https://github.com/elastic/elasticsearch/pull/18378)
  * Default to server VM and add client VM check [<1>8155](https://github.com/elastic/elasticsearch/pull/18155)
  * Add system bootstrap checks escape hatch [<1>8088](https://github.com/elastic/elasticsearch/pull/18088)
  * Avoid sliced locked contention in internal engine [<1>8060](https://github.com/elastic/elasticsearch/pull/18060) (issue: [<1>8053](https://github.com/elastic/elasticsearch/issues/18053)) 
  * Add heap size bootstrap check [<1>7728](https://github.com/elastic/elasticsearch/pull/17728) (issue: [<1>7490](https://github.com/elastic/elasticsearch/issues/17490)) 
  * Remove hostname from NetworkAddress.format [<1>7601](https://github.com/elastic/elasticsearch/pull/17601) (issue: [<1>7604](https://github.com/elastic/elasticsearch/issues/17604)) 
  * Bootstrapping bootstrap checks [<1>7595](https://github.com/elastic/elasticsearch/pull/17595) (issues: [<1>7474](https://github.com/elastic/elasticsearch/issues/17474), [<1>7570](https://github.com/elastic/elasticsearch/issues/17570)) 
  * Add max map count check [<1>6944](https://github.com/elastic/elasticsearch/pull/16944)
  * Remove PROTOTYPE from BulkItemResponse.Failure [<1>7433](https://github.com/elastic/elasticsearch/pull/17433) (issue: [<1>7086](https://github.com/elastic/elasticsearch/issues/17086)) 
  * Throw an exception if Writeable.Reader reads null [<1>7332](https://github.com/elastic/elasticsearch/pull/17332)
  * Remove PROTOTYPE from RescorerBuilders [<1>7330](https://github.com/elastic/elasticsearch/pull/17330)
  * Port Primary Terms to master [<1>7044](https://github.com/elastic/elasticsearch/pull/17044) (issues: [<1>4062](https://github.com/elastic/elasticsearch/issues/14062), [<1>4651](https://github.com/elastic/elasticsearch/issues/14651), [<1>7038](https://github.com/elastic/elasticsearch/issues/17038)) 
  * Use index UUID to lookup indices on IndicesService [<1>7001](https://github.com/elastic/elasticsearch/pull/17001)
  * Add -XX+AlwaysPreTouch JVM flag [<1>6937](https://github.com/elastic/elasticsearch/pull/16937)
  * Add max size virtual memory check [<1>6935](https://github.com/elastic/elasticsearch/pull/16935)
  * Use and test relative time in TransportBulkAction [<1>6916](https://github.com/elastic/elasticsearch/pull/16916)
  * Bump Elasticsearch version to 5.0.0-SNAPSHOT [<1>6862](https://github.com/elastic/elasticsearch/pull/16862)
  * Assert that we can write in all data-path on startup [<1>6745](https://github.com/elastic/elasticsearch/pull/16745)
  * Add G1GC check on startup [<1>6737](https://github.com/elastic/elasticsearch/pull/16737) (issue: [<1>0740](https://github.com/elastic/elasticsearch/issues/10740)) 
  * Shards with heavy indexing should get more of the indexing buffer [<1>4121](https://github.com/elastic/elasticsearch/pull/14121)
  * Remove and ban ImmutableMap [<1>3939](https://github.com/elastic/elasticsearch/pull/13939) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Finish banning ImmutableSet [<1>3820](https://github.com/elastic/elasticsearch/pull/13820) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Removes and bans ImmutableSet [<1>3754](https://github.com/elastic/elasticsearch/pull/13754) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and ban ImmutableMap#entrySet [<1>3724](https://github.com/elastic/elasticsearch/pull/13724)
  * Forbid ForwardingSet [<1>3720](https://github.com/elastic/elasticsearch/pull/13720) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 



Dates 
    

  * Improve TimeZoneRoundingTests error messages [<1>8895](https://github.com/elastic/elasticsearch/pull/18895)
  * Support full range of Java Long for epoch DateTime [<1>8509](https://github.com/elastic/elasticsearch/pull/18509) (issue: [<1>7936](https://github.com/elastic/elasticsearch/issues/17936)) 



Discovery 
    

  * Do not log cluster service errors at after joining a master [<1>9705](https://github.com/elastic/elasticsearch/pull/19705)
  * Log warning if minimum_master_nodes set to less than quorum [<1>5625](https://github.com/elastic/elasticsearch/pull/15625)
  * Add a dedicate queue for incoming ClusterStates [<1>3303](https://github.com/elastic/elasticsearch/pull/13303) (issue: [<1>3062](https://github.com/elastic/elasticsearch/issues/13062)) 



Engine 
    

  * Only try to read new segments info if we really flushed the index [<2>0474](https://github.com/elastic/elasticsearch/pull/20474)
  * Use _refresh instead of reading from Translog in the RT GET case [<2>0102](https://github.com/elastic/elasticsearch/pull/20102)
  * Remove writeLockTimeout from InternalEngine [<1>6930](https://github.com/elastic/elasticsearch/pull/16930)
  * Don’t guard IndexShard#refresh calls by a check to isRefreshNeeded [<1>6118](https://github.com/elastic/elasticsearch/pull/16118)
  * Never call a listerner under lock in InternalEngine [<1>5786](https://github.com/elastic/elasticsearch/pull/15786)
  * Use System.nanoTime() to initialize Engine.lastWriteNanos [<1>4321](https://github.com/elastic/elasticsearch/pull/14321)
  * Flush big merges automatically if shard is inactive [<1>4275](https://github.com/elastic/elasticsearch/pull/14275)
  * Remove Engine.Create [<1>3955](https://github.com/elastic/elasticsearch/pull/13955)
  * Remove the disabled autogenerated id optimization from InternalEngine [<1>3857](https://github.com/elastic/elasticsearch/pull/13857)



Exceptions 
    

  * Improve startup exception [<2>0083](https://github.com/elastic/elasticsearch/pull/20083)
  * Make NotMasterException a first class citizen [<1>9385](https://github.com/elastic/elasticsearch/pull/19385)
  * Do not catch throwable [<1>9231](https://github.com/elastic/elasticsearch/pull/19231)
  * Make the index-too-old exception more explicit [<1>8438](https://github.com/elastic/elasticsearch/pull/18438)
  * Add index name in IndexAlreadyExistsException default message [<1>8274](https://github.com/elastic/elasticsearch/pull/18274)
  * Fix typos in exception/assert/log messages in core module. [<1>6649](https://github.com/elastic/elasticsearch/pull/16649)
  * Add field names to several mapping errors [<1>6508](https://github.com/elastic/elasticsearch/pull/16508) (issue: [<1>6378](https://github.com/elastic/elasticsearch/issues/16378)) 
  * Add serialization support for more important IOExceptions [<1>5766](https://github.com/elastic/elasticsearch/pull/15766)
  * Adds exception objects to log messages. [<1>4827](https://github.com/elastic/elasticsearch/pull/14827) (issue: [<1>0021](https://github.com/elastic/elasticsearch/issues/10021)) 
  * Add stack traces to logged exceptions where missing [<1>3825](https://github.com/elastic/elasticsearch/pull/13825) (issue: [<1>0021](https://github.com/elastic/elasticsearch/issues/10021)) 
  * Remove reflection hacks from ElasticsearchException [<1>3796](https://github.com/elastic/elasticsearch/pull/13796)
  * Rename QueryParsingException to a more generic ParsingException [<1>3631](https://github.com/elastic/elasticsearch/pull/13631)
  * Add *Exception(Throwable cause) constructors/ call where appropriate [<1>3544](https://github.com/elastic/elasticsearch/pull/13544) (issue: [<1>0021](https://github.com/elastic/elasticsearch/issues/10021)) 



Expressions 
    

  * improve date api for expressions/painless fields [<1>8658](https://github.com/elastic/elasticsearch/pull/18658)
  * Support geo_point fields in lucene expressions [<1>8096](https://github.com/elastic/elasticsearch/pull/18096)
  * Add support for .empty to expressions, and some docs improvements [<1>8077](https://github.com/elastic/elasticsearch/pull/18077)



Geo 
    

  * GeoBoundingBoxQueryBuilder should throw IAE when topLeft and bottomRight are the same coordinate [<1>8668](https://github.com/elastic/elasticsearch/pull/18668) (issues: [<1>8458](https://github.com/elastic/elasticsearch/issues/18458), [<1>8631](https://github.com/elastic/elasticsearch/issues/18631)) 
  * Enhanced lat/long error handling [<1>6833](https://github.com/elastic/elasticsearch/pull/16833) (issue: [<1>6137](https://github.com/elastic/elasticsearch/issues/16137)) 
  * Fix a potential parsing problem in GeoDistanceSortParser [<1>7111](https://github.com/elastic/elasticsearch/pull/17111)
  * Geo: Add validation of shapes to ShapeBuilders [<1>5551](https://github.com/elastic/elasticsearch/pull/15551) (issue: [<1>4416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Make remaining ShapeBuilders implement Writeable [<1>5010](https://github.com/elastic/elasticsearch/pull/15010) (issue: [<1>4416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Geo: Remove internal `translated` flag from LineStringBuilder [<1>4969](https://github.com/elastic/elasticsearch/pull/14969)
  * Make PointBuilder, CircleBuilder & EnvelopeBuilder implement Writable [<1>4933](https://github.com/elastic/elasticsearch/pull/14933) (issue: [<1>4416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Merging BaseLineString and BasePolygonBuilder with subclass [<1>4887](https://github.com/elastic/elasticsearch/pull/14887) (issue: [<1>4482](https://github.com/elastic/elasticsearch/issues/14482)) 
  * Moving static factory methods to ShapeBuilders [<1>4529](https://github.com/elastic/elasticsearch/pull/14529)
  * Remove InternalLineStringBuilder and InternalPolygonBuilder [<1>4482](https://github.com/elastic/elasticsearch/pull/14482) (issue: [<1>4416](https://github.com/elastic/elasticsearch/issues/14416)) 



Highlighting 
    

  * Switch Highlighting to ObjectParser [<1>7363](https://github.com/elastic/elasticsearch/pull/17363)
  * Use HighlightBuilder in SearchSourceBuilder [<1>5376](https://github.com/elastic/elasticsearch/pull/15376) (issue: [<1>5044](https://github.com/elastic/elasticsearch/issues/15044)) 
  * Joint parsing of common global Hightlighter and subfield parameters [<1>5368](https://github.com/elastic/elasticsearch/pull/15368) (issue: [<1>5285](https://github.com/elastic/elasticsearch/issues/15285)) 
  * Enable HighlightBuilder to create SearchContextHighlight [<1>5324](https://github.com/elastic/elasticsearch/pull/15324)
  * Add fromXContent method to HighlightBuilder [<1>5157](https://github.com/elastic/elasticsearch/pull/15157)



Index APIs 
    

  * Add date-math support to `_rollover` [<2>0709](https://github.com/elastic/elasticsearch/pull/20709)
  * Add Shrink request source parser to parse create index request body [<1>8802](https://github.com/elastic/elasticsearch/pull/18802)
  * Fail hot_threads in a better way if unsupported by JDK [<1>5909](https://github.com/elastic/elasticsearch/pull/15909)



Index Templates 
    

  * Add "version" field to Templates [<2>0353](https://github.com/elastic/elasticsearch/pull/20353) (issue: [<2>0171](https://github.com/elastic/elasticsearch/issues/20171)) 
  * Parse and validate mappings on index template creation [<8>802](https://github.com/elastic/elasticsearch/pull/8802) (issue: [<2>415](https://github.com/elastic/elasticsearch/issues/2415)) 



Ingest 
    

  * Add "version" field to Pipelines [<2>0343](https://github.com/elastic/elasticsearch/pull/20343) (issue: [<2>0171](https://github.com/elastic/elasticsearch/issues/20171)) 
  * Make it possible for Ingest Processors to access AnalysisRegistry [<2>0233](https://github.com/elastic/elasticsearch/pull/20233)
  * add ignore_missing option to convert,trim,lowercase,uppercase,grok,rename [<2>0194](https://github.com/elastic/elasticsearch/pull/20194) (issue: [<1>9995](https://github.com/elastic/elasticsearch/issues/19995)) 
  * Add support for parameters to the script ingest processor [<2>0136](https://github.com/elastic/elasticsearch/pull/20136)
  * introduce the JSON Processor [<2>0128](https://github.com/elastic/elasticsearch/pull/20128) (issue: [<2>0052](https://github.com/elastic/elasticsearch/issues/20052)) 
  * Allow rename processor to turn leaf fields into branch fields [<2>0053](https://github.com/elastic/elasticsearch/pull/20053) (issue: [<1>9892](https://github.com/elastic/elasticsearch/issues/19892)) 
  * remove ability to set field value in script-processor configuration [<1>9981](https://github.com/elastic/elasticsearch/pull/19981)
  * Add REST _ingest/pipeline to get all pipelines [<1>9603](https://github.com/elastic/elasticsearch/pull/19603) (issue: [<1>9585](https://github.com/elastic/elasticsearch/issues/19585)) 
  * Show ignored errors in verbose simulate result [<1>9404](https://github.com/elastic/elasticsearch/pull/19404) (issue: [<1>9319](https://github.com/elastic/elasticsearch/issues/19319)) 
  * update foreach processor to only support one applied processor. [<1>9402](https://github.com/elastic/elasticsearch/pull/19402) (issue: [<1>9345](https://github.com/elastic/elasticsearch/issues/19345)) 
  * Skip the execution of an empty pipeline [<1>9200](https://github.com/elastic/elasticsearch/pull/19200) (issue: [<1>9192](https://github.com/elastic/elasticsearch/issues/19192)) 
  * Add `ignore_failure` option to all ingest processors [<1>8650](https://github.com/elastic/elasticsearch/pull/18650) (issue: [<1>8493](https://github.com/elastic/elasticsearch/issues/18493)) 
  * new ScriptProcessor for Ingest [<1>8193](https://github.com/elastic/elasticsearch/pull/18193)
  * Expose underlying processor to blame for thrown exception within CompoundProcessor [<1>8342](https://github.com/elastic/elasticsearch/pull/18342) (issue: [<1>7823](https://github.com/elastic/elasticsearch/issues/17823)) 
  * Avoid string concatentation in IngestDocument.FieldPath [<1>8108](https://github.com/elastic/elasticsearch/pull/18108)
  * add ability to specify multiple grok patterns [<1>8074](https://github.com/elastic/elasticsearch/pull/18074) (issue: [<1>7903](https://github.com/elastic/elasticsearch/issues/17903)) 
  * add ability to disable ability to override values of existing fields in set processor [<1>7902](https://github.com/elastic/elasticsearch/pull/17902) (issue: [<1>7659](https://github.com/elastic/elasticsearch/issues/17659)) 
  * Streamline option naming for several processors [<1>7892](https://github.com/elastic/elasticsearch/pull/17892) (issue: [<1>7835](https://github.com/elastic/elasticsearch/issues/17835)) 
  * add automatic type conversion support to ConvertProcessor [<1>7263](https://github.com/elastic/elasticsearch/pull/17263) (issue: [<1>7139](https://github.com/elastic/elasticsearch/issues/17139)) 
  * Give the foreach processor access to the rest of the document [<1>7172](https://github.com/elastic/elasticsearch/pull/17172) (issue: [<1>7147](https://github.com/elastic/elasticsearch/issues/17147)) 
  * Added ingest statistics to node stats API [<1>6915](https://github.com/elastic/elasticsearch/pull/16915)
  * Add `ingest_took` to bulk response [<1>6876](https://github.com/elastic/elasticsearch/pull/16876)
  * Add ingest info to node info API, which contains a list of available processors [<1>6865](https://github.com/elastic/elasticsearch/pull/16865)
  * Use diffs for ingest metadata in cluster state [<1>6847](https://github.com/elastic/elasticsearch/pull/16847)
  * hide null-valued metadata fields from WriteableIngestDocument#toXContent [<1>6557](https://github.com/elastic/elasticsearch/pull/16557)
  * Ingest: use bulk thread pool for bulk request processing (was index before) [<1>6539](https://github.com/elastic/elasticsearch/pull/16539) (issue: [<1>6503](https://github.com/elastic/elasticsearch/issues/16503)) 
  * Add foreach processor [<1>6432](https://github.com/elastic/elasticsearch/pull/16432)
  * revert PipelineFactoryError handling with throwing ElasticsearchParseException in ingest pipeline creation [<1>6355](https://github.com/elastic/elasticsearch/pull/16355)
  * Add processor tags to on_failure metadata in ingest pipeline [<1>6324](https://github.com/elastic/elasticsearch/pull/16324) (issue: [<1>6202](https://github.com/elastic/elasticsearch/issues/16202)) 
  * catch processor/pipeline factory exceptions and return structured error responses [<1>6276](https://github.com/elastic/elasticsearch/pull/16276) (issue: [<1>6010](https://github.com/elastic/elasticsearch/issues/16010)) 
  * Ingest: move get/put/delete pipeline methods to ClusterAdminClient [<1>6242](https://github.com/elastic/elasticsearch/pull/16242)
  * Geoip processor: remove redundant latitude and longitude fields and make location an object with lat and lon subfields [<1>6173](https://github.com/elastic/elasticsearch/pull/16173)



Inner Hits 
    

  * Change scriptFields member in InnerHitBuilder to set [<1>8092](https://github.com/elastic/elasticsearch/pull/18092) (issue: [<5>831](https://github.com/elastic/elasticsearch/issues/5831)) 



Internal 
    

  * Remove poor-mans compression in InternalSearchHit and friends [<2>0472](https://github.com/elastic/elasticsearch/pull/20472)
  * Don’t register SearchTransportService handlers more than once [<2>0468](https://github.com/elastic/elasticsearch/pull/20468)
  * Unguice SearchModule [<2>0456](https://github.com/elastic/elasticsearch/pull/20456)
  * Deguice SearchService and friends [<2>0423](https://github.com/elastic/elasticsearch/pull/20423)
  * NodeStats classes to implement Writeable rather then Streamable [<2>0327](https://github.com/elastic/elasticsearch/pull/20327)
  * More info classes to implement Writeable rather than Streamable [<2>0288](https://github.com/elastic/elasticsearch/pull/20288) (issue: [<2>0255](https://github.com/elastic/elasticsearch/issues/20255)) 
  * Internal: Split disk threshold monitoring from decider [<2>0018](https://github.com/elastic/elasticsearch/pull/20018)
  * Switching LockObtainFailedException over to ShardLockObtainFailedException [<1>9991](https://github.com/elastic/elasticsearch/pull/19991) (issue: [<1>9978](https://github.com/elastic/elasticsearch/issues/19978)) 
  * update and delete by query requests to implement IndicesRequest.Replaceable [<1>9961](https://github.com/elastic/elasticsearch/pull/19961)
  * VersionFetchSubPhase should not use Versions#loadDocIdAndVersion [<1>9944](https://github.com/elastic/elasticsearch/pull/19944)
  * Remove useless PK lookup in IndicesTTLService [<1>9945](https://github.com/elastic/elasticsearch/pull/19945)
  * ignore some docker craziness in seccomp environment checks [<1>9754](https://github.com/elastic/elasticsearch/pull/19754)
  * Make Priority an enum [<1>9448](https://github.com/elastic/elasticsearch/pull/19448)
  * Snapshot UUIDs in blob names [<1>9421](https://github.com/elastic/elasticsearch/pull/19421) (issues: [<1>8156](https://github.com/elastic/elasticsearch/issues/18156), [<1>8815](https://github.com/elastic/elasticsearch/issues/18815), [<1>9002](https://github.com/elastic/elasticsearch/issues/19002), [<7>540](https://github.com/elastic/elasticsearch/issues/7540)) 
  * Add RestController method for deprecating in one step [<1>9343](https://github.com/elastic/elasticsearch/pull/19343)
  * Tighten ensure atomic move cleanup [<1>9309](https://github.com/elastic/elasticsearch/pull/19309) (issue: [<1>9036](https://github.com/elastic/elasticsearch/issues/19036)) 
  * Enable checkstyle ModifierOrder [<1>9214](https://github.com/elastic/elasticsearch/pull/19214)
  * Expose task information from NodeClient [<1>9189](https://github.com/elastic/elasticsearch/pull/19189)
  * Changed rest handler interface to take NodeClient [<1>9170](https://github.com/elastic/elasticsearch/pull/19170)
  * Deprecate ExceptionsHelper.detailedMessage [<1>9160](https://github.com/elastic/elasticsearch/pull/19160) (issue: [<1>9069](https://github.com/elastic/elasticsearch/issues/19069)) 
  * Factor out ChannelBuffer from BytesReference [<1>9129](https://github.com/elastic/elasticsearch/pull/19129)
  * Cleanup Compressor interface [<1>9125](https://github.com/elastic/elasticsearch/pull/19125)
  * Hot methods redux [<1>9016](https://github.com/elastic/elasticsearch/pull/19016) (issue: [<1>6725](https://github.com/elastic/elasticsearch/issues/16725)) 
  * Remove forked joda time BaseDateTime class [<1>8953](https://github.com/elastic/elasticsearch/pull/18953)
  * Support optional ctor args in ConstructingObjectParser [<1>8725](https://github.com/elastic/elasticsearch/pull/18725)
  * Remove thread pool from page cache recycler [<1>8664](https://github.com/elastic/elasticsearch/pull/18664) (issue: [<1>8613](https://github.com/elastic/elasticsearch/issues/18613)) 
  * Do not automatically close XContent objects/arrays [<1>8549](https://github.com/elastic/elasticsearch/pull/18549) (issue: [<1>8433](https://github.com/elastic/elasticsearch/issues/18433)) 
  * Remove use of a Fields class in snapshot responses [<1>8497](https://github.com/elastic/elasticsearch/pull/18497)
  * Removes multiple toXContent entry points for SnapshotInfo [<1>8494](https://github.com/elastic/elasticsearch/pull/18494)
  * Removes unused methods in the o/e/common/Strings class [<1>8346](https://github.com/elastic/elasticsearch/pull/18346)
  * Determine content length eagerly in HttpServer [<1>8203](https://github.com/elastic/elasticsearch/pull/18203)
  * Consolidate query generation in QueryShardContext [<1>8129](https://github.com/elastic/elasticsearch/pull/18129)
  * Make reset in QueryShardContext private [<1>8113](https://github.com/elastic/elasticsearch/pull/18113)
  * Remove Strings#splitStringToArray [<1>8110](https://github.com/elastic/elasticsearch/pull/18110)
  * Add toString() to GetResponse [<1>8102](https://github.com/elastic/elasticsearch/pull/18102)
  * ConstructingObjectParser adapts ObjectParser for ctor args [<1>7596](https://github.com/elastic/elasticsearch/pull/17596) (issue: [<1>7352](https://github.com/elastic/elasticsearch/issues/17352)) 
  * Makes Script type writeable [<1>7908](https://github.com/elastic/elasticsearch/pull/17908) (issue: [<1>7753](https://github.com/elastic/elasticsearch/issues/17753)) 
  * FiltersAggregatorBuilder: Don’t create new context for inner parsing [<1>7851](https://github.com/elastic/elasticsearch/pull/17851)
  * Clean up serialization on some stats [<1>7832](https://github.com/elastic/elasticsearch/pull/17832) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Normalize registration for SignificanceHeuristics [<1>7830](https://github.com/elastic/elasticsearch/pull/17830) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Make (read|write)NamedWriteable public [<1>7829](https://github.com/elastic/elasticsearch/pull/17829) (issue: [<1>7682](https://github.com/elastic/elasticsearch/issues/17682)) 
  * Use try-with-resource when creating new parser instances where possible [<1>7822](https://github.com/elastic/elasticsearch/pull/17822)
  * Don’t pass XContentParser to ParseFieldRegistry#lookup [<1>7794](https://github.com/elastic/elasticsearch/pull/17794)
  * Internal: Remove threadlocal from document parser [<1>7764](https://github.com/elastic/elasticsearch/pull/17764)
  * Cut range aggregations to registerAggregation [<1>7757](https://github.com/elastic/elasticsearch/pull/17757) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove ParseFieldMatcher from AbstractXContentParser [<1>7756](https://github.com/elastic/elasticsearch/pull/17756) (issue: [<1>7417](https://github.com/elastic/elasticsearch/issues/17417)) 
  * Remove parser argument from methods where we already pass in a parse context [<1>7738](https://github.com/elastic/elasticsearch/pull/17738)
  * Switch SearchAfterBuilder to writeGenericValue [<1>7735](https://github.com/elastic/elasticsearch/pull/17735) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove StreamableReader [<1>7729](https://github.com/elastic/elasticsearch/pull/17729) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Cleanup nested, has_child & has_parent query builders for inner hits construction [<1>7719](https://github.com/elastic/elasticsearch/pull/17719) (issue: [<1>1118](https://github.com/elastic/elasticsearch/issues/11118)) 
  * Make AllocationCommands NamedWriteables [<1>7661](https://github.com/elastic/elasticsearch/pull/17661)
  * Isolate StreamableReader [<1>7656](https://github.com/elastic/elasticsearch/pull/17656) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Create registration methods for aggregations similar to those for queries [<1>7653](https://github.com/elastic/elasticsearch/pull/17653) (issues: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085), [<1>7389](https://github.com/elastic/elasticsearch/issues/17389)) 
  * Remove PROTOTYPEs from QueryBuilders [<1>7632](https://github.com/elastic/elasticsearch/pull/17632) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove registerQueryParser [<1>7608](https://github.com/elastic/elasticsearch/pull/17608)
  * ParseField#getAllNamesIncludedDeprecated to not return duplicate names [<1>7504](https://github.com/elastic/elasticsearch/pull/17504)
  * Rework a query parser and improve registration [<1>7458](https://github.com/elastic/elasticsearch/pull/17458)
  * Clean up QueryParseContext and don’t hold it inside QueryRewrite/ShardContext [<1>7417](https://github.com/elastic/elasticsearch/pull/17417)
  * Remove PROTOTYPE from MLT.Item [<1>7481](https://github.com/elastic/elasticsearch/pull/17481) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPE from VersionType [<1>7480](https://github.com/elastic/elasticsearch/pull/17480) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPEs from highlighting [<1>7466](https://github.com/elastic/elasticsearch/pull/17466) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPEs from ingest [<1>7434](https://github.com/elastic/elasticsearch/pull/17434) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Start to rework query registration [<1>7424](https://github.com/elastic/elasticsearch/pull/17424)
  * Factor out slow logs into Search and IndexingOperationListeners [<1>7398](https://github.com/elastic/elasticsearch/pull/17398)
  * Remove PROTOTYPE from Suggesters [<1>7370](https://github.com/elastic/elasticsearch/pull/17370)
  * Remove PROTOTYPE from SortBuilders [<1>7337](https://github.com/elastic/elasticsearch/pull/17337) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPE from ShapeBuilders [<1>7336](https://github.com/elastic/elasticsearch/pull/17336) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Replace FieldStatsProvider with a method on MappedFieldType. [<1>7334](https://github.com/elastic/elasticsearch/pull/17334)
  * Stop using PROTOTYPE in NamedWriteableRegistry [<1>7284](https://github.com/elastic/elasticsearch/pull/17284) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Support scheduled commands in current context [<1>7077](https://github.com/elastic/elasticsearch/pull/17077)
  * Thread limits [<1>7003](https://github.com/elastic/elasticsearch/pull/17003)
  * Remove leniency from segments info integrity checks [<1>6985](https://github.com/elastic/elasticsearch/pull/16985) (issue: [<1>6973](https://github.com/elastic/elasticsearch/issues/16973)) 
  * Rename SearchServiceTransportAction to SearchTransportService [<1>6880](https://github.com/elastic/elasticsearch/pull/16880)
  * Decouple the TransportService and ClusterService [<1>6872](https://github.com/elastic/elasticsearch/pull/16872) (issue: [<1>6788](https://github.com/elastic/elasticsearch/issues/16788)) 
  * Refactor bootstrap checks [<1>6844](https://github.com/elastic/elasticsearch/pull/16844) (issues: [<1>6733](https://github.com/elastic/elasticsearch/issues/16733), [<1>6835](https://github.com/elastic/elasticsearch/issues/16835)) 
  * Add LifecycleRunnable [<1>6752](https://github.com/elastic/elasticsearch/pull/16752)
  * Hot inlined methods in your area [<1>6725](https://github.com/elastic/elasticsearch/pull/16725)
  * Move IndicesQueryCache and IndicesRequestCache into IndicesService [<1>6603](https://github.com/elastic/elasticsearch/pull/16603)
  * Forbid use of java.security.MessageDigest#clone() [<1>6543](https://github.com/elastic/elasticsearch/pull/16543) (issue: [<1>6479](https://github.com/elastic/elasticsearch/issues/16479)) 
  * Make IndicesWarmer a private class of IndexService [<1>6470](https://github.com/elastic/elasticsearch/pull/16470)
  * Simplify IndicesFieldDataCache and detach from guice [<1>6469](https://github.com/elastic/elasticsearch/pull/16469)
  * Uppercase ells ( _L_ ) in long literals [<1>6329](https://github.com/elastic/elasticsearch/pull/16329) (issue: [<1>6279](https://github.com/elastic/elasticsearch/issues/16279)) 
  * ShardId equality and hash code inconsistency [<1>6319](https://github.com/elastic/elasticsearch/pull/16319) (issue: [<1>6217](https://github.com/elastic/elasticsearch/issues/16217)) 
  * Ensure all resources are closed on Node#close() [<1>6316](https://github.com/elastic/elasticsearch/pull/16316) (issue: [<1>3685](https://github.com/elastic/elasticsearch/issues/13685)) 
  * Make index uuid available in Index, ShardRouting & ShardId [<1>6217](https://github.com/elastic/elasticsearch/pull/16217)
  * Move RefreshTask into IndexService and use since task per index [<1>5933](https://github.com/elastic/elasticsearch/pull/15933)
  * Make IndexingMemoryController private to IndicesService [<1>5877](https://github.com/elastic/elasticsearch/pull/15877)
  * Cleanup IndexingOperationListeners infrastructure [<1>5875](https://github.com/elastic/elasticsearch/pull/15875)
  * Remove and forbid use of j.u.c.ThreadLocalRandom [<1>5862](https://github.com/elastic/elasticsearch/pull/15862) (issue: [<1>5294](https://github.com/elastic/elasticsearch/issues/15294)) 
  * Fix IntelliJ query builder type inference issues [<1>5429](https://github.com/elastic/elasticsearch/pull/15429)
  * Remove and forbid use of Collections#shuffle(List) and Random#<init>() [<1>5299](https://github.com/elastic/elasticsearch/pull/15299) (issue: [<1>5287](https://github.com/elastic/elasticsearch/issues/15287)) 
  * Remove and forbid use of the type-unsafe empty Collections fields [<1>5187](https://github.com/elastic/elasticsearch/pull/15187)
  * Move IndicesService.canDeleteShardContent to use IndexSettings [<1>5150](https://github.com/elastic/elasticsearch/pull/15150) (issue: [<1>5059](https://github.com/elastic/elasticsearch/issues/15059)) 
  * Simplify MonitorService construction and detach from guice [<1>5035](https://github.com/elastic/elasticsearch/pull/15035)
  * Use Supplier for StreamInput#readOptionalStreamable [<1>4806](https://github.com/elastic/elasticsearch/pull/14806)
  * Add variable-length long encoding [<1>4780](https://github.com/elastic/elasticsearch/pull/14780)
  * Extend usage of IndexSetting class [<1>4731](https://github.com/elastic/elasticsearch/pull/14731) (issue: [<1>4251](https://github.com/elastic/elasticsearch/issues/14251)) 
  * Fold SimilarityModule into IndexModule [<1>4284](https://github.com/elastic/elasticsearch/pull/14284)
  * Move to lucene BoostQuery [<1>4264](https://github.com/elastic/elasticsearch/pull/14264)
  * Use built-in method for computing hash code of longs [<1>4213](https://github.com/elastic/elasticsearch/pull/14213)
  * Refactor ShardFailure listener infrastructure [<1>4206](https://github.com/elastic/elasticsearch/pull/14206)
  * Add methods for variable-length encoding integral arrays [<1>4087](https://github.com/elastic/elasticsearch/pull/14087)
  * Fold IndexAliasesService into IndexService [<1>4044](https://github.com/elastic/elasticsearch/pull/14044)
  * Remove unneeded Module abstractions [<1>3944](https://github.com/elastic/elasticsearch/pull/13944)
  * Query refactoring: simplify IndexQueryParserService parse methods [<1>3938](https://github.com/elastic/elasticsearch/pull/13938) (issue: [<1>3859](https://github.com/elastic/elasticsearch/issues/13859)) 
  * Remove and forbid use of com.google.common.collect.Iterators [<1>3916](https://github.com/elastic/elasticsearch/pull/13916) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.ImmutableCollection [<1>3909](https://github.com/elastic/elasticsearch/pull/13909) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.io.Resources [<1>3908](https://github.com/elastic/elasticsearch/pull/13908) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.hash.* [<1>3907](https://github.com/elastic/elasticsearch/pull/13907) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.net.InetAddresses [<1>3905](https://github.com/elastic/elasticsearch/pull/13905) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.EvictingQueue [<1>3903](https://github.com/elastic/elasticsearch/pull/13903) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace Guava cache with simple concurrent LRU cache [<1>3879](https://github.com/elastic/elasticsearch/pull/13879)
  * Remove ClusterSerivce and IndexSettingsService dependency from IndexShard [<1>3853](https://github.com/elastic/elasticsearch/pull/13853)
  * Start making RecoverySourceHandler unittestable [<1>3840](https://github.com/elastic/elasticsearch/pull/13840)
  * Remove IndexService dep. from IndexShard [<1>3797](https://github.com/elastic/elasticsearch/pull/13797)
  * Remove ES internal deletion policies in favour of Lucenes implementations [<1>3794](https://github.com/elastic/elasticsearch/pull/13794)
  * Move ShardTermVectorService to be on indices level as TermVectorService [<1>3786](https://github.com/elastic/elasticsearch/pull/13786)
  * Move ShardPercolateService creation into IndexShard [<1>3777](https://github.com/elastic/elasticsearch/pull/13777)
  * Remove `ExpressionScriptCompilationException` and `ExpressionScriptExecutionException` [<1>3742](https://github.com/elastic/elasticsearch/pull/13742)
  * Reduced the number of ClusterStateUpdateTask variants [<1>3735](https://github.com/elastic/elasticsearch/pull/13735)
  * Add a BaseParser helper for stream parsing [<1>3615](https://github.com/elastic/elasticsearch/pull/13615)
  * Remove and forbid use of com.google.common.primitives.Ints [<1>3596](https://github.com/elastic/elasticsearch/pull/13596) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.math.LongMath [<1>3575](https://github.com/elastic/elasticsearch/pull/13575) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.base.Joiner [<1>3572](https://github.com/elastic/elasticsearch/pull/13572) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace and ban next batch of Guava classes [<1>3562](https://github.com/elastic/elasticsearch/pull/13562) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Iterables [<1>3559](https://github.com/elastic/elasticsearch/pull/13559) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace LoadingCache usage with a simple ConcurrentHashMap [<1>3552](https://github.com/elastic/elasticsearch/pull/13552) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Use Supplier instead of Reflection [<1>3545](https://github.com/elastic/elasticsearch/pull/13545)
  * Remove and forbid use of com.google.common.base.Preconditions [<1>3540](https://github.com/elastic/elasticsearch/pull/13540) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of guava Function, Charsets, Collections2 [<1>3533](https://github.com/elastic/elasticsearch/pull/13533) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.ImmutableSortedMap [<1>3525](https://github.com/elastic/elasticsearch/pull/13525) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of several com.google.common.util. classes [<1>3524](https://github.com/elastic/elasticsearch/pull/13524) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Cleanup SearchRequest & SearchRequestBuilder [<1>3518](https://github.com/elastic/elasticsearch/pull/13518)
  * Remove and forbid use of com.google.common.collect.Queues [<1>3498](https://github.com/elastic/elasticsearch/pull/13498) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.base.Preconditions#checkNotNull [<1>3493](https://github.com/elastic/elasticsearch/pull/13493) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Sets [<1>3463](https://github.com/elastic/elasticsearch/pull/13463) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Maps [<1>3438](https://github.com/elastic/elasticsearch/pull/13438) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove use of underscore as an identifier [<1>3353](https://github.com/elastic/elasticsearch/pull/13353)
  * Remove and forbid the use of com.google.common.base.Predicate(s)? [<1>3349](https://github.com/elastic/elasticsearch/pull/13349) (issues: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224), [<1>3314](https://github.com/elastic/elasticsearch/issues/13314)) 
  * This commit removes com.google.common.io [<1>3302](https://github.com/elastic/elasticsearch/pull/13302) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 



Java API 
    

  * Ensure PutMappingRequest.buildFromSimplifiedDef input are pairs [<1>9837](https://github.com/elastic/elasticsearch/pull/19837) (issue: [<1>9836](https://github.com/elastic/elasticsearch/issues/19836)) 
  * Start from a random node number so that clients do not overload the first node configured [<1>4143](https://github.com/elastic/elasticsearch/pull/14143)
  * Switch QueryBuilders to new MatchPhraseQueryBuilder [<1>8753](https://github.com/elastic/elasticsearch/pull/18753)
  * Improve adding clauses to `span_near` and `span_or` query [<1>8485](https://github.com/elastic/elasticsearch/pull/18485) (issue: [<1>8478](https://github.com/elastic/elasticsearch/issues/18478)) 
  * QueryBuilder does not need generics. [<1>8133](https://github.com/elastic/elasticsearch/pull/18133)
  * Remove copy constructors from request classes and TransportMessage type [<1>6640](https://github.com/elastic/elasticsearch/pull/16640) (issue: [<1>5776](https://github.com/elastic/elasticsearch/issues/15776)) 



Java REST Client 
    

  * Add support for a RestClient path prefix [<2>0190](https://github.com/elastic/elasticsearch/pull/20190)
  * Add "Async" to the end of each Async RestClient method [<2>0172](https://github.com/elastic/elasticsearch/pull/20172) (issue: [<2>0168](https://github.com/elastic/elasticsearch/issues/20168)) 
  * Allow RestClient to send array-based headers [<2>0151](https://github.com/elastic/elasticsearch/pull/20151)
  * Add response body to ResponseException error message [<1>9653](https://github.com/elastic/elasticsearch/pull/19653) (issue: [<1>9653](https://github.com/elastic/elasticsearch/issues/19653)) 
  * Simplify Sniffer initialization and automatically create the default HostsSniffer [<1>9599](https://github.com/elastic/elasticsearch/pull/19599)
  * Remove duplicate dependency declaration for http client [<1>9580](https://github.com/elastic/elasticsearch/pull/19580) (issue: [<1>9281](https://github.com/elastic/elasticsearch/issues/19281)) 
  * Add callback to customize http client settings [<1>9373](https://github.com/elastic/elasticsearch/pull/19373)
  * Rest Client: add short performRequest method variants without params and/or body [<1>9340](https://github.com/elastic/elasticsearch/pull/19340) (issue: [<1>9312](https://github.com/elastic/elasticsearch/issues/19312)) 



Logging 
    

  * Ensure logging is initialized in CLI tools [<2>0575](https://github.com/elastic/elasticsearch/pull/20575)
  * Give useful error message if log config is missing [<2>0493](https://github.com/elastic/elasticsearch/pull/20493)
  * Complete Elasticsearch logger names [<2>0457](https://github.com/elastic/elasticsearch/pull/20457) (issue: [<2>0326](https://github.com/elastic/elasticsearch/issues/20326)) 
  * Add node name to decider trace logging [<2>0437](https://github.com/elastic/elasticsearch/pull/20437) (issue: [<2>0379](https://github.com/elastic/elasticsearch/issues/20379)) 
  * Logging shutdown hack [<2>0389](https://github.com/elastic/elasticsearch/pull/20389) (issue: [<2>0304](https://github.com/elastic/elasticsearch/issues/20304)) 
  * Disable console logging [<2>0387](https://github.com/elastic/elasticsearch/pull/20387)
  * Skip loading of jansi from log4j2 [<2>0334](https://github.com/elastic/elasticsearch/pull/20334)
  * Configure AWS SDK logging configuration [<2>0313](https://github.com/elastic/elasticsearch/pull/20313) (issue: [<2>0294](https://github.com/elastic/elasticsearch/issues/20294)) 
  * Warn if unsupported logging configuration present [<2>0309](https://github.com/elastic/elasticsearch/pull/20309)
  * Size limit deprecation logs [<2>0287](https://github.com/elastic/elasticsearch/pull/20287) (issues: [<2>0235](https://github.com/elastic/elasticsearch/issues/20235), [<2>0254](https://github.com/elastic/elasticsearch/issues/20254)) 
  * Increase visibility of deprecation logger [<2>0254](https://github.com/elastic/elasticsearch/pull/20254) (issue: [<1>1033](https://github.com/elastic/elasticsearch/issues/11033)) 
  * Add log message about enforcing bootstrap checks [<1>9451](https://github.com/elastic/elasticsearch/pull/19451)
  * Improve logging for batched cluster state updates [<1>9255](https://github.com/elastic/elasticsearch/pull/19255)
  * Send HTTP Warning Header(s) for any Deprecation Usage from a REST request [<1>7804](https://github.com/elastic/elasticsearch/pull/17804) (issue: [<1>7687](https://github.com/elastic/elasticsearch/issues/17687)) 
  * Throw IllegalStateException when handshake fails due to version or cluster mismatch [<1>8676](https://github.com/elastic/elasticsearch/pull/18676)



Mapping 
    

  * Automatically downgrade text and keyword to string on indexes imported from 2.x [<2>0177](https://github.com/elastic/elasticsearch/pull/20177)
  * Do not parse numbers as both strings and numbers when not included in `_all`. [<2>0167](https://github.com/elastic/elasticsearch/pull/20167)
  * Don’t index the `_version` field [<2>0132](https://github.com/elastic/elasticsearch/pull/20132)
  * The root object mapper should support updating `numeric_detection`, `date_detection` and `dynamic_date_formats`. [<2>0119](https://github.com/elastic/elasticsearch/pull/20119) (issue: [<2>0111](https://github.com/elastic/elasticsearch/issues/20111)) 
  * Automatically upgrade analyzed string fields that have `index_options` or `position_increment_gap` set. [<2>0002](https://github.com/elastic/elasticsearch/pull/20002) (issue: [<1>9974](https://github.com/elastic/elasticsearch/issues/19974)) 
  * Mappings: Support dots in field names in mapping parsing [<1>9899](https://github.com/elastic/elasticsearch/pull/19899) (issue: [<1>9443](https://github.com/elastic/elasticsearch/issues/19443)) 
  * Save one utf8 conversion in KeywordFieldMapper. [<1>9867](https://github.com/elastic/elasticsearch/pull/19867)
  * Do not parse the created version from the settings every time a field is parsed. [<1>9824](https://github.com/elastic/elasticsearch/pull/19824)
  * Elasticsearch should reject dynamic templates with unknown `match_mapping_type`. [<1>7285](https://github.com/elastic/elasticsearch/pull/17285) (issue: [<1>6945](https://github.com/elastic/elasticsearch/issues/16945)) 
  * Upgrade `string` fields to `text`/`keyword` even if `include_in_all` is set. [<1>9004](https://github.com/elastic/elasticsearch/pull/19004) (issue: [<1>8974](https://github.com/elastic/elasticsearch/issues/18974)) 
  * Adds a methods to find (and dynamically create) the mappers for the parents of a field with dots in the field name [<1>8106](https://github.com/elastic/elasticsearch/pull/18106) (issue: [<1>5951](https://github.com/elastic/elasticsearch/issues/15951)) 
  * Automatically upgrade analyzed strings with an analyzer to `text`. [<1>7861](https://github.com/elastic/elasticsearch/pull/17861)
  * Support dots in field names when mapping already exists [<1>7759](https://github.com/elastic/elasticsearch/pull/17759) (issue: [<1>5951](https://github.com/elastic/elasticsearch/issues/15951)) 
  * Use the new points API to index numeric fields. [<1>7746](https://github.com/elastic/elasticsearch/pull/17746) (issues: [<1>1513](https://github.com/elastic/elasticsearch/issues/11513), [<1>6751](https://github.com/elastic/elasticsearch/issues/16751), [<1>7007](https://github.com/elastic/elasticsearch/issues/17007), [<1>7700](https://github.com/elastic/elasticsearch/issues/17700)) 
  * Simplify AllEntries, AllField and AllFieldMapper: [<1>7613](https://github.com/elastic/elasticsearch/pull/17613)
  * Make `parseMultiField` part of `parseField`. [<1>7313](https://github.com/elastic/elasticsearch/pull/17313)
  * Automatically add a sub keyword field to string dynamic mappings. [<1>7188](https://github.com/elastic/elasticsearch/pull/17188)
  * Remove friction from the mapping changes in 5.0. [<1>6991](https://github.com/elastic/elasticsearch/pull/16991)
  * Rework norms parameters for 5.0. [<1>6987](https://github.com/elastic/elasticsearch/pull/16987)
  * Moved dynamic field handling in doc parsing to end of parsing [<1>6798](https://github.com/elastic/elasticsearch/pull/16798)
  * Remove the MapperBuilders utility class. [<1>6609](https://github.com/elastic/elasticsearch/pull/16609)
  * Make the `index` property a boolean. [<1>6161](https://github.com/elastic/elasticsearch/pull/16161)
  * Remove the ability to enable doc values with the `fielddata.format` setting. [<1>6147](https://github.com/elastic/elasticsearch/pull/16147)
  * Be stricter about parsing boolean values in mappings. [<1>6146](https://github.com/elastic/elasticsearch/pull/16146)
  * Fix default doc values to be enabled when a field is not indexed. [<1>6141](https://github.com/elastic/elasticsearch/pull/16141)
  * Dynamically map floating-point numbers as floats instead of doubles. [<1>5319](https://github.com/elastic/elasticsearch/pull/15319) (issue: [<1>3851](https://github.com/elastic/elasticsearch/issues/13851)) 
  * Simplify MetaDataMappingService. [<1>5217](https://github.com/elastic/elasticsearch/pull/15217)
  * Remove MergeMappingException. [<1>5177](https://github.com/elastic/elasticsearch/pull/15177)



Network 
    

  * Avoid early initializing Netty [<1>9819](https://github.com/elastic/elasticsearch/pull/19819) (issue: [<5>644](https://github.com/elastic/elasticsearch/issues/5644)) 
  * Network: Allow to listen on virtual interfaces. [<1>9568](https://github.com/elastic/elasticsearch/pull/19568) (issues: [<1>7473](https://github.com/elastic/elasticsearch/issues/17473), [<1>9537](https://github.com/elastic/elasticsearch/issues/19537)) 
  * Explicitly tell Netty to not use unsafe [<1>9786](https://github.com/elastic/elasticsearch/pull/19786) (issues: [<1>9562](https://github.com/elastic/elasticsearch/issues/19562), [<5>624](https://github.com/elastic/elasticsearch/issues/5624)) 
  * Enable Netty 4 extensions [<1>9767](https://github.com/elastic/elasticsearch/pull/19767) (issue: [<1>9526](https://github.com/elastic/elasticsearch/issues/19526)) 
  * Modularize netty [<1>9392](https://github.com/elastic/elasticsearch/pull/19392)
  * Simplify TcpTransport interface by reducing send code to a single send method [<1>9223](https://github.com/elastic/elasticsearch/pull/19223)
  * Do not start scheduled pings until transport start [<1>8702](https://github.com/elastic/elasticsearch/pull/18702)



Packaging 
    

  * Add quiet option to disable console logging [<2>0422](https://github.com/elastic/elasticsearch/pull/20422) (issues: [<1>5315](https://github.com/elastic/elasticsearch/issues/15315), [<1>6159](https://github.com/elastic/elasticsearch/issues/16159), [<1>7220](https://github.com/elastic/elasticsearch/issues/17220)) 
  * Explicitly disable Netty key set replacement [<2>0249](https://github.com/elastic/elasticsearch/pull/20249)
  * Remove explicit parallel new GC flag [<1>8767](https://github.com/elastic/elasticsearch/pull/18767)
  * Use JAVA_HOME or java.exe in PATH like the Linux scripts do [<1>8685](https://github.com/elastic/elasticsearch/pull/18685) (issue: [<4>913](https://github.com/elastic/elasticsearch/issues/4913)) 
  * Don’t mkdir directly in deb init script [<1>8503](https://github.com/elastic/elasticsearch/pull/18503) (issue: [<1>8307](https://github.com/elastic/elasticsearch/issues/18307)) 
  * Increase default heap size to 2g [<1>8311](https://github.com/elastic/elasticsearch/pull/18311) (issues: [<1>6334](https://github.com/elastic/elasticsearch/issues/16334), [<1>7686](https://github.com/elastic/elasticsearch/issues/17686), [<1>8309](https://github.com/elastic/elasticsearch/issues/18309)) 
  * Switch init.d scripts to use bash [<1>8308](https://github.com/elastic/elasticsearch/pull/18308) (issue: [<1>8259](https://github.com/elastic/elasticsearch/issues/18259)) 
  * Switch scripts to use bash [<1>8251](https://github.com/elastic/elasticsearch/pull/18251) (issue: [<1>4002](https://github.com/elastic/elasticsearch/issues/14002)) 
  * Further simplifications of plugin script [<1>8239](https://github.com/elastic/elasticsearch/pull/18239) (issue: [<1>8207](https://github.com/elastic/elasticsearch/issues/18207)) 
  * Pass ES_JAVA_OPTS to JVM for plugins script [<1>8140](https://github.com/elastic/elasticsearch/pull/18140) (issue: [<1>6790](https://github.com/elastic/elasticsearch/issues/16790)) 
  * Remove unnecessary sleep from init script restart [<1>7966](https://github.com/elastic/elasticsearch/pull/17966)
  * Explicitly set packaging permissions [<1>7912](https://github.com/elastic/elasticsearch/pull/17912) (issue: [<1>7634](https://github.com/elastic/elasticsearch/issues/17634)) 
  * rpm uses non-portable `--system` flag to `useradd` [<1>4596](https://github.com/elastic/elasticsearch/pull/14596) (issue: [<1>4211](https://github.com/elastic/elasticsearch/issues/14211)) 
  * Adding JAVA_HOME to documents and env config file [<1>1338](https://github.com/elastic/elasticsearch/pull/11338) (issue: [<1>1291](https://github.com/elastic/elasticsearch/issues/11291)) 
  * Added RPM metadata [<1>7477](https://github.com/elastic/elasticsearch/pull/17477)
  * Elasticsearch ownership for data, logs, and configs [<1>7197](https://github.com/elastic/elasticsearch/pull/17197) (issue: [<1>2688](https://github.com/elastic/elasticsearch/issues/12688)) 
  * Fail early on JDK with compiler bug [<1>6418](https://github.com/elastic/elasticsearch/pull/16418) (issues: [<1>6097](https://github.com/elastic/elasticsearch/issues/16097), [<1>6362](https://github.com/elastic/elasticsearch/issues/16362)) 
  * Make security non-optional [<1>6176](https://github.com/elastic/elasticsearch/pull/16176)
  * Remove RuntimePermission("accessDeclaredMembers") [<1>5378](https://github.com/elastic/elasticsearch/pull/15378)
  * Remove Guava as a dependency [<1>4055](https://github.com/elastic/elasticsearch/pull/14055) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove Guava as a dependency [<1>4054](https://github.com/elastic/elasticsearch/pull/14054) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 



Percolator 
    

  * Also support query term extract for queries wrapped inside a FunctionScoreQuery [<1>9184](https://github.com/elastic/elasticsearch/pull/19184)
  * Add support for synonym query to percolator query term extraction [<1>9066](https://github.com/elastic/elasticsearch/pull/19066)
  * Add percolator query extraction support for dismax query [<1>8845](https://github.com/elastic/elasticsearch/pull/18845)
  * Improve percolate query performance by not verifying certain candidate matches [<1>8696](https://github.com/elastic/elasticsearch/pull/18696)
  * Improve percolator query term extraction [<1>8610](https://github.com/elastic/elasticsearch/pull/18610)
  * PercolatorQueryBuilder cleanup by using MemoryIndex#fromDocument(…) helper [<1>7669](https://github.com/elastic/elasticsearch/pull/17669) (issue: [<9>386](https://github.com/elastic/elasticsearch/issues/9386)) 
  * Add scoring support to the percolator query [<1>7385](https://github.com/elastic/elasticsearch/pull/17385) (issue: [<1>3827](https://github.com/elastic/elasticsearch/issues/13827)) 
  * Add query extract support for the blended term query and the common terms query [<1>7347](https://github.com/elastic/elasticsearch/pull/17347)
  * Add support for several span queries in ExtractQueryTermsService [<1>7323](https://github.com/elastic/elasticsearch/pull/17323)
  * Add support for TermsQuery in ExtractQueryTermsService [<1>7316](https://github.com/elastic/elasticsearch/pull/17316)
  * Replace percolate APIs with a percolator query [<1>6349](https://github.com/elastic/elasticsearch/pull/16349) (issues: [<1>0741](https://github.com/elastic/elasticsearch/issues/10741), [<1>1264](https://github.com/elastic/elasticsearch/issues/11264), [<1>3176](https://github.com/elastic/elasticsearch/issues/13176), [<1>3978](https://github.com/elastic/elasticsearch/issues/13978), [<4>317](https://github.com/elastic/elasticsearch/issues/4317), [<7>297](https://github.com/elastic/elasticsearch/issues/7297)) 



Plugin Analysis Kuromoji 
    

  * Add nbest options and NumberFilter [<1>7173](https://github.com/elastic/elasticsearch/pull/17173)



Plugin Discovery EC2 
    

  * Use `DefaultAWSCredentialsProviderChain` AWS SDK class for credentials [<1>9561](https://github.com/elastic/elasticsearch/pull/19561) (issue: [<1>9556](https://github.com/elastic/elasticsearch/issues/19556)) 
  * Support new Asia Pacific (Mumbai) ap-south-1 AWS region [<1>9112](https://github.com/elastic/elasticsearch/pull/19112) (issue: [<1>9110](https://github.com/elastic/elasticsearch/issues/19110)) 
  * Add support for proxy authentication for s3 and ec2 [<1>5293](https://github.com/elastic/elasticsearch/pull/15293) (issue: [<1>5268](https://github.com/elastic/elasticsearch/issues/15268)) 



Plugin Discovery GCE 
    

  * Allow `_gce_` network when not using discovery gce [<1>5765](https://github.com/elastic/elasticsearch/pull/15765) (issue: [<1>5724](https://github.com/elastic/elasticsearch/issues/15724)) 



Plugin Ingest Attachment 
    

  * Minor attachment processor improvements [<1>6574](https://github.com/elastic/elasticsearch/pull/16574)



Plugin Lang Painless 
    

  * Disable regexes by default in painless [<2>0427](https://github.com/elastic/elasticsearch/pull/20427) (issue: [<2>0397](https://github.com/elastic/elasticsearch/issues/20397)) 
  * Catch OutOfMemory and StackOverflow errors in Painless [<1>9936](https://github.com/elastic/elasticsearch/pull/19936)
  * Change Painless Tree Structure for Variable/Method Chains [<1>9459](https://github.com/elastic/elasticsearch/pull/19459)
  * Add replaceAll and replaceFirst [<1>9070](https://github.com/elastic/elasticsearch/pull/19070)
  * Painless Initializers [<1>9012](https://github.com/elastic/elasticsearch/pull/19012)
  * Add augmentation [<1>9003](https://github.com/elastic/elasticsearch/pull/19003)
  * Infer lambda arguments/return type [<1>8983](https://github.com/elastic/elasticsearch/pull/18983)
  * Fix explicit casts and improve tests. [<1>8958](https://github.com/elastic/elasticsearch/pull/18958)
  * Add lambda captures [<1>8954](https://github.com/elastic/elasticsearch/pull/18954)
  * improve Debugger to print code even if it hits exception [<1>8932](https://github.com/elastic/elasticsearch/pull/18932) (issue: [<1>](https://github.com/elastic/elasticsearch/issues/1)) 
  * Move semicolon hack into lexer [<1>8931](https://github.com/elastic/elasticsearch/pull/18931)
  * Add flag support to regexes [<1>8927](https://github.com/elastic/elasticsearch/pull/18927)
  * improve lambda syntax (allow single expression) [<1>8924](https://github.com/elastic/elasticsearch/pull/18924)
  * Remove useless dropArguments in megamorphic cache [<1>8913](https://github.com/elastic/elasticsearch/pull/18913)
  * non-capturing lambda support [<1>8911](https://github.com/elastic/elasticsearch/pull/18911) (issue: [<1>8824](https://github.com/elastic/elasticsearch/issues/18824)) 
  * fix bugs in operators and more improvements for the dynamic case [<1>8899](https://github.com/elastic/elasticsearch/pull/18899)
  * improve unary operators and cleanup tests [<1>8867](https://github.com/elastic/elasticsearch/pull/18867) (issue: [<1>8849](https://github.com/elastic/elasticsearch/issues/18849)) 
  * Add support for the find operator (=) and the match operator (==) [<1>8858](https://github.com/elastic/elasticsearch/pull/18858)
  * Remove casts and boxing for dynamic math [<1>8849](https://github.com/elastic/elasticsearch/pull/18849) (issue: [<1>8847](https://github.com/elastic/elasticsearch/issues/18847)) 
  * Refactor def math [<1>8847](https://github.com/elastic/elasticsearch/pull/18847)
  * Add support for /regex/ [<1>8842](https://github.com/elastic/elasticsearch/pull/18842)
  * Array constructor references [<1>8831](https://github.com/elastic/elasticsearch/pull/18831)
  * Method references to user functions [<1>8828](https://github.com/elastic/elasticsearch/pull/18828)
  * Add } as a delimiter. [<1>8827](https://github.com/elastic/elasticsearch/pull/18827) (issue: [<1>8821](https://github.com/elastic/elasticsearch/issues/18821)) 
  * Add Lambda Stub Node [<1>8824](https://github.com/elastic/elasticsearch/pull/18824)
  * Add capturing method references [<1>8818](https://github.com/elastic/elasticsearch/pull/18818) (issue: [<1>8748](https://github.com/elastic/elasticsearch/issues/18748)) 
  * Add Functions to Painless [<1>8810](https://github.com/elastic/elasticsearch/pull/18810)
  * Add Method to Get New MethodWriters [<1>8771](https://github.com/elastic/elasticsearch/pull/18771)
  * Static For Each [<1>8757](https://github.com/elastic/elasticsearch/pull/18757)
  * Method reference support [<1>8748](https://github.com/elastic/elasticsearch/pull/18748) (issue: [<1>8578](https://github.com/elastic/elasticsearch/issues/18578)) 
  * Add support for the new Java 9 MethodHandles#arrayLength() factory [<1>8734](https://github.com/elastic/elasticsearch/pull/18734)
  * Improve painless compile-time exceptions [<1>8711](https://github.com/elastic/elasticsearch/pull/18711) (issue: [<1>8600](https://github.com/elastic/elasticsearch/issues/18600)) 
  * add java.time packages to painless whitelist [<1>8621](https://github.com/elastic/elasticsearch/pull/18621)
  * Add Function Reference Stub to Painless [<1>8578](https://github.com/elastic/elasticsearch/pull/18578)
  * improve painless whitelist coverage of java api [<1>8533](https://github.com/elastic/elasticsearch/pull/18533)
  * Definition cleanup [<1>8463](https://github.com/elastic/elasticsearch/pull/18463)
  * Made def variable casting consistent with invokedynamic rules [<1>8425](https://github.com/elastic/elasticsearch/pull/18425)
  * Use Java 9 Indy String Concats, if available [<1>8400](https://github.com/elastic/elasticsearch/pull/18400) (issue: [<1>8398](https://github.com/elastic/elasticsearch/issues/18398)) 
  * Add method overloading based on arity [<1>8385](https://github.com/elastic/elasticsearch/pull/18385)
  * Refactor WriterUtils to extend ASM GeneratorAdapter [<1>8382](https://github.com/elastic/elasticsearch/pull/18382)
  * Whitelist expansion [<1>8372](https://github.com/elastic/elasticsearch/pull/18372)
  * Remove boxing when loading and storing values in "def" fields/arrays, remove boxing onsimple method calls of "def" methods [<1>8359](https://github.com/elastic/elasticsearch/pull/18359)
  * Some cleanups [<1>8352](https://github.com/elastic/elasticsearch/pull/18352)
  * Use isAssignableFrom instead of relying on ClassCastException [<1>8350](https://github.com/elastic/elasticsearch/pull/18350)
  * Build descriptor of array and field load/store in code [<1>8338](https://github.com/elastic/elasticsearch/pull/18338)
  * Rename the dynamic call site factory to DefBootstrap [<1>8335](https://github.com/elastic/elasticsearch/pull/18335)
  * Cleanup of DynamicCallSite [<1>8323](https://github.com/elastic/elasticsearch/pull/18323)
  * Improve exception stacktraces [<1>8319](https://github.com/elastic/elasticsearch/pull/18319)
  * Make Line Number Available in Painless [<1>8298](https://github.com/elastic/elasticsearch/pull/18298)
  * Remove input, support params instead [<1>8287](https://github.com/elastic/elasticsearch/pull/18287)
  * Decouple ANTLR AST from Painless [<1>8286](https://github.com/elastic/elasticsearch/pull/18286)
  * _value support in painess? [<1>8284](https://github.com/elastic/elasticsearch/pull/18284)
  * Long priority over Float [<1>8282](https://github.com/elastic/elasticsearch/pull/18282)
  * _score as double, not float [<1>8277](https://github.com/elastic/elasticsearch/pull/18277)
  * Add _ctx_ keyword to painless. [<1>8264](https://github.com/elastic/elasticsearch/pull/18264)
  * Painless doc access [<1>8262](https://github.com/elastic/elasticsearch/pull/18262)
  * Retrieve _score directly from Scorer [<1>8258](https://github.com/elastic/elasticsearch/pull/18258)
  * Implement needsScore() correctly. [<1>8247](https://github.com/elastic/elasticsearch/pull/18247)
  * Add synthetic length property as alias to Lists, so they can be used like arrays [<1>8241](https://github.com/elastic/elasticsearch/pull/18241)
  * Use better typing for dynamic method calls [<1>8234](https://github.com/elastic/elasticsearch/pull/18234)
  * Array load/store and length with invokedynamic [<1>8232](https://github.com/elastic/elasticsearch/pull/18232) (issue: [<1>8201](https://github.com/elastic/elasticsearch/issues/18201)) 
  * Switch painless dynamic calls to invokedynamic, remove perf hack/cheat [<1>8201](https://github.com/elastic/elasticsearch/pull/18201)
  * Add fielddata accessors (.value/.values/.distance()/etc) [<1>8169](https://github.com/elastic/elasticsearch/pull/18169)
  * painless: optimize/simplify dynamic field and method access [<1>8151](https://github.com/elastic/elasticsearch/pull/18151)
  * Painless: Single-Quoted Strings [<1>8150](https://github.com/elastic/elasticsearch/pull/18150)
  * Painless Clean Up [<1>7428](https://github.com/elastic/elasticsearch/pull/17428)
  * Make Painless a Module [<1>6755](https://github.com/elastic/elasticsearch/pull/16755)
  * Minor Clean up [<1>6457](https://github.com/elastic/elasticsearch/pull/16457)
  * Remove Extra String Concat Token [<1>6382](https://github.com/elastic/elasticsearch/pull/16382)



Plugin Mapper Attachment 
    

  * minor attachments cleanups: IDE test support and EPUB format [<1>4626](https://github.com/elastic/elasticsearch/pull/14626)



Plugin Mapper Size 
    

  * Add doc values support to the _size field in the mapper-size plugin [<1>9217](https://github.com/elastic/elasticsearch/pull/19217) (issue: [<1>8334](https://github.com/elastic/elasticsearch/issues/18334)) 



Plugin Repository Azure 
    

  * Support global `repositories.azure.` settings [<1>5141](https://github.com/elastic/elasticsearch/pull/15141) (issue: [<1>3776](https://github.com/elastic/elasticsearch/issues/13776)) 
  * Add timeout settings (default to 5 minutes) [<1>5080](https://github.com/elastic/elasticsearch/pull/15080) (issue: [<1>4277](https://github.com/elastic/elasticsearch/issues/14277)) 
  * Remove AbstractLegacyBlobContainer [<1>4650](https://github.com/elastic/elasticsearch/pull/14650) (issue: [<1>3434](https://github.com/elastic/elasticsearch/issues/13434)) 



Plugin Repository HDFS 
    

  * merge current hdfs improvements to master [<1>5588](https://github.com/elastic/elasticsearch/pull/15588)



Plugin Repository S3 
    

  * Extract AWS Key from KeyChain instead of using potential null value [<1>9560](https://github.com/elastic/elasticsearch/pull/19560) (issues: [<1>8703](https://github.com/elastic/elasticsearch/issues/18703), [<1>9557](https://github.com/elastic/elasticsearch/issues/19557)) 
  * Check that S3 setting `buffer_size` is always lower than `chunk_size` [<1>7274](https://github.com/elastic/elasticsearch/pull/17274) (issue: [<1>7244](https://github.com/elastic/elasticsearch/issues/17244)) 



Plugins 
    

  * Revert "Display plugins versions" [<2>0807](https://github.com/elastic/elasticsearch/pull/20807) (issues: [<1>8683](https://github.com/elastic/elasticsearch/issues/18683), [<2>0668](https://github.com/elastic/elasticsearch/issues/20668)) 
  * Provide error message when plugin id is missing [<2>0660](https://github.com/elastic/elasticsearch/pull/20660)
  * Print message when removing plugin with config [<2>0338](https://github.com/elastic/elasticsearch/pull/20338)
  * Plugins: Update official plugin location with unified release [<1>9996](https://github.com/elastic/elasticsearch/pull/19996)
  * Allow plugins to upgrade global custom metadata on startup [<1>9962](https://github.com/elastic/elasticsearch/pull/19962)
  * Switch aggregations from push to pull [<1>9839](https://github.com/elastic/elasticsearch/pull/19839)
  * Display plugins versions [<1>8683](https://github.com/elastic/elasticsearch/pull/18683)
  * Add ScriptService to dependencies available for plugin components [<1>9770](https://github.com/elastic/elasticsearch/pull/19770)
  * Make NamedWriteableRegistry immutable and add extension point for named writeables [<1>9764](https://github.com/elastic/elasticsearch/pull/19764)
  * Log one plugin info per line [<1>9441](https://github.com/elastic/elasticsearch/pull/19441)
  * Make rest headers registration pull based [<1>9440](https://github.com/elastic/elasticsearch/pull/19440)
  * Add resource watcher to services available for plugin components [<1>9401](https://github.com/elastic/elasticsearch/pull/19401)
  * Add some basic services to createComponents for plugins [<1>9380](https://github.com/elastic/elasticsearch/pull/19380)
  * Make plugins closeable [<1>9137](https://github.com/elastic/elasticsearch/pull/19137)
  * Plugins: Add status bar on download [<1>8695](https://github.com/elastic/elasticsearch/pull/18695)
  * Add did-you-mean for plugin cli [<1>8942](https://github.com/elastic/elasticsearch/pull/18942) (issue: [<1>8896](https://github.com/elastic/elasticsearch/issues/18896)) 
  * Plugins: Remove name() and description() from api [<1>8906](https://github.com/elastic/elasticsearch/pull/18906)
  * Emit nicer error message when trying to install unknown plugin [<1>8876](https://github.com/elastic/elasticsearch/pull/18876) (issue: [<1>7226](https://github.com/elastic/elasticsearch/issues/17226)) 
  * Add plugin information for Verbose mode [<1>8051](https://github.com/elastic/elasticsearch/pull/18051) (issue: [<1>6375](https://github.com/elastic/elasticsearch/issues/16375)) 
  * Cli: Improve output for usage errors [<1>7938](https://github.com/elastic/elasticsearch/pull/17938)
  * Cli: Add verbose output with zip url when installing plugin [<1>7662](https://github.com/elastic/elasticsearch/pull/17662) (issue: [<1>7529](https://github.com/elastic/elasticsearch/issues/17529)) 
  * PluginManager: Add xpack as official plugin [<1>7227](https://github.com/elastic/elasticsearch/pull/17227)
  * CliTool: Cleanup and document Terminal [<1>6443](https://github.com/elastic/elasticsearch/pull/16443)
  * Plugin cli: Improve maven coordinates detection [<1>6384](https://github.com/elastic/elasticsearch/pull/16384) (issue: [<1>6376](https://github.com/elastic/elasticsearch/issues/16376)) 
  * Enforce plugin zip does not contain zip entries outside of the plugin dir [<1>6361](https://github.com/elastic/elasticsearch/pull/16361)
  * CliTool: Allow unexpected exceptions to propagate [<1>6359](https://github.com/elastic/elasticsearch/pull/16359)
  * Reduce complexity of plugin cli [<1>6336](https://github.com/elastic/elasticsearch/pull/16336)
  * Remove Plugin.onIndexService. [<1>5029](https://github.com/elastic/elasticsearch/pull/15029) (issue: [<1>4896](https://github.com/elastic/elasticsearch/issues/14896)) 
  * Open up QueryCache and SearcherWrapper extension points [<1>4303](https://github.com/elastic/elasticsearch/pull/14303)



Query DSL 
    

  * Throw exception when multiple field names are provided as part of query short syntax [<1>9871](https://github.com/elastic/elasticsearch/pull/19871) (issue: [<1>9791](https://github.com/elastic/elasticsearch/issues/19791)) 
  * Query parsers to throw exception when multiple field names are provided [<1>9791](https://github.com/elastic/elasticsearch/pull/19791) (issue: [<1>9547](https://github.com/elastic/elasticsearch/issues/19547)) 
  * Allow empty json object in request body in `_count` API [<1>9595](https://github.com/elastic/elasticsearch/pull/19595) (issue: [<1>9422](https://github.com/elastic/elasticsearch/issues/19422)) 
  * Treat zero token in `common` terms query as MatchNoDocsQuery [<1>8656](https://github.com/elastic/elasticsearch/pull/18656)
  * Handle empty query bodies at parse time and remove EmptyQueryBuilder [<1>7624](https://github.com/elastic/elasticsearch/pull/17624) (issues: [<1>7540](https://github.com/elastic/elasticsearch/issues/17540), [<1>7541](https://github.com/elastic/elasticsearch/issues/17541)) 
  * Enforce MatchQueryBuilder#maxExpansions() to be strictly positive [<1>8464](https://github.com/elastic/elasticsearch/pull/18464)
  * Don’t allow `fuzziness` for `multi_match` types `cross_fields`, `phrase` and `phrase_prefix` [<1>8322](https://github.com/elastic/elasticsearch/pull/18322) (issues: [<6>866](https://github.com/elastic/elasticsearch/issues/6866), [<7>764](https://github.com/elastic/elasticsearch/issues/7764)) 
  * Add MatchNoDocsQuery, a query that matches no documents and prints the reason why in the toString method. [<1>7780](https://github.com/elastic/elasticsearch/pull/17780)
  * Adds `ignore_unmapped` option to geo queries [<1>7751](https://github.com/elastic/elasticsearch/pull/17751)
  * Adds `ignore_unmapped` option to nested and P/C queries [<1>7748](https://github.com/elastic/elasticsearch/pull/17748)
  * SimpleQueryParser should call MappedFieldType.termQuery when appropriate. [<1>7678](https://github.com/elastic/elasticsearch/pull/17678)
  * An `exists` query on an object should query a single term. [<1>7186](https://github.com/elastic/elasticsearch/pull/17186) (issue: [<1>7131](https://github.com/elastic/elasticsearch/issues/17131)) 
  * Function Score Query: make parsing stricter [<1>6617](https://github.com/elastic/elasticsearch/pull/16617) (issue: [<1>6583](https://github.com/elastic/elasticsearch/issues/16583)) 
  * Parsers should throw exception on unknown objects [<1>4255](https://github.com/elastic/elasticsearch/pull/14255) (issue: [<1>0974](https://github.com/elastic/elasticsearch/issues/10974)) 
  * UNICODE_CHARACTER_CLASS fix [<1>1598](https://github.com/elastic/elasticsearch/pull/11598) (issue: [<1>0146](https://github.com/elastic/elasticsearch/issues/10146)) 



Query Refactoring 
    

  * Add infrastructure to rewrite query builders [<1>6599](https://github.com/elastic/elasticsearch/pull/16599)
  * Switch geo validation to enum [<1>3672](https://github.com/elastic/elasticsearch/pull/13672) (issue: [<1>3608](https://github.com/elastic/elasticsearch/issues/13608)) 



REST 
    

  * Add a REST spec for the create API [<2>0924](https://github.com/elastic/elasticsearch/pull/20924)
  * Add response params to REST params did you mean [<2>0753](https://github.com/elastic/elasticsearch/pull/20753) (issues: [<2>0722](https://github.com/elastic/elasticsearch/issues/20722), [<2>0747](https://github.com/elastic/elasticsearch/issues/20747)) 
  * Add did you mean to strict REST params [<2>0747](https://github.com/elastic/elasticsearch/pull/20747) (issue: [<2>0722](https://github.com/elastic/elasticsearch/issues/20722)) 
  * Add exclusion support to response filtering [<1>9865](https://github.com/elastic/elasticsearch/pull/19865)
  * Only write forced_refresh if we forced a refresh [<1>9669](https://github.com/elastic/elasticsearch/pull/19669) (issue: [<1>9629](https://github.com/elastic/elasticsearch/issues/19629)) 
  * Add Location header to the index, update, and create APIs [<1>9509](https://github.com/elastic/elasticsearch/pull/19509) (issue: [<1>9079](https://github.com/elastic/elasticsearch/issues/19079)) 
  * Add support for `wait_for_events` to the `_cluster/health` REST endpoint [<1>9432](https://github.com/elastic/elasticsearch/pull/19432) (issue: [<1>9419](https://github.com/elastic/elasticsearch/issues/19419)) 
  * Rename Search Template REST spec names [<1>9178](https://github.com/elastic/elasticsearch/pull/19178)
  * Adding status field in _msearch error request bodies [<1>8586](https://github.com/elastic/elasticsearch/pull/18586) (issue: [<1>8013](https://github.com/elastic/elasticsearch/issues/18013)) 
  * Add semicolon query string parameter delimiter [<1>8186](https://github.com/elastic/elasticsearch/pull/18186) (issue: [<1>8175](https://github.com/elastic/elasticsearch/issues/18175)) 
  * Enable HTTP compression by default with compression level 3 [<1>8066](https://github.com/elastic/elasticsearch/pull/18066) (issue: [<7>309](https://github.com/elastic/elasticsearch/issues/7309)) 
  * Allow JSON with unquoted field names by enabling system property [<1>7801](https://github.com/elastic/elasticsearch/pull/17801) (issue: [<1>7674](https://github.com/elastic/elasticsearch/issues/17674)) 
  * More robust handling of CORS HTTP Access Control [<1>6092](https://github.com/elastic/elasticsearch/pull/16092)
  * Add option to exclude based on paths in XContent [<1>6017](https://github.com/elastic/elasticsearch/pull/16017)



Recovery 
    

  * Pass on maxUnsafeAutoIdTimestamp on recovery / relocation [<2>0300](https://github.com/elastic/elasticsearch/pull/20300)
  * Non-blocking primary relocation hand-off [<1>9013](https://github.com/elastic/elasticsearch/pull/19013) (issues: [<1>5900](https://github.com/elastic/elasticsearch/issues/15900), [<1>8553](https://github.com/elastic/elasticsearch/issues/18553)) 
  * index shard should be able to cancel check index on close. [<1>8839](https://github.com/elastic/elasticsearch/pull/18839) (issue: [<1>2011](https://github.com/elastic/elasticsearch/issues/12011)) 
  * TransportNodesListGatewayStartedShards should fall back to disk based index metadata if not found in cluster state [<1>7663](https://github.com/elastic/elasticsearch/pull/17663) (issue: [<1>7630](https://github.com/elastic/elasticsearch/issues/17630)) 
  * Recover broken IndexMetaData as closed [<1>7187](https://github.com/elastic/elasticsearch/pull/17187)
  * Relocation source should be marked as relocating before starting recovery to primary relocation target [<1>6500](https://github.com/elastic/elasticsearch/pull/16500)
  * Operation counter for IndexShard [<1>5956](https://github.com/elastic/elasticsearch/pull/15956) (issue: [<1>5900](https://github.com/elastic/elasticsearch/issues/15900)) 
  * Primary relocation handoff [<1>5900](https://github.com/elastic/elasticsearch/pull/15900) (issues: [<1>5532](https://github.com/elastic/elasticsearch/issues/15532), [<1>6274](https://github.com/elastic/elasticsearch/issues/16274), [<1>9013](https://github.com/elastic/elasticsearch/issues/19013)) 
  * Remove recovery threadpools and throttle outgoing recoveries on the master [<1>5372](https://github.com/elastic/elasticsearch/pull/15372)
  * Refactor StoreRecoveryService to be a simple package private util class [<1>3766](https://github.com/elastic/elasticsearch/pull/13766)



Reindex API 
    

  * Only ask for `_version` we need it [<1>9693](https://github.com/elastic/elasticsearch/pull/19693) (issue: [<1>9135](https://github.com/elastic/elasticsearch/issues/19135)) 
  * Use fewer threads when reindexing-from-remote [<1>9636](https://github.com/elastic/elasticsearch/pull/19636)
  * Support authentication with reindex-from-remote [<1>9310](https://github.com/elastic/elasticsearch/pull/19310)
  * Support requests_per_second=-1 to mean no throttling in reindex [<1>9101](https://github.com/elastic/elasticsearch/pull/19101) (issue: [<1>9089](https://github.com/elastic/elasticsearch/issues/19089)) 
  * Implement ctx.op = "delete" on _update_by_query and _reindex [<1>8614](https://github.com/elastic/elasticsearch/pull/18614) (issue: [<1>8043](https://github.com/elastic/elasticsearch/issues/18043)) 
  * Make Reindex cancellation tests more uniform [<1>8498](https://github.com/elastic/elasticsearch/pull/18498)
  * Makes DeleteByQueryRequest implements IndicesRequest [<1>8466](https://github.com/elastic/elasticsearch/pull/18466)
  * Teach reindex to retry on search failures [<1>8331](https://github.com/elastic/elasticsearch/pull/18331) (issue: [<1>8059](https://github.com/elastic/elasticsearch/issues/18059)) 
  * Remove ReindexResponse in favor of BulkIndexByScrollResponse [<1>8205](https://github.com/elastic/elasticsearch/pull/18205)
  * Stricter validation of Reindex’s requests_per_second [<1>8028](https://github.com/elastic/elasticsearch/pull/18028)
  * Properly mark reindex’s child tasks as child tasks [<1>7770](https://github.com/elastic/elasticsearch/pull/17770)
  * Make reindex throttling dynamic [<1>7262](https://github.com/elastic/elasticsearch/pull/17262)
  * Throttling support for reindex [<1>7039](https://github.com/elastic/elasticsearch/pull/17039)
  * Add ingest pipeline support to reindex [<1>6932](https://github.com/elastic/elasticsearch/pull/16932)



Scripting 
    

  * Parse script on storage instead of on retrieval [<2>0356](https://github.com/elastic/elasticsearch/pull/20356)
  * Migrate elasticsearch native script examples to the main repo [<1>9334](https://github.com/elastic/elasticsearch/pull/19334) (issue: [<1>4662](https://github.com/elastic/elasticsearch/issues/14662)) 
  * Remove ClusterState from compile api [<1>9136](https://github.com/elastic/elasticsearch/pull/19136)
  * Mustache: Render Map as JSON [<1>8856](https://github.com/elastic/elasticsearch/pull/18856) (issue: [<1>8970](https://github.com/elastic/elasticsearch/issues/18970)) 
  * Compile each Groovy script in its own classloader [<1>8918](https://github.com/elastic/elasticsearch/pull/18918) (issue: [<1>8572](https://github.com/elastic/elasticsearch/issues/18572)) 
  * Include script field even if it value is null [<1>8384](https://github.com/elastic/elasticsearch/pull/18384) (issue: [<1>6408](https://github.com/elastic/elasticsearch/issues/16408)) 
  * Skipping hidden files compilation for script service [<1>6286](https://github.com/elastic/elasticsearch/pull/16286) (issue: [<1>5269](https://github.com/elastic/elasticsearch/issues/15269)) 
  * Rename Plan A to Painless [<1>6245](https://github.com/elastic/elasticsearch/pull/16245)
  * Add plumbing for script compile-time parameters [<1>5464](https://github.com/elastic/elasticsearch/pull/15464)
  * Factor mustache → modules/lang-mustache [<1>5328](https://github.com/elastic/elasticsearch/pull/15328)



Scroll 
    

  * Add an index setting to limit the maximum number of slices allowed in a scroll request. [<1>8782](https://github.com/elastic/elasticsearch/pull/18782)



Search 
    

  * Limit batch size when scrolling [<1>9367](https://github.com/elastic/elasticsearch/pull/19367) (issue: [<1>9249](https://github.com/elastic/elasticsearch/issues/19249)) 
  * Record method counts while profiling query components [<1>8302](https://github.com/elastic/elasticsearch/pull/18302)
  * Change default similarity to BM25 [<1>8948](https://github.com/elastic/elasticsearch/pull/18948) (issue: [<1>8944](https://github.com/elastic/elasticsearch/issues/18944)) 
  * Add a parameter to cap the number of searches the msearch api will concurrently execute [<1>8721](https://github.com/elastic/elasticsearch/pull/18721)
  * Introduces GeoValidationMethod to GeoDistanceSortBuilder [<1>8036](https://github.com/elastic/elasticsearch/pull/18036)
  * Switches from empty boolean query to matchNoDocs [<1>8007](https://github.com/elastic/elasticsearch/pull/18007) (issue: [<1>7981](https://github.com/elastic/elasticsearch/issues/17981)) 
  * Allow binary sort values. [<1>7959](https://github.com/elastic/elasticsearch/pull/17959) (issues: [<1>7971](https://github.com/elastic/elasticsearch/issues/17971), [<6>077](https://github.com/elastic/elasticsearch/issues/6077)) 
  * Fail query if it contains very large rescores [<1>7917](https://github.com/elastic/elasticsearch/pull/17917) (issue: [<1>7522](https://github.com/elastic/elasticsearch/issues/17522)) 
  * Type filters should not have a performance impact when there is a single type. [<1>7350](https://github.com/elastic/elasticsearch/pull/17350)
  * Store _all payloads on 1 byte instead of 4. [<1>6899](https://github.com/elastic/elasticsearch/pull/16899)
  * Refuse to load fields from _source when using the `fields` option and support wildcards. [<1>5017](https://github.com/elastic/elasticsearch/pull/15017) (issues: [<1>0783](https://github.com/elastic/elasticsearch/issues/10783), [<1>4489](https://github.com/elastic/elasticsearch/issues/14489)) 
  * Add response into ClearScrollResponse [<1>3835](https://github.com/elastic/elasticsearch/pull/13835) (issue: [<1>3817](https://github.com/elastic/elasticsearch/issues/13817)) 
  * Shuffle shards for _only_nodes + support multiple specifications like cluster API [<1>2575](https://github.com/elastic/elasticsearch/pull/12575) (issues: [<1>2546](https://github.com/elastic/elasticsearch/issues/12546), [<1>2700](https://github.com/elastic/elasticsearch/issues/12700)) 



Search Refactoring 
    

  * Removes the now obsolete SearchParseElement implementations [<1>8233](https://github.com/elastic/elasticsearch/pull/18233)
  * Remove RescoreParseElement [<1>7441](https://github.com/elastic/elasticsearch/pull/17441)
  * Remove HighlighterParseElement [<1>7303](https://github.com/elastic/elasticsearch/pull/17303)
  * Move top level parsing of sort element to SortBuilder [<1>7248](https://github.com/elastic/elasticsearch/pull/17248)
  * Switch to using refactored SortBuilder instead of using BytesReference in serialization [<1>7205](https://github.com/elastic/elasticsearch/pull/17205) (issues: [<1>7146](https://github.com/elastic/elasticsearch/issues/17146), [<1>7257](https://github.com/elastic/elasticsearch/issues/17257)) 
  * Add build() method to SortBuilder implementations [<1>7146](https://github.com/elastic/elasticsearch/pull/17146) (issue: [<1>0217](https://github.com/elastic/elasticsearch/issues/10217)) 
  * Refactoring of Suggestions [<1>7096](https://github.com/elastic/elasticsearch/pull/17096) (issue: [<1>0217](https://github.com/elastic/elasticsearch/issues/10217)) 
  * Move sort `order` field up into SortBuilder [<1>7035](https://github.com/elastic/elasticsearch/pull/17035)
  * Moves SortParser:parse(…) to only require QueryShardContext [<1>6999](https://github.com/elastic/elasticsearch/pull/16999) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Change internal representation of suggesters [<1>6873](https://github.com/elastic/elasticsearch/pull/16873)
  * Make GeoDistanceSortBuilder serializable, 2nd try [<1>6572](https://github.com/elastic/elasticsearch/pull/16572) (issues: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178), [<1>6151](https://github.com/elastic/elasticsearch/issues/16151)) 
  * Move missing() from SortBuilder interface to class [<1>6225](https://github.com/elastic/elasticsearch/pull/16225) (issues: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178), [<1>6151](https://github.com/elastic/elasticsearch/issues/16151)) 
  * Remove deprecated parameters from ScriptSortBuilder [<1>6153](https://github.com/elastic/elasticsearch/pull/16153) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Refactor GeoSortBuilder [<1>6151](https://github.com/elastic/elasticsearch/pull/16151) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Refactor FieldSortBuilder [<1>6127](https://github.com/elastic/elasticsearch/pull/16127) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Make sort order enum writable. [<1>6124](https://github.com/elastic/elasticsearch/pull/16124) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Make DistanceUnit writable. [<1>6122](https://github.com/elastic/elasticsearch/pull/16122) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * RescoreBuilder: Add parsing and creating of RescoreSearchContext [<1>6014](https://github.com/elastic/elasticsearch/pull/16014) (issue: [<1>5559](https://github.com/elastic/elasticsearch/issues/15559)) 
  * Make RescoreBuilder and nested QueryRescorer Writable [<1>5953](https://github.com/elastic/elasticsearch/pull/15953) (issue: [<1>5559](https://github.com/elastic/elasticsearch/issues/15559)) 
  * Explain api: move query parsing to the coordinating node [<1>4270](https://github.com/elastic/elasticsearch/pull/14270)
  * Switch query parsers to use ParseField [<1>4249](https://github.com/elastic/elasticsearch/pull/14249) (issue: [<8>964](https://github.com/elastic/elasticsearch/issues/8964)) 
  * Refactoring of Aggregations [<1>4136](https://github.com/elastic/elasticsearch/pull/14136)



Sequence IDs 
    

  * Persist sequence number checkpoints [<1>8949](https://github.com/elastic/elasticsearch/pull/18949) (issue: [<1>0708](https://github.com/elastic/elasticsearch/issues/10708)) 
  * Add sequence numbers to cat shards API [<1>8772](https://github.com/elastic/elasticsearch/pull/18772)



Settings 
    

  * Add precise logging on unknown or invalid settings [<2>0951](https://github.com/elastic/elasticsearch/pull/20951) (issue: [<2>0946](https://github.com/elastic/elasticsearch/issues/20946)) 
  * Make `action.auto_create_index` setting a dynamic cluster setting [<2>0274](https://github.com/elastic/elasticsearch/pull/20274) (issue: [<7>513](https://github.com/elastic/elasticsearch/issues/7513)) 
  * Removes space between # and the setting in elasticsearch.yml [<2>0094](https://github.com/elastic/elasticsearch/pull/20094) (issue: [<2>0090](https://github.com/elastic/elasticsearch/issues/20090)) 
  * Validates new dynamic settings from the current state [<1>9122](https://github.com/elastic/elasticsearch/pull/19122) (issue: [<1>9046](https://github.com/elastic/elasticsearch/issues/19046)) 
  * Improve error message if a setting is not found [<1>8920](https://github.com/elastic/elasticsearch/pull/18920) (issue: [<1>8663](https://github.com/elastic/elasticsearch/issues/18663)) 
  * Cleanup placeholder replacement [<1>7335](https://github.com/elastic/elasticsearch/pull/17335)
  * Switch to registered Settings for all IndexingMemoryController settings [<1>7778](https://github.com/elastic/elasticsearch/pull/17778) (issue: [<1>7442](https://github.com/elastic/elasticsearch/issues/17442)) 
  * Add guard against null-valued settings [<1>7310](https://github.com/elastic/elasticsearch/pull/17310) (issue: [<1>7292](https://github.com/elastic/elasticsearch/issues/17292)) 
  * Useful error message for null property placeholder [<1>7293](https://github.com/elastic/elasticsearch/pull/17293) (issue: [<1>7292](https://github.com/elastic/elasticsearch/issues/17292)) 
  * Archive cluster level settings if unknown or broken [<1>7246](https://github.com/elastic/elasticsearch/pull/17246)
  * Improve error message if setting is not found [<1>7230](https://github.com/elastic/elasticsearch/pull/17230)
  * Improve upgrade experience of node level index settings [<1>7223](https://github.com/elastic/elasticsearch/pull/17223) (issue: [<1>7187](https://github.com/elastic/elasticsearch/issues/17187)) 
  * Settings with complex matchers should not overlap [<1>6754](https://github.com/elastic/elasticsearch/pull/16754)
  * Moves GCE settings to the new infra [<1>6722](https://github.com/elastic/elasticsearch/pull/16722) (issue: [<1>6720](https://github.com/elastic/elasticsearch/issues/16720)) 
  * Add filtering support within Setting class [<1>6629](https://github.com/elastic/elasticsearch/pull/16629) (issue: [<1>6598](https://github.com/elastic/elasticsearch/issues/16598)) 
  * Migrate AWS settings to new settings infrastructure [<1>6602](https://github.com/elastic/elasticsearch/pull/16602) (issue: [<1>6293](https://github.com/elastic/elasticsearch/issues/16293)) 
  * Remove `gateway.initial_meta` and always rely on min master nodes [<1>6446](https://github.com/elastic/elasticsearch/pull/16446)
  * Rewrite SettingsFilter to be immutable [<1>6425](https://github.com/elastic/elasticsearch/pull/16425)
  * Simplify azure settings [<1>6363](https://github.com/elastic/elasticsearch/pull/16363)
  * Convert PageCacheRecycler settings [<1>6341](https://github.com/elastic/elasticsearch/pull/16341)
  * Monitor settings [<1>6313](https://github.com/elastic/elasticsearch/pull/16313)
  * Cut over tribe node settings to new settings infra [<1>6311](https://github.com/elastic/elasticsearch/pull/16311)
  * Convert multcast plugin settings to the new infra [<1>6295](https://github.com/elastic/elasticsearch/pull/16295)
  * Convert `request.headers.*` to the new settings infra [<1>6292](https://github.com/elastic/elasticsearch/pull/16292)
  * Migrate Azure settings to new settings infrastructure [<1>6291](https://github.com/elastic/elasticsearch/pull/16291)
  * Validate logger settings and allow them to be reset via API [<1>6289](https://github.com/elastic/elasticsearch/pull/16289)
  * Switch NodeEnvironment’s settings to new settings [<1>6273](https://github.com/elastic/elasticsearch/pull/16273)
  * Simplify AutoCreateIndex and add more tests [<1>6270](https://github.com/elastic/elasticsearch/pull/16270)
  * Convert several pending settings [<1>6269](https://github.com/elastic/elasticsearch/pull/16269)
  * Migrate query caching settings to the new settings infra. [<1>6267](https://github.com/elastic/elasticsearch/pull/16267)
  * Convert `action.auto_create_index` and `action.master.force_local` to the new settings infra [<1>6263](https://github.com/elastic/elasticsearch/pull/16263)
  * Convert `cluster.routing.allocation.type` and `processors` to the new settings infra. [<1>6238](https://github.com/elastic/elasticsearch/pull/16238)
  * Validate tribe node settings on startup [<1>6237](https://github.com/elastic/elasticsearch/pull/16237)
  * Move node.client, node.data, node.master, node.local and node.mode to new settings infra [<1>6230](https://github.com/elastic/elasticsearch/pull/16230)
  * Moved http settings to the new settings infrastructure [<1>6188](https://github.com/elastic/elasticsearch/pull/16188)
  * Migrate network service to the new infra [<1>6187](https://github.com/elastic/elasticsearch/pull/16187)
  * Convert client.transport settings to new infra [<1>6183](https://github.com/elastic/elasticsearch/pull/16183)
  * Move discovery.* settings to new Setting infrastructure [<1>6182](https://github.com/elastic/elasticsearch/pull/16182)
  * Change over to o.e.common.settings.Setting for http settings [<1>6181](https://github.com/elastic/elasticsearch/pull/16181)
  * Convert "path.*" and "pidfile" to new settings infra [<1>6180](https://github.com/elastic/elasticsearch/pull/16180)
  * Migrate repository settings to the new settings API [<1>6178](https://github.com/elastic/elasticsearch/pull/16178)
  * Convert "indices.*" settings to new infra. [<1>6177](https://github.com/elastic/elasticsearch/pull/16177)
  * Migrate gateway settings to the new settings API. [<1>6175](https://github.com/elastic/elasticsearch/pull/16175)
  * Convert several node and test level settings [<1>6172](https://github.com/elastic/elasticsearch/pull/16172)
  * Run Metadata upgrade tool on every version [<1>6168](https://github.com/elastic/elasticsearch/pull/16168)
  * Check for invalid index settings on metadata upgrade [<1>6156](https://github.com/elastic/elasticsearch/pull/16156)
  * Validate the settings key if it’s simple chars separated by `.` [<1>6120](https://github.com/elastic/elasticsearch/pull/16120)
  * Validate known global settings on startup [<1>6091](https://github.com/elastic/elasticsearch/pull/16091)
  * Cut over all index scope settings to the new setting infrastrucuture [<1>6054](https://github.com/elastic/elasticsearch/pull/16054) (issues: [<1>2790](https://github.com/elastic/elasticsearch/issues/12790), [<1>2854](https://github.com/elastic/elasticsearch/issues/12854), [<1>6032](https://github.com/elastic/elasticsearch/issues/16032), [<6>732](https://github.com/elastic/elasticsearch/issues/6732)) 
  * Remove updatability of `index.flush_on_close` [<1>5964](https://github.com/elastic/elasticsearch/pull/15964) (issue: [<1>5955](https://github.com/elastic/elasticsearch/issues/15955)) 
  * Move all dynamic settings and their config classes to the index level [<1>5955](https://github.com/elastic/elasticsearch/pull/15955) (issue: [<6>732](https://github.com/elastic/elasticsearch/issues/6732)) 
  * Always require units for bytes and time settings [<1>5948](https://github.com/elastic/elasticsearch/pull/15948) (issue: [<1>1437](https://github.com/elastic/elasticsearch/issues/11437)) 
  * Make MetaData parsing less lenient. [<1>5828](https://github.com/elastic/elasticsearch/pull/15828)
  * Move async translog sync logic into IndexService [<1>5584](https://github.com/elastic/elasticsearch/pull/15584)
  * Remove `index.merge.scheduler.notify_on_failure` and default to `true` [<1>5572](https://github.com/elastic/elasticsearch/pull/15572) (issue: [<1>5570](https://github.com/elastic/elasticsearch/issues/15570)) 
  * Remove cache concurrency level settings that no longer apply [<1>4210](https://github.com/elastic/elasticsearch/pull/14210) (issues: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224), [<1>3717](https://github.com/elastic/elasticsearch/issues/13717), [<7>836](https://github.com/elastic/elasticsearch/issues/7836)) 



Similarities 
    

  * Defining a global default similarity [<1>6682](https://github.com/elastic/elasticsearch/pull/16682) (issue: [<1>6594](https://github.com/elastic/elasticsearch/issues/16594)) 



Snapshot/Restore 
    

  * Delete differing files in the store before restoring [<2>0220](https://github.com/elastic/elasticsearch/pull/20220) (issue: [<2>0148](https://github.com/elastic/elasticsearch/issues/20148)) 
  * Adds ignoreUnavailable option to the snapshot status API [<2>0066](https://github.com/elastic/elasticsearch/pull/20066) (issue: [<1>8522](https://github.com/elastic/elasticsearch/issues/18522)) 
  * Check restores in progress before deleting a snapshot [<1>9853](https://github.com/elastic/elasticsearch/pull/19853)
  * Snapshot repository cleans up empty index folders [<1>9751](https://github.com/elastic/elasticsearch/pull/19751)
  * BlobContainer#writeBlob no longer can overwrite a blob [<1>9749](https://github.com/elastic/elasticsearch/pull/19749) (issue: [<1>5579](https://github.com/elastic/elasticsearch/issues/15579)) 
  * More resilient blob handling in snapshot repositories [<1>9706](https://github.com/elastic/elasticsearch/pull/19706) (issues: [<1>8156](https://github.com/elastic/elasticsearch/issues/18156), [<1>8815](https://github.com/elastic/elasticsearch/issues/18815), [<1>9421](https://github.com/elastic/elasticsearch/issues/19421), [<7>540](https://github.com/elastic/elasticsearch/issues/7540)) 
  * Adding repository index generational files [<1>9002](https://github.com/elastic/elasticsearch/pull/19002) (issue: [<1>8156](https://github.com/elastic/elasticsearch/issues/18156)) 
  * Raised IOException on deleteBlob [<1>8815](https://github.com/elastic/elasticsearch/pull/18815) (issue: [<1>8530](https://github.com/elastic/elasticsearch/issues/18530)) 
  * Adds UUIDs to snapshots [<1>8228](https://github.com/elastic/elasticsearch/pull/18228) (issue: [<1>8156](https://github.com/elastic/elasticsearch/issues/18156)) 
  * Clarify the semantics of the BlobContainer interface [<1>8157](https://github.com/elastic/elasticsearch/pull/18157) (issue: [<1>5580](https://github.com/elastic/elasticsearch/issues/15580)) 
  * Change BlobPath.buildAsString() method [<1>8461](https://github.com/elastic/elasticsearch/pull/18461)
  * Remove the Snapshot class in favor of using SnapshotInfo [<1>8167](https://github.com/elastic/elasticsearch/pull/18167) (issue: [<1>8156](https://github.com/elastic/elasticsearch/issues/18156)) 



Stats 
    

  * Add mem div back to cluster stats [<2>0255](https://github.com/elastic/elasticsearch/pull/20255) (issue: [<1>7278](https://github.com/elastic/elasticsearch/issues/17278)) 
  * Add network types to cluster stats [<2>0144](https://github.com/elastic/elasticsearch/pull/20144)
  * Add missing field type in the FieldStats response. [<1>9241](https://github.com/elastic/elasticsearch/pull/19241) (issue: [<1>7750](https://github.com/elastic/elasticsearch/issues/17750)) 
  * Expose the ClusterInfo object in the allocation explain output [<1>9106](https://github.com/elastic/elasticsearch/pull/19106) (issue: [<1>4405](https://github.com/elastic/elasticsearch/issues/14405)) 
  * Add total_indexing_buffer/_in_bytes to nodes info API [<1>8914](https://github.com/elastic/elasticsearch/pull/18914) (issue: [<1>8651](https://github.com/elastic/elasticsearch/issues/18651)) 
  * Allow FieldStatsRequest to disable cache [<1>8900](https://github.com/elastic/elasticsearch/pull/18900)
  * Remove index_writer_max_memory stat from segment stats [<1>8651](https://github.com/elastic/elasticsearch/pull/18651) (issues: [<1>4121](https://github.com/elastic/elasticsearch/issues/14121), [<7>440](https://github.com/elastic/elasticsearch/issues/7440)) 
  * Move DocStats under Engine to get more accurate numbers [<1>8587](https://github.com/elastic/elasticsearch/pull/18587)
  * Do not return fieldstats information for fields that exist in the mapping but not in the index. [<1>8212](https://github.com/elastic/elasticsearch/pull/18212) (issue: [<1>7980](https://github.com/elastic/elasticsearch/issues/17980)) 
  * Add whether the shard state fetch is pending to the allocation explain API [<1>8119](https://github.com/elastic/elasticsearch/pull/18119) (issue: [<1>7372](https://github.com/elastic/elasticsearch/issues/17372)) 
  * Add Failure Details to every NodesResponse [<1>7964](https://github.com/elastic/elasticsearch/pull/17964) (issue: [<3>740](https://github.com/elastic/elasticsearch/issues/3740)) 
  * Add I/O statistics on Linux [<1>5915](https://github.com/elastic/elasticsearch/pull/15915) (issue: [<1>5296](https://github.com/elastic/elasticsearch/issues/15296)) 
  * Add points to SegmentStats. [<1>7775](https://github.com/elastic/elasticsearch/pull/17775) (issue: [<1>6974](https://github.com/elastic/elasticsearch/issues/16974)) 
  * Remove FieldStats.Float. [<1>7749](https://github.com/elastic/elasticsearch/pull/17749)
  * Show configured and remaining delay for an unassigned shard. [<1>7515](https://github.com/elastic/elasticsearch/pull/17515) (issue: [<1>7372](https://github.com/elastic/elasticsearch/issues/17372)) 
  * indexing stats now contain indexing ops from recovery [ISSUE] [<1>7412](https://github.com/elastic/elasticsearch/pull/17412)
  * Normalize unavailable load average [<1>6061](https://github.com/elastic/elasticsearch/pull/16061) (issues: [<1>2049](https://github.com/elastic/elasticsearch/issues/12049), [<1>4741](https://github.com/elastic/elasticsearch/issues/14741), [<1>5907](https://github.com/elastic/elasticsearch/issues/15907), [<1>5932](https://github.com/elastic/elasticsearch/issues/15932), [<1>5934](https://github.com/elastic/elasticsearch/issues/15934)) 
  * Add load averages to OS stats on FreeBSD [<1>5934](https://github.com/elastic/elasticsearch/pull/15934) (issue: [<1>5917](https://github.com/elastic/elasticsearch/issues/15917)) 
  * Expose pending cluster state queue size in node stats [<1>4040](https://github.com/elastic/elasticsearch/pull/14040) (issue: [<1>3610](https://github.com/elastic/elasticsearch/issues/13610)) 



Store 
    

  * Use `mmapfs` by default. [<1>7616](https://github.com/elastic/elasticsearch/pull/17616) (issue: [<1>6983](https://github.com/elastic/elasticsearch/issues/16983)) 
  * Remove support for legacy checksums [<1>6931](https://github.com/elastic/elasticsearch/pull/16931)
  * Rename index folder to index_uuid [<1>6442](https://github.com/elastic/elasticsearch/pull/16442) (issues: [<1>3264](https://github.com/elastic/elasticsearch/issues/13264), [<1>3265](https://github.com/elastic/elasticsearch/issues/13265), [<1>4512](https://github.com/elastic/elasticsearch/issues/14512), [<1>4932](https://github.com/elastic/elasticsearch/issues/14932), [<1>5853](https://github.com/elastic/elasticsearch/issues/15853)) 



Suggesters 
    

  * Move SuggestUtils methods to their respective caller classes [<1>9914](https://github.com/elastic/elasticsearch/pull/19914) (issue: [<1>9906](https://github.com/elastic/elasticsearch/issues/19906)) 
  * Remove payload option from completion suggester [<1>9877](https://github.com/elastic/elasticsearch/pull/19877) (issue: [<1>9536](https://github.com/elastic/elasticsearch/issues/19536)) 
  * Add bwc support for reading pre-5.0 completion index [<1>7602](https://github.com/elastic/elasticsearch/pull/17602)



Task Manager 
    

  * Rename Task Persistence into Storing Task Results [<1>9982](https://github.com/elastic/elasticsearch/pull/19982)
  * Fetch result when wait_for_completion [<1>8905](https://github.com/elastic/elasticsearch/pull/18905)
  * Create get task API that falls back to the .tasks index [<1>8682](https://github.com/elastic/elasticsearch/pull/18682)
  * Add ability to store results for long running tasks [<1>7928](https://github.com/elastic/elasticsearch/pull/17928)
  * Move parentTaskId into TransportRequest [<1>7872](https://github.com/elastic/elasticsearch/pull/17872)
  * Shorten the serialization of the empty TaskId [<1>7870](https://github.com/elastic/elasticsearch/pull/17870)
  * Expose whether a task is cancellable in the _tasks list API [<1>7464](https://github.com/elastic/elasticsearch/pull/17464) (issue: [<1>7369](https://github.com/elastic/elasticsearch/issues/17369)) 
  * Add ability to group tasks by common parent [<1>7341](https://github.com/elastic/elasticsearch/pull/17341)
  * Add start time and duration to tasks [<1>6829](https://github.com/elastic/elasticsearch/pull/16829)
  * Combine node name and task id into single string task id [<1>6744](https://github.com/elastic/elasticsearch/pull/16744)
  * Add task status [<1>6356](https://github.com/elastic/elasticsearch/pull/16356) (issue: [<1>6344](https://github.com/elastic/elasticsearch/issues/16344)) 
  * Extend tracking of parent tasks to master node, replication and broadcast actions [<1>5931](https://github.com/elastic/elasticsearch/pull/15931)



Translog 
    

  * Fsync documents in an async fashion [<2>0145](https://github.com/elastic/elasticsearch/pull/20145)
  * Add checksumming and versions to the Translog’s Checkpoint files [<1>9797](https://github.com/elastic/elasticsearch/pull/19797)
  * Beef up Translog testing with random channel exceptions [<1>8997](https://github.com/elastic/elasticsearch/pull/18997)
  * Do not replay into translog on local recovery [<1>8547](https://github.com/elastic/elasticsearch/pull/18547)
  * FSync translog outside of the writers global lock [<1>8360](https://github.com/elastic/elasticsearch/pull/18360)
  * Remove ChannelReference and simplify Views [<1>5898](https://github.com/elastic/elasticsearch/pull/15898)
  * Simplify TranslogWriter to always write to a stream [<1>5771](https://github.com/elastic/elasticsearch/pull/15771)
  * Remove TranslogService and fold it into synchronous IndexShard API [<1>3707](https://github.com/elastic/elasticsearch/pull/13707)



### Bug fixes

Aggregations 
    

  * Fixed writeable name from range to geo_distance [<2>0860](https://github.com/elastic/elasticsearch/pull/20860)
  * Fix date_range aggregation to not cache if now is used [<2>0740](https://github.com/elastic/elasticsearch/pull/20740)
  * The `top_hits` aggregation should compile scripts only once. [<2>0738](https://github.com/elastic/elasticsearch/pull/20738)
  * Fix agg profiling when using breadth_first collect mode [<2>0156](https://github.com/elastic/elasticsearch/pull/20156)
  * Throw exception when maxBounds greater than minBounds [<1>9855](https://github.com/elastic/elasticsearch/pull/19855) (issue: [<1>9833](https://github.com/elastic/elasticsearch/issues/19833)) 
  * Undeprecates `aggs` in the search request [<1>9674](https://github.com/elastic/elasticsearch/pull/19674) (issue: [<1>9504](https://github.com/elastic/elasticsearch/issues/19504)) 
  * Change how `nested` and `reverse_nested` aggs know about their nested depth level [<1>9550](https://github.com/elastic/elasticsearch/pull/19550) (issues: [<1>1749](https://github.com/elastic/elasticsearch/issues/11749), [<1>2410](https://github.com/elastic/elasticsearch/issues/12410)) 
  * Make ExtendedBounds immutable [<1>9490](https://github.com/elastic/elasticsearch/pull/19490) (issue: [<1>9481](https://github.com/elastic/elasticsearch/issues/19481)) 
  * Aggregations fix: support include/exclude strings for IP and dates [<1>8408](https://github.com/elastic/elasticsearch/pull/18408) (issue: [<1>7705](https://github.com/elastic/elasticsearch/issues/17705)) 
  * Fix xcontent rendering of ip terms aggs. [<1>8003](https://github.com/elastic/elasticsearch/pull/18003) (issue: [<1>7971](https://github.com/elastic/elasticsearch/issues/17971)) 
  * Improving parsing of sigma param for Extended Stats Bucket Aggregation [<1>7562](https://github.com/elastic/elasticsearch/pull/17562) (issue: [<1>7499](https://github.com/elastic/elasticsearch/issues/17499)) 
  * Fixes NPE when no window is specified in moving average request [<1>7556](https://github.com/elastic/elasticsearch/pull/17556) (issue: [<1>7516](https://github.com/elastic/elasticsearch/issues/17516)) 
  * Fixes Filter and FiltersAggregation to work with empty query [<1>7542](https://github.com/elastic/elasticsearch/pull/17542) (issue: [<1>7518](https://github.com/elastic/elasticsearch/issues/17518)) 
  * Fixes the defaults for `keyed` in the percentiles aggregations [<1>7217](https://github.com/elastic/elasticsearch/pull/17217)
  * Correct typo in class name of StatsAggregator [<1>5264](https://github.com/elastic/elasticsearch/pull/15264) (issue: [<1>4730](https://github.com/elastic/elasticsearch/issues/14730)) 



Allocation 
    

  * Keep a shadow replicas' allocation id when it is promoted to primary [<2>0863](https://github.com/elastic/elasticsearch/pull/20863) (issue: [<2>0650](https://github.com/elastic/elasticsearch/issues/20650)) 
  * IndicesClusterStateService should clean local started when re-assigns an initializing shard with the same aid [<2>0687](https://github.com/elastic/elasticsearch/pull/20687)
  * IndexRoutingTable.initializeEmpty shouldn’t override supplied primary RecoverySource [<2>0638](https://github.com/elastic/elasticsearch/pull/20638) (issue: [<2>0637](https://github.com/elastic/elasticsearch/issues/20637)) 
  * Update incoming recoveries stats when shadow replica is reinitialized [<2>0612](https://github.com/elastic/elasticsearch/pull/20612)
  * `index.routing.allocation.initial_recovery` limits replica allocation [<2>0589](https://github.com/elastic/elasticsearch/pull/20589)
  * Upon being elected as master, prefer joins' node info to existing cluster state [<1>9743](https://github.com/elastic/elasticsearch/pull/19743)
  * Fix NPE when initializing replica shard has no UnassignedInfo [<1>9491](https://github.com/elastic/elasticsearch/pull/19491) (issue: [<1>9488](https://github.com/elastic/elasticsearch/issues/19488)) 
  * Make shard store fetch less dependent on the current cluster state, both on master and non data nodes [<1>9044](https://github.com/elastic/elasticsearch/pull/19044) (issue: [<1>8938](https://github.com/elastic/elasticsearch/issues/18938)) 
  * Fix recovery throttling to properly handle relocating non-primary shards [<1>8701](https://github.com/elastic/elasticsearch/pull/18701) (issue: [<1>8640](https://github.com/elastic/elasticsearch/issues/18640)) 
  * Replica shards must be failed before primary shards [<1>5686](https://github.com/elastic/elasticsearch/pull/15686)



Analysis 
    

  * Named analyzer should close the analyzer that it wraps [<2>0197](https://github.com/elastic/elasticsearch/pull/20197)
  * Can load non-PreBuiltTokenFilter in Analyze API [<2>0396](https://github.com/elastic/elasticsearch/pull/20396)
  * Fix analyzer alias processing [<1>9506](https://github.com/elastic/elasticsearch/pull/19506) (issue: [<1>9163](https://github.com/elastic/elasticsearch/issues/19163)) 



Bulk 
    

  * Add not-null precondition check in BulkRequest [<1>8347](https://github.com/elastic/elasticsearch/pull/18347) (issue: [<1>2038](https://github.com/elastic/elasticsearch/issues/12038)) 



CAT API 
    

  * Fixes cat tasks operation in detailed mode [<1>9759](https://github.com/elastic/elasticsearch/pull/19759) (issue: [<1>9755](https://github.com/elastic/elasticsearch/issues/19755)) 
  * Add index pattern wildcards support to _cat/shards [<1>9655](https://github.com/elastic/elasticsearch/pull/19655) (issue: [<1>9634](https://github.com/elastic/elasticsearch/issues/19634)) 



CRUD 
    

  * GET operations should not extract fields from `_source`. [<2>0158](https://github.com/elastic/elasticsearch/pull/20158) (issues: [<1>5017](https://github.com/elastic/elasticsearch/issues/15017), [<2>0102](https://github.com/elastic/elasticsearch/issues/20102)) 
  * Squash a race condition in RefreshListeners [<1>8806](https://github.com/elastic/elasticsearch/pull/18806)
  * Prevent TransportReplicationAction to route request based on stale local routing table [<1>6274](https://github.com/elastic/elasticsearch/pull/16274) (issues: [<1>2573](https://github.com/elastic/elasticsearch/issues/12573), [<1>2574](https://github.com/elastic/elasticsearch/issues/12574)) 
  * Resolves the conflict between alias routing and parent routing by applying the alias routing and ignoring the parent routing. [<1>5371](https://github.com/elastic/elasticsearch/pull/15371) (issue: [<3>068](https://github.com/elastic/elasticsearch/issues/3068)) 



Cache 
    

  * Prevent requests that use scripts or now() from being cached [<2>0750](https://github.com/elastic/elasticsearch/pull/20750) (issue: [<2>0645](https://github.com/elastic/elasticsearch/issues/20645)) 
  * Serialize index boost and phrase suggest collation keys in a consistent order [<2>0081](https://github.com/elastic/elasticsearch/pull/20081) (issue: [<1>9986](https://github.com/elastic/elasticsearch/issues/19986)) 



Circuit Breakers 
    

  * Never trip circuit breaker in liveness request [<1>8627](https://github.com/elastic/elasticsearch/pull/18627) (issue: [<1>7951](https://github.com/elastic/elasticsearch/issues/17951)) 
  * Free bytes reserved on request breaker [<1>8204](https://github.com/elastic/elasticsearch/pull/18204) (issue: [<1>8144](https://github.com/elastic/elasticsearch/issues/18144)) 



Cluster 
    

  * Fixes issue with dangling index being deleted instead of re-imported [<1>9666](https://github.com/elastic/elasticsearch/pull/19666)
  * Allow routing table to be filtered by index pattern [<1>9688](https://github.com/elastic/elasticsearch/pull/19688)
  * Use executor’s describeTasks method to log task information in cluster service [<1>9531](https://github.com/elastic/elasticsearch/pull/19531)
  * Acknowledge index deletion requests based on standard cluster state acknowledgment [<1>8602](https://github.com/elastic/elasticsearch/pull/18602) (issues: [<1>6442](https://github.com/elastic/elasticsearch/issues/16442), [<1>8558](https://github.com/elastic/elasticsearch/issues/18558)) 
  * Dangling indices are not imported if a tombstone for the index exists [<1>8250](https://github.com/elastic/elasticsearch/pull/18250) (issue: [<1>8249](https://github.com/elastic/elasticsearch/issues/18249)) 
  * Fix issue with tombstones matching active indices in cluster state [<1>8058](https://github.com/elastic/elasticsearch/pull/18058) (issue: [<1>8054](https://github.com/elastic/elasticsearch/issues/18054)) 
  * Shard state action channel exceptions [<1>6057](https://github.com/elastic/elasticsearch/pull/16057) (issue: [<1>5748](https://github.com/elastic/elasticsearch/issues/15748)) 



Core 
    

  * Makes `m` case sensitive in TimeValue [<1>9649](https://github.com/elastic/elasticsearch/pull/19649) (issue: [<1>9619](https://github.com/elastic/elasticsearch/issues/19619)) 
  * Guard against negative result from FileStore.getUsableSpace when picking data path for a new shard [<1>9554](https://github.com/elastic/elasticsearch/pull/19554)
  * Handle rejected execution exception on reschedule [<1>9505](https://github.com/elastic/elasticsearch/pull/19505)
  * Fix concurrency bug in IMC that could cause it to check too infrequently [<1>8357](https://github.com/elastic/elasticsearch/pull/18357)
  * Iterables.flatten should not pre-cache the first iterator [<1>8355](https://github.com/elastic/elasticsearch/pull/18355) (issue: [<1>8353](https://github.com/elastic/elasticsearch/issues/18353)) 
  * Avoid race while retiring executors [<1>8333](https://github.com/elastic/elasticsearch/pull/18333)
  * Refactor UUID-generating methods out of Strings [<1>7837](https://github.com/elastic/elasticsearch/pull/17837) (issue: [<1>7819](https://github.com/elastic/elasticsearch/issues/17819)) 
  * Node names cleanup [<1>7723](https://github.com/elastic/elasticsearch/pull/17723) (issue: [<1>7718](https://github.com/elastic/elasticsearch/issues/17718)) 
  * NullPointerException from IndexingMemoryController when a version conflict happens during recovery [<1>7569](https://github.com/elastic/elasticsearch/pull/17569)
  * Handle RejectedExecution gracefully in TransportService during shutdown [<1>6965](https://github.com/elastic/elasticsearch/pull/16965)



Discovery 
    

  * Update discovery nodes after cluster state is published [<2>0409](https://github.com/elastic/elasticsearch/pull/20409)
  * Add current cluster state version to zen pings and use them in master election [<2>0384](https://github.com/elastic/elasticsearch/pull/20384) (issue: [<2>0348](https://github.com/elastic/elasticsearch/issues/20348)) 



Engine 
    

  * Take refresh IOExceptions into account when catching ACE in InternalEngine [<2>0546](https://github.com/elastic/elasticsearch/pull/20546) (issue: [<1>9975](https://github.com/elastic/elasticsearch/issues/19975)) 
  * Don’t suppress AlreadyClosedException [<1>9975](https://github.com/elastic/elasticsearch/pull/19975) (issue: [<1>9861](https://github.com/elastic/elasticsearch/issues/19861)) 



Expressions 
    

  * replace ScriptException with a better one [<1>8600](https://github.com/elastic/elasticsearch/pull/18600)



Geo 
    

  * Incomplete results when using geo_distance for large distances [ISSUE] [<1>7578](https://github.com/elastic/elasticsearch/pull/17578)
  * Fix multi-field support for GeoPoint types [<1>5702](https://github.com/elastic/elasticsearch/pull/15702) (issue: [<1>5701](https://github.com/elastic/elasticsearch/issues/15701)) 
  * Enforce distance in distance query is  > 0 [ISSUE] [<1>5135](https://github.com/elastic/elasticsearch/pull/15135)



Highlighting 
    

  * Enable BoostingQuery with FVH highlighter [<1>9984](https://github.com/elastic/elasticsearch/pull/19984) (issue: [<1>9985](https://github.com/elastic/elasticsearch/issues/19985)) 



Index APIs 
    

  * Fixes active shard count check in the case of `all` shards [<1>9760](https://github.com/elastic/elasticsearch/pull/19760)
  * Add zero-padding to auto-generated rollover index name increment [<1>9610](https://github.com/elastic/elasticsearch/pull/19610) (issue: [<1>9484](https://github.com/elastic/elasticsearch/issues/19484)) 



Ingest 
    

  * no null values in ingest configuration error messages [<2>0616](https://github.com/elastic/elasticsearch/pull/20616)
  * JSON Processor was not properly added [<2>0613](https://github.com/elastic/elasticsearch/pull/20613)
  * Don’t rebuild pipeline on every cluster state update [<2>0189](https://github.com/elastic/elasticsearch/pull/20189)
  * Add dotexpander processor [<2>0078](https://github.com/elastic/elasticsearch/pull/20078)
  * Fix NPE when simulating a pipeline with no id [<1>9650](https://github.com/elastic/elasticsearch/pull/19650)
  * Change foreach processor to use ingest metadata for array element [<1>9609](https://github.com/elastic/elasticsearch/pull/19609) (issue: [<1>9592](https://github.com/elastic/elasticsearch/issues/19592)) 
  * No other processors should be executed after on_failure is called [<1>9545](https://github.com/elastic/elasticsearch/pull/19545)
  * rethrow script compilation exceptions into ingest configuration exceptions [<1>9318](https://github.com/elastic/elasticsearch/pull/19318)
  * Rename from `ingest-useragent` plugin to `ingest-user-agent` and its processor from `useragent` to `user_agent` [<1>9261](https://github.com/elastic/elasticsearch/pull/19261)
  * Fix ignore_failure behavior in _simulate?verbose and more cleanup [<1>8987](https://github.com/elastic/elasticsearch/pull/18987)
  * Pipeline Stats: Fix concurrent modification exception [<1>8177](https://github.com/elastic/elasticsearch/pull/18177) (issue: [<1>8126](https://github.com/elastic/elasticsearch/issues/18126)) 
  * Validate properties values according to database type [<1>7940](https://github.com/elastic/elasticsearch/pull/17940) (issue: [<1>7683](https://github.com/elastic/elasticsearch/issues/17683)) 
  * Ingest does not close its factories [<1>7626](https://github.com/elastic/elasticsearch/pull/17626) (issue: [<1>7625](https://github.com/elastic/elasticsearch/issues/17625)) 
  * Handle regex parsing errors in Gsub and Grok Processors [<1>7260](https://github.com/elastic/elasticsearch/pull/17260)
  * add on_failure exception metadata to ingest document for verbose simulate [<1>6562](https://github.com/elastic/elasticsearch/pull/16562)
  * The IngestDocument copy constructor should make a deep copy [<1>6248](https://github.com/elastic/elasticsearch/pull/16248) (issue: [<1>6246](https://github.com/elastic/elasticsearch/issues/16246)) 



Inner Hits 
    

  * Ensure that that InnerHitBuilder uses rewritten queries [<1>9360](https://github.com/elastic/elasticsearch/pull/19360) (issue: [<1>9353](https://github.com/elastic/elasticsearch/issues/19353)) 



Internal 
    

  * Prevent AbstractArrays from release bytes more than once [<2>0819](https://github.com/elastic/elasticsearch/pull/20819)
  * IndicesAliasesRequest should not implement CompositeIndicesRequest [<2>0726](https://github.com/elastic/elasticsearch/pull/20726)
  * Ensure elasticsearch doesn’t start with unuspported indices [<2>0514](https://github.com/elastic/elasticsearch/pull/20514) (issue: [<2>0512](https://github.com/elastic/elasticsearch/issues/20512)) 
  * Remove ListTasksResponse#setDiscoveryNodes() [<1>9773](https://github.com/elastic/elasticsearch/pull/19773) (issue: [<1>9772](https://github.com/elastic/elasticsearch/issues/19772)) 
  * Priority values should be unmodifiable [<1>9447](https://github.com/elastic/elasticsearch/pull/19447)
  * Extract AbstractBytesReferenceTestCase [<1>9141](https://github.com/elastic/elasticsearch/pull/19141)
  * Add XPointValues [<1>8011](https://github.com/elastic/elasticsearch/pull/18011) (issue: [<1>8010](https://github.com/elastic/elasticsearch/issues/18010)) 
  * Fix BulkItemResponse.Failure.toString [<1>7871](https://github.com/elastic/elasticsearch/pull/17871)
  * Enable unmap hack for java 9 [<1>6986](https://github.com/elastic/elasticsearch/pull/16986) (issue: [<1>](https://github.com/elastic/elasticsearch/issues/1)) 
  * Fix issues with failed cache loads [<1>4315](https://github.com/elastic/elasticsearch/pull/14315)
  * Allow parser to move on the START_OBJECT token when parsing search source [<1>4145](https://github.com/elastic/elasticsearch/pull/14145)
  * Ensure searcher is release if wrapping fails [<1>4107](https://github.com/elastic/elasticsearch/pull/14107)
  * Avoid deadlocks in Cache#computeIfAbsent [<1>4091](https://github.com/elastic/elasticsearch/pull/14091) (issue: [<1>4090](https://github.com/elastic/elasticsearch/issues/14090)) 



Java API 
    

  * fix IndexResponse#toString to print out shards info [<2>0562](https://github.com/elastic/elasticsearch/pull/20562)
  * Add NamedWriteables from plugins to TransportClient [<1>9825](https://github.com/elastic/elasticsearch/pull/19825) (issue: [<1>9764](https://github.com/elastic/elasticsearch/issues/19764)) 
  * Fix potential NPE in SearchSourceBuilder [<1>6905](https://github.com/elastic/elasticsearch/pull/16905) (issue: [<1>6902](https://github.com/elastic/elasticsearch/issues/16902)) 



Java REST Client 
    

  * Rest Client: add slash to log line when missing between host and uri [<1>9325](https://github.com/elastic/elasticsearch/pull/19325) (issue: [<1>9314](https://github.com/elastic/elasticsearch/issues/19314)) 
  * Rest Client: HostsSniffer to set http as default scheme [<1>9306](https://github.com/elastic/elasticsearch/pull/19306)



Logging 
    

  * Fix logger when you can not create an azure storage client [<2>0670](https://github.com/elastic/elasticsearch/pull/20670) (issues: [<2>0633](https://github.com/elastic/elasticsearch/issues/20633), [<2>0669](https://github.com/elastic/elasticsearch/issues/20669)) 
  * Avoid unnecessary creation of prefix loggers [<2>0571](https://github.com/elastic/elasticsearch/pull/20571) (issue: [<2>0570](https://github.com/elastic/elasticsearch/issues/20570)) 
  * Fix logging hierarchy configs [<2>0463](https://github.com/elastic/elasticsearch/pull/20463)
  * Fix prefix logging [<2>0429](https://github.com/elastic/elasticsearch/pull/20429)
  * Hack around Log4j bug rendering exceptions [<2>0306](https://github.com/elastic/elasticsearch/pull/20306) (issue: [<2>0304](https://github.com/elastic/elasticsearch/issues/20304)) 
  * Avoid prematurely triggering logger initialization [<2>0170](https://github.com/elastic/elasticsearch/pull/20170)
  * Only log running out of slots when out of slots [<1>9637](https://github.com/elastic/elasticsearch/pull/19637)



Mapping 
    

  * Allow position_gap_increment for fields in indices created prior to 5.0 [<2>0806](https://github.com/elastic/elasticsearch/pull/20806) (issues: [<1>9510](https://github.com/elastic/elasticsearch/issues/19510), [<2>0413](https://github.com/elastic/elasticsearch/issues/20413)) 
  * Validate blank field name [<1>9860](https://github.com/elastic/elasticsearch/pull/19860) (issue: [<1>9251](https://github.com/elastic/elasticsearch/issues/19251)) 
  * Better error message when mapping configures null [<1>8809](https://github.com/elastic/elasticsearch/pull/18809) (issue: [<1>8803](https://github.com/elastic/elasticsearch/issues/18803)) 
  * Make doc_values accessible for _type [<1>8220](https://github.com/elastic/elasticsearch/pull/18220)
  * Fix and test handling of `null_value`. [<1>8090](https://github.com/elastic/elasticsearch/pull/18090) (issue: [<1>8085](https://github.com/elastic/elasticsearch/issues/18085)) 
  * Fail automatic string upgrade if the value of `index` is not recognized. [<1>8082](https://github.com/elastic/elasticsearch/pull/18082) (issue: [<1>8062](https://github.com/elastic/elasticsearch/issues/18062)) 
  * Fix dynamic check to properly handle parents [<1>7864](https://github.com/elastic/elasticsearch/pull/17864) (issues: [<1>7644](https://github.com/elastic/elasticsearch/issues/17644), [<1>7854](https://github.com/elastic/elasticsearch/issues/17854)) 
  * Fix array parsing to remove its context when finished parsing [<1>7768](https://github.com/elastic/elasticsearch/pull/17768)
  * Disallow fielddata loading on text fields that are not indexed. [<1>7747](https://github.com/elastic/elasticsearch/pull/17747)
  * Make dynamic template parsing less lenient. [<1>7249](https://github.com/elastic/elasticsearch/pull/17249)
  * Fix dynamic mapper when its parent already has an update [<1>7065](https://github.com/elastic/elasticsearch/pull/17065)
  * Fix copy_to when the target is a dynamic object field. [<1>5216](https://github.com/elastic/elasticsearch/pull/15216) (issues: [<1>11237](https://github.com/elastic/elasticsearch/issues/111237), [<1>1237](https://github.com/elastic/elasticsearch/issues/11237)) 
  * Preserve existing mappings on batch mapping updates [<1>5130](https://github.com/elastic/elasticsearch/pull/15130) (issues: [<1>4899](https://github.com/elastic/elasticsearch/issues/14899), [<1>5129](https://github.com/elastic/elasticsearch/issues/15129)) 



Network 
    

  * Fix connection close header handling [<2>0956](https://github.com/elastic/elasticsearch/pull/20956) (issue: [<2>0938](https://github.com/elastic/elasticsearch/issues/20938)) 
  * Ensure port range is readable in the exception message [<2>0893](https://github.com/elastic/elasticsearch/pull/20893)
  * Fix expect 100 continue header handling [<1>9904](https://github.com/elastic/elasticsearch/pull/19904) (issue: [<1>9834](https://github.com/elastic/elasticsearch/issues/19834)) 
  * Fixes netty4 module’s CORS config to use defaults [<1>9874](https://github.com/elastic/elasticsearch/pull/19874)
  * Fix various concurrency issues in transport [<1>9675](https://github.com/elastic/elasticsearch/pull/19675)
  * Verify lower level transport exceptions don’t bubble up on disconnects [<1>9518](https://github.com/elastic/elasticsearch/pull/19518) (issue: [<1>9096](https://github.com/elastic/elasticsearch/issues/19096)) 



Packaging 
    

  * [Packaging] Do not remove scripts directory on upgrade [<2>0452](https://github.com/elastic/elasticsearch/pull/20452)
  * [Package] Remove bin/lib/modules directories on RPM uninstall/upgrade [<2>0448](https://github.com/elastic/elasticsearch/pull/20448)
  * Fix handling of spaces for jvm.options on Windows [<1>9951](https://github.com/elastic/elasticsearch/pull/19951) (issue: [<1>9941](https://github.com/elastic/elasticsearch/issues/19941)) 
  * Disable service in pre-uninstall [<1>9328](https://github.com/elastic/elasticsearch/pull/19328)
  * Remove extra bin/ directory in bin folder [<1>8630](https://github.com/elastic/elasticsearch/pull/18630)
  * Filter client/server VM options from jvm.options [<1>8473](https://github.com/elastic/elasticsearch/pull/18473)
  * Preserve config files from RPM install [<1>8188](https://github.com/elastic/elasticsearch/pull/18188) (issue: [<1>8158](https://github.com/elastic/elasticsearch/issues/18158)) 
  * Fix typo in message for variable setup ES_MAX_MEM [<1>8168](https://github.com/elastic/elasticsearch/pull/18168)
  * Don’t run `mkdir` when $DATA_DIR contains a comma-separated list [<1>7419](https://github.com/elastic/elasticsearch/pull/17419) (issue: [<1>6992](https://github.com/elastic/elasticsearch/issues/16992)) 
  * Fix exit code [<1>7082](https://github.com/elastic/elasticsearch/pull/17082)
  * Set MAX_OPEN_FILES to 65536 [<1>7431](https://github.com/elastic/elasticsearch/pull/17431) (issue: [<1>7430](https://github.com/elastic/elasticsearch/issues/17430)) 
  * [windows] Service command still had positional start command [<1>7391](https://github.com/elastic/elasticsearch/pull/17391)
  * Do not pass double-dash arguments on startup [<1>7087](https://github.com/elastic/elasticsearch/pull/17087) (issue: [<1>7084](https://github.com/elastic/elasticsearch/issues/17084)) 



Parent/Child 
    

  * Make sure that no `_parent#null` gets introduces as default _parent mapping [<1>9470](https://github.com/elastic/elasticsearch/pull/19470) (issue: [<1>9389](https://github.com/elastic/elasticsearch/issues/19389)) 



Percolator 
    

  * Fail indexing percolator queries containing either a has_child or has_parent query [<2>0229](https://github.com/elastic/elasticsearch/pull/20229) (issue: [<2>960](https://github.com/elastic/elasticsearch/issues/2960)) 
  * Add support for MatchNoDocsQuery in percolator’s query terms extract service [<1>8492](https://github.com/elastic/elasticsearch/pull/18492)
  * Let PercolatorQuery’s explain use the two phase iterator [<1>7315](https://github.com/elastic/elasticsearch/pull/17315) (issue: [<1>7314](https://github.com/elastic/elasticsearch/issues/17314)) 



Plugin Discovery Azure Classic 
    

  * Make discovery-azure plugin work again [<1>9062](https://github.com/elastic/elasticsearch/pull/19062) (issues: [<1>5630](https://github.com/elastic/elasticsearch/issues/15630), [<1>8637](https://github.com/elastic/elasticsearch/issues/18637)) 



Plugin Discovery EC2 
    

  * Fix EC2 discovery settings [<1>8690](https://github.com/elastic/elasticsearch/pull/18690) (issues: [<1>8652](https://github.com/elastic/elasticsearch/issues/18652), [<1>8662](https://github.com/elastic/elasticsearch/issues/18662)) 
  * Add TAG_SETTING to list of allowed tags for the ec2 discovery plugin. [<1>8257](https://github.com/elastic/elasticsearch/pull/18257)
  * Fix EC2 Discovery settings [<1>7651](https://github.com/elastic/elasticsearch/pull/17651) (issue: [<1>6602](https://github.com/elastic/elasticsearch/issues/16602)) 



Plugin Discovery GCE 
    

  * Fix NPE when GCE region is empty [<1>9176](https://github.com/elastic/elasticsearch/pull/19176) (issue: [<1>6967](https://github.com/elastic/elasticsearch/issues/16967)) 



Plugin Ingest Attachment 
    

  * Adds content-length as number [<1>9927](https://github.com/elastic/elasticsearch/pull/19927) (issue: [<1>9924](https://github.com/elastic/elasticsearch/issues/19924)) 



Plugin Ingest GeoIp 
    

  * [ingest-geoip] update geoip to not include null-valued results from [<2>0455](https://github.com/elastic/elasticsearch/pull/20455)



Plugin Lang Painless 
    

  * Fix String Concatenation Bug In Painless [<2>0623](https://github.com/elastic/elasticsearch/pull/20623)
  * Fix break bug in for/foreach loops. [<2>0146](https://github.com/elastic/elasticsearch/pull/20146)
  * Fix compound assignment with string concats [<1>8933](https://github.com/elastic/elasticsearch/pull/18933) (issue: [<1>8929](https://github.com/elastic/elasticsearch/issues/18929)) 
  * Fix horrible capture [<1>8907](https://github.com/elastic/elasticsearch/pull/18907) (issue: [<1>8899](https://github.com/elastic/elasticsearch/issues/18899)) 
  * Fix Casting Bug [<1>8871](https://github.com/elastic/elasticsearch/pull/18871)
  * Remove Grammar Ambiguities [<1>8531](https://github.com/elastic/elasticsearch/pull/18531)
  * Remove if/else ANTLR ambiguity. [<1>8428](https://github.com/elastic/elasticsearch/pull/18428)
  * Fix insanely slow compilation [<1>8410](https://github.com/elastic/elasticsearch/pull/18410) (issue: [<1>8398](https://github.com/elastic/elasticsearch/issues/18398)) 
  * Fix Bug in Painless Assignment [<1>8379](https://github.com/elastic/elasticsearch/pull/18379)
  * Fix bracket shortcuts [<1>8263](https://github.com/elastic/elasticsearch/pull/18263)



Plugin Repository Azure 
    

  * Register group setting for repository-azure accounts [<1>9086](https://github.com/elastic/elasticsearch/pull/19086)
  * Fix azure files removal [<1>8451](https://github.com/elastic/elasticsearch/pull/18451) (issues: [<1>6472](https://github.com/elastic/elasticsearch/issues/16472), [<1>8436](https://github.com/elastic/elasticsearch/issues/18436)) 



Plugin Repository S3 
    

  * Fixes leading forward slash in S3 repository base_path [<2>0861](https://github.com/elastic/elasticsearch/pull/20861)
  * Add missing permission to repository-s3 [<1>9128](https://github.com/elastic/elasticsearch/pull/19128) (issues: [<1>8539](https://github.com/elastic/elasticsearch/issues/18539), [<1>9121](https://github.com/elastic/elasticsearch/issues/19121)) 
  * Fix repository S3 Settings and add more tests [<1>8703](https://github.com/elastic/elasticsearch/pull/18703) (issues: [<1>8662](https://github.com/elastic/elasticsearch/issues/18662), [<1>8690](https://github.com/elastic/elasticsearch/issues/18690)) 



Plugin Store SMB 
    

  * Fix calling ensureOpen() on the wrong directory (master forwardport) [<1>6395](https://github.com/elastic/elasticsearch/pull/16395) (issue: [<1>6383](https://github.com/elastic/elasticsearch/issues/16383)) 



Plugins 
    

  * Use sysprop like with es.path.home to pass conf dir [<1>8870](https://github.com/elastic/elasticsearch/pull/18870) (issue: [<1>8689](https://github.com/elastic/elasticsearch/issues/18689)) 
  * Quote path to java binary [<1>7496](https://github.com/elastic/elasticsearch/pull/17496) (issue: [<1>7495](https://github.com/elastic/elasticsearch/issues/17495)) 
  * CliTool: Messages printed in Terminal should have percent char escaped [<1>6367](https://github.com/elastic/elasticsearch/pull/16367)



Query DSL 
    

  * Fixes MultiMatchQuery so that it doesn’t provide a null context [<2>0882](https://github.com/elastic/elasticsearch/pull/20882)
  * Fix silently accepting malformed queries [<2>0515](https://github.com/elastic/elasticsearch/pull/20515) (issue: [<2>0500](https://github.com/elastic/elasticsearch/issues/20500)) 
  * query_string_query should take term length into consideration when fuzziness is auto [<2>0299](https://github.com/elastic/elasticsearch/pull/20299) (issue: [<1>5972](https://github.com/elastic/elasticsearch/issues/15972)) 
  * Throw ParsingException if a query is wrapped in an array [<1>9750](https://github.com/elastic/elasticsearch/pull/19750) (issue: [<1>2887](https://github.com/elastic/elasticsearch/issues/12887)) 
  * Restore parameter name auto_generate_phrase_queries [<1>9514](https://github.com/elastic/elasticsearch/pull/19514) (issue: [<1>9512](https://github.com/elastic/elasticsearch/issues/19512)) 
  * Resolve string dates and date math to millis before evaluating for rewrite in range query [<1>7239](https://github.com/elastic/elasticsearch/pull/17239)
  * `constant_score` query should throw error on more than one filter [<1>7135](https://github.com/elastic/elasticsearch/pull/17135) (issue: [<1>7126](https://github.com/elastic/elasticsearch/issues/17126)) 
  * Single IPv4 addresses in IP field term queries [<1>6068](https://github.com/elastic/elasticsearch/pull/16068) (issue: [<1>6058](https://github.com/elastic/elasticsearch/issues/16058)) 
  * Make strategy optional in GeoShapeQueryBuilder readFrom and writeTo [<1>3963](https://github.com/elastic/elasticsearch/pull/13963)



Query Refactoring 
    

  * Query refactoring: set has_parent & has_child types context properly [<1>3863](https://github.com/elastic/elasticsearch/pull/13863)
  * Make sure equivalent geohashCellQueries are equal after toQuery called [<1>3792](https://github.com/elastic/elasticsearch/pull/13792)



REST 
    

  * Remove lenient URL parameter parsing [<2>0722](https://github.com/elastic/elasticsearch/pull/20722) (issue: [<1>4719](https://github.com/elastic/elasticsearch/issues/14719)) 
  * Fixes CORS handling so that it uses the defaults [<1>9522](https://github.com/elastic/elasticsearch/pull/19522) (issue: [<1>9520](https://github.com/elastic/elasticsearch/issues/19520)) 
  * Get XContent params from request in Nodes rest actions [<1>8860](https://github.com/elastic/elasticsearch/pull/18860) (issue: [<1>8794](https://github.com/elastic/elasticsearch/issues/18794)) 
  * Fixes reading of CORS pre-flight headers and methods [<1>7523](https://github.com/elastic/elasticsearch/pull/17523) (issue: [<1>7483](https://github.com/elastic/elasticsearch/issues/17483)) 



Recovery 
    

  * Fix concurrency issues between cancelling a relocation and marking shard as relocated [<2>0443](https://github.com/elastic/elasticsearch/pull/20443)
  * Move `reset recovery` into RecoveriesCollection [<1>9466](https://github.com/elastic/elasticsearch/pull/19466) (issue: [<1>9473](https://github.com/elastic/elasticsearch/issues/19473)) 
  * Fix replica-primary inconsistencies when indexing during primary relocation with ongoing replica recoveries [<1>9287](https://github.com/elastic/elasticsearch/pull/19287) (issue: [<1>9248](https://github.com/elastic/elasticsearch/issues/19248)) 
  * Invoke `IndexingOperationListeners` also when recovering from store or remote [<1>7406](https://github.com/elastic/elasticsearch/pull/17406)
  * Prevent interruption while store checks lucene files for consistency [<1>6308](https://github.com/elastic/elasticsearch/pull/16308)
  * Mark shard as recovering on the cluster state thread [<1>4276](https://github.com/elastic/elasticsearch/pull/14276) (issues: [<1>3766](https://github.com/elastic/elasticsearch/issues/13766), [<1>4115](https://github.com/elastic/elasticsearch/issues/14115)) 



Reindex API 
    

  * Fix reindex with transport client [<1>9997](https://github.com/elastic/elasticsearch/pull/19997) (issues: [<1>9773](https://github.com/elastic/elasticsearch/issues/19773), [<1>9979](https://github.com/elastic/elasticsearch/issues/19979)) 
  * Fix a race condition in reindex’s rethrottle [<1>8731](https://github.com/elastic/elasticsearch/pull/18731) (issue: [<1>8744](https://github.com/elastic/elasticsearch/issues/18744)) 
  * Reindex should never report negative throttled_until [<1>7799](https://github.com/elastic/elasticsearch/pull/17799) (issue: [<1>7783](https://github.com/elastic/elasticsearch/issues/17783)) 
  * Reindex should gracefully handle when _source is disabled [<1>7667](https://github.com/elastic/elasticsearch/pull/17667) (issue: [<1>7666](https://github.com/elastic/elasticsearch/issues/17666)) 



Scripting 
    

  * Add support for booleans in scripts [<2>0950](https://github.com/elastic/elasticsearch/pull/20950) (issue: [<2>0949](https://github.com/elastic/elasticsearch/issues/20949)) 
  * Fix Javascript OOM build Failure [<2>0307](https://github.com/elastic/elasticsearch/pull/20307)
  * Fix propagating the default value for script settings [<2>0183](https://github.com/elastic/elasticsearch/pull/20183) (issue: [<2>0159](https://github.com/elastic/elasticsearch/issues/20159)) 
  * Catch and wrap AssertionError and NoClassDefFoundError in groovy scripts [<1>9958](https://github.com/elastic/elasticsearch/pull/19958) (issues: [<1>9806](https://github.com/elastic/elasticsearch/issues/19806), [<1>9923](https://github.com/elastic/elasticsearch/issues/19923)) 



Search 
    

  * Do not cache script queries. [<2>0799](https://github.com/elastic/elasticsearch/pull/20799) (issue: [<2>0763](https://github.com/elastic/elasticsearch/issues/20763)) 
  * Throw error when trying to fetch fields from source and source is disabled [<2>0424](https://github.com/elastic/elasticsearch/pull/20424) (issues: [<2>0093](https://github.com/elastic/elasticsearch/issues/20093), [<2>0408](https://github.com/elastic/elasticsearch/issues/20408)) 
  * Source filtering should keep working when the source contains numbers greater than `Long.MAX_VALUE`. [<2>0278](https://github.com/elastic/elasticsearch/pull/20278) (issue: [<1>1508](https://github.com/elastic/elasticsearch/issues/11508)) 
  * Fix NPE when running a range query on a `scaled_float` with no upper bound. [<2>0253](https://github.com/elastic/elasticsearch/pull/20253)
  * Fix NPE during search with source filtering if the source is disabled. [<2>0093](https://github.com/elastic/elasticsearch/pull/20093) (issue: [<7>758](https://github.com/elastic/elasticsearch/issues/7758)) 
  * Restore assignment of time value when deserializing a scroll instance [<1>9977](https://github.com/elastic/elasticsearch/pull/19977) (issue: [<1>8820](https://github.com/elastic/elasticsearch/issues/18820)) 
  * Fix explain output for dfs query [<1>9972](https://github.com/elastic/elasticsearch/pull/19972) (issue: [<1>5369](https://github.com/elastic/elasticsearch/issues/15369)) 
  * Don’t recursively count children profile timings [<1>9397](https://github.com/elastic/elasticsearch/pull/19397) (issue: [<1>8693](https://github.com/elastic/elasticsearch/issues/18693)) 
  * fix explain in function_score if no function filter matches [<1>9185](https://github.com/elastic/elasticsearch/pull/19185)
  * Fix NPEs due to disabled source [<1>8957](https://github.com/elastic/elasticsearch/pull/18957)
  * Require timeout units when parsing query body [<1>9077](https://github.com/elastic/elasticsearch/pull/19077) (issue: [<1>9075](https://github.com/elastic/elasticsearch/issues/19075)) 
  * Close SearchContext if query rewrite failed [<1>8727](https://github.com/elastic/elasticsearch/pull/18727)
  * Fix parsing single `rescore` element in SearchSourceBuilder [<1>8440](https://github.com/elastic/elasticsearch/pull/18440) (issue: [<1>8439](https://github.com/elastic/elasticsearch/issues/18439)) 
  * Fail queries on not indexed fields. [<1>8014](https://github.com/elastic/elasticsearch/pull/18014)
  * Fix for search after [<1>6271](https://github.com/elastic/elasticsearch/pull/16271)
  * Do not be lenient when parsing CIDRs [<1>4874](https://github.com/elastic/elasticsearch/pull/14874) (issue: [<1>4862](https://github.com/elastic/elasticsearch/issues/14862)) 



Settings 
    

  * Fix Setting.timeValue() method [<2>0696](https://github.com/elastic/elasticsearch/pull/20696) (issue: [<2>0662](https://github.com/elastic/elasticsearch/issues/20662)) 
  * Add a hard limit for `index.number_of_shard` [<2>0682](https://github.com/elastic/elasticsearch/pull/20682)
  * Include complex settings in settings requests [<2>0622](https://github.com/elastic/elasticsearch/pull/20622)
  * Fix filter cache setting to allow percentages [<2>0335](https://github.com/elastic/elasticsearch/pull/20335) (issue: [<2>0330](https://github.com/elastic/elasticsearch/issues/20330)) 
  * Move cluster.routing.allocation.same_shard.host setting to new settings infrastructure [<2>0046](https://github.com/elastic/elasticsearch/pull/20046) (issue: [<2>0045](https://github.com/elastic/elasticsearch/issues/20045)) 
  * Validate settings against dynamic updaters on the master [<1>9088](https://github.com/elastic/elasticsearch/pull/19088) (issue: [<1>9046](https://github.com/elastic/elasticsearch/issues/19046)) 
  * Register "cloud.node.auto_attributes" setting in EC2 discovery plugin [<1>8678](https://github.com/elastic/elasticsearch/pull/18678)
  * Use object equality to compare versions in IndexSettings [<1>8103](https://github.com/elastic/elasticsearch/pull/18103)
  * fix exists method for list settings when using numbered setting format [<1>7949](https://github.com/elastic/elasticsearch/pull/17949)
  * convert settings for ResourceWatcherService to new infrastructure [<1>7948](https://github.com/elastic/elasticsearch/pull/17948)
  * Register bootstrap settings [<1>6513](https://github.com/elastic/elasticsearch/pull/16513)
  * Add settings filtering to node info requests [<1>6445](https://github.com/elastic/elasticsearch/pull/16445)
  * Ban write access to system properties [<1>4914](https://github.com/elastic/elasticsearch/pull/14914)



Snapshot/Restore 
    

  * Better handling of an empty shard’s segments_N file [<1>8784](https://github.com/elastic/elasticsearch/pull/18784) (issue: [<1>8707](https://github.com/elastic/elasticsearch/issues/18707)) 
  * Fix race condition in snapshot initialization [<1>8426](https://github.com/elastic/elasticsearch/pull/18426) (issue: [<1>8121](https://github.com/elastic/elasticsearch/issues/18121)) 
  * Fix the semantics for the BlobContainer interface [<1>7878](https://github.com/elastic/elasticsearch/pull/17878) (issues: [<1>5579](https://github.com/elastic/elasticsearch/issues/15579), [<1>5580](https://github.com/elastic/elasticsearch/issues/15580)) 



Stats 
    

  * Fix FieldStats deserialization of `ip` field [<2>0522](https://github.com/elastic/elasticsearch/pull/20522) (issue: [<2>0516](https://github.com/elastic/elasticsearch/issues/20516)) 
  * Fix serialization bug in allocation explain API. [<1>9494](https://github.com/elastic/elasticsearch/pull/19494)
  * Allocation explain: Also serialize `includeDiskInfo` field [<1>9492](https://github.com/elastic/elasticsearch/pull/19492)
  * Add missing builder.endObject() in FsInfo [<1>8443](https://github.com/elastic/elasticsearch/pull/18443) (issues: [<1>5915](https://github.com/elastic/elasticsearch/issues/15915), [<1>8433](https://github.com/elastic/elasticsearch/issues/18433)) 



Store 
    

  * Tighten up concurrent store metadata listing and engine writes [<1>9684](https://github.com/elastic/elasticsearch/pull/19684) (issue: [<1>9416](https://github.com/elastic/elasticsearch/issues/19416)) 
  * Make static Store access shard lock aware [<1>9416](https://github.com/elastic/elasticsearch/pull/19416) (issue: [<1>8938](https://github.com/elastic/elasticsearch/issues/18938)) 
  * Catch assertion errors on commit and turn it into a real exception [<1>9357](https://github.com/elastic/elasticsearch/pull/19357) (issue: [<1>9356](https://github.com/elastic/elasticsearch/issues/19356)) 



Task Manager 
    

  * Shard level tasks in Bulk Action lose reference to their parent tasks [<1>7743](https://github.com/elastic/elasticsearch/pull/17743)
  * Take filterNodeIds into consideration while sending task requests to nodes [<1>7081](https://github.com/elastic/elasticsearch/pull/17081)



Term Vectors 
    

  * Fix calculation of took time of term vectors request [<1>7817](https://github.com/elastic/elasticsearch/pull/17817) (issue: [<1>2565](https://github.com/elastic/elasticsearch/issues/12565)) 



Translog 
    

  * Fix RAM usage estimation of LiveVersionMap. [<2>0123](https://github.com/elastic/elasticsearch/pull/20123) (issue: [<1>9787](https://github.com/elastic/elasticsearch/issues/19787)) 
  * Fix translog replay multiple operations same doc [<1>8611](https://github.com/elastic/elasticsearch/pull/18611) (issues: [<1>8547](https://github.com/elastic/elasticsearch/issues/18547), [<1>8623](https://github.com/elastic/elasticsearch/issues/18623)) 
  * Snapshotting and sync could cause a dead lock TranslogWriter [<1>8481](https://github.com/elastic/elasticsearch/pull/18481) (issues: [<1>](https://github.com/elastic/elasticsearch/issues/1), [<1>8360](https://github.com/elastic/elasticsearch/issues/18360), [<2>](https://github.com/elastic/elasticsearch/issues/2)) 
  * Move translog recover outside of the engine [<1>7422](https://github.com/elastic/elasticsearch/pull/17422)
  * Mark shard active during recovery; push settings after engine finally inits [<1>6250](https://github.com/elastic/elasticsearch/pull/16250) (issues: [<1>4121](https://github.com/elastic/elasticsearch/issues/14121), [<1>6209](https://github.com/elastic/elasticsearch/issues/16209)) 



### Regressions

Highlighting 
    

  * Handle SynonymQuery extraction for the FastVectorHighlighter [<2>0829](https://github.com/elastic/elasticsearch/pull/20829) (issue: [<2>0781](https://github.com/elastic/elasticsearch/issues/20781)) 



### Upgrades

Core 
    

  * Upgrade to Lucene 6.2.0 [<2>0147](https://github.com/elastic/elasticsearch/pull/20147) (issue: [<2>0092](https://github.com/elastic/elasticsearch/issues/20092)) 
  * Update to jackson 2.8.1 [<1>8939](https://github.com/elastic/elasticsearch/pull/18939) (issue: [<1>8076](https://github.com/elastic/elasticsearch/issues/18076)) 
  * Upgrade to Lucene 6.1.0. [<1>8926](https://github.com/elastic/elasticsearch/pull/18926)
  * Upgrade to lucene-6.1.0-snapshot-3a57bea. [<1>8786](https://github.com/elastic/elasticsearch/pull/18786)
  * Upgrade to Lucene 6.0.1. [<1>8648](https://github.com/elastic/elasticsearch/pull/18648) (issues: [<1>7535](https://github.com/elastic/elasticsearch/issues/17535), [<2>8](https://github.com/elastic/elasticsearch/issues/28)) 
  * Upgrade to lucene 6 release [<1>7657](https://github.com/elastic/elasticsearch/pull/17657)
  * Upgrade to lucene-6.0.0-f0aa4fc. [<1>7075](https://github.com/elastic/elasticsearch/pull/17075)
  * upgrade to lucene 6.0.0-snapshot-bea235f [<1>6964](https://github.com/elastic/elasticsearch/pull/16964)
  * Upgrade to Jackson 2.7.1 [<1>6801](https://github.com/elastic/elasticsearch/pull/16801) (issue: [<1>6294](https://github.com/elastic/elasticsearch/issues/16294)) 



Ingest 
    

  * Update MaxMind geoip2 version to 2.6 [<1>6837](https://github.com/elastic/elasticsearch/pull/16837) (issue: [<1>6801](https://github.com/elastic/elasticsearch/issues/16801)) 



Internal 
    

  * Bump master (3.0-snapshot) to java 8 [<1>3314](https://github.com/elastic/elasticsearch/pull/13314)



Network 
    

  * Upgrade to Netty 4.1.5 [<2>0222](https://github.com/elastic/elasticsearch/pull/20222) (issue: [<1>9786](https://github.com/elastic/elasticsearch/issues/19786)) 
  * Dependencies: Upgrade to netty 4.1.4 [<1>9689](https://github.com/elastic/elasticsearch/pull/19689)
  * Introduce Netty 4 [<1>9526](https://github.com/elastic/elasticsearch/pull/19526) (issue: [<3>226](https://github.com/elastic/elasticsearch/issues/3226)) 



Packaging 
    

  * Upgrade JNA to 4.2.2 and remove optionality [<1>9045](https://github.com/elastic/elasticsearch/pull/19045) (issue: [<1>3245](https://github.com/elastic/elasticsearch/issues/13245)) 



Plugin Discovery EC2 
    

  * Update aws sdk to 1.10.69 and add use_throttle_retries repository setting [<1>7784](https://github.com/elastic/elasticsearch/pull/17784) (issues: [<5>38](https://github.com/elastic/elasticsearch/issues/538), [<5>86](https://github.com/elastic/elasticsearch/issues/586), [<5>89](https://github.com/elastic/elasticsearch/issues/589)) 



Scripting 
    

  * Dependencies: Updates to mustache 0.9.3 [<2>0337](https://github.com/elastic/elasticsearch/pull/20337)



Search Templates 
    

  * Update mustache.java to version 0.9.1 [<1>4053](https://github.com/elastic/elasticsearch/pull/14053) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 


