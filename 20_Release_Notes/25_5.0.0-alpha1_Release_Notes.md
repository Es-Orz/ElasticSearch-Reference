## 5.0.0-alpha1 Release Notes

The changes listed below have been released for the first time in Elasticsearch 5.0.0-alpha1. Changes in this release which were first released in the 2.x series are listed in [_5.0.0-alpha1 Release Notes (Changes previously released in 2.x)_](release-notes-5.0.0-alpha1-2x.html).

Also see [_5.0的版本变更_](breaking-changes-5.0.html).

![Important](https://www.elastic.co/guide/en/elasticsearch/reference/current/images/icons/important.png)

This is an alpha release and is intended for _testing purposes only_. Indices created in this version will **not be compatible with Elasticsearch 5.0.0 GA**. Upgrading 5.0.0-alpha1 to any other version is not supported.

### Breaking changes

Aliases 
    

  * make get alias expand to open and closed indices by default [<1>5954](https://github.com/elastic/elasticsearch/pull/15954) (issue: [<1>4982](https://github.com/elastic/elasticsearch/issues/14982)) 
  * Remove deprecated indices.get_aliases [<1>3906](https://github.com/elastic/elasticsearch/pull/13906)



Allocation 
    

  * Remove DisableAllocationDecider [<1>3313](https://github.com/elastic/elasticsearch/pull/13313)



CAT API 
    

  * Add raw recovery progress to cat recovery API [<1>7064](https://github.com/elastic/elasticsearch/pull/17064) (issue: [<1>7022](https://github.com/elastic/elasticsearch/issues/17022)) 
  * Remove host from cat nodes API [<1>6656](https://github.com/elastic/elasticsearch/pull/16656) (issues: [<1>2959](https://github.com/elastic/elasticsearch/issues/12959), [<1>6575](https://github.com/elastic/elasticsearch/issues/16575)) 
  * Using the accept header in the request instead of content-type in _cat API. [<1>4421](https://github.com/elastic/elasticsearch/pull/14421) (issue: [<1>4195](https://github.com/elastic/elasticsearch/issues/14195)) 



CRUD 
    

  * Remove object notation for core types. [<1>5684](https://github.com/elastic/elasticsearch/pull/15684) (issue: [<1>5388](https://github.com/elastic/elasticsearch/issues/15388)) 



Cache 
    

  * Remove deprecated query cache settings [<1>5592](https://github.com/elastic/elasticsearch/pull/15592)



Cluster 
    

  * Remove memory div [<1>7278](https://github.com/elastic/elasticsearch/pull/17278) (issues: [<1>2049](https://github.com/elastic/elasticsearch/issues/12049), [<1>6756](https://github.com/elastic/elasticsearch/issues/16756)) 



Core 
    

  * Bootstrap does not set system properties [<1>7088](https://github.com/elastic/elasticsearch/pull/17088) (issues: [<1>6579](https://github.com/elastic/elasticsearch/issues/16579), [<1>6791](https://github.com/elastic/elasticsearch/issues/16791)) 
  * Add max number of processes check [<1>6919](https://github.com/elastic/elasticsearch/pull/16919)
  * Add mlockall bootstrap check [<1>6909](https://github.com/elastic/elasticsearch/pull/16909)
  * One log [<1>6703](https://github.com/elastic/elasticsearch/pull/16703) (issue: [<1>6585](https://github.com/elastic/elasticsearch/issues/16585)) 



Engine 
    

  * Remove `index.compound_on_flush` setting and default to `true` [<1>5594](https://github.com/elastic/elasticsearch/pull/15594) (issue: [<1>0778](https://github.com/elastic/elasticsearch/issues/10778)) 



Fielddata 
    

  * Remove "uninverted" and "binary" fielddata support for numeric and boolean fields. [<1>4082](https://github.com/elastic/elasticsearch/pull/14082)



Index APIs 
    

  * Remove `GET` option for /_forcemerge [<1>5223](https://github.com/elastic/elasticsearch/pull/15223) (issue: [<1>5165](https://github.com/elastic/elasticsearch/issues/15165)) 
  * Remove /_optimize REST API endpoint [<1>4226](https://github.com/elastic/elasticsearch/pull/14226) (issue: [<1>3778](https://github.com/elastic/elasticsearch/issues/13778)) 



Internal 
    

  * Remove support for pre 2.0 indices [<1>3799](https://github.com/elastic/elasticsearch/pull/13799)



Mapping 
    

  * Change the field mapping index time boost into a query time boost. [<1>6900](https://github.com/elastic/elasticsearch/pull/16900)
  * Deprecate string in favor of text/keyword. [<1>6877](https://github.com/elastic/elasticsearch/pull/16877)
  * Term vector APIs should no longer update mappings [<1>6285](https://github.com/elastic/elasticsearch/pull/16285)
  * Remove the `format` option of the `_source` field. [<1>5398](https://github.com/elastic/elasticsearch/pull/15398)
  * Remove transform [<1>3657](https://github.com/elastic/elasticsearch/pull/13657) (issue: [<1>2674](https://github.com/elastic/elasticsearch/issues/12674)) 



Parent/Child 
    

  * Removed `total` score mode in favour for `sum` score mode. [<1>7174](https://github.com/elastic/elasticsearch/pull/17174) (issues: [<1>3470](https://github.com/elastic/elasticsearch/issues/13470), [<1>7083](https://github.com/elastic/elasticsearch/issues/17083)) 
  * Removed pre 2.x parent child implementation [<1>3376](https://github.com/elastic/elasticsearch/pull/13376)



Percolator 
    

  * Change the percolate api to not dynamically add fields to mapping [<1>6077](https://github.com/elastic/elasticsearch/pull/16077) (issue: [<1>5751](https://github.com/elastic/elasticsearch/issues/15751)) 



Plugins 
    

  * Rename bin/plugin in bin/elasticsearch-plugin [<1>6454](https://github.com/elastic/elasticsearch/pull/16454)
  * Remove multicast plugin [<1>6326](https://github.com/elastic/elasticsearch/pull/16326) (issue: [<1>6310](https://github.com/elastic/elasticsearch/issues/16310)) 
  * Plugins: Remove site plugins [<1>6038](https://github.com/elastic/elasticsearch/pull/16038)



Query DSL 
    

  * Function score query: remove deprecated support for boost_factor [<1>3510](https://github.com/elastic/elasticsearch/pull/13510)
  * Remove support for deprecated queries. [<1>3418](https://github.com/elastic/elasticsearch/pull/13418) (issue: [<1>3326](https://github.com/elastic/elasticsearch/issues/13326)) 



REST 
    

  * Limit the accepted length of the _id [<1>6036](https://github.com/elastic/elasticsearch/pull/16036) (issue: [<1>6034](https://github.com/elastic/elasticsearch/issues/16034)) 



Search 
    

  * Remove deprecated reverse option from sorting [<1>7282](https://github.com/elastic/elasticsearch/pull/17282) (issue: [<1>7047](https://github.com/elastic/elasticsearch/issues/17047)) 
  * Remove some deprecations [<1>4331](https://github.com/elastic/elasticsearch/pull/14331)
  * Remove search exists api [<1>3911](https://github.com/elastic/elasticsearch/pull/13911) (issues: [<1>3682](https://github.com/elastic/elasticsearch/issues/13682), [<1>3910](https://github.com/elastic/elasticsearch/issues/13910)) 
  * Remove the scan and count search types. [<1>3310](https://github.com/elastic/elasticsearch/pull/13310)



Search Refactoring 
    

  * Remove "query" query and fix related parsing bugs [<1>4304](https://github.com/elastic/elasticsearch/pull/14304) (issue: [<1>3326](https://github.com/elastic/elasticsearch/issues/13326)) 



Settings 
    

  * Remove ability to specify arbitrary node attributes with `node.` prefix [<1>7402](https://github.com/elastic/elasticsearch/pull/17402) (issue: [<1>7280](https://github.com/elastic/elasticsearch/issues/17280)) 
  * Enforce `discovery.zen.minimum_master_nodes` is set when bound to a public ip [<1>7288](https://github.com/elastic/elasticsearch/pull/17288)
  * Prevent index level setting from being configured on a node level [<1>7144](https://github.com/elastic/elasticsearch/pull/17144) (issue: [<1>6799](https://github.com/elastic/elasticsearch/issues/16799)) 
  * Remove support for node.client setting [<1>6963](https://github.com/elastic/elasticsearch/pull/16963) (issue: [<1>6565](https://github.com/elastic/elasticsearch/issues/16565)) 
  * Remove es.max-open-files flag [<1>6757](https://github.com/elastic/elasticsearch/pull/16757) (issues: [<1>6506](https://github.com/elastic/elasticsearch/issues/16506), [<4>83](https://github.com/elastic/elasticsearch/issues/483)) 
  * Enforce node level limits if node is started in production env [<1>6733](https://github.com/elastic/elasticsearch/pull/16733) (issue: [<1>6727](https://github.com/elastic/elasticsearch/issues/16727)) 
  * Make settings validation strict [<1>6365](https://github.com/elastic/elasticsearch/pull/16365)
  * Remove the ability to fsync on every operation and only schedule fsync task if really needed [<1>6257](https://github.com/elastic/elasticsearch/pull/16257) (issue: [<1>6152](https://github.com/elastic/elasticsearch/issues/16152)) 
  * Script settings [<1>6197](https://github.com/elastic/elasticsearch/pull/16197)
  * Remove index.flush_on_close entirely [<1>5977](https://github.com/elastic/elasticsearch/pull/15977)
  * Restore chunksize of 512kb on recovery and remove configurability [<1>5235](https://github.com/elastic/elasticsearch/pull/15235) (issue: [<1>5161](https://github.com/elastic/elasticsearch/issues/15161)) 
  * Remove ancient deprecated and alternative recovery settings [<1>5234](https://github.com/elastic/elasticsearch/pull/15234)
  * Fix ping timeout settings inconsistencies [<1>3701](https://github.com/elastic/elasticsearch/pull/13701) (issue: [<6>579](https://github.com/elastic/elasticsearch/issues/6579)) 



Similarities 
    

  * Renames `default` similarity into `classic` [<1>5446](https://github.com/elastic/elasticsearch/pull/15446) (issue: [<1>5102](https://github.com/elastic/elasticsearch/issues/15102)) 



Snapshot/Restore 
    

  * Fail closing or deleting indices during a full snapshot [<1>7021](https://github.com/elastic/elasticsearch/pull/17021) (issue: [<1>6321](https://github.com/elastic/elasticsearch/issues/16321)) 



Stats 
    

  * Modify load average format [<1>5932](https://github.com/elastic/elasticsearch/pull/15932) (issue: [<1>5907](https://github.com/elastic/elasticsearch/issues/15907)) 
  * Reintroduce five-minute and fifteen-minute load averages on Linux [<1>5907](https://github.com/elastic/elasticsearch/pull/15907) (issues: [<1>2049](https://github.com/elastic/elasticsearch/issues/12049), [<1>4741](https://github.com/elastic/elasticsearch/issues/14741)) 
  * Add system CPU percent to OS stats [<1>4741](https://github.com/elastic/elasticsearch/pull/14741)



Term Vectors 
    

  * Remove DFS support from TermVector API [<1>6452](https://github.com/elastic/elasticsearch/pull/16452)



Translog 
    

  * Drop support for simple translog and hard-wire buffer to 8kb [<1>5574](https://github.com/elastic/elasticsearch/pull/15574)
  * Simplify translog-based flush settings [<1>5573](https://github.com/elastic/elasticsearch/pull/15573)



Warmers 
    

  * Remove query warmers and the warmer API. [<1>5614](https://github.com/elastic/elasticsearch/pull/15614) (issue: [<1>5607](https://github.com/elastic/elasticsearch/issues/15607)) 



### Breaking Java changes

Aggregations 
    

  * getKeyAsString and key_as_string should be the same for terms aggregation on boolean field [<1>5393](https://github.com/elastic/elasticsearch/pull/15393)



Allocation 
    

  * Simplify shard balancer interface [<1>7028](https://github.com/elastic/elasticsearch/pull/17028) (issue: [<8>954](https://github.com/elastic/elasticsearch/issues/8954)) 



Analysis 
    

  * Simplify Analysis registration and configuration [<1>4355](https://github.com/elastic/elasticsearch/pull/14355)



Cache 
    

  * Refactor IndicesRequestCache to make it testable. [<1>6610](https://github.com/elastic/elasticsearch/pull/16610)
  * Fold IndexCacheModule into IndexModule [<1>4293](https://github.com/elastic/elasticsearch/pull/14293)



Core 
    

  * Remove es.useLinkedTransferQueue [<1>6786](https://github.com/elastic/elasticsearch/pull/16786)



Discovery 
    

  * Include pings from client nodes in master election [<1>7329](https://github.com/elastic/elasticsearch/pull/17329) (issue: [<1>7325](https://github.com/elastic/elasticsearch/issues/17325)) 



Internal 
    

  * Remove duplicate getters from DiscoveryNode and DiscoveryNodes [<1>7410](https://github.com/elastic/elasticsearch/pull/17410) (issue: [<1>6963](https://github.com/elastic/elasticsearch/issues/16963)) 
  * Cli: Switch to jopt-simple [<1>7024](https://github.com/elastic/elasticsearch/pull/17024) (issue: [<1>1564](https://github.com/elastic/elasticsearch/issues/11564)) 
  * Replace ContextAndHeaders with a ThreadPool based ThreadLocal implementation [<1>5776](https://github.com/elastic/elasticsearch/pull/15776)
  * Remove NodeBuilder [<1>5354](https://github.com/elastic/elasticsearch/pull/15354)
  * Fix IndexSearcherWrapper interface to not depend on the EngineConfig [<1>4654](https://github.com/elastic/elasticsearch/pull/14654)
  * Cleanup query parsing and remove IndexQueryParserService [<1>4452](https://github.com/elastic/elasticsearch/pull/14452)
  * Remove circular dependency between IndicesService and IndicesStore [<1>4285](https://github.com/elastic/elasticsearch/pull/14285)
  * Remove guice injection from IndexStore and friends [<1>4279](https://github.com/elastic/elasticsearch/pull/14279)
  * Replace IndicesLifecycle with a per-index IndexEventListener [<1>4217](https://github.com/elastic/elasticsearch/pull/14217) (issue: [<1>3259](https://github.com/elastic/elasticsearch/issues/13259)) 
  * Simplify similarity module and friends [<1>3942](https://github.com/elastic/elasticsearch/pull/13942)
  * Refactor SearchRequest to be parsed on the coordinating node [<1>3859](https://github.com/elastic/elasticsearch/pull/13859)



Java API 
    

  * Remove the count api [<1>4166](https://github.com/elastic/elasticsearch/pull/14166) (issue: [<1>3928](https://github.com/elastic/elasticsearch/issues/13928)) 
  * IdsQueryBuilder to accept only non null ids and types [<1>3937](https://github.com/elastic/elasticsearch/pull/13937)



Mapping 
    

  * [Mapping] Several MappingService cleanups [<1>6133](https://github.com/elastic/elasticsearch/pull/16133) (issue: [<1>5924](https://github.com/elastic/elasticsearch/issues/15924)) 



Network 
    

  * Remove ability to disable Netty gathering writes [<1>6774](https://github.com/elastic/elasticsearch/pull/16774) (issue: [<7>811](https://github.com/elastic/elasticsearch/issues/7811)) 



Parent/Child 
    

  * Cleanup ParentFieldMapper [<1>6045](https://github.com/elastic/elasticsearch/pull/16045)
  * Several other parent/child cleanups [<1>3470](https://github.com/elastic/elasticsearch/pull/13470)



Plugins 
    

  * Enforce isolated mode for all plugins [<1>7276](https://github.com/elastic/elasticsearch/pull/17276)
  * Change the inner structure of the plugins zip [<1>6453](https://github.com/elastic/elasticsearch/pull/16453)
  * Don’t use guice for QueryParsers [<1>5761](https://github.com/elastic/elasticsearch/pull/15761)
  * Remove guice from the index level [<1>4518](https://github.com/elastic/elasticsearch/pull/14518)
  * Remove shard-level injector [<1>3881](https://github.com/elastic/elasticsearch/pull/13881)



Query DSL 
    

  * Remove the MissingQueryBuilder which was deprecated in 2.2.0. [<1>5364](https://github.com/elastic/elasticsearch/pull/15364) (issue: [<1>4112](https://github.com/elastic/elasticsearch/issues/14112)) 
  * Remove NotQueryBuilder [<1>4204](https://github.com/elastic/elasticsearch/pull/14204) (issue: [<1>3761](https://github.com/elastic/elasticsearch/issues/13761)) 



Search 
    

  * Query refactoring: split parse phase into fromXContent and toQuery for all queries [<1>3788](https://github.com/elastic/elasticsearch/pull/13788) (issue: [<1>0217](https://github.com/elastic/elasticsearch/issues/10217)) 



Search Refactoring 
    

  * Refactored inner hits parsing and intoduced InnerHitBuilder [<1>7291](https://github.com/elastic/elasticsearch/pull/17291)
  * Remove deprecated parameter from field sort builder. [<1>6573](https://github.com/elastic/elasticsearch/pull/16573) (issue: [<1>6127](https://github.com/elastic/elasticsearch/issues/16127)) 
  * Remove support for query_binary and filter_binary [<1>4433](https://github.com/elastic/elasticsearch/pull/14433) (issue: [<1>4308](https://github.com/elastic/elasticsearch/issues/14308)) 
  * Validate query api: move query parsing to the coordinating node [<1>4384](https://github.com/elastic/elasticsearch/pull/14384)



Settings 
    

  * Move remaining settings in NettyHttpServerTransport to the new infra [<1>6531](https://github.com/elastic/elasticsearch/pull/16531)
  * Replace IndexSettings annotation with a full-fledged class [<1>4251](https://github.com/elastic/elasticsearch/pull/14251)



Store 
    

  * Standardize state format type for global and index level metadata [<1>7123](https://github.com/elastic/elasticsearch/pull/17123)



Suggesters 
    

  * Remove suggest threadpool [<1>7304](https://github.com/elastic/elasticsearch/pull/17304) (issue: [<1>7198](https://github.com/elastic/elasticsearch/issues/17198)) 
  * Remove suggest transport action [<1>7198](https://github.com/elastic/elasticsearch/pull/17198) (issue: [<1>0217](https://github.com/elastic/elasticsearch/issues/10217)) 



### Deprecations

Plugin Mapper Attachment 
    

  * Deprecate mapper-attachments plugin [<1>6948](https://github.com/elastic/elasticsearch/pull/16948) (issue: [<1>6910](https://github.com/elastic/elasticsearch/issues/16910)) 



Search 
    

  * Deprecate fuzzy query [<1>6211](https://github.com/elastic/elasticsearch/pull/16211) (issues: [<1>5760](https://github.com/elastic/elasticsearch/issues/15760), [<1>6121](https://github.com/elastic/elasticsearch/issues/16121)) 



### New features

Allocation 
    

  * Add API to explain why a shard is or isn’t assigned [<1>7305](https://github.com/elastic/elasticsearch/pull/17305) (issue: [<1>4593](https://github.com/elastic/elasticsearch/issues/14593)) 



Discovery 
    

  * Add two phased commit to Cluster State publishing [<1>3062](https://github.com/elastic/elasticsearch/pull/13062)



Ingest 
    

  * Merge feature/ingest branch into master branch [<1>6049](https://github.com/elastic/elasticsearch/pull/16049) (issue: [<1>4049](https://github.com/elastic/elasticsearch/issues/14049)) 



Mapping 
    

  * Add a text field. [<1>6637](https://github.com/elastic/elasticsearch/pull/16637)
  * Add a new `keyword` field. [<1>6589](https://github.com/elastic/elasticsearch/pull/16589)



Percolator 
    

  * index the query terms from the percolator query [<1>3646](https://github.com/elastic/elasticsearch/pull/13646) (issue: [<1>2664](https://github.com/elastic/elasticsearch/issues/12664)) 



Plugin Ingest Attachment 
    

  * Ingest: Add attachment processor [<1>6490](https://github.com/elastic/elasticsearch/pull/16490) (issue: [<1>6303](https://github.com/elastic/elasticsearch/issues/16303)) 



Plugin Mapper Attachment 
    

  * Migrate mapper attachments plugin to main repository [<1>4605](https://github.com/elastic/elasticsearch/pull/14605)



Plugin Repository HDFS 
    

  * HDFS Snapshot/Restore plugin [<1>5192](https://github.com/elastic/elasticsearch/pull/15192) (issue: [<1>5191](https://github.com/elastic/elasticsearch/issues/15191)) 



Query DSL 
    

  * Adds a rewrite phase to queries on the shard level [<1>6870](https://github.com/elastic/elasticsearch/pull/16870) (issue: [<9>526](https://github.com/elastic/elasticsearch/issues/9526)) 



Reindex API 
    

  * Merge reindex to master [<1>6861](https://github.com/elastic/elasticsearch/pull/16861)



Scripting 
    

  * Exceptions and Infinite Loop Checking [<1>5936](https://github.com/elastic/elasticsearch/pull/15936)
  * Added a new scripting language (PlanA) [<1>5136](https://github.com/elastic/elasticsearch/pull/15136) (issue: [<1>3084](https://github.com/elastic/elasticsearch/issues/13084)) 



Search 
    

  * Add `search_after` parameter in the SearchAPI [<1>6125](https://github.com/elastic/elasticsearch/pull/16125) (issue: [<8>192](https://github.com/elastic/elasticsearch/issues/8192)) 



Settings 
    

  * Add infrastructure to transactionally apply and reset dynamic settings [<1>5278](https://github.com/elastic/elasticsearch/pull/15278)



Stats 
    

  * API for listing index file sizes [<1>6661](https://github.com/elastic/elasticsearch/pull/16661) (issue: [<1>6131](https://github.com/elastic/elasticsearch/issues/16131)) 



Suggesters 
    

  * Add document-oriented completion suggester [<1>4410](https://github.com/elastic/elasticsearch/pull/14410) (issue: [<1>0746](https://github.com/elastic/elasticsearch/issues/10746)) 



Task Manager 
    

  * Add task cancellation mechanism [<1>6320](https://github.com/elastic/elasticsearch/pull/16320)
  * Make the Task object available to the action caller [<1>6033](https://github.com/elastic/elasticsearch/pull/16033)
  * Task Management: Add framework for registering and communicating with tasks [<1>5347](https://github.com/elastic/elasticsearch/pull/15347) (issue: [<1>5117](https://github.com/elastic/elasticsearch/issues/15117)) 



### Enhancements

Aggregations 
    

  * Add tests and documentation for using `time_zone` in date range aggregation [<1>6955](https://github.com/elastic/elasticsearch/pull/16955) (issue: [<1>0130](https://github.com/elastic/elasticsearch/issues/10130)) 
  * Fixes serialisation of Ranges [<1>6674](https://github.com/elastic/elasticsearch/pull/16674)



Allocation 
    

  * Write shard state metadata as soon as shard is created / initializing [<1>6625](https://github.com/elastic/elasticsearch/pull/16625) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Reuse existing allocation id for primary shard allocation [<1>6530](https://github.com/elastic/elasticsearch/pull/16530) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Remove version in ShardRouting (now obsolete) [<1>6243](https://github.com/elastic/elasticsearch/pull/16243) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Prefer nodes that previously held primary shard for primary shard allocation [<1>6096](https://github.com/elastic/elasticsearch/pull/16096) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Extend reroute with an option to force assign stale primary shard copies [<1>5708](https://github.com/elastic/elasticsearch/pull/15708) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Allocate primary shards based on allocation IDs [<1>5281](https://github.com/elastic/elasticsearch/pull/15281) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Persist currently started allocation IDs to index metadata [<1>4964](https://github.com/elastic/elasticsearch/pull/14964) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Use ObjectParser to parse AllocationID [<1>4962](https://github.com/elastic/elasticsearch/pull/14962) (issue: [<1>4831](https://github.com/elastic/elasticsearch/issues/14831)) 
  * Persist allocation ID with shard state metadata on nodes [<1>4831](https://github.com/elastic/elasticsearch/pull/14831) (issue: [<1>4739](https://github.com/elastic/elasticsearch/issues/14739)) 



Analysis 
    

  * Improve error message if resource files have illegal encoding [<1>7237](https://github.com/elastic/elasticsearch/pull/17237) (issue: [<1>7212](https://github.com/elastic/elasticsearch/issues/17212)) 



CAT API 
    

  * Expose http address in cat/nodes [<1>6770](https://github.com/elastic/elasticsearch/pull/16770)
  * [cat/recovery] Make recovery time a TimeValue() [<1>6743](https://github.com/elastic/elasticsearch/pull/16743) (issue: [<9>209](https://github.com/elastic/elasticsearch/issues/9209)) 
  * :CAT API: remove space at the end of a line [<1>5250](https://github.com/elastic/elasticsearch/pull/15250) (issue: [<9>464](https://github.com/elastic/elasticsearch/issues/9464)) 



CRUD 
    

  * CRUD: Allow to get and set ttl as a time value/string [<1>5047](https://github.com/elastic/elasticsearch/pull/15047)



Cache 
    

  * Enable the indices request cache by default [<1>7162](https://github.com/elastic/elasticsearch/pull/17162) (issues: [<1>6870](https://github.com/elastic/elasticsearch/issues/16870), [<1>7134](https://github.com/elastic/elasticsearch/issues/17134)) 



Cluster 
    

  * Cluster Health should run on applied states, even if waitFor=0 [<1>7440](https://github.com/elastic/elasticsearch/pull/17440)
  * Resolve index names to Index instances early [<1>7048](https://github.com/elastic/elasticsearch/pull/17048)
  * Remove DiscoveryNode#shouldConnectTo method [<1>6898](https://github.com/elastic/elasticsearch/pull/16898) (issue: [<1>6815](https://github.com/elastic/elasticsearch/issues/16815)) 
  * Fail demoted primary shards and retry request [<1>6415](https://github.com/elastic/elasticsearch/pull/16415) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Illegal shard failure requests [<1>6275](https://github.com/elastic/elasticsearch/pull/16275)
  * Shard failure requests for non-existent shards [<1>6089](https://github.com/elastic/elasticsearch/pull/16089) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Add handling of channel failures when starting a shard [<1>6041](https://github.com/elastic/elasticsearch/pull/16041) (issue: [<1>5895](https://github.com/elastic/elasticsearch/issues/15895)) 
  * Wait for new master when failing shard [<1>5748](https://github.com/elastic/elasticsearch/pull/15748) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Master should wait on cluster state publication when failing a shard [<1>5468](https://github.com/elastic/elasticsearch/pull/15468) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Split cluster state update tasks into roles [<1>4899](https://github.com/elastic/elasticsearch/pull/14899) (issue: [<1>3627](https://github.com/elastic/elasticsearch/issues/13627)) 
  * Add timeout mechanism for sending shard failures [<1>4707](https://github.com/elastic/elasticsearch/pull/14707) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Add listener mechanism for failures to send shard failed [<1>4295](https://github.com/elastic/elasticsearch/pull/14295) (issue: [<1>4252](https://github.com/elastic/elasticsearch/issues/14252)) 



Core 
    

  * Remove PROTOTYPE from BulkItemResponse.Failure [<1>7433](https://github.com/elastic/elasticsearch/pull/17433) (issue: [<1>7086](https://github.com/elastic/elasticsearch/issues/17086)) 
  * Throw an exception if Writeable.Reader reads null [<1>7332](https://github.com/elastic/elasticsearch/pull/17332)
  * Remove PROTOTYPE from RescorerBuilders [<1>7330](https://github.com/elastic/elasticsearch/pull/17330)
  * Port Primary Terms to master [<1>7044](https://github.com/elastic/elasticsearch/pull/17044) (issues: [<1>4062](https://github.com/elastic/elasticsearch/issues/14062), [<1>4651](https://github.com/elastic/elasticsearch/issues/14651), [<1>7038](https://github.com/elastic/elasticsearch/issues/17038)) 
  * Use index UUID to lookup indices on IndicesService [<1>7001](https://github.com/elastic/elasticsearch/pull/17001)
  * Add -XX+AlwaysPreTouch JVM flag [<1>6937](https://github.com/elastic/elasticsearch/pull/16937)
  * Add max size virtual memory check [<1>6935](https://github.com/elastic/elasticsearch/pull/16935)
  * Use and test relative time in TransportBulkAction [<1>6916](https://github.com/elastic/elasticsearch/pull/16916)
  * Bump Elasticsearch version to 5.0.0-SNAPSHOT [<1>6862](https://github.com/elastic/elasticsearch/pull/16862)
  * Assert that we can write in all data-path on startup [<1>6745](https://github.com/elastic/elasticsearch/pull/16745)
  * Add G1GC check on startup [<1>6737](https://github.com/elastic/elasticsearch/pull/16737) (issue: [<1>0740](https://github.com/elastic/elasticsearch/issues/10740)) 
  * Shards with heavy indexing should get more of the indexing buffer [<1>4121](https://github.com/elastic/elasticsearch/pull/14121)
  * Remove and ban ImmutableMap [<1>3939](https://github.com/elastic/elasticsearch/pull/13939) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Finish banning ImmutableSet [<1>3820](https://github.com/elastic/elasticsearch/pull/13820) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Removes and bans ImmutableSet [<1>3754](https://github.com/elastic/elasticsearch/pull/13754) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and ban ImmutableMap#entrySet [<1>3724](https://github.com/elastic/elasticsearch/pull/13724)
  * Forbid ForwardingSet [<1>3720](https://github.com/elastic/elasticsearch/pull/13720) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 



Discovery 
    

  * Add a dedicate queue for incoming ClusterStates [<1>3303](https://github.com/elastic/elasticsearch/pull/13303) (issue: [<1>3062](https://github.com/elastic/elasticsearch/issues/13062)) 



Engine 
    

  * Remove writeLockTimeout from InternalEngine [<1>6930](https://github.com/elastic/elasticsearch/pull/16930)
  * Don’t guard IndexShard#refresh calls by a check to isRefreshNeeded [<1>6118](https://github.com/elastic/elasticsearch/pull/16118)
  * Never call a listerner under lock in InternalEngine [<1>5786](https://github.com/elastic/elasticsearch/pull/15786)
  * Use System.nanoTime() to initialize Engine.lastWriteNanos [<1>4321](https://github.com/elastic/elasticsearch/pull/14321)
  * Flush big merges automatically if shard is inactive [<1>4275](https://github.com/elastic/elasticsearch/pull/14275)
  * Remove Engine.Create [<1>3955](https://github.com/elastic/elasticsearch/pull/13955)
  * Remove the disabled autogenerated id optimization from InternalEngine [<1>3857](https://github.com/elastic/elasticsearch/pull/13857)



Exceptions 
    

  * Fix typos in exception/assert/log messages in core module. [<1>6649](https://github.com/elastic/elasticsearch/pull/16649)
  * Add field names to several mapping errors [<1>6508](https://github.com/elastic/elasticsearch/pull/16508) (issue: [<1>6378](https://github.com/elastic/elasticsearch/issues/16378)) 
  * Add serialization support for more important IOExceptions [<1>5766](https://github.com/elastic/elasticsearch/pull/15766)
  * Adds exception objects to log messages. [<1>4827](https://github.com/elastic/elasticsearch/pull/14827) (issue: [<1>0021](https://github.com/elastic/elasticsearch/issues/10021)) 
  * Add stack traces to logged exceptions where missing [<1>3825](https://github.com/elastic/elasticsearch/pull/13825) (issue: [<1>0021](https://github.com/elastic/elasticsearch/issues/10021)) 
  * Remove reflection hacks from ElasticsearchException [<1>3796](https://github.com/elastic/elasticsearch/pull/13796)
  * Rename QueryParsingException to a more generic ParsingException [<1>3631](https://github.com/elastic/elasticsearch/pull/13631)
  * Add *Exception(Throwable cause) constructors/ call where appropriate [<1>3544](https://github.com/elastic/elasticsearch/pull/13544) (issue: [<1>0021](https://github.com/elastic/elasticsearch/issues/10021)) 



Geo 
    

  * Fix a potential parsing problem in GeoDistanceSortParser [<1>7111](https://github.com/elastic/elasticsearch/pull/17111)
  * Geo: Add validation of shapes to ShapeBuilders [<1>5551](https://github.com/elastic/elasticsearch/pull/15551) (issue: [<1>4416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Make remaining ShapeBuilders implement Writeable [<1>5010](https://github.com/elastic/elasticsearch/pull/15010) (issue: [<1>4416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Geo: Remove internal `translated` flag from LineStringBuilder [<1>4969](https://github.com/elastic/elasticsearch/pull/14969)
  * Make PointBuilder, CircleBuilder  & EnvelopeBuilder implement Writable [<1>4933](https://github.com/elastic/elasticsearch/pull/14933) (issue: [<1>4416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Merging BaseLineString and BasePolygonBuilder with subclass [<1>4887](https://github.com/elastic/elasticsearch/pull/14887) (issue: [<1>4482](https://github.com/elastic/elasticsearch/issues/14482)) 
  * Moving static factory methods to ShapeBuilders [<1>4529](https://github.com/elastic/elasticsearch/pull/14529)
  * Remove InternalLineStringBuilder and InternalPolygonBuilder [<1>4482](https://github.com/elastic/elasticsearch/pull/14482) (issue: [<1>4416](https://github.com/elastic/elasticsearch/issues/14416)) 



Highlighting 
    

  * Switch Highlighting to ObjectParser [<1>7363](https://github.com/elastic/elasticsearch/pull/17363)
  * Use HighlightBuilder in SearchSourceBuilder [<1>5376](https://github.com/elastic/elasticsearch/pull/15376) (issue: [<1>5044](https://github.com/elastic/elasticsearch/issues/15044)) 
  * Joint parsing of common global Hightlighter and subfield parameters [<1>5368](https://github.com/elastic/elasticsearch/pull/15368) (issue: [<1>5285](https://github.com/elastic/elasticsearch/issues/15285)) 
  * Enable HighlightBuilder to create SearchContextHighlight [<1>5324](https://github.com/elastic/elasticsearch/pull/15324)
  * Add fromXContent method to HighlightBuilder [<1>5157](https://github.com/elastic/elasticsearch/pull/15157)



Ingest 
    

  * add automatic type conversion support to ConvertProcessor [<1>7263](https://github.com/elastic/elasticsearch/pull/17263) (issue: [<1>7139](https://github.com/elastic/elasticsearch/issues/17139)) 
  * Give the foreach processor access to the rest of the document [<1>7172](https://github.com/elastic/elasticsearch/pull/17172) (issue: [<1>7147](https://github.com/elastic/elasticsearch/issues/17147)) 
  * Added ingest statistics to node stats API [<1>6915](https://github.com/elastic/elasticsearch/pull/16915)
  * Add `ingest_took` to bulk response [<1>6876](https://github.com/elastic/elasticsearch/pull/16876)
  * Add ingest info to node info API, which contains a list of available processors [<1>6865](https://github.com/elastic/elasticsearch/pull/16865)
  * Use diffs for ingest metadata in cluster state [<1>6847](https://github.com/elastic/elasticsearch/pull/16847)
  * hide null-valued metadata fields from WriteableIngestDocument#toXContent [<1>6557](https://github.com/elastic/elasticsearch/pull/16557)
  * Ingest: use bulk thread pool for bulk request processing (was index before) [<1>6539](https://github.com/elastic/elasticsearch/pull/16539) (issue: [<1>6503](https://github.com/elastic/elasticsearch/issues/16503)) 
  * Add foreach processor [<1>6432](https://github.com/elastic/elasticsearch/pull/16432)
  * revert PipelineFactoryError handling with throwing ElasticsearchParseException in ingest pipeline creation [<1>6355](https://github.com/elastic/elasticsearch/pull/16355)
  * Add processor tags to on_failure metadata in ingest pipeline [<1>6324](https://github.com/elastic/elasticsearch/pull/16324) (issue: [<1>6202](https://github.com/elastic/elasticsearch/issues/16202)) 
  * catch processor/pipeline factory exceptions and return structured error responses [<1>6276](https://github.com/elastic/elasticsearch/pull/16276) (issue: [<1>6010](https://github.com/elastic/elasticsearch/issues/16010)) 
  * Ingest: move get/put/delete pipeline methods to ClusterAdminClient [<1>6242](https://github.com/elastic/elasticsearch/pull/16242)
  * Geoip processor: remove redundant latitude and longitude fields and make location an object with lat and lon subfields [<1>6173](https://github.com/elastic/elasticsearch/pull/16173)



Internal 
    

  * Remove PROTOTYPE from MLT.Item [<1>7481](https://github.com/elastic/elasticsearch/pull/17481) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPE from VersionType [<1>7480](https://github.com/elastic/elasticsearch/pull/17480) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPEs from highlighting [<1>7466](https://github.com/elastic/elasticsearch/pull/17466) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPEs from ingest [<1>7434](https://github.com/elastic/elasticsearch/pull/17434) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Start to rework query registration [<1>7424](https://github.com/elastic/elasticsearch/pull/17424)
  * Factor out slow logs into Search and IndexingOperationListeners [<1>7398](https://github.com/elastic/elasticsearch/pull/17398)
  * Remove PROTOTYPE from Suggesters [<1>7370](https://github.com/elastic/elasticsearch/pull/17370)
  * Remove PROTOTYPE from SortBuilders [<1>7337](https://github.com/elastic/elasticsearch/pull/17337) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPE from ShapeBuilders [<1>7336](https://github.com/elastic/elasticsearch/pull/17336) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Replace FieldStatsProvider with a method on MappedFieldType. [<1>7334](https://github.com/elastic/elasticsearch/pull/17334)
  * Stop using PROTOTYPE in NamedWriteableRegistry [<1>7284](https://github.com/elastic/elasticsearch/pull/17284) (issue: [<1>7085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Support scheduled commands in current context [<1>7077](https://github.com/elastic/elasticsearch/pull/17077)
  * Thread limits [<1>7003](https://github.com/elastic/elasticsearch/pull/17003)
  * Remove leniency from segments info integrity checks [<1>6985](https://github.com/elastic/elasticsearch/pull/16985) (issue: [<1>6973](https://github.com/elastic/elasticsearch/issues/16973)) 
  * Rename SearchServiceTransportAction to SearchTransportService [<1>6880](https://github.com/elastic/elasticsearch/pull/16880)
  * Decouple the TransportService and ClusterService [<1>6872](https://github.com/elastic/elasticsearch/pull/16872) (issue: [<1>6788](https://github.com/elastic/elasticsearch/issues/16788)) 
  * Refactor bootstrap checks [<1>6844](https://github.com/elastic/elasticsearch/pull/16844) (issues: [<1>6733](https://github.com/elastic/elasticsearch/issues/16733), [<1>6835](https://github.com/elastic/elasticsearch/issues/16835)) 
  * Add LifecycleRunnable [<1>6752](https://github.com/elastic/elasticsearch/pull/16752)
  * Hot inlined methods in your area [<1>6725](https://github.com/elastic/elasticsearch/pull/16725)
  * Move IndicesQueryCache and IndicesRequestCache into IndicesService [<1>6603](https://github.com/elastic/elasticsearch/pull/16603)
  * Forbid use of java.security.MessageDigest#clone() [<1>6543](https://github.com/elastic/elasticsearch/pull/16543) (issue: [<1>6479](https://github.com/elastic/elasticsearch/issues/16479)) 
  * Make IndicesWarmer a private class of IndexService [<1>6470](https://github.com/elastic/elasticsearch/pull/16470)
  * Simplify IndicesFieldDataCache and detach from guice [<1>6469](https://github.com/elastic/elasticsearch/pull/16469)
  * Uppercase ells ( _L_ ) in long literals [<1>6329](https://github.com/elastic/elasticsearch/pull/16329) (issue: [<1>6279](https://github.com/elastic/elasticsearch/issues/16279)) 
  * ShardId equality and hash code inconsistency [<1>6319](https://github.com/elastic/elasticsearch/pull/16319) (issue: [<1>6217](https://github.com/elastic/elasticsearch/issues/16217)) 
  * Ensure all resources are closed on Node#close() [<1>6316](https://github.com/elastic/elasticsearch/pull/16316) (issue: [<1>3685](https://github.com/elastic/elasticsearch/issues/13685)) 
  * Make index uuid available in Index, ShardRouting & ShardId [<1>6217](https://github.com/elastic/elasticsearch/pull/16217)
  * Move RefreshTask into IndexService and use since task per index [<1>5933](https://github.com/elastic/elasticsearch/pull/15933)
  * Make IndexingMemoryController private to IndicesService [<1>5877](https://github.com/elastic/elasticsearch/pull/15877)
  * Cleanup IndexingOperationListeners infrastructure [<1>5875](https://github.com/elastic/elasticsearch/pull/15875)
  * Remove and forbid use of j.u.c.ThreadLocalRandom [<1>5862](https://github.com/elastic/elasticsearch/pull/15862) (issue: [<1>5294](https://github.com/elastic/elasticsearch/issues/15294)) 
  * Fix IntelliJ query builder type inference issues [<1>5429](https://github.com/elastic/elasticsearch/pull/15429)
  * Remove and forbid use of Collections#shuffle(List) and Random#<init>() [<1>5299](https://github.com/elastic/elasticsearch/pull/15299) (issue: [<1>5287](https://github.com/elastic/elasticsearch/issues/15287)) 
  * Remove and forbid use of the type-unsafe empty Collections fields [<1>5187](https://github.com/elastic/elasticsearch/pull/15187)
  * Move IndicesService.canDeleteShardContent to use IndexSettings [<1>5150](https://github.com/elastic/elasticsearch/pull/15150) (issue: [<1>5059](https://github.com/elastic/elasticsearch/issues/15059)) 
  * Simplify MonitorService construction and detach from guice [<1>5035](https://github.com/elastic/elasticsearch/pull/15035)
  * Use Supplier for StreamInput#readOptionalStreamable [<1>4806](https://github.com/elastic/elasticsearch/pull/14806)
  * Add variable-length long encoding [<1>4780](https://github.com/elastic/elasticsearch/pull/14780)
  * Extend usage of IndexSetting class [<1>4731](https://github.com/elastic/elasticsearch/pull/14731) (issue: [<1>4251](https://github.com/elastic/elasticsearch/issues/14251)) 
  * Fold SimilarityModule into IndexModule [<1>4284](https://github.com/elastic/elasticsearch/pull/14284)
  * Move to lucene BoostQuery [<1>4264](https://github.com/elastic/elasticsearch/pull/14264)
  * Use built-in method for computing hash code of longs [<1>4213](https://github.com/elastic/elasticsearch/pull/14213)
  * Refactor ShardFailure listener infrastructure [<1>4206](https://github.com/elastic/elasticsearch/pull/14206)
  * Add methods for variable-length encoding integral arrays [<1>4087](https://github.com/elastic/elasticsearch/pull/14087)
  * Fold IndexAliasesService into IndexService [<1>4044](https://github.com/elastic/elasticsearch/pull/14044)
  * Remove unneeded Module abstractions [<1>3944](https://github.com/elastic/elasticsearch/pull/13944)
  * Query refactoring: simplify IndexQueryParserService parse methods [<1>3938](https://github.com/elastic/elasticsearch/pull/13938) (issue: [<1>3859](https://github.com/elastic/elasticsearch/issues/13859)) 
  * Remove and forbid use of com.google.common.collect.Iterators [<1>3916](https://github.com/elastic/elasticsearch/pull/13916) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.ImmutableCollection [<1>3909](https://github.com/elastic/elasticsearch/pull/13909) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.io.Resources [<1>3908](https://github.com/elastic/elasticsearch/pull/13908) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.hash.* [<1>3907](https://github.com/elastic/elasticsearch/pull/13907) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.net.InetAddresses [<1>3905](https://github.com/elastic/elasticsearch/pull/13905) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.EvictingQueue [<1>3903](https://github.com/elastic/elasticsearch/pull/13903) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace Guava cache with simple concurrent LRU cache [<1>3879](https://github.com/elastic/elasticsearch/pull/13879)
  * Remove ClusterSerivce and IndexSettingsService dependency from IndexShard [<1>3853](https://github.com/elastic/elasticsearch/pull/13853)
  * Start making RecoverySourceHandler unittestable [<1>3840](https://github.com/elastic/elasticsearch/pull/13840)
  * Remove IndexService dep. from IndexShard [<1>3797](https://github.com/elastic/elasticsearch/pull/13797)
  * Remove ES internal deletion policies in favour of Lucenes implementations [<1>3794](https://github.com/elastic/elasticsearch/pull/13794)
  * Move ShardTermVectorService to be on indices level as TermVectorService [<1>3786](https://github.com/elastic/elasticsearch/pull/13786)
  * Move ShardPercolateService creation into IndexShard [<1>3777](https://github.com/elastic/elasticsearch/pull/13777)
  * Remove `ExpressionScriptCompilationException` and `ExpressionScriptExecutionException` [<1>3742](https://github.com/elastic/elasticsearch/pull/13742)
  * Reduced the number of ClusterStateUpdateTask variants [<1>3735](https://github.com/elastic/elasticsearch/pull/13735)
  * Add a BaseParser helper for stream parsing [<1>3615](https://github.com/elastic/elasticsearch/pull/13615)
  * Remove and forbid use of com.google.common.primitives.Ints [<1>3596](https://github.com/elastic/elasticsearch/pull/13596) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.math.LongMath [<1>3575](https://github.com/elastic/elasticsearch/pull/13575) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.base.Joiner [<1>3572](https://github.com/elastic/elasticsearch/pull/13572) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace and ban next batch of Guava classes [<1>3562](https://github.com/elastic/elasticsearch/pull/13562) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Iterables [<1>3559](https://github.com/elastic/elasticsearch/pull/13559) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace LoadingCache usage with a simple ConcurrentHashMap [<1>3552](https://github.com/elastic/elasticsearch/pull/13552) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Use Supplier instead of Reflection [<1>3545](https://github.com/elastic/elasticsearch/pull/13545)
  * Remove and forbid use of com.google.common.base.Preconditions [<1>3540](https://github.com/elastic/elasticsearch/pull/13540) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of guava Function, Charsets, Collections2 [<1>3533](https://github.com/elastic/elasticsearch/pull/13533) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.ImmutableSortedMap [<1>3525](https://github.com/elastic/elasticsearch/pull/13525) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of several com.google.common.util. classes [<1>3524](https://github.com/elastic/elasticsearch/pull/13524) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Cleanup SearchRequest & SearchRequestBuilder [<1>3518](https://github.com/elastic/elasticsearch/pull/13518)
  * Remove and forbid use of com.google.common.collect.Queues [<1>3498](https://github.com/elastic/elasticsearch/pull/13498) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.base.Preconditions#checkNotNull [<1>3493](https://github.com/elastic/elasticsearch/pull/13493) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Sets [<1>3463](https://github.com/elastic/elasticsearch/pull/13463) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Maps [<1>3438](https://github.com/elastic/elasticsearch/pull/13438) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove use of underscore as an identifier [<1>3353](https://github.com/elastic/elasticsearch/pull/13353)
  * Remove and forbid the use of com.google.common.base.Predicate(s)? [<1>3349](https://github.com/elastic/elasticsearch/pull/13349) (issues: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224), [<1>3314](https://github.com/elastic/elasticsearch/issues/13314)) 
  * This commit removes com.google.common.io [<1>3302](https://github.com/elastic/elasticsearch/pull/13302) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 



Java API 
    

  * Remove copy constructors from request classes and TransportMessage type [<1>6640](https://github.com/elastic/elasticsearch/pull/16640) (issue: [<1>5776](https://github.com/elastic/elasticsearch/issues/15776)) 



Mapping 
    

  * Add a soft limit on the mapping depth. [<1>7400](https://github.com/elastic/elasticsearch/pull/17400)
  * Disable fielddata on text fields by defaults. [<1>7386](https://github.com/elastic/elasticsearch/pull/17386)
  * Add limit to total number of fields in mapping [<1>7357](https://github.com/elastic/elasticsearch/pull/17357)
  * Make `parseMultiField` part of `parseField`. [<1>7313](https://github.com/elastic/elasticsearch/pull/17313)
  * Automatically add a sub keyword field to string dynamic mappings. [<1>7188](https://github.com/elastic/elasticsearch/pull/17188)
  * Remove friction from the mapping changes in 5.0. [<1>6991](https://github.com/elastic/elasticsearch/pull/16991)
  * Rework norms parameters for 5.0. [<1>6987](https://github.com/elastic/elasticsearch/pull/16987)
  * Moved dynamic field handling in doc parsing to end of parsing [<1>6798](https://github.com/elastic/elasticsearch/pull/16798)
  * Remove the MapperBuilders utility class. [<1>6609](https://github.com/elastic/elasticsearch/pull/16609)
  * Make the `index` property a boolean. [<1>6161](https://github.com/elastic/elasticsearch/pull/16161)
  * Remove the ability to enable doc values with the `fielddata.format` setting. [<1>6147](https://github.com/elastic/elasticsearch/pull/16147)
  * Be stricter about parsing boolean values in mappings. [<1>6146](https://github.com/elastic/elasticsearch/pull/16146)
  * Fix default doc values to be enabled when a field is not indexed. [<1>6141](https://github.com/elastic/elasticsearch/pull/16141)
  * Dynamically map floating-point numbers as floats instead of doubles. [<1>5319](https://github.com/elastic/elasticsearch/pull/15319) (issue: [<1>3851](https://github.com/elastic/elasticsearch/issues/13851)) 
  * Simplify MetaDataMappingService. [<1>5217](https://github.com/elastic/elasticsearch/pull/15217)
  * Remove MergeMappingException. [<1>5177](https://github.com/elastic/elasticsearch/pull/15177)



Packaging 
    

  * Added RPM metadata [<1>7477](https://github.com/elastic/elasticsearch/pull/17477)
  * Elasticsearch ownership for data, logs, and configs [<1>7197](https://github.com/elastic/elasticsearch/pull/17197) (issue: [<1>2688](https://github.com/elastic/elasticsearch/issues/12688)) 
  * Fail early on JDK with compiler bug [<1>6418](https://github.com/elastic/elasticsearch/pull/16418) (issues: [<1>6097](https://github.com/elastic/elasticsearch/issues/16097), [<1>6362](https://github.com/elastic/elasticsearch/issues/16362)) 
  * Make security non-optional [<1>6176](https://github.com/elastic/elasticsearch/pull/16176)
  * Remove RuntimePermission("accessDeclaredMembers") [<1>5378](https://github.com/elastic/elasticsearch/pull/15378)
  * Remove Guava as a dependency [<1>4055](https://github.com/elastic/elasticsearch/pull/14055) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove Guava as a dependency [<1>4054](https://github.com/elastic/elasticsearch/pull/14054) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 



Percolator 
    

  * Add scoring support to the percolator query [<1>7385](https://github.com/elastic/elasticsearch/pull/17385) (issue: [<1>3827](https://github.com/elastic/elasticsearch/issues/13827)) 
  * Add query extract support for the blended term query and the common terms query [<1>7347](https://github.com/elastic/elasticsearch/pull/17347)
  * Add support for several span queries in ExtractQueryTermsService [<1>7323](https://github.com/elastic/elasticsearch/pull/17323)
  * Add support for TermsQuery in ExtractQueryTermsService [<1>7316](https://github.com/elastic/elasticsearch/pull/17316)
  * Replace percolate APIs with a percolator query [<1>6349](https://github.com/elastic/elasticsearch/pull/16349) (issues: [<1>0741](https://github.com/elastic/elasticsearch/issues/10741), [<1>1264](https://github.com/elastic/elasticsearch/issues/11264), [<1>3176](https://github.com/elastic/elasticsearch/issues/13176), [<1>3978](https://github.com/elastic/elasticsearch/issues/13978), [<4>317](https://github.com/elastic/elasticsearch/issues/4317), [<7>297](https://github.com/elastic/elasticsearch/issues/7297)) 



Plugin Analysis Kuromoji 
    

  * Add nbest options and NumberFilter [<1>7173](https://github.com/elastic/elasticsearch/pull/17173)



Plugin Discovery EC2 
    

  * Add support for proxy authentication for s3 and ec2 [<1>5293](https://github.com/elastic/elasticsearch/pull/15293) (issue: [<1>5268](https://github.com/elastic/elasticsearch/issues/15268)) 



Plugin Ingest Attachment 
    

  * Minor attachment processor improvements [<1>6574](https://github.com/elastic/elasticsearch/pull/16574)



Plugin Lang Painless 
    

  * Painless Clean Up [<1>7428](https://github.com/elastic/elasticsearch/pull/17428)
  * Make Painless a Module [<1>6755](https://github.com/elastic/elasticsearch/pull/16755)
  * Minor Clean up [<1>6457](https://github.com/elastic/elasticsearch/pull/16457)
  * Remove Extra String Concat Token [<1>6382](https://github.com/elastic/elasticsearch/pull/16382)



Plugin Mapper Attachment 
    

  * minor attachments cleanups: IDE test support and EPUB format [<1>4626](https://github.com/elastic/elasticsearch/pull/14626)



Plugin Repository Azure 
    

  * Support global `repositories.azure.` settings [<1>5141](https://github.com/elastic/elasticsearch/pull/15141) (issue: [<1>3776](https://github.com/elastic/elasticsearch/issues/13776)) 
  * Add timeout settings (default to 5 minutes) [<1>5080](https://github.com/elastic/elasticsearch/pull/15080) (issue: [<1>4277](https://github.com/elastic/elasticsearch/issues/14277)) 
  * Remove AbstractLegacyBlobContainer [<1>4650](https://github.com/elastic/elasticsearch/pull/14650) (issue: [<1>3434](https://github.com/elastic/elasticsearch/issues/13434)) 



Plugin Repository HDFS 
    

  * merge current hdfs improvements to master [<1>5588](https://github.com/elastic/elasticsearch/pull/15588)



Plugin Repository S3 
    

  * Check that S3 setting `buffer_size` is always lower than `chunk_size` [<1>7274](https://github.com/elastic/elasticsearch/pull/17274) (issue: [<1>7244](https://github.com/elastic/elasticsearch/issues/17244)) 



Plugins 
    

  * PluginManager: Add xpack as official plugin [<1>7227](https://github.com/elastic/elasticsearch/pull/17227)
  * CliTool: Cleanup and document Terminal [<1>6443](https://github.com/elastic/elasticsearch/pull/16443)
  * Plugin cli: Improve maven coordinates detection [<1>6384](https://github.com/elastic/elasticsearch/pull/16384) (issue: [<1>6376](https://github.com/elastic/elasticsearch/issues/16376)) 
  * Enforce plugin zip does not contain zip entries outside of the plugin dir [<1>6361](https://github.com/elastic/elasticsearch/pull/16361)
  * CliTool: Allow unexpected exceptions to propagate [<1>6359](https://github.com/elastic/elasticsearch/pull/16359)
  * Reduce complexity of plugin cli [<1>6336](https://github.com/elastic/elasticsearch/pull/16336)
  * Remove Plugin.onIndexService. [<1>5029](https://github.com/elastic/elasticsearch/pull/15029) (issue: [<1>4896](https://github.com/elastic/elasticsearch/issues/14896)) 
  * Open up QueryCache and SearcherWrapper extension points [<1>4303](https://github.com/elastic/elasticsearch/pull/14303)



Query DSL 
    

  * An `exists` query on an object should query a single term. [<1>7186](https://github.com/elastic/elasticsearch/pull/17186) (issue: [<1>7131](https://github.com/elastic/elasticsearch/issues/17131)) 
  * Function Score Query: make parsing stricter [<1>6617](https://github.com/elastic/elasticsearch/pull/16617) (issue: [<1>6583](https://github.com/elastic/elasticsearch/issues/16583)) 
  * Parsers should throw exception on unknown objects [<1>4255](https://github.com/elastic/elasticsearch/pull/14255) (issue: [<1>0974](https://github.com/elastic/elasticsearch/issues/10974)) 
  * UNICODE_CHARACTER_CLASS fix [<1>1598](https://github.com/elastic/elasticsearch/pull/11598) (issue: [<1>0146](https://github.com/elastic/elasticsearch/issues/10146)) 



Query Refactoring 
    

  * Add infrastructure to rewrite query builders [<1>6599](https://github.com/elastic/elasticsearch/pull/16599)
  * Switch geo validation to enum [<1>3672](https://github.com/elastic/elasticsearch/pull/13672) (issue: [<1>3608](https://github.com/elastic/elasticsearch/issues/13608)) 



REST 
    

  * More robust handling of CORS HTTP Access Control [<1>6092](https://github.com/elastic/elasticsearch/pull/16092)
  * Add option to exclude based on paths in XContent [<1>6017](https://github.com/elastic/elasticsearch/pull/16017)



Recovery 
    

  * Recover broken IndexMetaData as closed [<1>7187](https://github.com/elastic/elasticsearch/pull/17187)
  * Relocation source should be marked as relocating before starting recovery to primary relocation target [<1>6500](https://github.com/elastic/elasticsearch/pull/16500)
  * Operation counter for IndexShard [<1>5956](https://github.com/elastic/elasticsearch/pull/15956) (issue: [<1>5900](https://github.com/elastic/elasticsearch/issues/15900)) 
  * Primary relocation handoff [<1>5900](https://github.com/elastic/elasticsearch/pull/15900) (issue: [<1>5532](https://github.com/elastic/elasticsearch/issues/15532)) 
  * Remove recovery threadpools and throttle outgoing recoveries on the master [<1>5372](https://github.com/elastic/elasticsearch/pull/15372)
  * Refactor StoreRecoveryService to be a simple package private util class [<1>3766](https://github.com/elastic/elasticsearch/pull/13766)



Reindex API 
    

  * Make reindex throttling dynamic [<1>7262](https://github.com/elastic/elasticsearch/pull/17262)
  * Throttling support for reindex [<1>7039](https://github.com/elastic/elasticsearch/pull/17039)
  * Add ingest pipeline support to reindex [<1>6932](https://github.com/elastic/elasticsearch/pull/16932)



Scripting 
    

  * Skipping hidden files compilation for script service [<1>6286](https://github.com/elastic/elasticsearch/pull/16286) (issue: [<1>5269](https://github.com/elastic/elasticsearch/issues/15269)) 
  * Rename Plan A to Painless [<1>6245](https://github.com/elastic/elasticsearch/pull/16245)
  * Add plumbing for script compile-time parameters [<1>5464](https://github.com/elastic/elasticsearch/pull/15464)
  * Factor mustache → modules/lang-mustache [<1>5328](https://github.com/elastic/elasticsearch/pull/15328)



Search 
    

  * Add a soft limit on the number of shards that can be queried in a single search request. [<1>7396](https://github.com/elastic/elasticsearch/pull/17396)
  * Type filters should not have a performance impact when there is a single type. [<1>7350](https://github.com/elastic/elasticsearch/pull/17350)
  * Store _all payloads on 1 byte instead of 4. [<1>6899](https://github.com/elastic/elasticsearch/pull/16899)
  * Refuse to load fields from _source when using the `fields` option and support wildcards. [<1>5017](https://github.com/elastic/elasticsearch/pull/15017) (issues: [<1>0783](https://github.com/elastic/elasticsearch/issues/10783), [<1>4489](https://github.com/elastic/elasticsearch/issues/14489)) 
  * Add response into ClearScrollResponse [<1>3835](https://github.com/elastic/elasticsearch/pull/13835) (issue: [<1>3817](https://github.com/elastic/elasticsearch/issues/13817)) 
  * Shuffle shards for _only_nodes + support multiple specifications like cluster API [<1>2575](https://github.com/elastic/elasticsearch/pull/12575) (issues: [<1>2546](https://github.com/elastic/elasticsearch/issues/12546), [<1>2700](https://github.com/elastic/elasticsearch/issues/12700)) 



Search Refactoring 
    

  * Remove RescoreParseElement [<1>7441](https://github.com/elastic/elasticsearch/pull/17441)
  * Remove HighlighterParseElement [<1>7303](https://github.com/elastic/elasticsearch/pull/17303)
  * Move top level parsing of sort element to SortBuilder [<1>7248](https://github.com/elastic/elasticsearch/pull/17248)
  * Switch to using refactored SortBuilder instead of using BytesReference in serialization [<1>7205](https://github.com/elastic/elasticsearch/pull/17205) (issues: [<1>7146](https://github.com/elastic/elasticsearch/issues/17146), [<1>7257](https://github.com/elastic/elasticsearch/issues/17257)) 
  * Add build() method to SortBuilder implementations [<1>7146](https://github.com/elastic/elasticsearch/pull/17146) (issue: [<1>0217](https://github.com/elastic/elasticsearch/issues/10217)) 
  * Refactoring of Suggestions [<1>7096](https://github.com/elastic/elasticsearch/pull/17096) (issue: [<1>0217](https://github.com/elastic/elasticsearch/issues/10217)) 
  * Move sort `order` field up into SortBuilder [<1>7035](https://github.com/elastic/elasticsearch/pull/17035)
  * Moves SortParser:parse(…) to only require QueryShardContext [<1>6999](https://github.com/elastic/elasticsearch/pull/16999) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Change internal representation of suggesters [<1>6873](https://github.com/elastic/elasticsearch/pull/16873)
  * Make GeoDistanceSortBuilder serializable, 2nd try [<1>6572](https://github.com/elastic/elasticsearch/pull/16572) (issues: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178), [<1>6151](https://github.com/elastic/elasticsearch/issues/16151)) 
  * Move missing() from SortBuilder interface to class [<1>6225](https://github.com/elastic/elasticsearch/pull/16225) (issues: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178), [<1>6151](https://github.com/elastic/elasticsearch/issues/16151)) 
  * Remove deprecated parameters from ScriptSortBuilder [<1>6153](https://github.com/elastic/elasticsearch/pull/16153) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Refactor GeoSortBuilder [<1>6151](https://github.com/elastic/elasticsearch/pull/16151) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Refactor FieldSortBuilder [<1>6127](https://github.com/elastic/elasticsearch/pull/16127) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Make sort order enum writable. [<1>6124](https://github.com/elastic/elasticsearch/pull/16124) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Make DistanceUnit writable. [<1>6122](https://github.com/elastic/elasticsearch/pull/16122) (issue: [<1>5178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * RescoreBuilder: Add parsing and creating of RescoreSearchContext [<1>6014](https://github.com/elastic/elasticsearch/pull/16014) (issue: [<1>5559](https://github.com/elastic/elasticsearch/issues/15559)) 
  * Make RescoreBuilder and nested QueryRescorer Writable [<1>5953](https://github.com/elastic/elasticsearch/pull/15953) (issue: [<1>5559](https://github.com/elastic/elasticsearch/issues/15559)) 
  * Explain api: move query parsing to the coordinating node [<1>4270](https://github.com/elastic/elasticsearch/pull/14270)
  * Switch query parsers to use ParseField [<1>4249](https://github.com/elastic/elasticsearch/pull/14249) (issue: [<8>964](https://github.com/elastic/elasticsearch/issues/8964)) 
  * Refactoring of Aggregations [<1>4136](https://github.com/elastic/elasticsearch/pull/14136)



Settings 
    

  * Add guard against null-valued settings [<1>7310](https://github.com/elastic/elasticsearch/pull/17310) (issue: [<1>7292](https://github.com/elastic/elasticsearch/issues/17292)) 
  * Useful error message for null property placeholder [<1>7293](https://github.com/elastic/elasticsearch/pull/17293) (issue: [<1>7292](https://github.com/elastic/elasticsearch/issues/17292)) 
  * Archive cluster level settings if unknown or broken [<1>7246](https://github.com/elastic/elasticsearch/pull/17246)
  * Improve error message if setting is not found [<1>7230](https://github.com/elastic/elasticsearch/pull/17230)
  * Improve upgrade experience of node level index settings [<1>7223](https://github.com/elastic/elasticsearch/pull/17223) (issue: [<1>7187](https://github.com/elastic/elasticsearch/issues/17187)) 
  * Settings with complex matchers should not overlap [<1>6754](https://github.com/elastic/elasticsearch/pull/16754)
  * Moves GCE settings to the new infra [<1>6722](https://github.com/elastic/elasticsearch/pull/16722) (issue: [<1>6720](https://github.com/elastic/elasticsearch/issues/16720)) 
  * Add filtering support within Setting class [<1>6629](https://github.com/elastic/elasticsearch/pull/16629) (issue: [<1>6598](https://github.com/elastic/elasticsearch/issues/16598)) 
  * Migrate AWS settings to new settings infrastructure [<1>6602](https://github.com/elastic/elasticsearch/pull/16602) (issue: [<1>6293](https://github.com/elastic/elasticsearch/issues/16293)) 
  * Remove `gateway.initial_meta` and always rely on min master nodes [<1>6446](https://github.com/elastic/elasticsearch/pull/16446)
  * Rewrite SettingsFilter to be immutable [<1>6425](https://github.com/elastic/elasticsearch/pull/16425)
  * Simplify azure settings [<1>6363](https://github.com/elastic/elasticsearch/pull/16363)
  * Convert PageCacheRecycler settings [<1>6341](https://github.com/elastic/elasticsearch/pull/16341)
  * Monitor settings [<1>6313](https://github.com/elastic/elasticsearch/pull/16313)
  * Cut over tribe node settings to new settings infra [<1>6311](https://github.com/elastic/elasticsearch/pull/16311)
  * Convert multcast plugin settings to the new infra [<1>6295](https://github.com/elastic/elasticsearch/pull/16295)
  * Convert `request.headers.*` to the new settings infra [<1>6292](https://github.com/elastic/elasticsearch/pull/16292)
  * Migrate Azure settings to new settings infrastructure [<1>6291](https://github.com/elastic/elasticsearch/pull/16291)
  * Validate logger settings and allow them to be reset via API [<1>6289](https://github.com/elastic/elasticsearch/pull/16289)
  * Switch NodeEnvironment’s settings to new settings [<1>6273](https://github.com/elastic/elasticsearch/pull/16273)
  * Simplify AutoCreateIndex and add more tests [<1>6270](https://github.com/elastic/elasticsearch/pull/16270)
  * Convert several pending settings [<1>6269](https://github.com/elastic/elasticsearch/pull/16269)
  * Migrate query caching settings to the new settings infra. [<1>6267](https://github.com/elastic/elasticsearch/pull/16267)
  * Convert `action.auto_create_index` and `action.master.force_local` to the new settings infra [<1>6263](https://github.com/elastic/elasticsearch/pull/16263)
  * Convert `cluster.routing.allocation.type` and `processors` to the new settings infra. [<1>6238](https://github.com/elastic/elasticsearch/pull/16238)
  * Validate tribe node settings on startup [<1>6237](https://github.com/elastic/elasticsearch/pull/16237)
  * Move node.client, node.data, node.master, node.local and node.mode to new settings infra [<1>6230](https://github.com/elastic/elasticsearch/pull/16230)
  * Moved http settings to the new settings infrastructure [<1>6188](https://github.com/elastic/elasticsearch/pull/16188)
  * Migrate network service to the new infra [<1>6187](https://github.com/elastic/elasticsearch/pull/16187)
  * Convert client.transport settings to new infra [<1>6183](https://github.com/elastic/elasticsearch/pull/16183)
  * Move discovery.* settings to new Setting infrastructure [<1>6182](https://github.com/elastic/elasticsearch/pull/16182)
  * Change over to o.e.common.settings.Setting for http settings [<1>6181](https://github.com/elastic/elasticsearch/pull/16181)
  * Convert "path.*" and "pidfile" to new settings infra [<1>6180](https://github.com/elastic/elasticsearch/pull/16180)
  * Migrate repository settings to the new settings API [<1>6178](https://github.com/elastic/elasticsearch/pull/16178)
  * Convert "indices.*" settings to new infra. [<1>6177](https://github.com/elastic/elasticsearch/pull/16177)
  * Migrate gateway settings to the new settings API. [<1>6175](https://github.com/elastic/elasticsearch/pull/16175)
  * Convert several node and test level settings [<1>6172](https://github.com/elastic/elasticsearch/pull/16172)
  * Run Metadata upgrade tool on every version [<1>6168](https://github.com/elastic/elasticsearch/pull/16168)
  * Check for invalid index settings on metadata upgrade [<1>6156](https://github.com/elastic/elasticsearch/pull/16156)
  * Validate the settings key if it’s simple chars separated by `.` [<1>6120](https://github.com/elastic/elasticsearch/pull/16120)
  * Validate known global settings on startup [<1>6091](https://github.com/elastic/elasticsearch/pull/16091)
  * Cut over all index scope settings to the new setting infrastrucuture [<1>6054](https://github.com/elastic/elasticsearch/pull/16054) (issues: [<1>2790](https://github.com/elastic/elasticsearch/issues/12790), [<1>2854](https://github.com/elastic/elasticsearch/issues/12854), [<1>6032](https://github.com/elastic/elasticsearch/issues/16032), [<6>732](https://github.com/elastic/elasticsearch/issues/6732)) 
  * Remove updatability of `index.flush_on_close` [<1>5964](https://github.com/elastic/elasticsearch/pull/15964) (issue: [<1>5955](https://github.com/elastic/elasticsearch/issues/15955)) 
  * Move all dynamic settings and their config classes to the index level [<1>5955](https://github.com/elastic/elasticsearch/pull/15955) (issue: [<6>732](https://github.com/elastic/elasticsearch/issues/6732)) 
  * Always require units for bytes and time settings [<1>5948](https://github.com/elastic/elasticsearch/pull/15948) (issue: [<1>1437](https://github.com/elastic/elasticsearch/issues/11437)) 
  * Make MetaData parsing less lenient. [<1>5828](https://github.com/elastic/elasticsearch/pull/15828)
  * Move async translog sync logic into IndexService [<1>5584](https://github.com/elastic/elasticsearch/pull/15584)
  * Remove `index.merge.scheduler.notify_on_failure` and default to `true` [<1>5572](https://github.com/elastic/elasticsearch/pull/15572) (issue: [<1>5570](https://github.com/elastic/elasticsearch/issues/15570)) 
  * Remove cache concurrency level settings that no longer apply [<1>4210](https://github.com/elastic/elasticsearch/pull/14210) (issues: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224), [<1>3717](https://github.com/elastic/elasticsearch/issues/13717), [<7>836](https://github.com/elastic/elasticsearch/issues/7836)) 



Similarities 
    

  * Defining a global default similarity [<1>6682](https://github.com/elastic/elasticsearch/pull/16682) (issue: [<1>6594](https://github.com/elastic/elasticsearch/issues/16594)) 



Stats 
    

  * Normalize unavailable load average [<1>6061](https://github.com/elastic/elasticsearch/pull/16061) (issues: [<1>2049](https://github.com/elastic/elasticsearch/issues/12049), [<1>4741](https://github.com/elastic/elasticsearch/issues/14741), [<1>5907](https://github.com/elastic/elasticsearch/issues/15907), [<1>5932](https://github.com/elastic/elasticsearch/issues/15932), [<1>5934](https://github.com/elastic/elasticsearch/issues/15934)) 
  * Add load averages to OS stats on FreeBSD [<1>5934](https://github.com/elastic/elasticsearch/pull/15934) (issue: [<1>5917](https://github.com/elastic/elasticsearch/issues/15917)) 
  * Expose pending cluster state queue size in node stats [<1>4040](https://github.com/elastic/elasticsearch/pull/14040) (issue: [<1>3610](https://github.com/elastic/elasticsearch/issues/13610)) 



Store 
    

  * Remove support for legacy checksums [<1>6931](https://github.com/elastic/elasticsearch/pull/16931)
  * Rename index folder to index_uuid [<1>6442](https://github.com/elastic/elasticsearch/pull/16442) (issues: [<1>3264](https://github.com/elastic/elasticsearch/issues/13264), [<1>3265](https://github.com/elastic/elasticsearch/issues/13265), [<1>4512](https://github.com/elastic/elasticsearch/issues/14512), [<1>4932](https://github.com/elastic/elasticsearch/issues/14932), [<1>5853](https://github.com/elastic/elasticsearch/issues/15853)) 



Task Manager 
    

  * Add ability to group tasks by common parent [<1>7341](https://github.com/elastic/elasticsearch/pull/17341)
  * Add start time and duration to tasks [<1>6829](https://github.com/elastic/elasticsearch/pull/16829)
  * Combine node name and task id into single string task id [<1>6744](https://github.com/elastic/elasticsearch/pull/16744)
  * Add task status [<1>6356](https://github.com/elastic/elasticsearch/pull/16356) (issue: [<1>6344](https://github.com/elastic/elasticsearch/issues/16344)) 
  * Extend tracking of parent tasks to master node, replication and broadcast actions [<1>5931](https://github.com/elastic/elasticsearch/pull/15931)



Translog 
    

  * Remove ChannelReference and simplify Views [<1>5898](https://github.com/elastic/elasticsearch/pull/15898)
  * Simplify TranslogWriter to always write to a stream [<1>5771](https://github.com/elastic/elasticsearch/pull/15771)
  * Remove TranslogService and fold it into synchronous IndexShard API [<1>3707](https://github.com/elastic/elasticsearch/pull/13707)



### Bug fixes

Aggregations 
    

  * Fixes the defaults for `keyed` in the percentiles aggregations [<1>7217](https://github.com/elastic/elasticsearch/pull/17217)
  * Correct typo in class name of StatsAggregator [<1>5264](https://github.com/elastic/elasticsearch/pull/15264) (issue: [<1>4730](https://github.com/elastic/elasticsearch/issues/14730)) 



Allocation 
    

  * Replica shards must be failed before primary shards [<1>5686](https://github.com/elastic/elasticsearch/pull/15686)



CRUD 
    

  * Prevent TransportReplicationAction to route request based on stale local routing table [<1>6274](https://github.com/elastic/elasticsearch/pull/16274) (issues: [<1>2573](https://github.com/elastic/elasticsearch/issues/12573), [<1>2574](https://github.com/elastic/elasticsearch/issues/12574)) 
  * Resolves the conflict between alias routing and parent routing by applying the alias routing and ignoring the parent routing. [<1>5371](https://github.com/elastic/elasticsearch/pull/15371) (issue: [<3>068](https://github.com/elastic/elasticsearch/issues/3068)) 



Cluster 
    

  * Shard state action channel exceptions [<1>6057](https://github.com/elastic/elasticsearch/pull/16057) (issue: [<1>5748](https://github.com/elastic/elasticsearch/issues/15748)) 



Core 
    

  * Handle RejectedExecution gracefully in TransportService during shutdown [<1>6965](https://github.com/elastic/elasticsearch/pull/16965)



Geo 
    

  * Fix multi-field support for GeoPoint types [<1>5702](https://github.com/elastic/elasticsearch/pull/15702) (issue: [<1>5701](https://github.com/elastic/elasticsearch/issues/15701)) 
  * Enforce distance in distance query is > 0 [ISSUE] [<1>5135](https://github.com/elastic/elasticsearch/pull/15135)



Ingest 
    

  * Handle regex parsing errors in Gsub and Grok Processors [<1>7260](https://github.com/elastic/elasticsearch/pull/17260)
  * add on_failure exception metadata to ingest document for verbose simulate [<1>6562](https://github.com/elastic/elasticsearch/pull/16562)
  * The IngestDocument copy constructor should make a deep copy [<1>6248](https://github.com/elastic/elasticsearch/pull/16248) (issue: [<1>6246](https://github.com/elastic/elasticsearch/issues/16246)) 



Internal 
    

  * Enable unmap hack for java 9 [<1>6986](https://github.com/elastic/elasticsearch/pull/16986) (issue: [<1>](https://github.com/elastic/elasticsearch/issues/1)) 
  * Fix issues with failed cache loads [<1>4315](https://github.com/elastic/elasticsearch/pull/14315)
  * Allow parser to move on the START_OBJECT token when parsing search source [<1>4145](https://github.com/elastic/elasticsearch/pull/14145)
  * Ensure searcher is release if wrapping fails [<1>4107](https://github.com/elastic/elasticsearch/pull/14107)
  * Avoid deadlocks in Cache#computeIfAbsent [<1>4091](https://github.com/elastic/elasticsearch/pull/14091) (issue: [<1>4090](https://github.com/elastic/elasticsearch/issues/14090)) 



Java API 
    

  * Fix potential NPE in SearchSourceBuilder [<1>6905](https://github.com/elastic/elasticsearch/pull/16905) (issue: [<1>6902](https://github.com/elastic/elasticsearch/issues/16902)) 



Mapping 
    

  * Make dynamic template parsing less lenient. [<1>7249](https://github.com/elastic/elasticsearch/pull/17249)
  * Fix dynamic mapper when its parent already has an update [<1>7065](https://github.com/elastic/elasticsearch/pull/17065)
  * Fix copy_to when the target is a dynamic object field. [<1>5216](https://github.com/elastic/elasticsearch/pull/15216) (issues: [<1>11237](https://github.com/elastic/elasticsearch/issues/111237), [<1>1237](https://github.com/elastic/elasticsearch/issues/11237)) 
  * Preserve existing mappings on batch mapping updates [<1>5130](https://github.com/elastic/elasticsearch/pull/15130) (issues: [<1>4899](https://github.com/elastic/elasticsearch/issues/14899), [<1>5129](https://github.com/elastic/elasticsearch/issues/15129)) 



Packaging 
    

  * Set MAX_OPEN_FILES to 65536 [<1>7431](https://github.com/elastic/elasticsearch/pull/17431) (issue: [<1>7430](https://github.com/elastic/elasticsearch/issues/17430)) 
  * [windows] Service command still had positional start command [<1>7391](https://github.com/elastic/elasticsearch/pull/17391)
  * Do not pass double-dash arguments on startup [<1>7087](https://github.com/elastic/elasticsearch/pull/17087) (issue: [<1>7084](https://github.com/elastic/elasticsearch/issues/17084)) 



Percolator 
    

  * Let PercolatorQuery’s explain use the two phase iterator [<1>7315](https://github.com/elastic/elasticsearch/pull/17315) (issue: [<1>7314](https://github.com/elastic/elasticsearch/issues/17314)) 



Plugin Store SMB 
    

  * Fix calling ensureOpen() on the wrong directory (master forwardport) [<1>6395](https://github.com/elastic/elasticsearch/pull/16395) (issue: [<1>6383](https://github.com/elastic/elasticsearch/issues/16383)) 



Plugins 
    

  * CliTool: Messages printed in Terminal should have percent char escaped [<1>6367](https://github.com/elastic/elasticsearch/pull/16367)



Query DSL 
    

  * Resolve string dates and date math to millis before evaluating for rewrite in range query [<1>7239](https://github.com/elastic/elasticsearch/pull/17239)
  * `constant_score` query should throw error on more than one filter [<1>7135](https://github.com/elastic/elasticsearch/pull/17135) (issue: [<1>7126](https://github.com/elastic/elasticsearch/issues/17126)) 
  * Single IPv4 addresses in IP field term queries [<1>6068](https://github.com/elastic/elasticsearch/pull/16068) (issue: [<1>6058](https://github.com/elastic/elasticsearch/issues/16058)) 
  * Make strategy optional in GeoShapeQueryBuilder readFrom and writeTo [<1>3963](https://github.com/elastic/elasticsearch/pull/13963)



Query Refactoring 
    

  * Query refactoring: set has_parent & has_child types context properly [<1>3863](https://github.com/elastic/elasticsearch/pull/13863)
  * Make sure equivalent geohashCellQueries are equal after toQuery called [<1>3792](https://github.com/elastic/elasticsearch/pull/13792)



Recovery 
    

  * Invoke `IndexingOperationListeners` also when recovering from store or remote [<1>7406](https://github.com/elastic/elasticsearch/pull/17406)
  * Prevent interruption while store checks lucene files for consistency [<1>6308](https://github.com/elastic/elasticsearch/pull/16308)
  * Mark shard as recovering on the cluster state thread [<1>4276](https://github.com/elastic/elasticsearch/pull/14276) (issues: [<1>3766](https://github.com/elastic/elasticsearch/issues/13766), [<1>4115](https://github.com/elastic/elasticsearch/issues/14115)) 



Search 
    

  * Fix for search after [<1>6271](https://github.com/elastic/elasticsearch/pull/16271)
  * Do not be lenient when parsing CIDRs [<1>4874](https://github.com/elastic/elasticsearch/pull/14874) (issue: [<1>4862](https://github.com/elastic/elasticsearch/issues/14862)) 



Settings 
    

  * Register bootstrap settings [<1>6513](https://github.com/elastic/elasticsearch/pull/16513)
  * Add settings filtering to node info requests [<1>6445](https://github.com/elastic/elasticsearch/pull/16445)
  * Ban write access to system properties [<1>4914](https://github.com/elastic/elasticsearch/pull/14914)



Task Manager 
    

  * Take filterNodeIds into consideration while sending task requests to nodes [<1>7081](https://github.com/elastic/elasticsearch/pull/17081)



Translog 
    

  * Move translog recover outside of the engine [<1>7422](https://github.com/elastic/elasticsearch/pull/17422)
  * Mark shard active during recovery; push settings after engine finally inits [<1>6250](https://github.com/elastic/elasticsearch/pull/16250) (issues: [<1>4121](https://github.com/elastic/elasticsearch/issues/14121), [<1>6209](https://github.com/elastic/elasticsearch/issues/16209)) 



### Upgrades

Core 
    

  * Upgrade to lucene-6.0.0-f0aa4fc. [<1>7075](https://github.com/elastic/elasticsearch/pull/17075)
  * upgrade to lucene 6.0.0-snapshot-bea235f [<1>6964](https://github.com/elastic/elasticsearch/pull/16964)
  * Upgrade to Jackson 2.7.1 [<1>6801](https://github.com/elastic/elasticsearch/pull/16801) (issue: [<1>6294](https://github.com/elastic/elasticsearch/issues/16294)) 



Ingest 
    

  * Update MaxMind geoip2 version to 2.6 [<1>6837](https://github.com/elastic/elasticsearch/pull/16837) (issue: [<1>6801](https://github.com/elastic/elasticsearch/issues/16801)) 



Internal 
    

  * Bump master (3.0-snapshot) to java 8 [<1>3314](https://github.com/elastic/elasticsearch/pull/13314)



Search Templates 
    

  * Update mustache.java to version 0.9.1 [<1>4053](https://github.com/elastic/elasticsearch/pull/14053) (issue: [<1>3224](https://github.com/elastic/elasticsearch/issues/13224)) 


