## 5.0.0-alpha1 Release Notes

The changes listed below have been released for the first time in Elasticsearch 5.0.0-alpha1. Changes in this release which were first released in the 2.x series are listed in [_5.0.0-alpha1 Release Notes (Changes previously released in 2.x)_](release-notes-5.0.0-alpha1-2x.html "5.0.0-alpha1 Release Notes \(Changes previously released in 2.x\)").

Also see [_Breaking changes in 5.0_](breaking-changes-5.0.html "Breaking changes in 5.0").

![Important](images/icons/important.png)

This is an alpha release and is intended for _testing purposes only_. Indices created in this version will **not be compatible with Elasticsearch 5.0.0 GA**. Upgrading 5.0.0-alpha1 to any other version is not supported.

### Breaking changes

Aliases 
    

  * make get alias expand to open and closed indices by default [#15954](https://github.com/elastic/elasticsearch/pull/15954) (issue: [#14982](https://github.com/elastic/elasticsearch/issues/14982)) 
  * Remove deprecated indices.get_aliases [#13906](https://github.com/elastic/elasticsearch/pull/13906)



Allocation 
    

  * Remove DisableAllocationDecider [#13313](https://github.com/elastic/elasticsearch/pull/13313)



CAT API 
    

  * Add raw recovery progress to cat recovery API [#17064](https://github.com/elastic/elasticsearch/pull/17064) (issue: [#17022](https://github.com/elastic/elasticsearch/issues/17022)) 
  * Remove host from cat nodes API [#16656](https://github.com/elastic/elasticsearch/pull/16656) (issues: [#12959](https://github.com/elastic/elasticsearch/issues/12959), [#16575](https://github.com/elastic/elasticsearch/issues/16575)) 
  * Using the accept header in the request instead of content-type in _cat API. [#14421](https://github.com/elastic/elasticsearch/pull/14421) (issue: [#14195](https://github.com/elastic/elasticsearch/issues/14195)) 



CRUD 
    

  * Remove object notation for core types. [#15684](https://github.com/elastic/elasticsearch/pull/15684) (issue: [#15388](https://github.com/elastic/elasticsearch/issues/15388)) 



Cache 
    

  * Remove deprecated query cache settings [#15592](https://github.com/elastic/elasticsearch/pull/15592)



Cluster 
    

  * Remove memory div [#17278](https://github.com/elastic/elasticsearch/pull/17278) (issues: [#12049](https://github.com/elastic/elasticsearch/issues/12049), [#16756](https://github.com/elastic/elasticsearch/issues/16756)) 



Core 
    

  * Bootstrap does not set system properties [#17088](https://github.com/elastic/elasticsearch/pull/17088) (issues: [#16579](https://github.com/elastic/elasticsearch/issues/16579), [#16791](https://github.com/elastic/elasticsearch/issues/16791)) 
  * Add max number of processes check [#16919](https://github.com/elastic/elasticsearch/pull/16919)
  * Add mlockall bootstrap check [#16909](https://github.com/elastic/elasticsearch/pull/16909)
  * One log [#16703](https://github.com/elastic/elasticsearch/pull/16703) (issue: [#16585](https://github.com/elastic/elasticsearch/issues/16585)) 



Engine 
    

  * Remove `index.compound_on_flush` setting and default to `true` [#15594](https://github.com/elastic/elasticsearch/pull/15594) (issue: [#10778](https://github.com/elastic/elasticsearch/issues/10778)) 



Fielddata 
    

  * Remove "uninverted" and "binary" fielddata support for numeric and boolean fields. [#14082](https://github.com/elastic/elasticsearch/pull/14082)



Index APIs 
    

  * Remove `GET` option for /_forcemerge [#15223](https://github.com/elastic/elasticsearch/pull/15223) (issue: [#15165](https://github.com/elastic/elasticsearch/issues/15165)) 
  * Remove /_optimize REST API endpoint [#14226](https://github.com/elastic/elasticsearch/pull/14226) (issue: [#13778](https://github.com/elastic/elasticsearch/issues/13778)) 



Internal 
    

  * Remove support for pre 2.0 indices [#13799](https://github.com/elastic/elasticsearch/pull/13799)



Mapping 
    

  * Change the field mapping index time boost into a query time boost. [#16900](https://github.com/elastic/elasticsearch/pull/16900)
  * Deprecate string in favor of text/keyword. [#16877](https://github.com/elastic/elasticsearch/pull/16877)
  * Term vector APIs should no longer update mappings [#16285](https://github.com/elastic/elasticsearch/pull/16285)
  * Remove the `format` option of the `_source` field. [#15398](https://github.com/elastic/elasticsearch/pull/15398)
  * Remove transform [#13657](https://github.com/elastic/elasticsearch/pull/13657) (issue: [#12674](https://github.com/elastic/elasticsearch/issues/12674)) 



Parent/Child 
    

  * Removed `total` score mode in favour for `sum` score mode. [#17174](https://github.com/elastic/elasticsearch/pull/17174) (issues: [#13470](https://github.com/elastic/elasticsearch/issues/13470), [#17083](https://github.com/elastic/elasticsearch/issues/17083)) 
  * Removed pre 2.x parent child implementation [#13376](https://github.com/elastic/elasticsearch/pull/13376)



Percolator 
    

  * Change the percolate api to not dynamically add fields to mapping [#16077](https://github.com/elastic/elasticsearch/pull/16077) (issue: [#15751](https://github.com/elastic/elasticsearch/issues/15751)) 



Plugins 
    

  * Rename bin/plugin in bin/elasticsearch-plugin [#16454](https://github.com/elastic/elasticsearch/pull/16454)
  * Remove multicast plugin [#16326](https://github.com/elastic/elasticsearch/pull/16326) (issue: [#16310](https://github.com/elastic/elasticsearch/issues/16310)) 
  * Plugins: Remove site plugins [#16038](https://github.com/elastic/elasticsearch/pull/16038)



Query DSL 
    

  * Function score query: remove deprecated support for boost_factor [#13510](https://github.com/elastic/elasticsearch/pull/13510)
  * Remove support for deprecated queries. [#13418](https://github.com/elastic/elasticsearch/pull/13418) (issue: [#13326](https://github.com/elastic/elasticsearch/issues/13326)) 



REST 
    

  * Limit the accepted length of the _id [#16036](https://github.com/elastic/elasticsearch/pull/16036) (issue: [#16034](https://github.com/elastic/elasticsearch/issues/16034)) 



Search 
    

  * Remove deprecated reverse option from sorting [#17282](https://github.com/elastic/elasticsearch/pull/17282) (issue: [#17047](https://github.com/elastic/elasticsearch/issues/17047)) 
  * Remove some deprecations [#14331](https://github.com/elastic/elasticsearch/pull/14331)
  * Remove search exists api [#13911](https://github.com/elastic/elasticsearch/pull/13911) (issues: [#13682](https://github.com/elastic/elasticsearch/issues/13682), [#13910](https://github.com/elastic/elasticsearch/issues/13910)) 
  * Remove the scan and count search types. [#13310](https://github.com/elastic/elasticsearch/pull/13310)



Search Refactoring 
    

  * Remove "query" query and fix related parsing bugs [#14304](https://github.com/elastic/elasticsearch/pull/14304) (issue: [#13326](https://github.com/elastic/elasticsearch/issues/13326)) 



Settings 
    

  * Remove ability to specify arbitrary node attributes with `node.` prefix [#17402](https://github.com/elastic/elasticsearch/pull/17402) (issue: [#17280](https://github.com/elastic/elasticsearch/issues/17280)) 
  * Enforce `discovery.zen.minimum_master_nodes` is set when bound to a public ip [#17288](https://github.com/elastic/elasticsearch/pull/17288)
  * Prevent index level setting from being configured on a node level [#17144](https://github.com/elastic/elasticsearch/pull/17144) (issue: [#16799](https://github.com/elastic/elasticsearch/issues/16799)) 
  * Remove support for node.client setting [#16963](https://github.com/elastic/elasticsearch/pull/16963) (issue: [#16565](https://github.com/elastic/elasticsearch/issues/16565)) 
  * Remove es.max-open-files flag [#16757](https://github.com/elastic/elasticsearch/pull/16757) (issues: [#16506](https://github.com/elastic/elasticsearch/issues/16506), [#483](https://github.com/elastic/elasticsearch/issues/483)) 
  * Enforce node level limits if node is started in production env [#16733](https://github.com/elastic/elasticsearch/pull/16733) (issue: [#16727](https://github.com/elastic/elasticsearch/issues/16727)) 
  * Make settings validation strict [#16365](https://github.com/elastic/elasticsearch/pull/16365)
  * Remove the ability to fsync on every operation and only schedule fsync task if really needed [#16257](https://github.com/elastic/elasticsearch/pull/16257) (issue: [#16152](https://github.com/elastic/elasticsearch/issues/16152)) 
  * Script settings [#16197](https://github.com/elastic/elasticsearch/pull/16197)
  * Remove index.flush_on_close entirely [#15977](https://github.com/elastic/elasticsearch/pull/15977)
  * Restore chunksize of 512kb on recovery and remove configurability [#15235](https://github.com/elastic/elasticsearch/pull/15235) (issue: [#15161](https://github.com/elastic/elasticsearch/issues/15161)) 
  * Remove ancient deprecated and alternative recovery settings [#15234](https://github.com/elastic/elasticsearch/pull/15234)
  * Fix ping timeout settings inconsistencies [#13701](https://github.com/elastic/elasticsearch/pull/13701) (issue: [#6579](https://github.com/elastic/elasticsearch/issues/6579)) 



Similarities 
    

  * Renames `default` similarity into `classic` [#15446](https://github.com/elastic/elasticsearch/pull/15446) (issue: [#15102](https://github.com/elastic/elasticsearch/issues/15102)) 



Snapshot/Restore 
    

  * Fail closing or deleting indices during a full snapshot [#17021](https://github.com/elastic/elasticsearch/pull/17021) (issue: [#16321](https://github.com/elastic/elasticsearch/issues/16321)) 



Stats 
    

  * Modify load average format [#15932](https://github.com/elastic/elasticsearch/pull/15932) (issue: [#15907](https://github.com/elastic/elasticsearch/issues/15907)) 
  * Reintroduce five-minute and fifteen-minute load averages on Linux [#15907](https://github.com/elastic/elasticsearch/pull/15907) (issues: [#12049](https://github.com/elastic/elasticsearch/issues/12049), [#14741](https://github.com/elastic/elasticsearch/issues/14741)) 
  * Add system CPU percent to OS stats [#14741](https://github.com/elastic/elasticsearch/pull/14741)



Term Vectors 
    

  * Remove DFS support from TermVector API [#16452](https://github.com/elastic/elasticsearch/pull/16452)



Translog 
    

  * Drop support for simple translog and hard-wire buffer to 8kb [#15574](https://github.com/elastic/elasticsearch/pull/15574)
  * Simplify translog-based flush settings [#15573](https://github.com/elastic/elasticsearch/pull/15573)



Warmers 
    

  * Remove query warmers and the warmer API. [#15614](https://github.com/elastic/elasticsearch/pull/15614) (issue: [#15607](https://github.com/elastic/elasticsearch/issues/15607)) 



### Breaking Java changes

Aggregations 
    

  * getKeyAsString and key_as_string should be the same for terms aggregation on boolean field [#15393](https://github.com/elastic/elasticsearch/pull/15393)



Allocation 
    

  * Simplify shard balancer interface [#17028](https://github.com/elastic/elasticsearch/pull/17028) (issue: [#8954](https://github.com/elastic/elasticsearch/issues/8954)) 



Analysis 
    

  * Simplify Analysis registration and configuration [#14355](https://github.com/elastic/elasticsearch/pull/14355)



Cache 
    

  * Refactor IndicesRequestCache to make it testable. [#16610](https://github.com/elastic/elasticsearch/pull/16610)
  * Fold IndexCacheModule into IndexModule [#14293](https://github.com/elastic/elasticsearch/pull/14293)



Core 
    

  * Remove es.useLinkedTransferQueue [#16786](https://github.com/elastic/elasticsearch/pull/16786)



Discovery 
    

  * Include pings from client nodes in master election [#17329](https://github.com/elastic/elasticsearch/pull/17329) (issue: [#17325](https://github.com/elastic/elasticsearch/issues/17325)) 



Internal 
    

  * Remove duplicate getters from DiscoveryNode and DiscoveryNodes [#17410](https://github.com/elastic/elasticsearch/pull/17410) (issue: [#16963](https://github.com/elastic/elasticsearch/issues/16963)) 
  * Cli: Switch to jopt-simple [#17024](https://github.com/elastic/elasticsearch/pull/17024) (issue: [#11564](https://github.com/elastic/elasticsearch/issues/11564)) 
  * Replace ContextAndHeaders with a ThreadPool based ThreadLocal implementation [#15776](https://github.com/elastic/elasticsearch/pull/15776)
  * Remove NodeBuilder [#15354](https://github.com/elastic/elasticsearch/pull/15354)
  * Fix IndexSearcherWrapper interface to not depend on the EngineConfig [#14654](https://github.com/elastic/elasticsearch/pull/14654)
  * Cleanup query parsing and remove IndexQueryParserService [#14452](https://github.com/elastic/elasticsearch/pull/14452)
  * Remove circular dependency between IndicesService and IndicesStore [#14285](https://github.com/elastic/elasticsearch/pull/14285)
  * Remove guice injection from IndexStore and friends [#14279](https://github.com/elastic/elasticsearch/pull/14279)
  * Replace IndicesLifecycle with a per-index IndexEventListener [#14217](https://github.com/elastic/elasticsearch/pull/14217) (issue: [#13259](https://github.com/elastic/elasticsearch/issues/13259)) 
  * Simplify similarity module and friends [#13942](https://github.com/elastic/elasticsearch/pull/13942)
  * Refactor SearchRequest to be parsed on the coordinating node [#13859](https://github.com/elastic/elasticsearch/pull/13859)



Java API 
    

  * Remove the count api [#14166](https://github.com/elastic/elasticsearch/pull/14166) (issue: [#13928](https://github.com/elastic/elasticsearch/issues/13928)) 
  * IdsQueryBuilder to accept only non null ids and types [#13937](https://github.com/elastic/elasticsearch/pull/13937)



Mapping 
    

  * [Mapping] Several MappingService cleanups [#16133](https://github.com/elastic/elasticsearch/pull/16133) (issue: [#15924](https://github.com/elastic/elasticsearch/issues/15924)) 



Network 
    

  * Remove ability to disable Netty gathering writes [#16774](https://github.com/elastic/elasticsearch/pull/16774) (issue: [#7811](https://github.com/elastic/elasticsearch/issues/7811)) 



Parent/Child 
    

  * Cleanup ParentFieldMapper [#16045](https://github.com/elastic/elasticsearch/pull/16045)
  * Several other parent/child cleanups [#13470](https://github.com/elastic/elasticsearch/pull/13470)



Plugins 
    

  * Enforce isolated mode for all plugins [#17276](https://github.com/elastic/elasticsearch/pull/17276)
  * Change the inner structure of the plugins zip [#16453](https://github.com/elastic/elasticsearch/pull/16453)
  * Don’t use guice for QueryParsers [#15761](https://github.com/elastic/elasticsearch/pull/15761)
  * Remove guice from the index level [#14518](https://github.com/elastic/elasticsearch/pull/14518)
  * Remove shard-level injector [#13881](https://github.com/elastic/elasticsearch/pull/13881)



Query DSL 
    

  * Remove the MissingQueryBuilder which was deprecated in 2.2.0. [#15364](https://github.com/elastic/elasticsearch/pull/15364) (issue: [#14112](https://github.com/elastic/elasticsearch/issues/14112)) 
  * Remove NotQueryBuilder [#14204](https://github.com/elastic/elasticsearch/pull/14204) (issue: [#13761](https://github.com/elastic/elasticsearch/issues/13761)) 



Search 
    

  * Query refactoring: split parse phase into fromXContent and toQuery for all queries [#13788](https://github.com/elastic/elasticsearch/pull/13788) (issue: [#10217](https://github.com/elastic/elasticsearch/issues/10217)) 



Search Refactoring 
    

  * Refactored inner hits parsing and intoduced InnerHitBuilder [#17291](https://github.com/elastic/elasticsearch/pull/17291)
  * Remove deprecated parameter from field sort builder. [#16573](https://github.com/elastic/elasticsearch/pull/16573) (issue: [#16127](https://github.com/elastic/elasticsearch/issues/16127)) 
  * Remove support for query_binary and filter_binary [#14433](https://github.com/elastic/elasticsearch/pull/14433) (issue: [#14308](https://github.com/elastic/elasticsearch/issues/14308)) 
  * Validate query api: move query parsing to the coordinating node [#14384](https://github.com/elastic/elasticsearch/pull/14384)



Settings 
    

  * Move remaining settings in NettyHttpServerTransport to the new infra [#16531](https://github.com/elastic/elasticsearch/pull/16531)
  * Replace IndexSettings annotation with a full-fledged class [#14251](https://github.com/elastic/elasticsearch/pull/14251)



Store 
    

  * Standardize state format type for global and index level metadata [#17123](https://github.com/elastic/elasticsearch/pull/17123)



Suggesters 
    

  * Remove suggest threadpool [#17304](https://github.com/elastic/elasticsearch/pull/17304) (issue: [#17198](https://github.com/elastic/elasticsearch/issues/17198)) 
  * Remove suggest transport action [#17198](https://github.com/elastic/elasticsearch/pull/17198) (issue: [#10217](https://github.com/elastic/elasticsearch/issues/10217)) 



### Deprecations

Plugin Mapper Attachment 
    

  * Deprecate mapper-attachments plugin [#16948](https://github.com/elastic/elasticsearch/pull/16948) (issue: [#16910](https://github.com/elastic/elasticsearch/issues/16910)) 



Search 
    

  * Deprecate fuzzy query [#16211](https://github.com/elastic/elasticsearch/pull/16211) (issues: [#15760](https://github.com/elastic/elasticsearch/issues/15760), [#16121](https://github.com/elastic/elasticsearch/issues/16121)) 



### New features

Allocation 
    

  * Add API to explain why a shard is or isn’t assigned [#17305](https://github.com/elastic/elasticsearch/pull/17305) (issue: [#14593](https://github.com/elastic/elasticsearch/issues/14593)) 



Discovery 
    

  * Add two phased commit to Cluster State publishing [#13062](https://github.com/elastic/elasticsearch/pull/13062)



Ingest 
    

  * Merge feature/ingest branch into master branch [#16049](https://github.com/elastic/elasticsearch/pull/16049) (issue: [#14049](https://github.com/elastic/elasticsearch/issues/14049)) 



Mapping 
    

  * Add a text field. [#16637](https://github.com/elastic/elasticsearch/pull/16637)
  * Add a new `keyword` field. [#16589](https://github.com/elastic/elasticsearch/pull/16589)



Percolator 
    

  * index the query terms from the percolator query [#13646](https://github.com/elastic/elasticsearch/pull/13646) (issue: [#12664](https://github.com/elastic/elasticsearch/issues/12664)) 



Plugin Ingest Attachment 
    

  * Ingest: Add attachment processor [#16490](https://github.com/elastic/elasticsearch/pull/16490) (issue: [#16303](https://github.com/elastic/elasticsearch/issues/16303)) 



Plugin Mapper Attachment 
    

  * Migrate mapper attachments plugin to main repository [#14605](https://github.com/elastic/elasticsearch/pull/14605)



Plugin Repository HDFS 
    

  * HDFS Snapshot/Restore plugin [#15192](https://github.com/elastic/elasticsearch/pull/15192) (issue: [#15191](https://github.com/elastic/elasticsearch/issues/15191)) 



Query DSL 
    

  * Adds a rewrite phase to queries on the shard level [#16870](https://github.com/elastic/elasticsearch/pull/16870) (issue: [#9526](https://github.com/elastic/elasticsearch/issues/9526)) 



Reindex API 
    

  * Merge reindex to master [#16861](https://github.com/elastic/elasticsearch/pull/16861)



Scripting 
    

  * Exceptions and Infinite Loop Checking [#15936](https://github.com/elastic/elasticsearch/pull/15936)
  * Added a new scripting language (PlanA) [#15136](https://github.com/elastic/elasticsearch/pull/15136) (issue: [#13084](https://github.com/elastic/elasticsearch/issues/13084)) 



Search 
    

  * Add `search_after` parameter in the SearchAPI [#16125](https://github.com/elastic/elasticsearch/pull/16125) (issue: [#8192](https://github.com/elastic/elasticsearch/issues/8192)) 



Settings 
    

  * Add infrastructure to transactionally apply and reset dynamic settings [#15278](https://github.com/elastic/elasticsearch/pull/15278)



Stats 
    

  * API for listing index file sizes [#16661](https://github.com/elastic/elasticsearch/pull/16661) (issue: [#16131](https://github.com/elastic/elasticsearch/issues/16131)) 



Suggesters 
    

  * Add document-oriented completion suggester [#14410](https://github.com/elastic/elasticsearch/pull/14410) (issue: [#10746](https://github.com/elastic/elasticsearch/issues/10746)) 



Task Manager 
    

  * Add task cancellation mechanism [#16320](https://github.com/elastic/elasticsearch/pull/16320)
  * Make the Task object available to the action caller [#16033](https://github.com/elastic/elasticsearch/pull/16033)
  * Task Management: Add framework for registering and communicating with tasks [#15347](https://github.com/elastic/elasticsearch/pull/15347) (issue: [#15117](https://github.com/elastic/elasticsearch/issues/15117)) 



### Enhancements

Aggregations 
    

  * Add tests and documentation for using `time_zone` in date range aggregation [#16955](https://github.com/elastic/elasticsearch/pull/16955) (issue: [#10130](https://github.com/elastic/elasticsearch/issues/10130)) 
  * Fixes serialisation of Ranges [#16674](https://github.com/elastic/elasticsearch/pull/16674)



Allocation 
    

  * Write shard state metadata as soon as shard is created / initializing [#16625](https://github.com/elastic/elasticsearch/pull/16625) (issue: [#14739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Reuse existing allocation id for primary shard allocation [#16530](https://github.com/elastic/elasticsearch/pull/16530) (issue: [#14739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Remove version in ShardRouting (now obsolete) [#16243](https://github.com/elastic/elasticsearch/pull/16243) (issue: [#14739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Prefer nodes that previously held primary shard for primary shard allocation [#16096](https://github.com/elastic/elasticsearch/pull/16096) (issue: [#14739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Extend reroute with an option to force assign stale primary shard copies [#15708](https://github.com/elastic/elasticsearch/pull/15708) (issue: [#14739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Allocate primary shards based on allocation IDs [#15281](https://github.com/elastic/elasticsearch/pull/15281) (issue: [#14739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Persist currently started allocation IDs to index metadata [#14964](https://github.com/elastic/elasticsearch/pull/14964) (issue: [#14739](https://github.com/elastic/elasticsearch/issues/14739)) 
  * Use ObjectParser to parse AllocationID [#14962](https://github.com/elastic/elasticsearch/pull/14962) (issue: [#14831](https://github.com/elastic/elasticsearch/issues/14831)) 
  * Persist allocation ID with shard state metadata on nodes [#14831](https://github.com/elastic/elasticsearch/pull/14831) (issue: [#14739](https://github.com/elastic/elasticsearch/issues/14739)) 



Analysis 
    

  * Improve error message if resource files have illegal encoding [#17237](https://github.com/elastic/elasticsearch/pull/17237) (issue: [#17212](https://github.com/elastic/elasticsearch/issues/17212)) 



CAT API 
    

  * Expose http address in cat/nodes [#16770](https://github.com/elastic/elasticsearch/pull/16770)
  * [cat/recovery] Make recovery time a TimeValue() [#16743](https://github.com/elastic/elasticsearch/pull/16743) (issue: [#9209](https://github.com/elastic/elasticsearch/issues/9209)) 
  * :CAT API: remove space at the end of a line [#15250](https://github.com/elastic/elasticsearch/pull/15250) (issue: [#9464](https://github.com/elastic/elasticsearch/issues/9464)) 



CRUD 
    

  * CRUD: Allow to get and set ttl as a time value/string [#15047](https://github.com/elastic/elasticsearch/pull/15047)



Cache 
    

  * Enable the indices request cache by default [#17162](https://github.com/elastic/elasticsearch/pull/17162) (issues: [#16870](https://github.com/elastic/elasticsearch/issues/16870), [#17134](https://github.com/elastic/elasticsearch/issues/17134)) 



Cluster 
    

  * Cluster Health should run on applied states, even if waitFor=0 [#17440](https://github.com/elastic/elasticsearch/pull/17440)
  * Resolve index names to Index instances early [#17048](https://github.com/elastic/elasticsearch/pull/17048)
  * Remove DiscoveryNode#shouldConnectTo method [#16898](https://github.com/elastic/elasticsearch/pull/16898) (issue: [#16815](https://github.com/elastic/elasticsearch/issues/16815)) 
  * Fail demoted primary shards and retry request [#16415](https://github.com/elastic/elasticsearch/pull/16415) (issue: [#14252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Illegal shard failure requests [#16275](https://github.com/elastic/elasticsearch/pull/16275)
  * Shard failure requests for non-existent shards [#16089](https://github.com/elastic/elasticsearch/pull/16089) (issue: [#14252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Add handling of channel failures when starting a shard [#16041](https://github.com/elastic/elasticsearch/pull/16041) (issue: [#15895](https://github.com/elastic/elasticsearch/issues/15895)) 
  * Wait for new master when failing shard [#15748](https://github.com/elastic/elasticsearch/pull/15748) (issue: [#14252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Master should wait on cluster state publication when failing a shard [#15468](https://github.com/elastic/elasticsearch/pull/15468) (issue: [#14252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Split cluster state update tasks into roles [#14899](https://github.com/elastic/elasticsearch/pull/14899) (issue: [#13627](https://github.com/elastic/elasticsearch/issues/13627)) 
  * Add timeout mechanism for sending shard failures [#14707](https://github.com/elastic/elasticsearch/pull/14707) (issue: [#14252](https://github.com/elastic/elasticsearch/issues/14252)) 
  * Add listener mechanism for failures to send shard failed [#14295](https://github.com/elastic/elasticsearch/pull/14295) (issue: [#14252](https://github.com/elastic/elasticsearch/issues/14252)) 



Core 
    

  * Remove PROTOTYPE from BulkItemResponse.Failure [#17433](https://github.com/elastic/elasticsearch/pull/17433) (issue: [#17086](https://github.com/elastic/elasticsearch/issues/17086)) 
  * Throw an exception if Writeable.Reader reads null [#17332](https://github.com/elastic/elasticsearch/pull/17332)
  * Remove PROTOTYPE from RescorerBuilders [#17330](https://github.com/elastic/elasticsearch/pull/17330)
  * Port Primary Terms to master [#17044](https://github.com/elastic/elasticsearch/pull/17044) (issues: [#14062](https://github.com/elastic/elasticsearch/issues/14062), [#14651](https://github.com/elastic/elasticsearch/issues/14651), [#17038](https://github.com/elastic/elasticsearch/issues/17038)) 
  * Use index UUID to lookup indices on IndicesService [#17001](https://github.com/elastic/elasticsearch/pull/17001)
  * Add -XX+AlwaysPreTouch JVM flag [#16937](https://github.com/elastic/elasticsearch/pull/16937)
  * Add max size virtual memory check [#16935](https://github.com/elastic/elasticsearch/pull/16935)
  * Use and test relative time in TransportBulkAction [#16916](https://github.com/elastic/elasticsearch/pull/16916)
  * Bump Elasticsearch version to 5.0.0-SNAPSHOT [#16862](https://github.com/elastic/elasticsearch/pull/16862)
  * Assert that we can write in all data-path on startup [#16745](https://github.com/elastic/elasticsearch/pull/16745)
  * Add G1GC check on startup [#16737](https://github.com/elastic/elasticsearch/pull/16737) (issue: [#10740](https://github.com/elastic/elasticsearch/issues/10740)) 
  * Shards with heavy indexing should get more of the indexing buffer [#14121](https://github.com/elastic/elasticsearch/pull/14121)
  * Remove and ban ImmutableMap [#13939](https://github.com/elastic/elasticsearch/pull/13939) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Finish banning ImmutableSet [#13820](https://github.com/elastic/elasticsearch/pull/13820) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Removes and bans ImmutableSet [#13754](https://github.com/elastic/elasticsearch/pull/13754) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and ban ImmutableMap#entrySet [#13724](https://github.com/elastic/elasticsearch/pull/13724)
  * Forbid ForwardingSet [#13720](https://github.com/elastic/elasticsearch/pull/13720) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 



Discovery 
    

  * Add a dedicate queue for incoming ClusterStates [#13303](https://github.com/elastic/elasticsearch/pull/13303) (issue: [#13062](https://github.com/elastic/elasticsearch/issues/13062)) 



Engine 
    

  * Remove writeLockTimeout from InternalEngine [#16930](https://github.com/elastic/elasticsearch/pull/16930)
  * Don’t guard IndexShard#refresh calls by a check to isRefreshNeeded [#16118](https://github.com/elastic/elasticsearch/pull/16118)
  * Never call a listerner under lock in InternalEngine [#15786](https://github.com/elastic/elasticsearch/pull/15786)
  * Use System.nanoTime() to initialize Engine.lastWriteNanos [#14321](https://github.com/elastic/elasticsearch/pull/14321)
  * Flush big merges automatically if shard is inactive [#14275](https://github.com/elastic/elasticsearch/pull/14275)
  * Remove Engine.Create [#13955](https://github.com/elastic/elasticsearch/pull/13955)
  * Remove the disabled autogenerated id optimization from InternalEngine [#13857](https://github.com/elastic/elasticsearch/pull/13857)



Exceptions 
    

  * Fix typos in exception/assert/log messages in core module. [#16649](https://github.com/elastic/elasticsearch/pull/16649)
  * Add field names to several mapping errors [#16508](https://github.com/elastic/elasticsearch/pull/16508) (issue: [#16378](https://github.com/elastic/elasticsearch/issues/16378)) 
  * Add serialization support for more important IOExceptions [#15766](https://github.com/elastic/elasticsearch/pull/15766)
  * Adds exception objects to log messages. [#14827](https://github.com/elastic/elasticsearch/pull/14827) (issue: [#10021](https://github.com/elastic/elasticsearch/issues/10021)) 
  * Add stack traces to logged exceptions where missing [#13825](https://github.com/elastic/elasticsearch/pull/13825) (issue: [#10021](https://github.com/elastic/elasticsearch/issues/10021)) 
  * Remove reflection hacks from ElasticsearchException [#13796](https://github.com/elastic/elasticsearch/pull/13796)
  * Rename QueryParsingException to a more generic ParsingException [#13631](https://github.com/elastic/elasticsearch/pull/13631)
  * Add *Exception(Throwable cause) constructors/ call where appropriate [#13544](https://github.com/elastic/elasticsearch/pull/13544) (issue: [#10021](https://github.com/elastic/elasticsearch/issues/10021)) 



Geo 
    

  * Fix a potential parsing problem in GeoDistanceSortParser [#17111](https://github.com/elastic/elasticsearch/pull/17111)
  * Geo: Add validation of shapes to ShapeBuilders [#15551](https://github.com/elastic/elasticsearch/pull/15551) (issue: [#14416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Make remaining ShapeBuilders implement Writeable [#15010](https://github.com/elastic/elasticsearch/pull/15010) (issue: [#14416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Geo: Remove internal `translated` flag from LineStringBuilder [#14969](https://github.com/elastic/elasticsearch/pull/14969)
  * Make PointBuilder, CircleBuilder  & EnvelopeBuilder implement Writable [#14933](https://github.com/elastic/elasticsearch/pull/14933) (issue: [#14416](https://github.com/elastic/elasticsearch/issues/14416)) 
  * Merging BaseLineString and BasePolygonBuilder with subclass [#14887](https://github.com/elastic/elasticsearch/pull/14887) (issue: [#14482](https://github.com/elastic/elasticsearch/issues/14482)) 
  * Moving static factory methods to ShapeBuilders [#14529](https://github.com/elastic/elasticsearch/pull/14529)
  * Remove InternalLineStringBuilder and InternalPolygonBuilder [#14482](https://github.com/elastic/elasticsearch/pull/14482) (issue: [#14416](https://github.com/elastic/elasticsearch/issues/14416)) 



Highlighting 
    

  * Switch Highlighting to ObjectParser [#17363](https://github.com/elastic/elasticsearch/pull/17363)
  * Use HighlightBuilder in SearchSourceBuilder [#15376](https://github.com/elastic/elasticsearch/pull/15376) (issue: [#15044](https://github.com/elastic/elasticsearch/issues/15044)) 
  * Joint parsing of common global Hightlighter and subfield parameters [#15368](https://github.com/elastic/elasticsearch/pull/15368) (issue: [#15285](https://github.com/elastic/elasticsearch/issues/15285)) 
  * Enable HighlightBuilder to create SearchContextHighlight [#15324](https://github.com/elastic/elasticsearch/pull/15324)
  * Add fromXContent method to HighlightBuilder [#15157](https://github.com/elastic/elasticsearch/pull/15157)



Ingest 
    

  * add automatic type conversion support to ConvertProcessor [#17263](https://github.com/elastic/elasticsearch/pull/17263) (issue: [#17139](https://github.com/elastic/elasticsearch/issues/17139)) 
  * Give the foreach processor access to the rest of the document [#17172](https://github.com/elastic/elasticsearch/pull/17172) (issue: [#17147](https://github.com/elastic/elasticsearch/issues/17147)) 
  * Added ingest statistics to node stats API [#16915](https://github.com/elastic/elasticsearch/pull/16915)
  * Add `ingest_took` to bulk response [#16876](https://github.com/elastic/elasticsearch/pull/16876)
  * Add ingest info to node info API, which contains a list of available processors [#16865](https://github.com/elastic/elasticsearch/pull/16865)
  * Use diffs for ingest metadata in cluster state [#16847](https://github.com/elastic/elasticsearch/pull/16847)
  * hide null-valued metadata fields from WriteableIngestDocument#toXContent [#16557](https://github.com/elastic/elasticsearch/pull/16557)
  * Ingest: use bulk thread pool for bulk request processing (was index before) [#16539](https://github.com/elastic/elasticsearch/pull/16539) (issue: [#16503](https://github.com/elastic/elasticsearch/issues/16503)) 
  * Add foreach processor [#16432](https://github.com/elastic/elasticsearch/pull/16432)
  * revert PipelineFactoryError handling with throwing ElasticsearchParseException in ingest pipeline creation [#16355](https://github.com/elastic/elasticsearch/pull/16355)
  * Add processor tags to on_failure metadata in ingest pipeline [#16324](https://github.com/elastic/elasticsearch/pull/16324) (issue: [#16202](https://github.com/elastic/elasticsearch/issues/16202)) 
  * catch processor/pipeline factory exceptions and return structured error responses [#16276](https://github.com/elastic/elasticsearch/pull/16276) (issue: [#16010](https://github.com/elastic/elasticsearch/issues/16010)) 
  * Ingest: move get/put/delete pipeline methods to ClusterAdminClient [#16242](https://github.com/elastic/elasticsearch/pull/16242)
  * Geoip processor: remove redundant latitude and longitude fields and make location an object with lat and lon subfields [#16173](https://github.com/elastic/elasticsearch/pull/16173)



Internal 
    

  * Remove PROTOTYPE from MLT.Item [#17481](https://github.com/elastic/elasticsearch/pull/17481) (issue: [#17085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPE from VersionType [#17480](https://github.com/elastic/elasticsearch/pull/17480) (issue: [#17085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPEs from highlighting [#17466](https://github.com/elastic/elasticsearch/pull/17466) (issue: [#17085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPEs from ingest [#17434](https://github.com/elastic/elasticsearch/pull/17434) (issue: [#17085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Start to rework query registration [#17424](https://github.com/elastic/elasticsearch/pull/17424)
  * Factor out slow logs into Search and IndexingOperationListeners [#17398](https://github.com/elastic/elasticsearch/pull/17398)
  * Remove PROTOTYPE from Suggesters [#17370](https://github.com/elastic/elasticsearch/pull/17370)
  * Remove PROTOTYPE from SortBuilders [#17337](https://github.com/elastic/elasticsearch/pull/17337) (issue: [#17085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Remove PROTOTYPE from ShapeBuilders [#17336](https://github.com/elastic/elasticsearch/pull/17336) (issue: [#17085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Replace FieldStatsProvider with a method on MappedFieldType. [#17334](https://github.com/elastic/elasticsearch/pull/17334)
  * Stop using PROTOTYPE in NamedWriteableRegistry [#17284](https://github.com/elastic/elasticsearch/pull/17284) (issue: [#17085](https://github.com/elastic/elasticsearch/issues/17085)) 
  * Support scheduled commands in current context [#17077](https://github.com/elastic/elasticsearch/pull/17077)
  * Thread limits [#17003](https://github.com/elastic/elasticsearch/pull/17003)
  * Remove leniency from segments info integrity checks [#16985](https://github.com/elastic/elasticsearch/pull/16985) (issue: [#16973](https://github.com/elastic/elasticsearch/issues/16973)) 
  * Rename SearchServiceTransportAction to SearchTransportService [#16880](https://github.com/elastic/elasticsearch/pull/16880)
  * Decouple the TransportService and ClusterService [#16872](https://github.com/elastic/elasticsearch/pull/16872) (issue: [#16788](https://github.com/elastic/elasticsearch/issues/16788)) 
  * Refactor bootstrap checks [#16844](https://github.com/elastic/elasticsearch/pull/16844) (issues: [#16733](https://github.com/elastic/elasticsearch/issues/16733), [#16835](https://github.com/elastic/elasticsearch/issues/16835)) 
  * Add LifecycleRunnable [#16752](https://github.com/elastic/elasticsearch/pull/16752)
  * Hot inlined methods in your area [#16725](https://github.com/elastic/elasticsearch/pull/16725)
  * Move IndicesQueryCache and IndicesRequestCache into IndicesService [#16603](https://github.com/elastic/elasticsearch/pull/16603)
  * Forbid use of java.security.MessageDigest#clone() [#16543](https://github.com/elastic/elasticsearch/pull/16543) (issue: [#16479](https://github.com/elastic/elasticsearch/issues/16479)) 
  * Make IndicesWarmer a private class of IndexService [#16470](https://github.com/elastic/elasticsearch/pull/16470)
  * Simplify IndicesFieldDataCache and detach from guice [#16469](https://github.com/elastic/elasticsearch/pull/16469)
  * Uppercase ells ( _L_ ) in long literals [#16329](https://github.com/elastic/elasticsearch/pull/16329) (issue: [#16279](https://github.com/elastic/elasticsearch/issues/16279)) 
  * ShardId equality and hash code inconsistency [#16319](https://github.com/elastic/elasticsearch/pull/16319) (issue: [#16217](https://github.com/elastic/elasticsearch/issues/16217)) 
  * Ensure all resources are closed on Node#close() [#16316](https://github.com/elastic/elasticsearch/pull/16316) (issue: [#13685](https://github.com/elastic/elasticsearch/issues/13685)) 
  * Make index uuid available in Index, ShardRouting & ShardId [#16217](https://github.com/elastic/elasticsearch/pull/16217)
  * Move RefreshTask into IndexService and use since task per index [#15933](https://github.com/elastic/elasticsearch/pull/15933)
  * Make IndexingMemoryController private to IndicesService [#15877](https://github.com/elastic/elasticsearch/pull/15877)
  * Cleanup IndexingOperationListeners infrastructure [#15875](https://github.com/elastic/elasticsearch/pull/15875)
  * Remove and forbid use of j.u.c.ThreadLocalRandom [#15862](https://github.com/elastic/elasticsearch/pull/15862) (issue: [#15294](https://github.com/elastic/elasticsearch/issues/15294)) 
  * Fix IntelliJ query builder type inference issues [#15429](https://github.com/elastic/elasticsearch/pull/15429)
  * Remove and forbid use of Collections#shuffle(List) and Random#<init>() [#15299](https://github.com/elastic/elasticsearch/pull/15299) (issue: [#15287](https://github.com/elastic/elasticsearch/issues/15287)) 
  * Remove and forbid use of the type-unsafe empty Collections fields [#15187](https://github.com/elastic/elasticsearch/pull/15187)
  * Move IndicesService.canDeleteShardContent to use IndexSettings [#15150](https://github.com/elastic/elasticsearch/pull/15150) (issue: [#15059](https://github.com/elastic/elasticsearch/issues/15059)) 
  * Simplify MonitorService construction and detach from guice [#15035](https://github.com/elastic/elasticsearch/pull/15035)
  * Use Supplier for StreamInput#readOptionalStreamable [#14806](https://github.com/elastic/elasticsearch/pull/14806)
  * Add variable-length long encoding [#14780](https://github.com/elastic/elasticsearch/pull/14780)
  * Extend usage of IndexSetting class [#14731](https://github.com/elastic/elasticsearch/pull/14731) (issue: [#14251](https://github.com/elastic/elasticsearch/issues/14251)) 
  * Fold SimilarityModule into IndexModule [#14284](https://github.com/elastic/elasticsearch/pull/14284)
  * Move to lucene BoostQuery [#14264](https://github.com/elastic/elasticsearch/pull/14264)
  * Use built-in method for computing hash code of longs [#14213](https://github.com/elastic/elasticsearch/pull/14213)
  * Refactor ShardFailure listener infrastructure [#14206](https://github.com/elastic/elasticsearch/pull/14206)
  * Add methods for variable-length encoding integral arrays [#14087](https://github.com/elastic/elasticsearch/pull/14087)
  * Fold IndexAliasesService into IndexService [#14044](https://github.com/elastic/elasticsearch/pull/14044)
  * Remove unneeded Module abstractions [#13944](https://github.com/elastic/elasticsearch/pull/13944)
  * Query refactoring: simplify IndexQueryParserService parse methods [#13938](https://github.com/elastic/elasticsearch/pull/13938) (issue: [#13859](https://github.com/elastic/elasticsearch/issues/13859)) 
  * Remove and forbid use of com.google.common.collect.Iterators [#13916](https://github.com/elastic/elasticsearch/pull/13916) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.ImmutableCollection [#13909](https://github.com/elastic/elasticsearch/pull/13909) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.io.Resources [#13908](https://github.com/elastic/elasticsearch/pull/13908) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.hash.* [#13907](https://github.com/elastic/elasticsearch/pull/13907) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.net.InetAddresses [#13905](https://github.com/elastic/elasticsearch/pull/13905) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.EvictingQueue [#13903](https://github.com/elastic/elasticsearch/pull/13903) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace Guava cache with simple concurrent LRU cache [#13879](https://github.com/elastic/elasticsearch/pull/13879)
  * Remove ClusterSerivce and IndexSettingsService dependency from IndexShard [#13853](https://github.com/elastic/elasticsearch/pull/13853)
  * Start making RecoverySourceHandler unittestable [#13840](https://github.com/elastic/elasticsearch/pull/13840)
  * Remove IndexService dep. from IndexShard [#13797](https://github.com/elastic/elasticsearch/pull/13797)
  * Remove ES internal deletion policies in favour of Lucenes implementations [#13794](https://github.com/elastic/elasticsearch/pull/13794)
  * Move ShardTermVectorService to be on indices level as TermVectorService [#13786](https://github.com/elastic/elasticsearch/pull/13786)
  * Move ShardPercolateService creation into IndexShard [#13777](https://github.com/elastic/elasticsearch/pull/13777)
  * Remove `ExpressionScriptCompilationException` and `ExpressionScriptExecutionException` [#13742](https://github.com/elastic/elasticsearch/pull/13742)
  * Reduced the number of ClusterStateUpdateTask variants [#13735](https://github.com/elastic/elasticsearch/pull/13735)
  * Add a BaseParser helper for stream parsing [#13615](https://github.com/elastic/elasticsearch/pull/13615)
  * Remove and forbid use of com.google.common.primitives.Ints [#13596](https://github.com/elastic/elasticsearch/pull/13596) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.math.LongMath [#13575](https://github.com/elastic/elasticsearch/pull/13575) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.base.Joiner [#13572](https://github.com/elastic/elasticsearch/pull/13572) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace and ban next batch of Guava classes [#13562](https://github.com/elastic/elasticsearch/pull/13562) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Iterables [#13559](https://github.com/elastic/elasticsearch/pull/13559) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Replace LoadingCache usage with a simple ConcurrentHashMap [#13552](https://github.com/elastic/elasticsearch/pull/13552) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Use Supplier instead of Reflection [#13545](https://github.com/elastic/elasticsearch/pull/13545)
  * Remove and forbid use of com.google.common.base.Preconditions [#13540](https://github.com/elastic/elasticsearch/pull/13540) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of guava Function, Charsets, Collections2 [#13533](https://github.com/elastic/elasticsearch/pull/13533) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.ImmutableSortedMap [#13525](https://github.com/elastic/elasticsearch/pull/13525) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of several com.google.common.util. classes [#13524](https://github.com/elastic/elasticsearch/pull/13524) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Cleanup SearchRequest & SearchRequestBuilder [#13518](https://github.com/elastic/elasticsearch/pull/13518)
  * Remove and forbid use of com.google.common.collect.Queues [#13498](https://github.com/elastic/elasticsearch/pull/13498) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.base.Preconditions#checkNotNull [#13493](https://github.com/elastic/elasticsearch/pull/13493) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Sets [#13463](https://github.com/elastic/elasticsearch/pull/13463) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove and forbid use of com.google.common.collect.Maps [#13438](https://github.com/elastic/elasticsearch/pull/13438) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove use of underscore as an identifier [#13353](https://github.com/elastic/elasticsearch/pull/13353)
  * Remove and forbid the use of com.google.common.base.Predicate(s)? [#13349](https://github.com/elastic/elasticsearch/pull/13349) (issues: [#13224](https://github.com/elastic/elasticsearch/issues/13224), [#13314](https://github.com/elastic/elasticsearch/issues/13314)) 
  * This commit removes com.google.common.io [#13302](https://github.com/elastic/elasticsearch/pull/13302) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 



Java API 
    

  * Remove copy constructors from request classes and TransportMessage type [#16640](https://github.com/elastic/elasticsearch/pull/16640) (issue: [#15776](https://github.com/elastic/elasticsearch/issues/15776)) 



Mapping 
    

  * Add a soft limit on the mapping depth. [#17400](https://github.com/elastic/elasticsearch/pull/17400)
  * Disable fielddata on text fields by defaults. [#17386](https://github.com/elastic/elasticsearch/pull/17386)
  * Add limit to total number of fields in mapping [#17357](https://github.com/elastic/elasticsearch/pull/17357)
  * Make `parseMultiField` part of `parseField`. [#17313](https://github.com/elastic/elasticsearch/pull/17313)
  * Automatically add a sub keyword field to string dynamic mappings. [#17188](https://github.com/elastic/elasticsearch/pull/17188)
  * Remove friction from the mapping changes in 5.0. [#16991](https://github.com/elastic/elasticsearch/pull/16991)
  * Rework norms parameters for 5.0. [#16987](https://github.com/elastic/elasticsearch/pull/16987)
  * Moved dynamic field handling in doc parsing to end of parsing [#16798](https://github.com/elastic/elasticsearch/pull/16798)
  * Remove the MapperBuilders utility class. [#16609](https://github.com/elastic/elasticsearch/pull/16609)
  * Make the `index` property a boolean. [#16161](https://github.com/elastic/elasticsearch/pull/16161)
  * Remove the ability to enable doc values with the `fielddata.format` setting. [#16147](https://github.com/elastic/elasticsearch/pull/16147)
  * Be stricter about parsing boolean values in mappings. [#16146](https://github.com/elastic/elasticsearch/pull/16146)
  * Fix default doc values to be enabled when a field is not indexed. [#16141](https://github.com/elastic/elasticsearch/pull/16141)
  * Dynamically map floating-point numbers as floats instead of doubles. [#15319](https://github.com/elastic/elasticsearch/pull/15319) (issue: [#13851](https://github.com/elastic/elasticsearch/issues/13851)) 
  * Simplify MetaDataMappingService. [#15217](https://github.com/elastic/elasticsearch/pull/15217)
  * Remove MergeMappingException. [#15177](https://github.com/elastic/elasticsearch/pull/15177)



Packaging 
    

  * Added RPM metadata [#17477](https://github.com/elastic/elasticsearch/pull/17477)
  * Elasticsearch ownership for data, logs, and configs [#17197](https://github.com/elastic/elasticsearch/pull/17197) (issue: [#12688](https://github.com/elastic/elasticsearch/issues/12688)) 
  * Fail early on JDK with compiler bug [#16418](https://github.com/elastic/elasticsearch/pull/16418) (issues: [#16097](https://github.com/elastic/elasticsearch/issues/16097), [#16362](https://github.com/elastic/elasticsearch/issues/16362)) 
  * Make security non-optional [#16176](https://github.com/elastic/elasticsearch/pull/16176)
  * Remove RuntimePermission("accessDeclaredMembers") [#15378](https://github.com/elastic/elasticsearch/pull/15378)
  * Remove Guava as a dependency [#14055](https://github.com/elastic/elasticsearch/pull/14055) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 
  * Remove Guava as a dependency [#14054](https://github.com/elastic/elasticsearch/pull/14054) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 



Percolator 
    

  * Add scoring support to the percolator query [#17385](https://github.com/elastic/elasticsearch/pull/17385) (issue: [#13827](https://github.com/elastic/elasticsearch/issues/13827)) 
  * Add query extract support for the blended term query and the common terms query [#17347](https://github.com/elastic/elasticsearch/pull/17347)
  * Add support for several span queries in ExtractQueryTermsService [#17323](https://github.com/elastic/elasticsearch/pull/17323)
  * Add support for TermsQuery in ExtractQueryTermsService [#17316](https://github.com/elastic/elasticsearch/pull/17316)
  * Replace percolate APIs with a percolator query [#16349](https://github.com/elastic/elasticsearch/pull/16349) (issues: [#10741](https://github.com/elastic/elasticsearch/issues/10741), [#11264](https://github.com/elastic/elasticsearch/issues/11264), [#13176](https://github.com/elastic/elasticsearch/issues/13176), [#13978](https://github.com/elastic/elasticsearch/issues/13978), [#4317](https://github.com/elastic/elasticsearch/issues/4317), [#7297](https://github.com/elastic/elasticsearch/issues/7297)) 



Plugin Analysis Kuromoji 
    

  * Add nbest options and NumberFilter [#17173](https://github.com/elastic/elasticsearch/pull/17173)



Plugin Discovery EC2 
    

  * Add support for proxy authentication for s3 and ec2 [#15293](https://github.com/elastic/elasticsearch/pull/15293) (issue: [#15268](https://github.com/elastic/elasticsearch/issues/15268)) 



Plugin Ingest Attachment 
    

  * Minor attachment processor improvements [#16574](https://github.com/elastic/elasticsearch/pull/16574)



Plugin Lang Painless 
    

  * Painless Clean Up [#17428](https://github.com/elastic/elasticsearch/pull/17428)
  * Make Painless a Module [#16755](https://github.com/elastic/elasticsearch/pull/16755)
  * Minor Clean up [#16457](https://github.com/elastic/elasticsearch/pull/16457)
  * Remove Extra String Concat Token [#16382](https://github.com/elastic/elasticsearch/pull/16382)



Plugin Mapper Attachment 
    

  * minor attachments cleanups: IDE test support and EPUB format [#14626](https://github.com/elastic/elasticsearch/pull/14626)



Plugin Repository Azure 
    

  * Support global `repositories.azure.` settings [#15141](https://github.com/elastic/elasticsearch/pull/15141) (issue: [#13776](https://github.com/elastic/elasticsearch/issues/13776)) 
  * Add timeout settings (default to 5 minutes) [#15080](https://github.com/elastic/elasticsearch/pull/15080) (issue: [#14277](https://github.com/elastic/elasticsearch/issues/14277)) 
  * Remove AbstractLegacyBlobContainer [#14650](https://github.com/elastic/elasticsearch/pull/14650) (issue: [#13434](https://github.com/elastic/elasticsearch/issues/13434)) 



Plugin Repository HDFS 
    

  * merge current hdfs improvements to master [#15588](https://github.com/elastic/elasticsearch/pull/15588)



Plugin Repository S3 
    

  * Check that S3 setting `buffer_size` is always lower than `chunk_size` [#17274](https://github.com/elastic/elasticsearch/pull/17274) (issue: [#17244](https://github.com/elastic/elasticsearch/issues/17244)) 



Plugins 
    

  * PluginManager: Add xpack as official plugin [#17227](https://github.com/elastic/elasticsearch/pull/17227)
  * CliTool: Cleanup and document Terminal [#16443](https://github.com/elastic/elasticsearch/pull/16443)
  * Plugin cli: Improve maven coordinates detection [#16384](https://github.com/elastic/elasticsearch/pull/16384) (issue: [#16376](https://github.com/elastic/elasticsearch/issues/16376)) 
  * Enforce plugin zip does not contain zip entries outside of the plugin dir [#16361](https://github.com/elastic/elasticsearch/pull/16361)
  * CliTool: Allow unexpected exceptions to propagate [#16359](https://github.com/elastic/elasticsearch/pull/16359)
  * Reduce complexity of plugin cli [#16336](https://github.com/elastic/elasticsearch/pull/16336)
  * Remove Plugin.onIndexService. [#15029](https://github.com/elastic/elasticsearch/pull/15029) (issue: [#14896](https://github.com/elastic/elasticsearch/issues/14896)) 
  * Open up QueryCache and SearcherWrapper extension points [#14303](https://github.com/elastic/elasticsearch/pull/14303)



Query DSL 
    

  * An `exists` query on an object should query a single term. [#17186](https://github.com/elastic/elasticsearch/pull/17186) (issue: [#17131](https://github.com/elastic/elasticsearch/issues/17131)) 
  * Function Score Query: make parsing stricter [#16617](https://github.com/elastic/elasticsearch/pull/16617) (issue: [#16583](https://github.com/elastic/elasticsearch/issues/16583)) 
  * Parsers should throw exception on unknown objects [#14255](https://github.com/elastic/elasticsearch/pull/14255) (issue: [#10974](https://github.com/elastic/elasticsearch/issues/10974)) 
  * UNICODE_CHARACTER_CLASS fix [#11598](https://github.com/elastic/elasticsearch/pull/11598) (issue: [#10146](https://github.com/elastic/elasticsearch/issues/10146)) 



Query Refactoring 
    

  * Add infrastructure to rewrite query builders [#16599](https://github.com/elastic/elasticsearch/pull/16599)
  * Switch geo validation to enum [#13672](https://github.com/elastic/elasticsearch/pull/13672) (issue: [#13608](https://github.com/elastic/elasticsearch/issues/13608)) 



REST 
    

  * More robust handling of CORS HTTP Access Control [#16092](https://github.com/elastic/elasticsearch/pull/16092)
  * Add option to exclude based on paths in XContent [#16017](https://github.com/elastic/elasticsearch/pull/16017)



Recovery 
    

  * Recover broken IndexMetaData as closed [#17187](https://github.com/elastic/elasticsearch/pull/17187)
  * Relocation source should be marked as relocating before starting recovery to primary relocation target [#16500](https://github.com/elastic/elasticsearch/pull/16500)
  * Operation counter for IndexShard [#15956](https://github.com/elastic/elasticsearch/pull/15956) (issue: [#15900](https://github.com/elastic/elasticsearch/issues/15900)) 
  * Primary relocation handoff [#15900](https://github.com/elastic/elasticsearch/pull/15900) (issue: [#15532](https://github.com/elastic/elasticsearch/issues/15532)) 
  * Remove recovery threadpools and throttle outgoing recoveries on the master [#15372](https://github.com/elastic/elasticsearch/pull/15372)
  * Refactor StoreRecoveryService to be a simple package private util class [#13766](https://github.com/elastic/elasticsearch/pull/13766)



Reindex API 
    

  * Make reindex throttling dynamic [#17262](https://github.com/elastic/elasticsearch/pull/17262)
  * Throttling support for reindex [#17039](https://github.com/elastic/elasticsearch/pull/17039)
  * Add ingest pipeline support to reindex [#16932](https://github.com/elastic/elasticsearch/pull/16932)



Scripting 
    

  * Skipping hidden files compilation for script service [#16286](https://github.com/elastic/elasticsearch/pull/16286) (issue: [#15269](https://github.com/elastic/elasticsearch/issues/15269)) 
  * Rename Plan A to Painless [#16245](https://github.com/elastic/elasticsearch/pull/16245)
  * Add plumbing for script compile-time parameters [#15464](https://github.com/elastic/elasticsearch/pull/15464)
  * Factor mustache → modules/lang-mustache [#15328](https://github.com/elastic/elasticsearch/pull/15328)



Search 
    

  * Add a soft limit on the number of shards that can be queried in a single search request. [#17396](https://github.com/elastic/elasticsearch/pull/17396)
  * Type filters should not have a performance impact when there is a single type. [#17350](https://github.com/elastic/elasticsearch/pull/17350)
  * Store _all payloads on 1 byte instead of 4. [#16899](https://github.com/elastic/elasticsearch/pull/16899)
  * Refuse to load fields from _source when using the `fields` option and support wildcards. [#15017](https://github.com/elastic/elasticsearch/pull/15017) (issues: [#10783](https://github.com/elastic/elasticsearch/issues/10783), [#14489](https://github.com/elastic/elasticsearch/issues/14489)) 
  * Add response into ClearScrollResponse [#13835](https://github.com/elastic/elasticsearch/pull/13835) (issue: [#13817](https://github.com/elastic/elasticsearch/issues/13817)) 
  * Shuffle shards for _only_nodes + support multiple specifications like cluster API [#12575](https://github.com/elastic/elasticsearch/pull/12575) (issues: [#12546](https://github.com/elastic/elasticsearch/issues/12546), [#12700](https://github.com/elastic/elasticsearch/issues/12700)) 



Search Refactoring 
    

  * Remove RescoreParseElement [#17441](https://github.com/elastic/elasticsearch/pull/17441)
  * Remove HighlighterParseElement [#17303](https://github.com/elastic/elasticsearch/pull/17303)
  * Move top level parsing of sort element to SortBuilder [#17248](https://github.com/elastic/elasticsearch/pull/17248)
  * Switch to using refactored SortBuilder instead of using BytesReference in serialization [#17205](https://github.com/elastic/elasticsearch/pull/17205) (issues: [#17146](https://github.com/elastic/elasticsearch/issues/17146), [#17257](https://github.com/elastic/elasticsearch/issues/17257)) 
  * Add build() method to SortBuilder implementations [#17146](https://github.com/elastic/elasticsearch/pull/17146) (issue: [#10217](https://github.com/elastic/elasticsearch/issues/10217)) 
  * Refactoring of Suggestions [#17096](https://github.com/elastic/elasticsearch/pull/17096) (issue: [#10217](https://github.com/elastic/elasticsearch/issues/10217)) 
  * Move sort `order` field up into SortBuilder [#17035](https://github.com/elastic/elasticsearch/pull/17035)
  * Moves SortParser:parse(…) to only require QueryShardContext [#16999](https://github.com/elastic/elasticsearch/pull/16999) (issue: [#15178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Change internal representation of suggesters [#16873](https://github.com/elastic/elasticsearch/pull/16873)
  * Make GeoDistanceSortBuilder serializable, 2nd try [#16572](https://github.com/elastic/elasticsearch/pull/16572) (issues: [#15178](https://github.com/elastic/elasticsearch/issues/15178), [#16151](https://github.com/elastic/elasticsearch/issues/16151)) 
  * Move missing() from SortBuilder interface to class [#16225](https://github.com/elastic/elasticsearch/pull/16225) (issues: [#15178](https://github.com/elastic/elasticsearch/issues/15178), [#16151](https://github.com/elastic/elasticsearch/issues/16151)) 
  * Remove deprecated parameters from ScriptSortBuilder [#16153](https://github.com/elastic/elasticsearch/pull/16153) (issue: [#15178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Refactor GeoSortBuilder [#16151](https://github.com/elastic/elasticsearch/pull/16151) (issue: [#15178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Refactor FieldSortBuilder [#16127](https://github.com/elastic/elasticsearch/pull/16127) (issue: [#15178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Make sort order enum writable. [#16124](https://github.com/elastic/elasticsearch/pull/16124) (issue: [#15178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * Make DistanceUnit writable. [#16122](https://github.com/elastic/elasticsearch/pull/16122) (issue: [#15178](https://github.com/elastic/elasticsearch/issues/15178)) 
  * RescoreBuilder: Add parsing and creating of RescoreSearchContext [#16014](https://github.com/elastic/elasticsearch/pull/16014) (issue: [#15559](https://github.com/elastic/elasticsearch/issues/15559)) 
  * Make RescoreBuilder and nested QueryRescorer Writable [#15953](https://github.com/elastic/elasticsearch/pull/15953) (issue: [#15559](https://github.com/elastic/elasticsearch/issues/15559)) 
  * Explain api: move query parsing to the coordinating node [#14270](https://github.com/elastic/elasticsearch/pull/14270)
  * Switch query parsers to use ParseField [#14249](https://github.com/elastic/elasticsearch/pull/14249) (issue: [#8964](https://github.com/elastic/elasticsearch/issues/8964)) 
  * Refactoring of Aggregations [#14136](https://github.com/elastic/elasticsearch/pull/14136)



Settings 
    

  * Add guard against null-valued settings [#17310](https://github.com/elastic/elasticsearch/pull/17310) (issue: [#17292](https://github.com/elastic/elasticsearch/issues/17292)) 
  * Useful error message for null property placeholder [#17293](https://github.com/elastic/elasticsearch/pull/17293) (issue: [#17292](https://github.com/elastic/elasticsearch/issues/17292)) 
  * Archive cluster level settings if unknown or broken [#17246](https://github.com/elastic/elasticsearch/pull/17246)
  * Improve error message if setting is not found [#17230](https://github.com/elastic/elasticsearch/pull/17230)
  * Improve upgrade experience of node level index settings [#17223](https://github.com/elastic/elasticsearch/pull/17223) (issue: [#17187](https://github.com/elastic/elasticsearch/issues/17187)) 
  * Settings with complex matchers should not overlap [#16754](https://github.com/elastic/elasticsearch/pull/16754)
  * Moves GCE settings to the new infra [#16722](https://github.com/elastic/elasticsearch/pull/16722) (issue: [#16720](https://github.com/elastic/elasticsearch/issues/16720)) 
  * Add filtering support within Setting class [#16629](https://github.com/elastic/elasticsearch/pull/16629) (issue: [#16598](https://github.com/elastic/elasticsearch/issues/16598)) 
  * Migrate AWS settings to new settings infrastructure [#16602](https://github.com/elastic/elasticsearch/pull/16602) (issue: [#16293](https://github.com/elastic/elasticsearch/issues/16293)) 
  * Remove `gateway.initial_meta` and always rely on min master nodes [#16446](https://github.com/elastic/elasticsearch/pull/16446)
  * Rewrite SettingsFilter to be immutable [#16425](https://github.com/elastic/elasticsearch/pull/16425)
  * Simplify azure settings [#16363](https://github.com/elastic/elasticsearch/pull/16363)
  * Convert PageCacheRecycler settings [#16341](https://github.com/elastic/elasticsearch/pull/16341)
  * Monitor settings [#16313](https://github.com/elastic/elasticsearch/pull/16313)
  * Cut over tribe node settings to new settings infra [#16311](https://github.com/elastic/elasticsearch/pull/16311)
  * Convert multcast plugin settings to the new infra [#16295](https://github.com/elastic/elasticsearch/pull/16295)
  * Convert `request.headers.*` to the new settings infra [#16292](https://github.com/elastic/elasticsearch/pull/16292)
  * Migrate Azure settings to new settings infrastructure [#16291](https://github.com/elastic/elasticsearch/pull/16291)
  * Validate logger settings and allow them to be reset via API [#16289](https://github.com/elastic/elasticsearch/pull/16289)
  * Switch NodeEnvironment’s settings to new settings [#16273](https://github.com/elastic/elasticsearch/pull/16273)
  * Simplify AutoCreateIndex and add more tests [#16270](https://github.com/elastic/elasticsearch/pull/16270)
  * Convert several pending settings [#16269](https://github.com/elastic/elasticsearch/pull/16269)
  * Migrate query caching settings to the new settings infra. [#16267](https://github.com/elastic/elasticsearch/pull/16267)
  * Convert `action.auto_create_index` and `action.master.force_local` to the new settings infra [#16263](https://github.com/elastic/elasticsearch/pull/16263)
  * Convert `cluster.routing.allocation.type` and `processors` to the new settings infra. [#16238](https://github.com/elastic/elasticsearch/pull/16238)
  * Validate tribe node settings on startup [#16237](https://github.com/elastic/elasticsearch/pull/16237)
  * Move node.client, node.data, node.master, node.local and node.mode to new settings infra [#16230](https://github.com/elastic/elasticsearch/pull/16230)
  * Moved http settings to the new settings infrastructure [#16188](https://github.com/elastic/elasticsearch/pull/16188)
  * Migrate network service to the new infra [#16187](https://github.com/elastic/elasticsearch/pull/16187)
  * Convert client.transport settings to new infra [#16183](https://github.com/elastic/elasticsearch/pull/16183)
  * Move discovery.* settings to new Setting infrastructure [#16182](https://github.com/elastic/elasticsearch/pull/16182)
  * Change over to o.e.common.settings.Setting for http settings [#16181](https://github.com/elastic/elasticsearch/pull/16181)
  * Convert "path.*" and "pidfile" to new settings infra [#16180](https://github.com/elastic/elasticsearch/pull/16180)
  * Migrate repository settings to the new settings API [#16178](https://github.com/elastic/elasticsearch/pull/16178)
  * Convert "indices.*" settings to new infra. [#16177](https://github.com/elastic/elasticsearch/pull/16177)
  * Migrate gateway settings to the new settings API. [#16175](https://github.com/elastic/elasticsearch/pull/16175)
  * Convert several node and test level settings [#16172](https://github.com/elastic/elasticsearch/pull/16172)
  * Run Metadata upgrade tool on every version [#16168](https://github.com/elastic/elasticsearch/pull/16168)
  * Check for invalid index settings on metadata upgrade [#16156](https://github.com/elastic/elasticsearch/pull/16156)
  * Validate the settings key if it’s simple chars separated by `.` [#16120](https://github.com/elastic/elasticsearch/pull/16120)
  * Validate known global settings on startup [#16091](https://github.com/elastic/elasticsearch/pull/16091)
  * Cut over all index scope settings to the new setting infrastrucuture [#16054](https://github.com/elastic/elasticsearch/pull/16054) (issues: [#12790](https://github.com/elastic/elasticsearch/issues/12790), [#12854](https://github.com/elastic/elasticsearch/issues/12854), [#16032](https://github.com/elastic/elasticsearch/issues/16032), [#6732](https://github.com/elastic/elasticsearch/issues/6732)) 
  * Remove updatability of `index.flush_on_close` [#15964](https://github.com/elastic/elasticsearch/pull/15964) (issue: [#15955](https://github.com/elastic/elasticsearch/issues/15955)) 
  * Move all dynamic settings and their config classes to the index level [#15955](https://github.com/elastic/elasticsearch/pull/15955) (issue: [#6732](https://github.com/elastic/elasticsearch/issues/6732)) 
  * Always require units for bytes and time settings [#15948](https://github.com/elastic/elasticsearch/pull/15948) (issue: [#11437](https://github.com/elastic/elasticsearch/issues/11437)) 
  * Make MetaData parsing less lenient. [#15828](https://github.com/elastic/elasticsearch/pull/15828)
  * Move async translog sync logic into IndexService [#15584](https://github.com/elastic/elasticsearch/pull/15584)
  * Remove `index.merge.scheduler.notify_on_failure` and default to `true` [#15572](https://github.com/elastic/elasticsearch/pull/15572) (issue: [#15570](https://github.com/elastic/elasticsearch/issues/15570)) 
  * Remove cache concurrency level settings that no longer apply [#14210](https://github.com/elastic/elasticsearch/pull/14210) (issues: [#13224](https://github.com/elastic/elasticsearch/issues/13224), [#13717](https://github.com/elastic/elasticsearch/issues/13717), [#7836](https://github.com/elastic/elasticsearch/issues/7836)) 



Similarities 
    

  * Defining a global default similarity [#16682](https://github.com/elastic/elasticsearch/pull/16682) (issue: [#16594](https://github.com/elastic/elasticsearch/issues/16594)) 



Stats 
    

  * Normalize unavailable load average [#16061](https://github.com/elastic/elasticsearch/pull/16061) (issues: [#12049](https://github.com/elastic/elasticsearch/issues/12049), [#14741](https://github.com/elastic/elasticsearch/issues/14741), [#15907](https://github.com/elastic/elasticsearch/issues/15907), [#15932](https://github.com/elastic/elasticsearch/issues/15932), [#15934](https://github.com/elastic/elasticsearch/issues/15934)) 
  * Add load averages to OS stats on FreeBSD [#15934](https://github.com/elastic/elasticsearch/pull/15934) (issue: [#15917](https://github.com/elastic/elasticsearch/issues/15917)) 
  * Expose pending cluster state queue size in node stats [#14040](https://github.com/elastic/elasticsearch/pull/14040) (issue: [#13610](https://github.com/elastic/elasticsearch/issues/13610)) 



Store 
    

  * Remove support for legacy checksums [#16931](https://github.com/elastic/elasticsearch/pull/16931)
  * Rename index folder to index_uuid [#16442](https://github.com/elastic/elasticsearch/pull/16442) (issues: [#13264](https://github.com/elastic/elasticsearch/issues/13264), [#13265](https://github.com/elastic/elasticsearch/issues/13265), [#14512](https://github.com/elastic/elasticsearch/issues/14512), [#14932](https://github.com/elastic/elasticsearch/issues/14932), [#15853](https://github.com/elastic/elasticsearch/issues/15853)) 



Task Manager 
    

  * Add ability to group tasks by common parent [#17341](https://github.com/elastic/elasticsearch/pull/17341)
  * Add start time and duration to tasks [#16829](https://github.com/elastic/elasticsearch/pull/16829)
  * Combine node name and task id into single string task id [#16744](https://github.com/elastic/elasticsearch/pull/16744)
  * Add task status [#16356](https://github.com/elastic/elasticsearch/pull/16356) (issue: [#16344](https://github.com/elastic/elasticsearch/issues/16344)) 
  * Extend tracking of parent tasks to master node, replication and broadcast actions [#15931](https://github.com/elastic/elasticsearch/pull/15931)



Translog 
    

  * Remove ChannelReference and simplify Views [#15898](https://github.com/elastic/elasticsearch/pull/15898)
  * Simplify TranslogWriter to always write to a stream [#15771](https://github.com/elastic/elasticsearch/pull/15771)
  * Remove TranslogService and fold it into synchronous IndexShard API [#13707](https://github.com/elastic/elasticsearch/pull/13707)



### Bug fixes

Aggregations 
    

  * Fixes the defaults for `keyed` in the percentiles aggregations [#17217](https://github.com/elastic/elasticsearch/pull/17217)
  * Correct typo in class name of StatsAggregator [#15264](https://github.com/elastic/elasticsearch/pull/15264) (issue: [#14730](https://github.com/elastic/elasticsearch/issues/14730)) 



Allocation 
    

  * Replica shards must be failed before primary shards [#15686](https://github.com/elastic/elasticsearch/pull/15686)



CRUD 
    

  * Prevent TransportReplicationAction to route request based on stale local routing table [#16274](https://github.com/elastic/elasticsearch/pull/16274) (issues: [#12573](https://github.com/elastic/elasticsearch/issues/12573), [#12574](https://github.com/elastic/elasticsearch/issues/12574)) 
  * Resolves the conflict between alias routing and parent routing by applying the alias routing and ignoring the parent routing. [#15371](https://github.com/elastic/elasticsearch/pull/15371) (issue: [#3068](https://github.com/elastic/elasticsearch/issues/3068)) 



Cluster 
    

  * Shard state action channel exceptions [#16057](https://github.com/elastic/elasticsearch/pull/16057) (issue: [#15748](https://github.com/elastic/elasticsearch/issues/15748)) 



Core 
    

  * Handle RejectedExecution gracefully in TransportService during shutdown [#16965](https://github.com/elastic/elasticsearch/pull/16965)



Geo 
    

  * Fix multi-field support for GeoPoint types [#15702](https://github.com/elastic/elasticsearch/pull/15702) (issue: [#15701](https://github.com/elastic/elasticsearch/issues/15701)) 
  * Enforce distance in distance query is > 0 [ISSUE] [#15135](https://github.com/elastic/elasticsearch/pull/15135)



Ingest 
    

  * Handle regex parsing errors in Gsub and Grok Processors [#17260](https://github.com/elastic/elasticsearch/pull/17260)
  * add on_failure exception metadata to ingest document for verbose simulate [#16562](https://github.com/elastic/elasticsearch/pull/16562)
  * The IngestDocument copy constructor should make a deep copy [#16248](https://github.com/elastic/elasticsearch/pull/16248) (issue: [#16246](https://github.com/elastic/elasticsearch/issues/16246)) 



Internal 
    

  * Enable unmap hack for java 9 [#16986](https://github.com/elastic/elasticsearch/pull/16986) (issue: [#1](https://github.com/elastic/elasticsearch/issues/1)) 
  * Fix issues with failed cache loads [#14315](https://github.com/elastic/elasticsearch/pull/14315)
  * Allow parser to move on the START_OBJECT token when parsing search source [#14145](https://github.com/elastic/elasticsearch/pull/14145)
  * Ensure searcher is release if wrapping fails [#14107](https://github.com/elastic/elasticsearch/pull/14107)
  * Avoid deadlocks in Cache#computeIfAbsent [#14091](https://github.com/elastic/elasticsearch/pull/14091) (issue: [#14090](https://github.com/elastic/elasticsearch/issues/14090)) 



Java API 
    

  * Fix potential NPE in SearchSourceBuilder [#16905](https://github.com/elastic/elasticsearch/pull/16905) (issue: [#16902](https://github.com/elastic/elasticsearch/issues/16902)) 



Mapping 
    

  * Make dynamic template parsing less lenient. [#17249](https://github.com/elastic/elasticsearch/pull/17249)
  * Fix dynamic mapper when its parent already has an update [#17065](https://github.com/elastic/elasticsearch/pull/17065)
  * Fix copy_to when the target is a dynamic object field. [#15216](https://github.com/elastic/elasticsearch/pull/15216) (issues: [#111237](https://github.com/elastic/elasticsearch/issues/111237), [#11237](https://github.com/elastic/elasticsearch/issues/11237)) 
  * Preserve existing mappings on batch mapping updates [#15130](https://github.com/elastic/elasticsearch/pull/15130) (issues: [#14899](https://github.com/elastic/elasticsearch/issues/14899), [#15129](https://github.com/elastic/elasticsearch/issues/15129)) 



Packaging 
    

  * Set MAX_OPEN_FILES to 65536 [#17431](https://github.com/elastic/elasticsearch/pull/17431) (issue: [#17430](https://github.com/elastic/elasticsearch/issues/17430)) 
  * [windows] Service command still had positional start command [#17391](https://github.com/elastic/elasticsearch/pull/17391)
  * Do not pass double-dash arguments on startup [#17087](https://github.com/elastic/elasticsearch/pull/17087) (issue: [#17084](https://github.com/elastic/elasticsearch/issues/17084)) 



Percolator 
    

  * Let PercolatorQuery’s explain use the two phase iterator [#17315](https://github.com/elastic/elasticsearch/pull/17315) (issue: [#17314](https://github.com/elastic/elasticsearch/issues/17314)) 



Plugin Store SMB 
    

  * Fix calling ensureOpen() on the wrong directory (master forwardport) [#16395](https://github.com/elastic/elasticsearch/pull/16395) (issue: [#16383](https://github.com/elastic/elasticsearch/issues/16383)) 



Plugins 
    

  * CliTool: Messages printed in Terminal should have percent char escaped [#16367](https://github.com/elastic/elasticsearch/pull/16367)



Query DSL 
    

  * Resolve string dates and date math to millis before evaluating for rewrite in range query [#17239](https://github.com/elastic/elasticsearch/pull/17239)
  * `constant_score` query should throw error on more than one filter [#17135](https://github.com/elastic/elasticsearch/pull/17135) (issue: [#17126](https://github.com/elastic/elasticsearch/issues/17126)) 
  * Single IPv4 addresses in IP field term queries [#16068](https://github.com/elastic/elasticsearch/pull/16068) (issue: [#16058](https://github.com/elastic/elasticsearch/issues/16058)) 
  * Make strategy optional in GeoShapeQueryBuilder readFrom and writeTo [#13963](https://github.com/elastic/elasticsearch/pull/13963)



Query Refactoring 
    

  * Query refactoring: set has_parent & has_child types context properly [#13863](https://github.com/elastic/elasticsearch/pull/13863)
  * Make sure equivalent geohashCellQueries are equal after toQuery called [#13792](https://github.com/elastic/elasticsearch/pull/13792)



Recovery 
    

  * Invoke `IndexingOperationListeners` also when recovering from store or remote [#17406](https://github.com/elastic/elasticsearch/pull/17406)
  * Prevent interruption while store checks lucene files for consistency [#16308](https://github.com/elastic/elasticsearch/pull/16308)
  * Mark shard as recovering on the cluster state thread [#14276](https://github.com/elastic/elasticsearch/pull/14276) (issues: [#13766](https://github.com/elastic/elasticsearch/issues/13766), [#14115](https://github.com/elastic/elasticsearch/issues/14115)) 



Search 
    

  * Fix for search after [#16271](https://github.com/elastic/elasticsearch/pull/16271)
  * Do not be lenient when parsing CIDRs [#14874](https://github.com/elastic/elasticsearch/pull/14874) (issue: [#14862](https://github.com/elastic/elasticsearch/issues/14862)) 



Settings 
    

  * Register bootstrap settings [#16513](https://github.com/elastic/elasticsearch/pull/16513)
  * Add settings filtering to node info requests [#16445](https://github.com/elastic/elasticsearch/pull/16445)
  * Ban write access to system properties [#14914](https://github.com/elastic/elasticsearch/pull/14914)



Task Manager 
    

  * Take filterNodeIds into consideration while sending task requests to nodes [#17081](https://github.com/elastic/elasticsearch/pull/17081)



Translog 
    

  * Move translog recover outside of the engine [#17422](https://github.com/elastic/elasticsearch/pull/17422)
  * Mark shard active during recovery; push settings after engine finally inits [#16250](https://github.com/elastic/elasticsearch/pull/16250) (issues: [#14121](https://github.com/elastic/elasticsearch/issues/14121), [#16209](https://github.com/elastic/elasticsearch/issues/16209)) 



### Upgrades

Core 
    

  * Upgrade to lucene-6.0.0-f0aa4fc. [#17075](https://github.com/elastic/elasticsearch/pull/17075)
  * upgrade to lucene 6.0.0-snapshot-bea235f [#16964](https://github.com/elastic/elasticsearch/pull/16964)
  * Upgrade to Jackson 2.7.1 [#16801](https://github.com/elastic/elasticsearch/pull/16801) (issue: [#16294](https://github.com/elastic/elasticsearch/issues/16294)) 



Ingest 
    

  * Update MaxMind geoip2 version to 2.6 [#16837](https://github.com/elastic/elasticsearch/pull/16837) (issue: [#16801](https://github.com/elastic/elasticsearch/issues/16801)) 



Internal 
    

  * Bump master (3.0-snapshot) to java 8 [#13314](https://github.com/elastic/elasticsearch/pull/13314)



Search Templates 
    

  * Update mustache.java to version 0.9.1 [#14053](https://github.com/elastic/elasticsearch/pull/14053) (issue: [#13224](https://github.com/elastic/elasticsearch/issues/13224)) 


